import{u as T,a as V,j as e,F as d,G as c,C as v,S as P,b as D,f as H,d as L,e as O,c as R,r as q,R as G,n as k,g as I,P as _,B as C,L as z,da as F,s as B,A as K,q as W}from"./index-a3421f29.js";import{D as $}from"./DynamicComponents-72877b30.js";import{F as J}from"./FormAccess-1cceaef6.js";import{K as y}from"./KeycloakTextInput-e7f6e917.js";import{u as M}from"./useParams-5abeab7d.js";import{E as Q}from"./ExtendedHeader-d25be090.js";import{S as X}from"./SettingsCache-d185f52c.js";import{A as Y}from"./Form-518a2cf2.js";import"./ClientSelect-3f0fc581.js";import"./Select-0f56a9cc.js";import"./check-fc57dbe1.js";import"./star-icon-6a7e7d25.js";import"./FileUpload-ca37c1a6.js";import"./CodeEditor-2fb93648.js";import"./copy-icon-a4fe01af.js";import"./EmptyStateBody-7b4fcee1.js";import"./EmptyStateSecondaryActions-08edafb5.js";import"./GroupPickerDialog-caf8c38d.js";import"./PaginatingTableToolbar-08ca9efb.js";import"./plus-circle-icon-cb854796.js";import"./TableToolbar-ee0c86ef.js";import"./ToolbarContent-7b435752.js";import"./DataListItemRow-75e02946.js";import"./data-list-7d55714c.js";import"./grip-vertical-icon-cbeff50f.js";import"./Modal-21c37af7.js";import"./ActionListItem-ab1a4322.js";import"./FlexItem-65b5f999.js";import"./minus-circle-icon-6f9a971c.js";import"./MultiLineInput-14187d1c.js";import"./PasswordInput-85f9399f.js";import"./useToggle-a9cb2c55.js";import"./AddRoleMappingModal-abb19beb.js";import"./KeycloakDataTable-10a62d94.js";import"./Td-6d4ab209.js";import"./Checkbox-d00621d8.js";import"./useLocaleSort-3efc7c31.js";import"./resource-08ae7dbc.js";import"./joinPath-55fd24bc.js";import"./filter-icon-9d72dc58.js";import"./ConfirmDialog-09ff7a12.js";import"./KeycloakTextArea-1b518857.js";import"./GridItem-d34dae2e.js";import"./ViewHeader-832ec56e.js";import"./Text-564bf299.js";import"./isEqual-69fbe00f.js";import"./NumberInput-85f36a0d.js";import"./minus-icon-16876c86.js";import"./plus-icon-2a767bad.js";const Z=()=>{const{t:r}=T("user-federation"),{control:i,register:s,watch:l}=V(),t=l("config.fullSyncPeriod","-1"),p=l("config.changedSyncPeriod","-1");return e.jsxs(e.Fragment,{children:[e.jsx(d,{label:r("periodicFullSync"),labelIcon:e.jsx(c,{helpText:r("user-federation-help:periodicFullSyncHelp"),fieldLabelId:"user-federation:periodicFullSync"}),fieldId:"kc-periodic-full-sync",hasNoPaddingTop:!0,children:e.jsx(v,{name:"config.fullSyncPeriod",defaultValue:"-1",control:i,render:({field:a})=>e.jsx(P,{id:"kc-periodic-full-sync","data-testid":"periodic-full-sync",onChange:n=>{a.onChange(n?"604800":"-1")},isChecked:a.value!=="-1",label:r("common:on"),labelOff:r("common:off"),"aria-label":r("periodicFullSync")})})}),t!=="-1"&&e.jsx(d,{hasNoPaddingTop:!0,label:r("fullSyncPeriod"),labelIcon:e.jsx(c,{helpText:r("user-federation-help:fullSyncPeriodHelp"),fieldLabelId:"user-federation:fullSyncPeriod"}),fieldId:"kc-full-sync-period",children:e.jsx(y,{type:"number",min:-1,defaultValue:"604800",id:"kc-full-sync-period","data-testid":"full-sync-period",...s("config.fullSyncPeriod")})}),e.jsx(d,{label:r("periodicChangedUsersSync"),labelIcon:e.jsx(c,{helpText:r("user-federation-help:periodicChangedUsersSyncHelp"),fieldLabelId:"user-federation:periodicChangedUsersSync"}),fieldId:"kc-periodic-changed-users-sync",hasNoPaddingTop:!0,children:e.jsx(v,{name:"config.changedSyncPeriod",defaultValue:"-1",control:i,render:({field:a})=>e.jsx(P,{id:"kc-periodic-changed-users-sync","data-testid":"periodic-changed-users-sync",onChange:n=>{a.onChange(n?"86400":"-1")},isChecked:a.value!=="-1",label:r("common:on"),labelOff:r("common:off"),"aria-label":r("periodicChangedUsersSync")})})}),p!=="-1"&&e.jsx(d,{label:r("changedUsersSyncPeriod"),labelIcon:e.jsx(c,{helpText:r("user-federation-help:changedUsersSyncHelp"),fieldLabelId:"user-federation:changedUsersSyncPeriod"}),fieldId:"kc-changed-users-sync-period",hasNoPaddingTop:!0,children:e.jsx(y,{type:"number",min:-1,defaultValue:"86400",id:"kc-changed-users-sync-period","data-testid":"changed-users-sync-period",...s("config.changedSyncPeriod")})})]})};function Me(){const{t:r}=T("user-federation"),{id:i,providerId:s}=M(),l=D(),t=H({mode:"onChange"}),{register:p,reset:a,setValue:n,handleSubmit:g,formState:{errors:x,isDirty:N}}=t,{adminClient:m}=L(),{addAlert:A,addError:U}=O(),{realm:u}=R(),[w,E]=q.useState(""),S=(G().componentTypes?.["org.keycloak.storage.UserStorageProvider"]||[]).find(o=>o.id===s);k(async()=>{if(i)return await m.components.findOne({id:i})},o=>{if(o)W(o,n);else if(i)throw new Error(r("common:notFound"))},[]),k(()=>m.realms.findOne({realm:u}),o=>E(o?.id),[]);const j=async o=>{const b=B({...o,config:Object.fromEntries(Object.entries(o.config||{}).map(([f,h])=>[f,Array.isArray(h)?h:[h]])),providerId:s,providerType:"org.keycloak.storage.UserStorageProvider",parentId:w});try{i?await m.components.update({id:i},b):(await m.components.create(b),l(F({realm:u}))),a({...o}),A(r(i?"saveSuccess":"createSuccess"),K.success)}catch(f){U(`user-federation:${i?"saveError":"createError"}`,f)}};return e.jsxs(I,{...t,children:[e.jsx(Q,{provider:s,save:()=>g(j)()}),e.jsx(_,{variant:"light",children:e.jsxs(J,{role:"manage-realm",isHorizontal:!0,className:"keycloak__user-federation__custom-form",onSubmit:g(j),children:[e.jsx(d,{label:r("uiDisplayName"),labelIcon:e.jsx(c,{helpText:r("user-federation-help:uiDisplayNameHelp"),fieldLabelId:"user-federation:uiDisplayName"}),helperTextInvalid:r("validateName"),validated:x.name?"error":"default",fieldId:"kc-ui-display-name",isRequired:!0,children:e.jsx(y,{isRequired:!0,id:"kc-ui-display-name","data-testid":"ui-name",validated:x.name?"error":"default",...p("name",{required:!0})})}),e.jsxs(I,{...t,children:[e.jsx($,{properties:S?.properties||[]}),S?.metadata.synchronizable&&e.jsx(Z,{})]}),e.jsx(X,{form:t,unWrap:!0}),e.jsxs(Y,{children:[e.jsx(C,{isDisabled:!N,variant:"primary",type:"submit","data-testid":"custom-save",children:r("common:save")}),e.jsx(C,{variant:"link",component:o=>e.jsx(z,{...o,to:F({realm:u})}),"data-testid":"custom-cancel",children:r("common:cancel")})]})]})})]})}export{Me as default};
//# sourceMappingURL=CustomProviderSettings-fb1bd744.js.map
