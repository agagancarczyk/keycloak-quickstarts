{"version":3,"file":"ClientScopeTypes-b557e5db.js","sources":["../../src/components/client-scope/ClientScopeTypes.tsx"],"sourcesContent":["import { useState } from \"react\";\n\nimport type { TFunction } from \"i18next\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  DropdownItem,\n  Select,\n  SelectOption,\n  SelectProps,\n} from \"@patternfly/react-core\";\n\nimport type ClientScopeRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/clientScopeRepresentation\";\nimport type KeycloakAdminClient from \"@keycloak/keycloak-admin-client\";\nimport { toUpperCase } from \"../../util\";\n\nexport enum ClientScope {\n  default = \"default\",\n  optional = \"optional\",\n}\n\nexport enum AllClientScopes {\n  none = \"none\",\n}\n\nexport type ClientScopeType = ClientScope;\nexport type AllClientScopeType = ClientScope | AllClientScopes;\n\nconst clientScopeTypes = Object.keys(ClientScope);\nexport const allClientScopeTypes = Object.keys({\n  ...AllClientScopes,\n  ...ClientScope,\n}) as AllClientScopeType[];\n\nexport const clientScopeTypesSelectOptions = (\n  t: TFunction,\n  scopeTypes: string[] | undefined = clientScopeTypes\n) =>\n  scopeTypes.map((type) => (\n    <SelectOption key={type} value={type}>\n      {t(`common:clientScope.${type}`)}\n    </SelectOption>\n  ));\n\nexport const clientScopeTypesDropdown = (\n  t: TFunction,\n  onClick: (scope: ClientScopeType) => void\n) =>\n  clientScopeTypes.map((type) => (\n    <DropdownItem key={type} onClick={() => onClick(type as ClientScopeType)}>\n      {t(`common:clientScope.${type}`)}\n    </DropdownItem>\n  ));\n\ntype CellDropdownProps = Omit<SelectProps, \"onToggle\"> & {\n  clientScope: ClientScopeRepresentation;\n  type: ClientScopeType | AllClientScopeType;\n  all?: boolean;\n  onSelect: (value: ClientScopeType | AllClientScopeType) => void;\n};\n\nexport const CellDropdown = ({\n  clientScope,\n  type,\n  onSelect,\n  all = false,\n  ...props\n}: CellDropdownProps) => {\n  const { t } = useTranslation();\n  const [open, setOpen] = useState(false);\n\n  return (\n    <Select\n      className={`keycloak__client-scope__${type}`}\n      key={clientScope.id}\n      onToggle={() => setOpen(!open)}\n      isOpen={open}\n      selections={[type]}\n      onSelect={(_, value) => {\n        onSelect(\n          all ? (value as ClientScopeType) : (value as AllClientScopeType)\n        );\n        setOpen(false);\n      }}\n      {...props}\n    >\n      {clientScopeTypesSelectOptions(\n        t,\n        all ? allClientScopeTypes : clientScopeTypes\n      )}\n    </Select>\n  );\n};\n\nexport type ClientScopeDefaultOptionalType = ClientScopeRepresentation & {\n  type: AllClientScopeType;\n};\n\nexport const changeScope = async (\n  adminClient: KeycloakAdminClient,\n  clientScope: ClientScopeDefaultOptionalType,\n  changeTo: AllClientScopeType\n) => {\n  await removeScope(adminClient, clientScope);\n  await addScope(adminClient, clientScope, changeTo);\n};\n\nconst castAdminClient = (adminClient: KeycloakAdminClient) =>\n  adminClient.clientScopes as unknown as {\n    [index: string]: Function;\n  };\n\nexport const removeScope = async (\n  adminClient: KeycloakAdminClient,\n  clientScope: ClientScopeDefaultOptionalType\n) => {\n  if (clientScope.type !== AllClientScopes.none)\n    await castAdminClient(adminClient)[\n      `delDefault${\n        clientScope.type === ClientScope.optional ? \"Optional\" : \"\"\n      }ClientScope`\n    ]({\n      id: clientScope.id!,\n    });\n};\n\nconst addScope = async (\n  adminClient: KeycloakAdminClient,\n  clientScope: ClientScopeDefaultOptionalType,\n  type: AllClientScopeType\n) => {\n  if (type !== AllClientScopes.none)\n    await castAdminClient(adminClient)[\n      `addDefault${type === ClientScope.optional ? \"Optional\" : \"\"}ClientScope`\n    ]({\n      id: clientScope.id!,\n    });\n};\n\nexport const changeClientScope = async (\n  adminClient: KeycloakAdminClient,\n  clientId: string,\n  clientScope: ClientScopeRepresentation,\n  type: AllClientScopeType,\n  changeTo: ClientScopeType\n) => {\n  if (type !== \"none\") {\n    await removeClientScope(adminClient, clientId, clientScope, type);\n  }\n  await addClientScope(adminClient, clientId, clientScope, changeTo);\n};\n\nexport const removeClientScope = async (\n  adminClient: KeycloakAdminClient,\n  clientId: string,\n  clientScope: ClientScopeRepresentation,\n  type: ClientScope\n) => {\n  const methodName = `del${toUpperCase(type)}ClientScope` as const;\n\n  await adminClient.clients[methodName]({\n    id: clientId,\n    clientScopeId: clientScope.id!,\n  });\n};\n\nexport const addClientScope = async (\n  adminClient: KeycloakAdminClient,\n  clientId: string,\n  clientScope: ClientScopeRepresentation,\n  type: ClientScopeType\n) => {\n  const methodName = `add${toUpperCase(type)}ClientScope` as const;\n\n  await adminClient.clients[methodName]({\n    id: clientId,\n    clientScopeId: clientScope.id!,\n  });\n};\n"],"names":["ClientScope","AllClientScopes","clientScopeTypes","allClientScopeTypes","clientScopeTypesSelectOptions","t","scopeTypes","type","jsx","SelectOption","clientScopeTypesDropdown","onClick","DropdownItem","CellDropdown","clientScope","onSelect","all","props","useTranslation","open","setOpen","useState","Select","_","value","changeScope","adminClient","changeTo","removeScope","addScope","castAdminClient","changeClientScope","clientId","removeClientScope","addClientScope","methodName","toUpperCase"],"mappings":"qHAeY,IAAAA,GAAAA,IACVA,EAAA,QAAU,UACVA,EAAA,SAAW,WAFDA,IAAAA,GAAA,CAAA,CAAA,EAKAC,GAAAA,IACVA,EAAA,KAAO,OADGA,IAAAA,GAAA,CAAA,CAAA,EAOZ,MAAMC,EAAmB,OAAO,KAAKF,CAAW,EACnCG,EAAsB,OAAO,KAAK,CAC7C,GAAGF,EACH,GAAGD,CACL,CAAC,EAEYI,EAAgC,CAC3CC,EACAC,EAAmCJ,IAEnCI,EAAW,IAAKC,GACbC,EAAAA,IAAAC,EAAA,CAAwB,MAAOF,EAC7B,SAAAF,EAAE,sBAAsBE,GAAM,GADdA,CAEnB,CACD,EAEUG,EAA2B,CACtCL,EACAM,IAEAT,EAAiB,IAAKK,GACnBC,EAAAA,IAAAI,EAAA,CAAwB,QAAS,IAAMD,EAAQJ,CAAuB,EACpE,SAAAF,EAAE,sBAAsBE,GAAM,GADdA,CAEnB,CACD,EASUM,EAAe,CAAC,CAC3B,YAAAC,EACA,KAAAP,EACA,SAAAQ,EACA,IAAAC,EAAM,GACN,GAAGC,CACL,IAAyB,CACjB,KAAA,CAAE,EAAAZ,GAAMa,IACR,CAACC,EAAMC,CAAO,EAAIC,WAAS,EAAK,EAGpC,OAAAb,EAAA,IAACc,EAAA,CACC,UAAW,2BAA2Bf,IAEtC,SAAU,IAAMa,EAAQ,CAACD,CAAI,EAC7B,OAAQA,EACR,WAAY,CAACZ,CAAI,EACjB,SAAU,CAACgB,EAAGC,IAAU,CACtBT,EACSS,CAA6B,EAEtCJ,EAAQ,EAAK,CACf,EACC,GAAGH,EAEH,SAAAb,EACCC,EACAW,EAAMb,EAAsBD,CAC9B,CAAA,EAfKY,EAAY,EAAA,CAkBvB,EAMaW,EAAc,MACzBC,EACAZ,EACAa,IACG,CACG,MAAAC,EAAYF,EAAaZ,CAAW,EACpC,MAAAe,EAASH,EAAaZ,EAAaa,CAAQ,CACnD,EAEMG,EAAmBJ,GACvBA,EAAY,aAIDE,EAAc,MACzBF,EACAZ,IACG,CACCA,EAAY,OAAS,QACjB,MAAAgB,EAAgBJ,CAAW,EAC/B,aACEZ,EAAY,OAAS,WAAuB,WAAa,eAE7D,EAAE,CACA,GAAIA,EAAY,EAAA,CACjB,CACL,EAEMe,EAAW,MACfH,EACAZ,EACAP,IACG,CACCA,IAAS,QACL,MAAAuB,EAAgBJ,CAAW,EAC/B,aAAanB,IAAS,WAAuB,WAAa,eAC5D,EAAE,CACA,GAAIO,EAAY,EAAA,CACjB,CACL,EAEaiB,EAAoB,MAC/BL,EACAM,EACAlB,EACAP,EACAoB,IACG,CACCpB,IAAS,QACX,MAAM0B,EAAkBP,EAAaM,EAAUlB,EAAaP,CAAI,EAElE,MAAM2B,EAAeR,EAAaM,EAAUlB,EAAaa,CAAQ,CACnE,EAEaM,EAAoB,MAC/BP,EACAM,EACAlB,EACAP,IACG,CACG,MAAA4B,EAAa,MAAMC,EAAY7B,CAAI,eAEnC,MAAAmB,EAAY,QAAQS,CAAU,EAAE,CACpC,GAAIH,EACJ,cAAelB,EAAY,EAAA,CAC5B,CACH,EAEaoB,EAAiB,MAC5BR,EACAM,EACAlB,EACAP,IACG,CACG,MAAA4B,EAAa,MAAMC,EAAY7B,CAAI,eAEnC,MAAAmB,EAAY,QAAQS,CAAU,EAAE,CACpC,GAAIH,EACJ,cAAelB,EAAY,EAAA,CAC5B,CACH"}