import{u as j,a as k,r as x,j as e,F as y,G as b,C as h,d as H,n as _,f as ye,e as be,b as he,c as te,R as je,k as J,A as P,bK as ve,bL as X,X as Ce,U as Se,B as N,g as Ie,P as Te,bM as Z,L as se,as as we,w as ke,bN as Fe}from"./index-a3421f29.js";import{u as V}from"./ConfirmDialog-09ff7a12.js";import{F as A}from"./FormAccess-1cceaef6.js";import{L as Re}from"./PaginatingTableToolbar-08ca9efb.js";import{P as Me}from"./PermissionTab-c2ee2a77.js";import{R as De,u as Le}from"./RoutableTabs-7f56b0c5.js";import{S as Oe}from"./ScrollForm-a21fd695.js";import{K as Pe}from"./KeycloakDataTable-10a62d94.js";import{V as Ne}from"./ViewHeader-832ec56e.js";import{u as G}from"./useParams-5abeab7d.js";import{G as Ae,E as Ee}from"./GeneralSettings-eaaddf99.js";import{T as B,S as m,F as Ke}from"./discovery-settings-095f2617.js";import{S as F,a as R,b as I}from"./Select-0f56a9cc.js";import{S as Ve,D as Be}from"./SamlGeneralSettings-6ba43280.js";import{O as He,D as _e,a as Ge}from"./OIDCGeneralSettings-a93cb3b6.js";import{E as Ue}from"./ExpandableSection-15721cb7.js";import{F as ne,A as qe}from"./Form-518a2cf2.js";import{N as ze}from"./NumberInput-85f36a0d.js";import{M as Q}from"./MultiLineInput-14187d1c.js";import{a as E,b as K}from"./Tabs-5beaba80.js";import{b as $e}from"./ToolbarContent-7b435752.js";import"./Modal-21c37af7.js";import"./copy-icon-a4fe01af.js";import"./GridItem-d34dae2e.js";import"./plus-circle-icon-cb854796.js";import"./EmptyStateBody-7b4fcee1.js";import"./EmptyStateSecondaryActions-08edafb5.js";import"./TableToolbar-ee0c86ef.js";import"./useLocaleSort-3efc7c31.js";import"./Trans-2fec9e72.js";import"./Card-aa3ba03c.js";import"./CardTitle-9175b04a.js";import"./CardBody-519f6395.js";import"./Td-6d4ab209.js";import"./star-icon-6a7e7d25.js";import"./check-fc57dbe1.js";import"./grip-vertical-icon-cbeff50f.js";import"./Checkbox-d00621d8.js";import"./FormPanel-11cb7e22.js";import"./CardHeader-457352d1.js";import"./Text-564bf299.js";import"./KeycloakTextInput-e7f6e917.js";import"./DisplayOrder-43d5f15a.js";import"./ClientIdSecret-f71639f8.js";import"./PasswordInput-85f9399f.js";import"./KeycloakTextArea-1b518857.js";import"./minus-icon-16876c86.js";import"./plus-icon-2a767bad.js";import"./minus-circle-icon-6f9a971c.js";import"./MenuList-e3786b59.js";const W=({field:t,label:s,defaultValue:i})=>{const{t:a}=j("identity-providers"),{control:r}=k(),{adminClient:d}=H(),[l,n]=x.useState(),[p,u]=x.useState(!1);return _(()=>d.authenticationManagement.getFlows(),g=>n(g.filter(c=>c.providerId==="basic-flow")),[]),e.jsx(y,{label:a(s),labelIcon:e.jsx(b,{helpText:a(`identity-providers-help:${s}`),fieldLabelId:`identity-providers:${s}`}),fieldId:s,children:e.jsx(h,{name:t,defaultValue:i,control:r,render:({field:g})=>e.jsx(F,{toggleId:s,required:!0,onToggle:()=>u(!p),onSelect:(c,v)=>{g.onChange(v),u(!1)},selections:g.value||a("common:none"),variant:R.single,"aria-label":a(s),isOpen:p,children:[...i===""?[e.jsx(I,{value:"",children:a("common:none")},"empty")]:[],...l?.map(c=>e.jsx(I,{selected:c.alias===g.value,value:c.alias,children:c.alias},c.id))||[]]})})})},Y=["import","legacy","force"],Je=({isOIDC:t,isSAML:s})=>{const{t:i}=j("identity-providers"),{control:a}=k(),[r,d]=x.useState(!1);return e.jsxs(e.Fragment,{children:[!t&&!s&&e.jsx(B,{field:"config.defaultScope",label:"scopes"}),e.jsx(m,{field:"storeToken",label:"storeTokens",fieldType:"boolean"}),(s||t)&&e.jsx(m,{field:"addReadTokenRoleOnCreate",label:"storedTokensReadable",fieldType:"boolean"}),!t&&!s&&e.jsxs(e.Fragment,{children:[e.jsx(m,{field:"config.acceptsPromptNoneForwardFromClient",label:"acceptsPromptNone"}),e.jsx(m,{field:"config.disableUserInfo",label:"disableUserInfo"})]}),e.jsx(m,{field:"trustEmail",label:"trustEmail",fieldType:"boolean"}),e.jsx(m,{field:"linkOnly",label:"accountLinkingOnly",fieldType:"boolean"}),e.jsx(m,{field:"config.hideOnLoginPage",label:"hideOnLoginPage"}),e.jsx(W,{field:"firstBrokerLoginFlowAlias",label:"firstBrokerLoginFlowAlias",defaultValue:"fist broker login"}),e.jsx(W,{field:"postBrokerLoginFlowAlias",label:"postBrokerLoginFlowAlias",defaultValue:""}),e.jsx(y,{className:"pf-u-pb-3xl",label:i("syncMode"),labelIcon:e.jsx(b,{helpText:i("identity-providers-help:syncMode"),fieldLabelId:"identity-providers:syncMode"}),fieldId:"syncMode",children:e.jsx(h,{name:"config.syncMode",defaultValue:Y[0].toUpperCase(),control:a,render:({field:l})=>e.jsx(F,{toggleId:"syncMode",required:!0,direction:"up",onToggle:()=>d(!r),onSelect:(n,p)=>{l.onChange(p),d(!1)},selections:i(`syncModes.${l.value.toLowerCase()}`),variant:R.single,"aria-label":i("syncMode"),isOpen:r,children:Y.map(n=>e.jsx(I,{selected:n===l.value,value:n.toUpperCase(),children:i(`syncModes.${n}`)},n))})})})]})},Xe={unspecified:"",none:"none",consent:"consent",login:"login",select_account:"select_account"},Ze=()=>{const{t}=j("identity-providers"),{control:s}=k(),[i,a]=x.useState(!1),[r,d]=x.useState(!1);return e.jsx(Ue,{toggleText:t("advanced"),onToggle:()=>a(!i),isExpanded:i,children:e.jsxs(ne,{isHorizontal:!0,children:[e.jsx(m,{label:"passLoginHint",field:"config.loginHint"}),e.jsx(m,{label:"passMaxAge",field:"config.passMaxAge"}),e.jsx(m,{label:"passCurrentLocale",field:"config.uiLocales"}),e.jsx(m,{field:"config.backchannelSupported",label:"backchannelLogout"}),e.jsx(m,{field:"config.disableUserInfo",label:"disableUserInfo"}),e.jsx(B,{field:"config.defaultScope",label:"scopes"}),e.jsx(Ke,{label:"prompt",children:e.jsx(h,{name:"config.prompt",defaultValue:"",control:s,render:({field:l})=>e.jsx(F,{toggleId:"prompt",required:!0,onToggle:()=>d(!r),onSelect:(n,p)=>{l.onChange(p),d(!1)},selections:l.value||t("prompts.unspecified"),variant:R.single,"aria-label":t("prompt"),isOpen:r,children:Object.entries(Xe).map(([n,p])=>e.jsx(I,{selected:p===l.value,value:p,children:t(`prompts.${n}`)},n))})})}),e.jsx(m,{field:"config.acceptsPromptNoneForwardFromClient",label:"acceptsPromptNone"}),e.jsx(y,{label:t("allowedClockSkew"),labelIcon:e.jsx(b,{helpText:"identity-providers-help:allowedClockSkew",fieldLabelId:"identity-providers:allowedClockSkew"}),fieldId:"allowedClockSkew",children:e.jsx(h,{name:"config.allowedClockSkew",defaultValue:0,control:s,render:({field:l})=>{const n=Number(l.value);return e.jsx(ze,{"data-testid":"allowedClockSkew",inputName:"allowedClockSkew",min:0,max:2147483,value:n,readOnly:!0,onPlus:()=>l.onChange(n+1),onMinus:()=>l.onChange(n-1),onChange:p=>{const u=Number(p.target.value);l.onChange(u<0?0:u)}})}})}),e.jsx(B,{field:"config.forwardParameters",label:"forwardParameters"})]})})},ee=["exact","minimum","maximum","better"],Qe=()=>{const{t}=j("identity-providers"),{control:s}=k(),[i,a]=x.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(y,{label:t("comparison"),labelIcon:e.jsx(b,{helpText:t("identity-providers-help:comparison"),fieldLabelId:"identity-providers:comparison"}),fieldId:"comparison",children:e.jsx(h,{name:"config.authnContextComparisonType",defaultValue:ee[0],control:s,render:({field:r})=>e.jsx(F,{toggleId:"comparison",required:!0,direction:"up",onToggle:d=>a(d),onSelect:(d,l)=>{r.onChange(l.toString()),a(!1)},selections:r.value,variant:R.single,"aria-label":t("comparison"),isOpen:i,children:ee.map(d=>e.jsx(I,{selected:d===r.value,value:d,children:t(d)},d))})})}),e.jsx(y,{label:t("authnContextClassRefs"),fieldId:"kc-authnContextClassRefs",labelIcon:e.jsx(b,{helpText:t("identity-providers-help:authnContextClassRefs"),fieldLabelId:"authnContextClassRefs"}),children:e.jsx(Q,{name:"config.authnContextClassRefs","aria-label":t("identify-providers:authnContextClassRefs"),addButtonLabel:"identity-providers:addAuthnContextClassRef","data-testid":"classref-field"})}),e.jsx(y,{label:t("authnContextDeclRefs"),fieldId:"kc-authnContextDeclRefs",labelIcon:e.jsx(b,{helpText:t("identity-providers-help:authnContextDeclRefs"),fieldLabelId:"authnContextDeclRefs"}),children:e.jsx(Q,{name:"config.authnContextDeclRefs","aria-label":t("identify-providers:authnContextDeclRefs"),addButtonLabel:"identity-providers:addAuthnContextDeclRef","data-testid":"declref-field"})})]})},We=({onChange:t,value:s,save:i,toggleDeleteDialog:a})=>{const{t:r}=j("identity-providers"),{alias:d}=G(),{adminClient:l}=H(),[n,p]=x.useState();_(()=>l.identityProviders.findOne({alias:d}),c=>{if(!c)throw new Error(r("common:notFound"));p(c)},[]);const[u,g]=V({titleKey:"identity-providers:disableProvider",messageKey:r("disableConfirm",{provider:d}),continueButtonLabel:"common:disable",onConfirm:()=>{t(!s),i()}});return e.jsxs(e.Fragment,{children:[e.jsx(g,{}),e.jsx(Ne,{titleKey:we(n?n.displayName?n.displayName:n.providerId:""),divider:!1,dropdownItems:[e.jsx(ke,{onClick:()=>a(),children:r("common:delete")},"delete")],isEnabled:s,onToggle:c=>{c?(t(c),i()):u()}})]})},Ye=({name:t,mapperId:s,provider:i})=>{const{realm:a}=te(),{alias:r}=G();return e.jsx(se,{to:Fe({realm:a,alias:r,providerId:i?.providerId,id:s}),children:t})};function Qt(){const{t}=j("identity-providers"),{alias:s,providerId:i}=G(),a=ye(),{handleSubmit:r,getValues:d,reset:l}=a,[n,p]=x.useState(),[u,g]=x.useState(),{adminClient:c}=H(),{addAlert:v,addError:M}=be(),D=he(),{realm:C}=te(),[U,oe]=x.useState(0),{profileInfo:ie}=je(),ae=()=>oe(U+1);_(()=>c.identityProviders.findOne({alias:s}),o=>{if(!o)throw new Error(t("common:notFound"));l(o),p(o),o.config.authnContextClassRefs&&a.setValue("config.authnContextClassRefs",JSON.parse(o.config?.authnContextClassRefs)),o.config.authnContextDeclRefs&&a.setValue("config.authnContextDeclRefs",JSON.parse(o.config?.authnContextDeclRefs))},[]);const q=o=>X({realm:C,alias:s,providerId:i,tab:o}),L=o=>Le(q(o)),re=L("settings"),le=L("mappers"),de=L("permissions"),T=async o=>{const f=o||d();f.config?.authnContextClassRefs&&(f.config.authnContextClassRefs=JSON.stringify(f.config.authnContextClassRefs)),f.config?.authnContextDeclRefs&&(f.config.authnContextDeclRefs=JSON.stringify(f.config.authnContextDeclRefs));try{await c.identityProviders.update({alias:s},{...f,config:{...n?.config,...f.config},alias:s,providerId:i}),v(t("updateSuccess"),P.success)}catch(z){M("identity-providers:updateError",z)}},[ce,pe]=V({titleKey:"identity-providers:deleteProvider",messageKey:t("identity-providers:deleteConfirm",{provider:s}),continueButtonLabel:"common:delete",continueButtonVariant:J.danger,onConfirm:async()=>{try{await c.identityProviders.del({alias:s}),v(t("deletedSuccess"),P.success),D(ve({realm:C}))}catch(o){M("identity-providers:deleteErrorError",o)}}}),[me,ue]=V({titleKey:"identity-providers:deleteProviderMapper",messageKey:t("identity-providers:deleteMapperConfirm",{mapper:u?.name}),continueButtonLabel:"common:delete",continueButtonVariant:J.danger,onConfirm:async()=>{try{await c.identityProviders.delMapper({alias:s,id:u?.mapperId}),v(t("deleteMapperSuccess"),P.success),ae(),D(X({providerId:i,alias:s,tab:"mappers",realm:C}))}catch(o){M("identity-providers:deleteErrorError",o)}}});if(!n)return e.jsx(Ce,{});const w=n.providerId.includes("oidc"),S=n.providerId.includes("saml"),fe=async()=>{const[o,f]=await Promise.all([c.identityProviders.findMappers({alias:s}),c.identityProviders.findMapperTypes({alias:s})]);return o.map(O=>{const $=Object.values(f).find(ge=>O.identityProviderMapper===ge.id);return{...$,name:O.name,type:$?.name,mapperId:O.id}})},xe=[{title:t("generalSettings"),panel:e.jsxs(A,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:r(T),children:[!w&&!S&&e.jsxs(e.Fragment,{children:[e.jsx(Ae,{create:!1,id:s}),e.jsx(Ee,{providerId:s})]}),w&&e.jsx(He,{id:s}),S&&e.jsx(Ve,{id:s,isAliasReadonly:!0})]})},{title:t("oidcSettings"),isHidden:!w,panel:e.jsxs(e.Fragment,{children:[e.jsx(_e,{readOnly:!1}),e.jsxs(ne,{isHorizontal:!0,className:"pf-u-py-lg",children:[e.jsx(Se,{}),e.jsx(Ge,{create:!1})]}),e.jsx(Ze,{})]})},{title:t("samlSettings"),isHidden:!S,panel:e.jsx(Be,{readOnly:!1})},{title:t("reqAuthnConstraints"),isHidden:!S,panel:e.jsx(A,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:r(T),children:e.jsx(Qe,{})})},{title:t("advancedSettings"),panel:e.jsxs(A,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:r(T),children:[e.jsx(Je,{isOIDC:w,isSAML:S}),e.jsxs(qe,{className:"keycloak__form_actions",children:[e.jsx(N,{"data-testid":"save",type:"submit",children:t("common:save")}),e.jsx(N,{"data-testid":"revert",variant:"link",onClick:()=>{l()},children:t("common:revert")})]})]})}];return e.jsxs(Ie,{...a,children:[e.jsx(pe,{}),e.jsx(ue,{}),e.jsx(h,{name:"enabled",control:a.control,defaultValue:!0,render:({field:o})=>e.jsx(We,{value:o.value||!1,onChange:o.onChange,save:T,toggleDeleteDialog:ce})}),e.jsx(Te,{variant:"light",className:"pf-u-p-0",children:e.jsxs(De,{isBox:!0,defaultLocation:q("settings"),children:[e.jsx(E,{id:"settings",title:e.jsx(K,{children:t("common:settings")}),...re,children:e.jsx(Oe,{className:"pf-u-px-lg",sections:xe})}),e.jsx(E,{id:"mappers","data-testid":"mappers-tab",title:e.jsx(K,{children:t("common:mappers")}),...le,children:e.jsx(Pe,{emptyState:e.jsx(Re,{message:t("identity-providers:noMappers"),instructions:t("identity-providers:noMappersInstructions"),primaryActionText:t("identity-providers:addMapper"),onPrimaryAction:()=>D(Z({realm:C,alias:s,providerId:n.providerId,tab:"mappers"}))}),loader:fe,ariaLabelKey:"identity-providers:mappersList",searchPlaceholderKey:"identity-providers:searchForMapper",toolbarItem:e.jsx($e,{children:e.jsx(N,{id:"add-mapper-button",component:o=>e.jsx(se,{...o,to:Z({realm:C,alias:s,providerId:n.providerId,tab:"mappers"})}),"data-testid":"addMapper",children:t("addMapper")})}),columns:[{name:"name",displayKey:"common:name",cellRenderer:o=>e.jsx(Ye,{...o,provider:n})},{name:"category",displayKey:"common:category"},{name:"type",displayKey:"common:type"}],actions:[{title:t("common:delete"),onRowClick:o=>{g(o),me()}}]},U)}),!ie?.disabledFeatures?.includes("ADMIN_FINE_GRAINED_AUTHZ")&&e.jsx(E,{id:"permissions","data-testid":"permissionsTab",title:e.jsx(K,{children:t("common:permissions")}),...de,children:e.jsx(Me,{id:s,type:"identityProviders"})})]})})]})}export{Qt as default};
//# sourceMappingURL=DetailSettings-defa4606.js.map
