import{bk as rs,r as c,aw as Bt,i as os,cA as Et,ca as vt,d as se,n as ve,u as M,c as ae,e as oe,f as he,N as Te,j as e,P as Q,F as f,cX as mt,G as C,C as L,S as X,a4 as at,cY as cs,L as ge,aN as ds,B as P,A as Z,R as Ee,U as ze,k as ee,q as Ce,ad as Ze,g as yt,a0 as Pt,b as $e,X as Pe,a8 as Je,cV as ht,cW as St,M as ms,ax as Gt,cZ as us,V as ue,c_ as je,aT as wt,K as ct,ap as ps,aq as Ye,E as tt,T as Ht,c$ as At,d0 as hs,d1 as gt,d2 as gs,d3 as fs,d4 as xs,a as _t,ar as bs,d5 as Dt,d6 as js,d7 as vs,d8 as Rt,d9 as Nt,W as ys,J as Ss,da as Ot,D as Ts,a7 as Cs,w as st,db as zt,bt as ut,p as Mt,bo as ks,aU as Is,Z as Ls,aD as Es,s as Ps}from"./index-a3421f29.js";import{u as ws}from"./useParams-5abeab7d.js";import{u as de}from"./ConfirmDialog-09ff7a12.js";import{R as nt,u as lt}from"./RoutableTabs-7f56b0c5.js";import{F as ft,V as As}from"./ViewHeader-832ec56e.js";import{u as $t,F as qt}from"./useIsFeatureEnabled-1df1a04b.js";import{F as Y,b as Ds,S as Wt,a as Ie}from"./FormAccess-1cceaef6.js";import{K as le}from"./KeycloakTextInput-e7f6e917.js";import{P as Rs}from"./PasswordInput-85f9399f.js";import{F as ie}from"./FormPanel-11cb7e22.js";import{u as Me}from"./useToggle-a9cb2c55.js";import"./realm-settings-section-4ed993c7.js";import{C as xt}from"./Checkbox-d00621d8.js";import{A as fe,F as Tt}from"./Form-518a2cf2.js";import{a as pt}from"./ActionListItem-ab1a4322.js";import{K as Ke,T as Ns,l as Os,m as Ms}from"./KeycloakDataTable-10a62d94.js";import{L as Le,P as Vs}from"./PaginatingTableToolbar-08ca9efb.js";import{b as xe,T as Jt,c as Ks,a as Fs}from"./ToolbarContent-7b435752.js";import{M as Ve,a as _e}from"./Modal-21c37af7.js";import{T as q,t as Us}from"./TimeSelector-a2bc30e2.js";import{S as re,a as pe,b as te,e as Vt}from"./Select-0f56a9cc.js";import{i as Xt}from"./isEqual-69fbe00f.js";import{T as Ct,a as F,b as U}from"./Tabs-5beaba80.js";import{K as Bs}from"./KeyValueInput-ce08b760.js";import{a8 as Kt,N as Ge,Y as Gs,al as Hs,am as _s,an as zs}from"./Td-6d4ab209.js";import{F as Yt}from"./filter-icon-9d72dc58.js";import{D as Qt}from"./DraggableTable-40ed6015.js";import{KeyProviderForm as $s}from"./KeyProviderForm-657f5169.js";import{e as Zt,D as es,a as ts,c as ss,d as bt}from"./DataListItemRow-75e02946.js";import{T as Oe,a as qs}from"./Text-564bf299.js";import{J as Ws}from"./JsonFileUpload-a913d52f.js";import{F as as,a as He}from"./FlexItem-65b5f999.js";import{R as it}from"./Radio-e3ba1ffb.js";import{C as kt,L as It}from"./CodeEditor-2fb93648.js";import{T as rt}from"./Trans-2fec9e72.js";import{N as ot}from"./NumberInput-85f36a0d.js";import{u as Lt,U as Js}from"./UserProfileContext-1adc9dc8.js";import{R as Xs}from"./AddRoleMappingModal-abb19beb.js";import{G as Ys}from"./GroupPickerDialog-caf8c38d.js";import{Q as Qs}from"./question-circle-icon-45a94074.js";import"./copy-icon-a4fe01af.js";import"./GridItem-d34dae2e.js";import"./CardHeader-457352d1.js";import"./Card-aa3ba03c.js";import"./CardTitle-9175b04a.js";import"./CardBody-519f6395.js";import"./check-fc57dbe1.js";import"./EmptyStateBody-7b4fcee1.js";import"./plus-circle-icon-cb854796.js";import"./EmptyStateSecondaryActions-08edafb5.js";import"./TableToolbar-ee0c86ef.js";import"./star-icon-6a7e7d25.js";import"./plus-icon-2a767bad.js";import"./MenuList-e3786b59.js";import"./minus-icon-16876c86.js";import"./minus-circle-icon-6f9a971c.js";import"./grip-vertical-icon-cbeff50f.js";import"./data-list-7d55714c.js";import"./DynamicComponents-72877b30.js";import"./ClientSelect-3f0fc581.js";import"./FileUpload-ca37c1a6.js";import"./MultiLineInput-14187d1c.js";import"./KeycloakTextArea-1b518857.js";import"./useLocaleSort-3efc7c31.js";import"./resource-08ae7dbc.js";import"./joinPath-55fd24bc.js";import"./FileUploadForm-96efeae2.js";function Zs(s,a){return a=typeof a=="function"?a:void 0,s&&s.length?rs(s,void 0,a):[]}const jt=({value:s,rowIndex:a,cellIndex:t,props:n,handleTextInputChange:l,inputAriaLabel:o,isDisabled:m=!1})=>c.createElement(c.Fragment,null,c.createElement("div",{className:Kt.inlineEditValue},s),c.createElement("div",{className:Kt.inlineEditInput},c.createElement(Bt,{isDisabled:m,value:n.editableValue!==void 0?n.editableValue:s,validated:n.isValid!==!1?"default":"error",type:"text",onChange:(u,p)=>{l(u,p,a,t)},"aria-label":o}),c.createElement("div",{className:os(Et.formHelperText,Et.modifiers.error),"aria-live":"polite"},n.errorText)));jt.displayName="EditableTextCell";function ea(){const{whoAmI:s}=vt(),{adminClient:a}=se(),[t,n]=c.useState(),l=s.getUserId();return ve(()=>a.users.findOne({id:l}),n,[l]),t}const ta=({realm:s})=>{const{t:a}=M("realm-settings"),{adminClient:t}=se(),{realm:n}=ae(),{addAlert:l,addError:o}=oe(),m=ea(),[u,p]=c.useState(s),{register:i,control:j,handleSubmit:g,watch:S,reset:x,getValues:k,formState:{errors:r}}=he({defaultValues:u}),v=()=>x(u),h=S("smtpServer.from",""),d=S("smtpServer.host",""),[w,A]=Me(),V=Te({control:j,name:"smtpServer.auth",defaultValue:""}),K=async T=>{try{const O={...u,...T};O.smtpServer?.port===""&&(O.smtpServer.port=null),await t.realms.update({realm:n},O),p(O),l(a("saveSuccess"),Z.success)}catch(O){o("realm-settings:saveError",O)}},E=async()=>{const T=N=>Number(N),O=N=>N===(!0).toString(),B=new Map([["port",T],["ssl",O],["starttls",O],["auth",O]]),b={...k().smtpServer};for(const[N,H]of B.entries())b[N]=H(b[N]);b.port===0&&(b.port=null);try{A(),await t.realms.testSMTPConnection({realm:u.realm},b),l(a("testConnectionSuccess"),Z.success)}catch(N){o("realm-settings:testConnectionError",N)}A()};return e.jsxs(Q,{variant:"light",children:[e.jsx(ie,{title:a("template"),className:"kc-email-template",children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:g(K),children:[e.jsx(f,{label:a("from"),fieldId:"kc-display-name",isRequired:!0,validated:r.smtpServer?.from?"error":"default",helperTextInvalid:a("users:emailInvalid"),children:e.jsx(le,{type:"email",id:"kc-sender-email-address","data-testid":"sender-email-address",placeholder:"Sender email address",validated:r.smtpServer?.from?"error":"default",...i("smtpServer.from",{pattern:mt,required:!0})})}),e.jsx(f,{label:a("fromDisplayName"),fieldId:"kc-from-display-name",labelIcon:e.jsx(C,{helpText:a("realm-settings-help:fromDisplayName"),fieldLabelId:"realm-settings:authentication"}),children:e.jsx(le,{id:"kc-from-display-name","data-testid":"from-display-name",placeholder:"Display name for Sender email address",...i("smtpServer.fromDisplayName")})}),e.jsx(f,{label:a("replyTo"),fieldId:"kc-reply-to",validated:r.smtpServer?.replyTo?"error":"default",helperTextInvalid:a("users:emailInvalid"),children:e.jsx(le,{type:"email",id:"kc-reply-to",placeholder:"Reply to email address",validated:r.smtpServer?.replyTo?"error":"default",...i("smtpServer.replyTo",{pattern:mt})})}),e.jsx(f,{label:a("replyToDisplayName"),fieldId:"kc-reply-to-display-name",labelIcon:e.jsx(C,{helpText:a("realm-settings-help:replyToDisplayName"),fieldLabelId:"realm-settings:replyToDisplayName"}),children:e.jsx(le,{id:"kc-reply-to-display-name",placeholder:'Display name for "reply to" email address',...i("smtpServer.replyToDisplayName")})}),e.jsx(f,{label:a("envelopeFrom"),fieldId:"kc-envelope-from",labelIcon:e.jsx(C,{helpText:a("realm-settings-help:envelopeFrom"),fieldLabelId:"realm-settings:envelopeFrom"}),children:e.jsx(le,{id:"kc-envelope-from",placeholder:"Sender envelope email address",...i("smtpServer.envelopeFrom")})})]})}),e.jsx(ie,{className:"kc-email-connection",title:a("connectionAndAuthentication"),children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:g(K),children:[e.jsx(f,{label:a("host"),fieldId:"kc-host",isRequired:!0,validated:r.smtpServer?.host?"error":"default",helperTextInvalid:a("common:required"),children:e.jsx(le,{id:"kc-host",placeholder:"SMTP host",validated:r.smtpServer?.host?"error":"default",...i("smtpServer.host",{required:!0})})}),e.jsx(f,{label:a("port"),fieldId:"kc-port",children:e.jsx(le,{id:"kc-port",placeholder:"SMTP port (defaults to 25)",...i("smtpServer.port")})}),e.jsxs(f,{label:a("encryption"),fieldId:"kc-html-display-name",children:[e.jsx(L,{name:"smtpServer.ssl",control:j,defaultValue:"false",render:({field:T})=>e.jsx(xt,{id:"kc-enable-ssl","data-testid":"enable-ssl",label:a("enableSSL"),isChecked:T.value==="true",onChange:O=>T.onChange(""+O)})}),e.jsx(L,{name:"smtpServer.starttls",control:j,defaultValue:"false",render:({field:T})=>e.jsx(xt,{id:"kc-enable-start-tls","data-testid":"enable-start-tls",label:a("enableStartTLS"),isChecked:T.value==="true",onChange:O=>T.onChange(""+O)})})]}),e.jsx(f,{hasNoPaddingTop:!0,label:a("authentication"),fieldId:"kc-authentication",children:e.jsx(L,{name:"smtpServer.auth",control:j,defaultValue:"",render:({field:T})=>e.jsx(X,{id:"kc-authentication-switch","data-testid":"email-authentication-switch",label:a("common:enabled"),labelOff:a("common:disabled"),isChecked:T.value==="true",onChange:O=>{T.onChange(""+O)},"aria-label":a("authentication")})})}),V==="true"&&e.jsxs(e.Fragment,{children:[e.jsx(f,{label:a("username"),fieldId:"kc-username",isRequired:!0,validated:r.smtpServer?.user?"error":"default",helperTextInvalid:a("common:required"),children:e.jsx(le,{id:"kc-username","data-testid":"username-input",placeholder:"Login username",validated:r.smtpServer?.user?"error":"default",...i("smtpServer.user",{required:!0})})}),e.jsx(f,{label:a("password"),fieldId:"kc-username",isRequired:!0,validated:r.smtpServer?.password?"error":"default",helperTextInvalid:a("common:required"),labelIcon:e.jsx(C,{helpText:a("realm-settings-help:password"),fieldLabelId:"realm-settings:password"}),children:e.jsx(Rs,{id:"kc-password","data-testid":"password-input","aria-label":a("password"),validated:r.smtpServer?.password?"error":"default",...i("smtpServer.password",{required:!0})})})]}),m&&e.jsx(f,{id:"descriptionTestConnection",children:m.email?e.jsx(at,{variant:"info",isInline:!0,title:a("testConnectionHint.withEmail",{email:m.email})}):e.jsx(at,{variant:"warning",isInline:!0,title:a("testConnectionHint.withoutEmail",{userName:m.username}),actionLinks:e.jsx(cs,{component:T=>e.jsx(ge,{...T,to:ds({realm:n,id:m.id,tab:"settings"})}),children:a("testConnectionHint.withoutEmailAction")})})}),e.jsxs(fe,{children:[e.jsx(pt,{children:e.jsx(P,{variant:"primary",type:"submit","data-testid":"email-tab-save",children:a("common:save")})}),e.jsx(pt,{children:e.jsx(P,{variant:"secondary",onClick:()=>E(),"data-testid":"test-connection-button",isDisabled:!(mt.test(h)&&d)||!m?.email,"aria-describedby":"descriptionTestConnection",isLoading:w,spinnerAriaValueText:a("testingConnection"),children:a("common:testConnection")})}),e.jsx(pt,{children:e.jsx(P,{variant:"link",onClick:v,"data-testid":"email-tab-revert",children:a("common:revert")})})]})]})})]})};function ns({ariaLabelKey:s="userEventsRegistered",eventTypes:a,addTypes:t,onSelect:n,onDelete:l}){const{t:o}=M("realm-settings"),m=a.map(u=>({id:o(`eventTypes.${u}.name`),description:o(`eventTypes.${u}.description`)}));return e.jsx(Ke,{ariaLabelKey:s,searchPlaceholderKey:"realm-settings:searchEventType",loader:m,onSelect:n||void 0,canSelectAll:!!n,toolbarItem:t&&e.jsx(xe,{children:e.jsx(P,{id:"addTypes",onClick:t,"data-testid":"addTypes",children:o("addSavedTypes")})}),actions:l?[{title:o("common:remove"),onRowClick:l}]:[],columns:[{name:"id",displayKey:"realm-settings:eventType"},{name:"description",displayKey:"description"}],emptyState:e.jsx(Le,{message:o("emptyEvents"),instructions:o("emptyEventsInstructions")})})}const sa=({onConfirm:s,onClose:a,configured:t})=>{const{t:n}=M("realm-settings"),{enums:l}=Ee(),[o,m]=c.useState([]);return e.jsx(Ve,{variant:_e.medium,title:n("addTypes"),isOpen:!0,onClose:a,actions:[e.jsx(P,{"data-testid":"addEventTypeConfirm",variant:"primary",onClick:()=>s(o),children:n("common:add")},"confirm"),e.jsx(P,{"data-testid":"moveCancel",variant:"link",onClick:a,children:n("common:cancel")},"cancel")],children:e.jsx(ns,{ariaLabelKey:"addTypes",onSelect:u=>m(u),eventTypes:l.eventType.filter(u=>!t.includes(u))})})},Ft=({type:s,form:a,reset:t,clear:n})=>{const{t:l}=M("realm-settings"),{control:o,watch:m,setValue:u,formState:{isDirty:p}}=a,i=s==="admin"?"adminEventsEnabled":"eventsEnabled",j=m(i),[g,S]=de({titleKey:"realm-settings:events-disable-title",messageKey:"realm-settings:events-disable-confirm",continueButtonLabel:"realm-settings:confirm",onConfirm:()=>u(i,!1)});return e.jsxs(e.Fragment,{children:[e.jsx(S,{}),e.jsx(f,{hasNoPaddingTop:!0,label:l("saveEvents"),fieldId:i,labelIcon:e.jsx(C,{helpText:l(`realm-settings-help:save-${s}-events`),fieldLabelId:"realm-settings:saveEvents"}),children:e.jsx(L,{name:i,defaultValue:!1,control:o,render:({field:x})=>e.jsx(X,{"data-testid":i,id:`${i}-switch`,label:l("common:on"),labelOff:l("common:off"),isChecked:x.value,onChange:k=>{k?x.onChange(k):g()},"aria-label":l("saveEvents")})})}),j&&e.jsxs(e.Fragment,{children:[s==="admin"&&e.jsx(f,{hasNoPaddingTop:!0,label:l("includeRepresentation"),fieldId:"includeRepresentation",labelIcon:e.jsx(C,{helpText:l("realm-settings-help:includeRepresentation"),fieldLabelId:"realm-settings:includeRepresentation"}),children:e.jsx(L,{name:"adminEventsDetailsEnabled",defaultValue:!1,control:o,render:({field:x})=>e.jsx(X,{"data-testid":"includeRepresentation",id:"includeRepresentation",label:l("common:on"),labelOff:l("common:off"),isChecked:x.value,onChange:x.onChange,"aria-label":l("includeRepresentation")})})}),e.jsx(f,{label:l("expiration"),fieldId:"expiration",labelIcon:e.jsx(C,{helpText:l("realm-settings-help:expiration"),fieldLabelId:"realm-settings:expiration"}),children:e.jsx(L,{name:s==="user"?"eventsExpiration":"adminEventsExpiration",defaultValue:"",control:o,render:({field:x})=>e.jsx(q,{value:x.value,onChange:x.onChange,units:["minute","hour","day"]})})})]}),e.jsxs(fe,{children:[e.jsx(P,{variant:"primary",type:"submit",id:`save-${s}`,"data-testid":`save-${s}`,isDisabled:!p,children:l("common:save")}),e.jsx(P,{variant:"link",onClick:t,children:l("common:revert")})]}),e.jsx(ze,{}),e.jsx(f,{label:l(s==="user"?"clearUserEvents":"clearAdminEvents"),fieldId:`clear-${s}-events`,labelIcon:e.jsx(C,{helpText:l(`realm-settings-help:${s}-clearEvents`),fieldLabelId:`realm-settings:clear-${s}-events`}),children:e.jsx(P,{variant:"danger",id:`clear-${s}-events`,"data-testid":`clear-${s}-events`,onClick:()=>n(),children:l(s==="user"?"clearUserEvents":"clearAdminEvents")})})]})},aa=({form:s,reset:a})=>{const{t}=M("realm-settings"),{control:n,formState:{isDirty:l}}=s,[o,m]=c.useState(!1),p=Ee().providers?.eventsListener.providers;return e.jsxs(e.Fragment,{children:[e.jsx(f,{hasNoPaddingTop:!0,label:t("eventListeners"),fieldId:"kc-eventListeners",labelIcon:e.jsx(C,{helpText:t("eventListenersHelpText"),fieldLabelId:"realm-settings:eventListeners"}),children:e.jsx(L,{name:"eventsListeners",defaultValue:"",control:n,render:({field:i})=>e.jsx(re,{name:"eventsListeners",className:"kc_eventListeners_select","data-testid":"eventListeners-select",chipGroupProps:{numChips:3,expandedText:t("common:hide"),collapsedText:t("common:showRemaining")},variant:pe.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:j=>m(j),selections:i.value,onSelect:(j,g)=>{const S=g.toString(),x=i.value.includes(S)?i.value.filter(k=>k!==S):[...i.value,S];i.onChange(x)},onClear:j=>{j.stopPropagation(),i.onChange([])},isOpen:o,"aria-labelledby":"eventsListeners",children:Object.keys(p).map(j=>e.jsx(te,{value:j},j))})})}),e.jsxs(fe,{children:[e.jsx(P,{variant:"primary",type:"submit","data-testid":"saveEventListenerBtn",isDisabled:!l,children:t("common:save")}),e.jsx(P,{variant:"link","data-testid":"revertEventListenerBtn",onClick:a,children:t("common:revert")})]})]})},na=({realm:s})=>{const{t:a}=M("realm-settings"),t=he(),{setValue:n,handleSubmit:l}=t,[o,m]=c.useState(0),u=()=>m(new Date().getTime()),[p,i]=c.useState(0),j=()=>i(new Date().getTime()),[g,S]=c.useState("event"),[x,k]=c.useState(),[r,v]=c.useState(),[h,d]=c.useState(!1),{adminClient:w}=se(),{addAlert:A,addError:V}=oe(),{realm:K}=ae(),E=D=>{k(D),Ce(D||{},n)},T=async D=>{v(D),O()},[O,B]=de({titleKey:"realm-settings:deleteEvents",messageKey:"realm-settings:deleteEventsConfirm",continueButtonLabel:"common:clear",continueButtonVariant:ee.danger,onConfirm:async()=>{try{switch(r){case"admin":await w.realms.clearAdminEvents({realm:K});break;case"user":await w.realms.clearEvents({realm:K});break}A(a(`${r}-events-cleared`),Z.success)}catch(D){V(`realm-settings:${r}-events-cleared-error`,D)}}});ve(()=>w.realms.getConfigEvents({realm:K}),D=>{E({...D,adminEventsExpiration:s.attributes?.adminEventsExpiration}),j()},[o]);const b=async D=>{const z=!Xt(x?.eventsListeners,D.eventsListeners),{adminEventsExpiration:W,...ce}=D;s.attributes?.adminEventsExpiration!==W&&await w.realms.update({realm:K},{...s,attributes:{...s.attributes||{},adminEventsExpiration:W}});try{await w.realms.updateConfigEvents({realm:K},ce),E({...x,...ce,adminEventsExpiration:W}),A(a(z?"realm-settings:saveEventListenersSuccess":"realm-settings:eventConfigSuccessfully"),Z.success)}catch(be){V(a(z?"realm-settings:saveEventListenersError":"realm-settings:eventConfigError"),be)}},N=async D=>{const z=D.map(ce=>ce.id),W=x.enabledEventTypes?.concat(z);await H(W)},H=async(D=[])=>{const z={...t.getValues(),enabledEventTypes:D};await b(z),d(!1),u()};return e.jsxs(e.Fragment,{children:[e.jsx(B,{}),h&&e.jsx(sa,{onConfirm:D=>N(D),configured:x?.enabledEventTypes||[],onClose:()=>d(!1)}),e.jsxs(Ct,{activeKey:g,onSelect:(D,z)=>S(z),children:[e.jsx(F,{eventKey:"event",title:e.jsx(U,{children:a("eventListeners")}),"data-testid":"rs-event-listeners-tab",children:e.jsx(Q,{children:e.jsx(Y,{role:"manage-events",isHorizontal:!0,onSubmit:l(b),children:e.jsx(aa,{form:t,reset:()=>E(x)})})})}),e.jsxs(F,{eventKey:"user",title:e.jsx(U,{children:a("userEventsSettings")}),"data-testid":"rs-events-tab",children:[e.jsx(Q,{children:e.jsx(Y,{role:"manage-events",isHorizontal:!0,onSubmit:l(b),children:e.jsx(Ft,{type:"user",form:t,reset:()=>E(x),clear:()=>T("user")})})}),x?.eventsEnabled&&e.jsx(Q,{children:e.jsx(ns,{addTypes:()=>d(!0),eventTypes:x.enabledEventTypes||[],onDelete:D=>{const z=x.enabledEventTypes?.filter(W=>W!==D.id);H(z),k({...x,enabledEventTypes:z})}},p)})]}),e.jsx(F,{eventKey:"admin",title:e.jsx(U,{children:a("adminEventsSettings")}),"data-testid":"rs-admin-events-tab",children:e.jsx(Q,{children:e.jsx(Y,{role:"manage-events",isHorizontal:!0,onSubmit:l(b),children:e.jsx(Ft,{type:"admin",form:t,reset:()=>E(x),clear:()=>T("admin")})})})})]})]})},la=({realm:s,save:a})=>{const{t}=M("realm-settings"),{adminClient:n}=se(),{realm:l}=ae(),o=he(),{register:m,control:u,handleSubmit:p,setValue:i,formState:{isDirty:j,errors:g}}=o,S=$t(),[x,k]=c.useState(!1),r=["all","external","none"],v=()=>{if(Ce(s,i),s.attributes?.["acr.loa.map"]){const h=Object.entries(JSON.parse(s.attributes["acr.loa.map"])).flatMap(([d,w])=>({key:d,value:w}));h.concat({key:"",value:""}),i(Ze("attributes.acr.loa.map"),h)}};return c.useEffect(v,[]),e.jsx(Q,{variant:"light",children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:p(a),children:[e.jsx(f,{label:t("realmId"),fieldId:"kc-realm-id",isRequired:!0,validated:g.realm?"error":"default",helperTextInvalid:g.realm?.message,children:e.jsx(L,{name:"realm",control:u,rules:{required:{value:!0,message:t("common:required")},pattern:{value:/^[a-zA-Z0-9-_]+$/,message:t("realm:invalidRealmName")}},defaultValue:"",render:({field:h})=>e.jsx(Ds,{"data-testid":"realmName",onChange:h.onChange,children:h.value})})}),e.jsx(f,{label:t("displayName"),fieldId:"kc-display-name",children:e.jsx(le,{id:"kc-display-name",...m("displayName")})}),e.jsx(f,{label:t("htmlDisplayName"),fieldId:"kc-html-display-name",children:e.jsx(le,{id:"kc-html-display-name",...m("displayNameHtml")})}),e.jsx(f,{label:t("frontendUrl"),fieldId:"kc-frontend-url",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:frontendUrl"),fieldLabelId:"realm-settings:frontendUrl"}),children:e.jsx(le,{type:"url",id:"kc-frontend-url",...m(Ze("attributes.frontendUrl"))})}),e.jsx(f,{label:t("requireSsl"),fieldId:"kc-require-ssl",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:requireSsl"),fieldLabelId:"realm-settings:requireSsl"}),children:e.jsx(L,{name:"sslRequired",defaultValue:"none",control:u,render:({field:h})=>e.jsx(re,{toggleId:"kc-require-ssl",onToggle:()=>k(!x),onSelect:(d,w)=>{h.onChange(w),k(!1)},selections:h.value,variant:pe.single,"aria-label":t("requireSsl"),isOpen:x,children:r.map(d=>e.jsx(te,{selected:d===h.value,value:d,children:t(`sslType.${d}`)},d))})})}),e.jsx(f,{label:t("clients:acrToLoAMapping"),fieldId:"acrToLoAMapping",labelIcon:e.jsx(C,{helpText:t("clients-help:acrToLoAMapping"),fieldLabelId:"clients:acrToLoAMapping"}),children:e.jsx(yt,{...o,children:e.jsx(Bs,{name:Ze("attributes.acr.loa.map")})})}),e.jsx(f,{hasNoPaddingTop:!0,label:t("userManagedAccess"),labelIcon:e.jsx(C,{helpText:t("realm-settings-help:userManagedAccess"),fieldLabelId:"realm-settings:userManagedAccess"}),fieldId:"kc-user-managed-access",children:e.jsx(L,{name:"userManagedAccessAllowed",control:u,defaultValue:!1,render:({field:h})=>e.jsx(X,{id:"kc-user-managed-access","data-testid":"user-managed-access-switch",label:t("common:on"),labelOff:t("common:off"),isChecked:h.value,onChange:h.onChange,"aria-label":t("userManagedAccess")})})}),S(qt.DeclarativeUserProfile)&&e.jsx(f,{hasNoPaddingTop:!0,label:t("userProfileEnabled"),labelIcon:e.jsx(C,{helpText:t("realm-settings-help:userProfileEnabled"),fieldLabelId:"realm-settings:userProfileEnabled"}),fieldId:"kc-user-profile-enabled",children:e.jsx(L,{name:Ze("attributes.userProfileEnabled"),control:u,defaultValue:"false",render:({field:h})=>e.jsx(X,{id:"kc-user-profile-enabled","data-testid":"user-profile-enabled-switch",label:t("common:on"),labelOff:t("common:off"),isChecked:h.value==="true",onChange:d=>h.onChange(d.toString()),"aria-label":t("userProfileEnabled")})})}),e.jsx(f,{label:t("endpoints"),labelIcon:e.jsx(C,{helpText:t("realm-settings-help:endpoints"),fieldLabelId:"realm-settings:endpoints"}),fieldId:"kc-endpoints",children:e.jsxs(Wt,{children:[e.jsx(Ie,{children:e.jsx(ft,{href:`${Pt(n.baseUrl)}realms/${l}/.well-known/openid-configuration`,title:t("openIDEndpointConfiguration")})}),e.jsx(Ie,{children:e.jsx(ft,{href:`${Pt(n.baseUrl)}realms/${l}/protocol/saml/descriptor`,title:t("samlIdentityProviderMetadata")})})]})}),e.jsxs(fe,{children:[e.jsx(P,{variant:"primary",type:"submit","data-testid":"general-tab-save",isDisabled:!j,children:t("common:save")}),e.jsx(P,{"data-testid":"general-tab-revert",variant:"link",onClick:v,children:t("common:revert")})]})]})})},Xe=["ACTIVE","PASSIVE","DISABLED"],ia=({onFilter:s})=>{const{t:a}=M("realm-settings"),[t,n]=c.useState(Xe[0]),[l,o]=Me();return e.jsx(re,{width:300,"data-testid":"filter-type-select",isOpen:l,className:"kc-filter-type-select",variant:pe.single,onToggle:o,toggleIcon:e.jsx(Yt,{}),onSelect:(m,u)=>{const p=Xe.find(i=>i===u.toString())||Xe[0];n(p),s(p),o()},selections:t,children:Xe.map(m=>e.jsx(te,{"data-testid":`${m}-option`,value:m,children:a(`keysFilter.${m}`)},m))})},ra=({realmComponents:s})=>{const{t:a}=M("realm-settings"),t=$e(),[n,l]=c.useState(""),[o,m]=c.useState(""),{adminClient:u}=se(),{realm:p}=ae(),[i,j]=c.useState(),[g,S]=c.useState();ve(async()=>(await u.realms.getKeys({realm:p})).keys?.map(d=>{const w=s.find(A=>A.id===d.providerId);return{...d,provider:w?.name}}),j,[]);const[x,k]=de({titleKey:a("publicKeys").slice(0,-1),messageKey:n,continueButtonLabel:"common:close",continueButtonVariant:ee.primary,onConfirm:()=>Promise.resolve()}),[r,v]=de({titleKey:a("certificate"),messageKey:o,continueButtonLabel:"common:close",continueButtonVariant:ee.primary,onConfirm:()=>Promise.resolve()});return i?e.jsxs(Q,{variant:"light",padding:{default:"noPadding"},children:[e.jsx(k,{}),e.jsx(v,{}),e.jsx(Ke,{isNotCompact:!0,className:"kc-keys-list",loader:g||i,ariaLabelKey:"realm-settings:keysList",searchPlaceholderKey:"realm-settings:searchKey",searchTypeComponent:e.jsx(ia,{onFilter:h=>S(h!==Xe[0]?i.filter(({status:d})=>d===h):void 0)}),canSelectAll:!0,columns:[{name:"algorithm",displayKey:"realm-settings:algorithm",cellFormatters:[Je()],transforms:[Ge(15)]},{name:"type",displayKey:"type",cellFormatters:[Je()],transforms:[Ge(10)]},{name:"kid",displayKey:"realm-settings:kid",cellFormatters:[Je()],transforms:[Ge(10)]},{name:"use",displayKey:"realm-settings:use",cellFormatters:[Je()],transforms:[Ge(10)]},{name:"provider",displayKey:"realm-settings:provider",cellRenderer:({provider:h})=>h||"",cellFormatters:[Je()],transforms:[Ge(10)]},{name:"publicKeys",displayKey:"realm-settings:publicKeys",cellRenderer:({type:h,publicKey:d,certificate:w})=>h==="EC"?e.jsx(P,{onClick:()=>{x(),l(d)},variant:"secondary",id:"kc-public-key",children:a("publicKeys").slice(0,-1)}):h==="RSA"?e.jsxs("div",{className:"button-wrapper",children:[e.jsx(P,{onClick:()=>{x(),l(d)},variant:"secondary",id:d,children:a("publicKeys").slice(0,-1)}),e.jsx(P,{onClick:()=>{r(),m(w)},variant:"secondary",id:w,className:"kc-certificate",children:a("certificate")})]}):"",cellFormatters:[],transforms:[Ge(20)]}],isSearching:!!g,emptyState:e.jsx(Le,{hasIcon:!0,message:a("noKeys"),instructions:a("noKeysDescription"),primaryActionText:a("addProvider"),onPrimaryAction:()=>t(ht({realm:p,tab:"providers"}))})})]}):e.jsx(Pe,{})},oa=({providerType:s,onClose:a})=>{const{t}=M("realm-settings");return e.jsx(Ve,{className:"add-provider-modal",variant:_e.medium,title:t("addProvider"),isOpen:!0,onClose:a,children:e.jsx($s,{providerType:s,onClose:a})})},ca=({onConfirm:s,onClose:a})=>{const{t}=M("realm-settings"),l=Ee().componentTypes?.[St]??[];return e.jsx(Ve,{variant:"medium",title:t("addProvider"),isOpen:!0,onClose:a,children:e.jsx(Zt,{onSelectDataListItem:o=>{s(o)},"aria-label":t("addPredefinedMappers"),isCompact:!0,children:l.map(o=>e.jsx(es,{"aria-label":o.id,id:o.id,children:e.jsx(ts,{children:e.jsx(ss,{dataListCells:[e.jsx(bt,{"data-testid":`option-${o.id}`,children:o.id},`name-${o.id}`),e.jsx(bt,{width:2,children:o.helpText},`helpText-${o.helpText}`)]})})},o.id))})})},da=({realmComponents:s,refresh:a})=>{const{t}=M("realm-settings"),{addAlert:n,addError:l}=oe(),{adminClient:o}=se(),{realm:m}=ae(),[u,p]=c.useState(""),[i,j]=c.useState([]),[g,S]=Me(),k=Ee().componentTypes?.[St]??[],[r,v]=Me(),[h,d]=c.useState(),[w,A]=c.useState(),V=c.useMemo(()=>s.map(b=>{const N=k.find(H=>b.providerId===H.id);return{...b,providerDescription:N?.helpText}}),[s]),[K,E]=de({titleKey:"realm-settings:deleteProviderTitle",messageKey:t("deleteProviderConfirm",{provider:w?.name}),continueButtonLabel:"common:delete",continueButtonVariant:ee.danger,onConfirm:async()=>{try{await o.components.del({id:w.id,realm:m}),a(),n(t("deleteProviderSuccess"),Z.success)}catch(b){l("realm-settings:deleteProviderError",b)}}}),T=()=>{if(u!==""){p(u);const b=V.filter(N=>N.name?.includes(u)||N.providerId?.includes(u));j(b)}else p(""),j(V)},O=b=>{b.key==="Enter"&&T()},B=b=>{p(b)};return e.jsxs(e.Fragment,{children:[r&&e.jsx(ca,{onClose:()=>v(),onConfirm:b=>{S(),d(b),v()}}),g&&h&&e.jsx(oa,{providerType:h,onClose:()=>{S(),a()}}),e.jsx(E,{}),e.jsxs(Q,{variant:"light",padding:{default:"noPadding"},children:[e.jsx(Jt,{children:e.jsxs(Ks,{className:"providers-toolbar",children:[e.jsx(xe,{children:e.jsxs(ms,{children:[e.jsx(Bt,{name:"inputGroupName",id:"inputGroupName","data-testid":"provider-search-input",type:"search","aria-label":t("common:search"),placeholder:t("common:search"),onChange:B,onKeyDown:O}),e.jsx(P,{variant:ee.control,"aria-label":t("common:search"),onClick:T,children:e.jsx(Gt,{})})]})}),e.jsx(xe,{children:e.jsx(P,{"data-testid":"addProviderDropdown",className:"add-provider-dropdown",onClick:()=>v(),children:t("addProvider")})})]})}),e.jsx(Qt,{variant:"compact",className:"kc-draggable-table",keyField:"id",data:i.length===0?V:i,onDragFinish:async(b,N)=>{const H=V.map(D=>{const z={...D};return delete z.providerDescription,o.components.update({id:D.id},{...z,config:{priority:[(N.length-N.indexOf(D.id)+100).toString()]}})});try{await Promise.all(H),a(),n(t("saveProviderListSuccess"),Z.success)}catch(D){l("realm-settings:saveProviderError",D)}},columns:[{name:"name",displayKey:"realm-settings:name",cellRenderer:b=>e.jsx(ge,{"data-testid":"provider-name-link",to:us({realm:m,id:b.id,providerType:b.providerId}),children:b.name},b.name)},{name:"providerId",displayKey:"realm-settings:provider"},{name:"providerDescription",displayKey:"realm-settings:providerDescription"}],actions:[{title:t("common:delete"),onClick:(b,N,H)=>{A(H),K()}}]})]})]})},ma=s=>[...s].sort((t,n)=>{const l=Number(t.config?.priority),o=Number(n.config?.priority);return(isNaN(o)?0:o)-(isNaN(l)?0:l)}),ua=()=>{const{t:s}=M("realm-settings"),{adminClient:a}=se(),{realm:t}=ae(),[n,l]=c.useState(),[o,m]=c.useState(0),u=()=>{m(o+1)};ve(()=>a.components.find({type:St,realm:t}),g=>l(ma(g)),[o]);const p=g=>lt(ht({realm:t,tab:g})),i=p("list"),j=p("providers");return n?e.jsxs(nt,{mountOnEnter:!0,unmountOnExit:!0,defaultLocation:ht({realm:t,tab:"list"}),children:[e.jsx(F,{id:"keysList","data-testid":"rs-keys-list-tab","aria-label":"keys-list-subtab",title:e.jsx(U,{children:s("keysList")}),...i,children:e.jsx(ra,{realmComponents:n})}),e.jsx(F,{id:"providers","data-testid":"rs-providers-tab","aria-label":"rs-providers-tab",title:e.jsx(U,{children:s("providers")}),...j,children:e.jsx(da,{realmComponents:n,refresh:u})})]}):e.jsx(Pe,{})},pa=({handleModalToggle:s,save:a,form:{register:t,handleSubmit:n,formState:{errors:l}}})=>{const{t:o}=M("realm-settings");return e.jsx(Ve,{variant:_e.small,title:o("addMessageBundle"),isOpen:!0,onClose:s,actions:[e.jsx(P,{"data-testid":"add-bundle-confirm-button",variant:"primary",type:"submit",form:"bundle-form",children:o("common:create")},"confirm"),e.jsx(P,{id:"modal-cancel","data-testid":"cancel",variant:ee.link,onClick:()=>{s()},children:o("common:cancel")},"cancel")],children:e.jsxs(Tt,{id:"bundle-form",isHorizontal:!0,onSubmit:n(a),children:[e.jsx(f,{label:o("common:key"),name:"key",fieldId:"key-id",helperTextInvalid:o("common:required"),validated:l.key?ue.error:ue.default,isRequired:!0,children:e.jsx(le,{"data-testid":"key-input",autoFocus:!0,id:"key-id",validated:l.key?ue.error:ue.default,...t("key",{required:!0})})}),e.jsx(f,{label:o("common:value"),name:"add-value",fieldId:"value-id",helperTextInvalid:o("common:required"),validated:l.value?ue.error:ue.default,isRequired:!0,children:e.jsx(le,{"data-testid":"value-input",id:"value-id",validated:l.value?ue.error:ue.default,...t("value",{required:!0})})})]})})},ke=s=>{try{return new Intl.DisplayNames([s],{type:"language"}).of(s)}catch{return s}},ha=({save:s,realm:a})=>{const{t}=M("realm-settings"),{adminClient:n}=se(),[l,o]=c.useState(!1),[m,u]=c.useState(!1),[p,i]=c.useState(!1),[j,g]=c.useState(!1),[S,x]=c.useState(je),{setValue:k,getValues:r,control:v,handleSubmit:h,formState:d}=he(),[w,A]=c.useState(!1),[V,K]=c.useState([]),[E,T]=c.useState([]),O=Ee().themes,B=c.useMemo(()=>{const I=Object.values(O).flatMap(R=>R.flatMap(({locales:J})=>J||[]));return Array.from(new Set(I))},[O]),b=he({mode:"onChange"}),{addAlert:N,addError:H}=oe(),{realm:D}=ae(),{whoAmI:z}=vt(),W=a.supportedLocales?.length?a.supportedLocales:[je],ce=()=>{Ce(a,k),k("supportedLocales",W)};c.useEffect(ce,[]);const be=Te({control:v,name:"supportedLocales",defaultValue:W}),Fe=Te({control:v,name:"internationalizationEnabled",defaultValue:a.internationalizationEnabled}),[_,ye]=c.useState(0),[me,Ue]=c.useState(10),[we,Be]=c.useState(0),[Ae,dt]=c.useState(""),qe=()=>{ye(_+1)};ve(async()=>{let I=await n.realms.getRealmLocalizationTexts({first:we,max:me,realm:a.realm,selectedLocale:S||r("defaultLocale")||z.getLocale()}).catch(()=>[]);const R=J=>Object.entries(I).filter($=>$[J].includes(Ae));if(Ae){const J=Zs(R(0).concat(R(1)),Xt);I=Object.fromEntries(J)}return{result:I}},({result:I})=>{const R=Object.entries(I).slice(we,we+me+1);K(R);const J=R.map($=>({rowEditBtnAriaLabel:()=>t("rowEditBtnAriaLabel",{messageBundle:$[1]}),rowSaveBtnAriaLabel:()=>t("rowSaveBtnAriaLabel",{messageBundle:$[1]}),rowCancelBtnAriaLabel:()=>t("rowCancelBtnAriaLabel",{messageBundle:$[1]}),cells:[{title:(ne,Se,Re,We)=>e.jsx(jt,{value:ne,rowIndex:Se,cellIndex:Re,props:We,isDisabled:!0,handleTextInputChange:Qe,inputAriaLabel:$[0]}),props:{value:$[0]}},{title:(ne,Se,Re,We)=>e.jsx(jt,{value:ne,rowIndex:Se,cellIndex:Re,props:We,handleTextInputChange:Qe,inputAriaLabel:$[1]}),props:{value:$[1]}}]}));return T(J),R},[_,Ae,we,me]);const Qe=(I,R,J,$)=>{T(ne=>{const Se=wt(ne),Re=Se[J]?.cells?.[$];return Re.props.editableValue=I,Se})},y=async(I,R,J)=>{if(R===void 0)return;const $=wt(E);let ne;const Se=!!J&&Object.keys(J).length>0;if(Se?ne=Hs($[R],I,J):I==="cancel"?ne=_s($[R]):ne=zs($[R],I),$[R]=ne,!Se&&I==="save"){const Re=(ne.cells?.[0]).props.value,We=(ne.cells?.[1]).props.value;try{await n.realms.addLocalization({realm:a.realm,selectedLocale:S||r("defaultLocale")||je,key:Re},We),N(t("updateMessageBundleSuccess"),Z.success)}catch{N(t("updateMessageBundleError"),Z.danger)}}T($)},G=()=>{o(!l)},De=[e.jsx(Vt,{label:t("defaultLocale"),children:e.jsx(te,{value:je,children:ke(je)},je)},"group1"),e.jsx(ze,{},"divider"),e.jsx(Vt,{label:t("supportedLocales"),children:be.map(I=>e.jsx(te,{value:I,children:ke(I)},I))},"group2")],ls=async I=>{try{await n.realms.addLocalization({realm:D,selectedLocale:S||r("defaultLocale")||je,key:I.key},I.value),n.setConfig({realmName:D}),qe(),N(t("addMessageBundleSuccess"),Z.success)}catch(R){H(t("addMessageBundleError"),R)}},is=async I=>{try{await n.realms.deleteRealmLocalizationTexts({realm:D,selectedLocale:S,key:I}),qe(),N(t("deleteMessageBundleSuccess"))}catch(R){H("realm-settings:deleteMessageBundleError",R)}};return e.jsxs(e.Fragment,{children:[l&&e.jsx(pa,{handleModalToggle:G,save:I=>{ls(I),G()},form:b}),e.jsxs(Q,{variant:"light",children:[e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:h(s),children:[e.jsx(f,{label:t("internationalization"),fieldId:"kc-internationalization",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:internationalization"),fieldLabelId:"realm-settings:internationalization"}),children:e.jsx(L,{name:"internationalizationEnabled",control:v,defaultValue:a.internationalizationEnabled,render:({field:I})=>e.jsx(X,{id:"kc-l-internationalization",label:t("common:enabled"),labelOff:t("common:disabled"),isChecked:I.value,"data-testid":I.value?"internationalization-enabled":"internationalization-disabled",onChange:I.onChange,"aria-label":t("internationalization")})})}),Fe&&e.jsxs(e.Fragment,{children:[e.jsx(f,{label:t("supportedLocales"),fieldId:"kc-l-supported-locales",children:e.jsx(L,{name:"supportedLocales",control:v,defaultValue:W,render:({field:I})=>e.jsx(re,{toggleId:"kc-l-supported-locales",onToggle:R=>{u(R)},onSelect:(R,J)=>{const $=J;I.value.includes($)?I.onChange(I.value.filter(ne=>ne!==$)):I.onChange([...I.value,$])},onClear:()=>{I.onChange([])},selections:I.value,variant:pe.typeaheadMulti,"aria-label":t("supportedLocales"),isOpen:m,placeholderText:t("selectLocales"),children:B.map(R=>e.jsx(te,{selected:I.value.includes(R),value:R,children:ke(R)},R))})})}),e.jsx(f,{label:t("defaultLocale"),fieldId:"kc-l-default-locale",children:e.jsx(L,{name:"defaultLocale",control:v,defaultValue:je,render:({field:I})=>e.jsx(re,{toggleId:"kc-default-locale",onToggle:()=>i(!p),onSelect:(R,J)=>{I.onChange(J),i(!1)},selections:I.value?ke(I.value):a.defaultLocale!==""?ke(a.defaultLocale||je):t("placeholderText"),variant:pe.single,"aria-label":t("defaultLocale"),isOpen:p,placeholderText:t("placeholderText"),"data-testid":"select-default-locale",children:be.map((R,J)=>e.jsx(te,{value:R,children:ke(R)},`default-locale-${J}`))})})})]}),e.jsxs(fe,{children:[e.jsx(P,{variant:"primary",isDisabled:!d.isDirty,type:"submit","data-testid":"localization-tab-save",children:t("common:save")}),e.jsx(P,{variant:"link",onClick:ce,children:t("common:revert")})]})]}),e.jsxs(ie,{className:"kc-message-bundles",title:"Edit message bundles",children:[e.jsx(ct,{className:"messageBundleDescription",children:t("messageBundleDescription")}),e.jsx("div",{className:"tableBorder",children:e.jsxs(Vs,{count:V.length,first:we,max:me,onNextClick:Be,onPreviousClick:Be,onPerPageSelect:(I,R)=>{Be(I),Ue(R)},inputGroupName:"common:search",inputGroupOnEnter:I=>{dt(I),Be(0),Ue(10)},inputGroupPlaceholder:t("searchForMessageBundle"),toolbarItem:e.jsx(P,{"data-testid":"add-bundle-button",onClick:()=>o(!0),children:t("addMessageBundle")}),searchTypeComponent:e.jsx(xe,{children:e.jsx(re,{width:180,"data-testid":"filter-by-locale-select",isOpen:j,className:"kc-filter-by-locale-select",variant:pe.single,isDisabled:!Fe,onToggle:I=>g(I),onSelect:(I,R)=>{x(R.toString()),A(!0),qe(),g(!1)},selections:w?ke(S):a.defaultLocale!==""?ke(je):t("placeholderText"),children:De})}),children:[V.length===0&&!Ae&&e.jsx(Le,{hasIcon:!0,message:t("noMessageBundles"),instructions:t("noMessageBundlesInstructions"),onPrimaryAction:G}),V.length===0&&Ae&&e.jsx(Le,{hasIcon:!0,icon:Gt,isSearchVariant:!0,message:t("common:noSearchResults"),instructions:t("common:noSearchResultsInstructions")}),V.length!==0&&e.jsxs(Ns,{"aria-label":t("editableRowsTable"),"data-testid":"editable-rows-table",variant:Gs.compact,cells:[t("common:key"),t("common:value")],rows:E,onRowEdit:(I,R,J,$,ne)=>y(R,$,ne),actions:[{title:t("common:delete"),onClick:(I,R)=>is((E[R].cells?.[0]).props.value)}],children:[e.jsx(Os,{}),e.jsx(Ms,{})]})]})})]})]})]})},ga=({realm:s,refresh:a})=>{const{t}=M("realm-settings"),{addAlert:n,addError:l}=oe(),{adminClient:o}=se(),{realm:m}=ae(),u=async p=>{const i=Array.isArray(p)?Object.keys(p[0])[0]:Object.keys(p)[0];try{await o.realms.update({realm:m},Array.isArray(p)?p.reduce((j,g)=>Object.assign(j,g),s):Object.assign(s,p)),n(t("enableSwitchSuccess",{switch:t(i)})),a()}catch(j){l(t("enableSwitchError"),j)}};return e.jsxs(Q,{variant:"light",children:[e.jsx(ie,{className:"kc-login-screen",title:t("loginScreenCustomization"),children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",children:[e.jsx(f,{label:t("registrationAllowed"),fieldId:"kc-user-reg",labelIcon:e.jsx(C,{helpText:t("userRegistrationHelpText"),fieldLabelId:"realm-settings:registrationAllowed"}),hasNoPaddingTop:!0,children:e.jsx(X,{id:"kc-user-reg-switch","data-testid":"user-reg-switch",value:s.registrationAllowed?"on":"off",label:t("common:on"),labelOff:t("common:off"),isChecked:s.registrationAllowed,onChange:p=>{u({registrationAllowed:p})},"aria-label":t("registrationAllowed")})}),e.jsx(f,{label:t("resetPasswordAllowed"),fieldId:"kc-forgot-pw",labelIcon:e.jsx(C,{helpText:t("realm-settings:forgotPasswordHelpText"),fieldLabelId:"realm-settings:resetPasswordAllowed"}),hasNoPaddingTop:!0,children:e.jsx(X,{id:"kc-forgot-pw-switch","data-testid":"forgot-pw-switch",name:"resetPasswordAllowed",value:s.resetPasswordAllowed?"on":"off",label:t("common:on"),labelOff:t("common:off"),isChecked:s.resetPasswordAllowed,onChange:p=>{u({resetPasswordAllowed:p})},"aria-label":t("resetPasswordAllowed")})}),e.jsx(f,{label:t("rememberMe"),fieldId:"kc-remember-me",labelIcon:e.jsx(C,{helpText:t("realm-settings:rememberMeHelpText"),fieldLabelId:"realm-settings:rememberMe"}),hasNoPaddingTop:!0,children:e.jsx(X,{id:"kc-remember-me-switch","data-testid":"remember-me-switch",value:s.rememberMe?"on":"off",label:t("common:on"),labelOff:t("common:off"),isChecked:s.rememberMe,onChange:p=>{u({rememberMe:p})},"aria-label":t("rememberMe")})})]})}),e.jsx(ie,{className:"kc-email-settings",title:t("emailSettings"),children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",children:[e.jsx(f,{label:t("registrationEmailAsUsername"),fieldId:"kc-email-as-username",labelIcon:e.jsx(C,{helpText:t("realm-settings:emailAsUsernameHelpText"),fieldLabelId:"realm-settings:registrationEmailAsUsername"}),hasNoPaddingTop:!0,children:e.jsx(X,{id:"kc-email-as-username-switch","data-testid":"email-as-username-switch",value:s.registrationEmailAsUsername?"on":"off",label:t("common:on"),labelOff:t("common:off"),isChecked:s.registrationEmailAsUsername,onChange:p=>{u([{registrationEmailAsUsername:p},{duplicateEmailsAllowed:!1}])},"aria-label":t("registrationEmailAsUsername")})}),e.jsx(f,{label:t("loginWithEmailAllowed"),fieldId:"kc-login-with-email",labelIcon:e.jsx(C,{helpText:t("realm-settings:loginWithEmailHelpText"),fieldLabelId:"realm-settings:loginWithEmailAllowed"}),hasNoPaddingTop:!0,children:e.jsx(X,{id:"kc-login-with-email-switch","data-testid":"login-with-email-switch",value:s.loginWithEmailAllowed?"on":"off",label:t("common:on"),labelOff:t("common:off"),isChecked:s.loginWithEmailAllowed,onChange:p=>{u([{loginWithEmailAllowed:p},{duplicateEmailsAllowed:!1}])},"aria-label":t("loginWithEmailAllowed")})}),e.jsx(f,{label:t("duplicateEmailsAllowed"),fieldId:"kc-duplicate-emails",labelIcon:e.jsx(C,{helpText:t("realm-settings:duplicateEmailsHelpText"),fieldLabelId:"realm-settings:duplicateEmailsAllowed"}),hasNoPaddingTop:!0,children:e.jsx(X,{id:"kc-duplicate-emails-switch","data-testid":"duplicate-emails-switch",label:t("common:on"),labelOff:t("common:off"),isChecked:s.duplicateEmailsAllowed||s.loginWithEmailAllowed&&s.registrationEmailAsUsername,onChange:p=>{u({duplicateEmailsAllowed:p})},isDisabled:s.loginWithEmailAllowed||s.registrationEmailAsUsername,"aria-label":t("duplicateEmailsAllowed")})}),e.jsx(f,{label:t("verifyEmail"),fieldId:"kc-verify-email",labelIcon:e.jsx(C,{helpText:t("realm-settings:verifyEmailHelpText"),fieldLabelId:"realm-settings:verifyEmail"}),hasNoPaddingTop:!0,children:e.jsx(X,{id:"kc-verify-email-switch","data-testid":"verify-email-switch",name:"verifyEmail",value:s.verifyEmail?"on":"off",label:t("common:on"),labelOff:t("common:off"),isChecked:s.verifyEmail,onChange:p=>{u({verifyEmail:p})},"aria-label":t("verifyEmail")})})]})}),e.jsx(ie,{className:"kc-user-info-settings",title:t("userInfoSettings"),children:e.jsx(Y,{isHorizontal:!0,role:"manage-realm",children:e.jsx(f,{label:t("editUsernameAllowed"),fieldId:"kc-edit-username",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:editUsername"),fieldLabelId:"realm-settings:editUsernameAllowed"}),hasNoPaddingTop:!0,children:e.jsx(X,{id:"kc-edit-username-switch","data-testid":"edit-username-switch",value:s.editUsernameAllowed?"on":"off",label:t("common:on"),labelOff:t("common:off"),isChecked:s.editUsernameAllowed,onChange:p=>{u({editUsernameAllowed:p})},"aria-label":t("editUsernameAllowed")})})})})]})};const fa=({isOpen:s,onClose:a})=>{const{t}=M("realm-settings"),{realm:n}=ae(),{adminClient:l}=se(),{addAlert:o,addError:m}=oe(),[u,p]=c.useState(!1),[i,j]=c.useState(!1),[g,S]=c.useState(!1),x=u||i;async function k(){S(!0);try{const r=await l.realms.export({realm:n,exportClients:i,exportGroupsAndRoles:u});ps.saveAs(new Blob([Ye(r)],{type:"application/json"}),"realm-export.json"),o(t("exportSuccess"),Z.success),a()}catch(r){m("exportFail",r)}S(!1)}return e.jsxs(Ve,{variant:_e.small,title:t("partialExport"),isOpen:s,onClose:a,actions:[e.jsx(P,{"data-testid":"export-button",isDisabled:g,onClick:k,children:t("common:export")},"export"),e.jsx(P,{"data-testid":"cancel-button",variant:ee.link,onClick:a,children:t("common:cancel")},"cancel")],children:[e.jsx(ct,{children:e.jsx(Oe,{children:t("partialExportHeaderText")})}),e.jsxs(Tt,{isHorizontal:!0,className:"keycloak__realm-settings__partial-import_form",children:[e.jsx(f,{label:t("includeGroupsAndRoles"),fieldId:"include-groups-and-roles-check",hasNoPaddingTop:!0,children:e.jsx(X,{id:"include-groups-and-roles-check","data-testid":"include-groups-and-roles-check",isChecked:u,onChange:p,label:t("common:on"),labelOff:t("common:off"),"aria-label":t("includeGroupsAndRoles")})}),e.jsx(f,{label:t("includeClients"),fieldId:"include-clients-check",hasNoPaddingTop:!0,children:e.jsx(X,{id:"include-clients-check","data-testid":"include-clients-check",onChange:j,isChecked:i,label:t("common:on"),labelOff:t("common:off"),"aria-label":t("includeClients")})})]}),x&&e.jsx(at,{"data-testid":"warning-message",variant:"warning",title:t("exportWarningTitle"),isInline:!0,children:t("exportWarningDescription")})]})},Ut={users:!1,clients:!1,groups:!1,identityProviders:!1,realmRoles:!1,clientRoles:!1},xa=s=>{const{t:a}=M("realm-settings"),{adminClient:t}=se(),{realm:n}=ae(),[l,o]=c.useState(),m=!!l,[u,p]=c.useState(!1),[i,j]=c.useState(!1),[g,S]=c.useState(!1),[x,k]=c.useState("FAIL"),[r,v]=c.useState({}),[h,d]=c.useState(),{addError:w}=oe(),[A,V]=c.useState(Ut),K=Object.values(A).some(y=>y),E=()=>{V(Ut)},T=()=>{o(void 0),v({}),k("FAIL"),E()};c.useEffect(()=>{S(!1),d(void 0),T()},[s.open]);const O=y=>{T(),o(y),Array.isArray(y)?y.length>0&&v(y[0]):v(y)},B=y=>{v(y),p(!1),E()},b=(y,G)=>{const De=G.currentTarget.name;V({...A,[De]:y})},N=y=>y.map(G=>e.jsx(te,{value:G,"data-testid":G.id+"-select-option",children:G.realm||G.id},G.id)),H=(y,G)=>{k(G),j(!1)},D=()=>[e.jsx(te,{value:"FAIL",children:a("FAIL")},"fail"),e.jsx(te,{value:"SKIP",children:a("SKIP")},"skip"),e.jsx(te,{value:"OVERWRITE",children:a("OVERWRITE")},"overwrite")],z=()=>W("users")||W("groups")||W("clients")||W("identityProviders")||ce()||be(),W=y=>{const G=r[y];return G!==void 0&&G.length>0},ce=()=>{const y=r.roles?.realm;return y!==void 0&&y.length>0},be=()=>{const y=r.roles?.client;return y!==void 0&&Object.keys(y).length>0},Fe=y=>m?y==="realmRoles"?r.roles?.realm?.length??0:y==="clientRoles"?be()?_(r.roles.client):0:r[y]?.length??0:0,_=y=>Object.values(y).reduce((G,De)=>G+De.length,0),ye=(y,G)=>e.jsx(es,{"aria-labelledby":`${y}-list-item`,children:e.jsx(ts,{children:e.jsx(ss,{dataListCells:[e.jsx(bt,{children:e.jsx(xt,{id:`${y}-checkbox`,label:`${Fe(y)} ${G}`,"aria-labelledby":`${y}-checkbox`,name:y,isChecked:A[y],onChange:b,"data-testid":y+"-checkbox"})},y)]})})}),me=()=>{const y={ifResourceExists:x,id:r.id,realm:r.realm};return A.users&&(y.users=r.users),A.groups&&(y.groups=r.groups),A.identityProviders&&(y.identityProviders=r.identityProviders),A.clients&&(y.clients=r.clients),(A.realmRoles||A.clientRoles)&&(y.roles=r.roles,A.realmRoles||delete y.roles?.realm,A.clientRoles||delete y.roles?.client),y};async function Ue(){if(!g){S(!0);try{const y=await t.realms.partialImport({realm:n,rep:me()});d(y)}catch(y){w("realm-settings:importFail",y)}S(!1)}}const we=()=>e.jsx(Ve,{variant:_e.medium,title:a("partialImport"),isOpen:s.open,onClose:s.toggleDialog,actions:[e.jsx(P,{id:"modal-import","data-testid":"import-button",isDisabled:!K,onClick:()=>{Ue()},children:a("import")},"import"),e.jsx(P,{id:"modal-cancel","data-testid":"cancel-button",variant:ee.link,onClick:()=>{s.toggleDialog()},children:a("common:cancel")},"cancel")],children:e.jsxs(Wt,{hasGutter:!0,children:[e.jsx(Ie,{children:e.jsx(ct,{children:e.jsx(Oe,{children:a("partialImportHeaderText")})})}),e.jsx(Ie,{children:e.jsx(Ws,{id:"partial-import-file",allowEditingUploadedText:!0,onChange:O})}),m&&z()&&e.jsxs(e.Fragment,{children:[e.jsx(Ie,{children:e.jsx(ze,{})}),Array.isArray(l)&&l.length>1&&e.jsxs(Ie,{children:[e.jsxs(Oe,{children:[a("selectRealm"),":"]}),e.jsx(re,{toggleId:"realm-selector",isOpen:u,onToggle:()=>p(!u),onSelect:(y,G)=>B(G),placeholderText:r.realm||r.id,children:N(l)})]}),e.jsxs(Ie,{children:[e.jsxs(Oe,{children:[a("chooseResources"),":"]}),e.jsxs(Zt,{"aria-label":a("resourcesToImport"),isCompact:!0,children:[W("users")&&ye("users",a("common:users")),W("groups")&&ye("groups",a("common:groups")),W("clients")&&ye("clients",a("common:clients")),W("identityProviders")&&ye("identityProviders",a("common:identityProviders")),ce()&&ye("realmRoles",a("common:realmRoles")),be()&&ye("clientRoles",a("common:clientRoles"))]})]}),e.jsxs(Ie,{children:[e.jsxs(Oe,{children:[a("selectIfResourceExists"),":"]}),e.jsx(re,{isOpen:i,direction:"up",onToggle:()=>{j(!i)},onSelect:H,placeholderText:a(x),children:D()})]})]})]})}),Be=()=>`${a("importAdded",{count:h?.added})}  ${a("importSkipped",{count:h?.skipped})} ${a("importOverwritten",{count:h?.overwritten})}`,Ae=async(y=0,G=15)=>{if(!h)return[];const De=Math.min(y+G,h.results.length);return h.results.slice(y,De)},dt=y=>{switch(y.action){case"ADDED":return e.jsx(tt,{color:"green",children:a("added")},y.id);case"SKIPPED":return e.jsx(tt,{color:"orange",children:a("skipped")},y.id);case"OVERWRITTEN":return e.jsx(tt,{color:"purple",children:a("overwritten")},y.id);default:return""}},qe=y=>{const G=new Map([["CLIENT",a("common:clients")],["REALM_ROLE",a("common:realmRoles")],["USER",a("common:users")],["CLIENT_ROLE",a("common:clientRoles")],["IDP",a("common:identityProviders")],["GROUP",a("common:groups")]]);return e.jsx("span",{children:G.get(y.resourceType)})},Qe=()=>e.jsxs(Ve,{variant:_e.medium,title:a("partialImport"),isOpen:s.open,onClose:s.toggleDialog,actions:[e.jsx(P,{id:"modal-close","data-testid":"close-button",variant:ee.primary,onClick:()=>{s.toggleDialog()},children:a("common:close")},"close")],children:[e.jsx(at,{variant:"success",isInline:!0,title:Be()}),e.jsx(Ke,{loader:Ae,isPaginated:!0,ariaLabelKey:"realm-settings:partialImport",columns:[{name:"action",displayKey:"common:action",cellRenderer:dt},{name:"resourceType",displayKey:"common:type",cellRenderer:qe},{name:"resourceName",displayKey:"common:name"},{name:"id",displayKey:"common:id"}]})]});return h?Qe():we()},ba=()=>{const{t:s}=M("realm-settings"),{adminClient:a}=se(),{addAlert:t,addError:n}=oe(),{realm:l}=ae(),o=$e(),[m,u]=c.useState(!1),[p,i]=c.useState(),[j,g]=c.useState(),[S,x]=c.useState(0),[k,r]=c.useState(),[v,h]=c.useState(),d=()=>x(S+1),w=he({mode:"onChange"});ve(()=>a.clientPolicies.listPolicies(),b=>{i(b.policies),h(b.policies||[]),r(Ye(b.policies))},[S]);const A=async()=>p??[],V=async()=>{const b=w.getValues(),N=p?.map(H=>{const D=b[H.name];return{...H,enabled:D}});try{await a.clientPolicies.updatePolicy({policies:N}),o(gt({realm:l,tab:"policies"})),t(s("realm-settings:updateClientPolicySuccess"),Z.success)}catch(H){n("realm-settings:updateClientPolicyError",H)}},K=({name:b})=>e.jsx(ge,{to:hs({realm:l,policyName:b}),children:b}),E=({clientPolicy:b})=>{const[N,H]=de({titleKey:"realm-settings:disablePolicyConfirmTitle",messageKey:"realm-settings:disablePolicyConfirm",continueButtonLabel:"common:disable",onConfirm:()=>{w.setValue(b.name,!1),V()}});return e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsx(L,{name:b.name,"data-testid":`${b.name}-switch`,defaultValue:b.enabled,control:w.control,render:({field:D})=>e.jsx(X,{label:s("common:enabled"),labelOff:s("common:disabled"),isChecked:D.value,onChange:z=>{z?(D.onChange(z),V()):N()},"aria-label":b.name})})]})},T=async()=>{if(k)try{const b=JSON.parse(k);try{await a.clientPolicies.updatePolicy({policies:b}),t(s("realm-settings:updateClientPoliciesSuccess"),Z.success),d()}catch(N){n("realm-settings:updateClientPoliciesError",N)}}catch(b){console.warn("Invalid json, ignoring value using {}"),n("realm-settings:updateClientPoliciesError",b)}},[O,B]=de({titleKey:s("deleteClientPolicyConfirmTitle"),messageKey:s("deleteClientPolicyConfirm",{policyName:j?.name}),continueButtonLabel:s("delete"),continueButtonVariant:ee.danger,onConfirm:async()=>{const b=p?.filter(N=>N.name!==j?.name);try{await a.clientPolicies.updatePolicy({policies:b}),t(s("deleteClientPolicySuccess"),Z.success),d()}catch(N){n(s("deleteClientPolicyError"),N)}}});return p?e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsx(Q,{children:e.jsxs(as,{className:"kc-policies-config-section",children:[e.jsx(He,{children:e.jsx(Ht,{headingLevel:"h1",size:"md",children:s("policiesConfigType")})}),e.jsx(He,{children:e.jsx(it,{isChecked:!m,name:"policiesView",onChange:()=>u(!1),label:s("policiesConfigTypes.formView"),id:"formView-policiesView","data-testid":"formView-policiesView",className:"kc-form-radio-btn pf-u-mr-sm pf-u-ml-sm"})}),e.jsx(He,{children:e.jsx(it,{isChecked:m,name:"policiesView",onChange:()=>u(!0),label:s("policiesConfigTypes.jsonEditor"),id:"jsonEditor-policiesView","data-testid":"jsonEditor-policiesView",className:"kc-editor-radio-btn"})})]})}),e.jsx(ze,{}),m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pf-u-mt-md pf-u-ml-lg",children:e.jsx(kt,{isLineNumbersVisible:!0,isLanguageLabelVisible:!0,isReadOnly:!1,code:k,language:It.json,height:"30rem",onChange:r})}),e.jsxs("div",{className:"pf-u-mt-md",children:[e.jsx(P,{variant:ee.primary,className:"pf-u-mr-md pf-u-ml-lg","data-testid":"jsonEditor-policies-saveBtn",onClick:T,children:s("save")}),e.jsx(P,{variant:ee.link,"data-testid":"jsonEditor-reloadBtn",onClick:()=>{r(Ye(v))},children:s("reload")})]})]}):e.jsx(Ke,{emptyState:e.jsx(Le,{message:s("realm-settings:noClientPolicies"),instructions:s("realm-settings:noClientPoliciesInstructions"),primaryActionText:s("realm-settings:createClientPolicy"),onPrimaryAction:()=>o(At({realm:l}))}),ariaLabelKey:"realm-settings:clientPolicies",searchPlaceholderKey:"realm-settings:clientPolicySearch",loader:A,toolbarItem:e.jsx(xe,{children:e.jsx(P,{id:"createPolicy",component:b=>e.jsx(ge,{...b,to:At({realm:l})}),"data-testid":"createPolicy",children:s("createClientPolicy")})}),actions:[{title:s("common:delete"),onRowClick:b=>{O(),g(b)}}],columns:[{name:"name",cellRenderer:K},{name:"enabled",displayKey:"realm-settings:status",cellRenderer:b=>e.jsx(E,{clientPolicy:b})},{name:"description"}]},p.length)]}):e.jsx(Pe,{})};function ja(){const{t:s}=M("realm-settings"),{adminClient:a}=se(),{realm:t}=ae(),{addAlert:n,addError:l}=oe(),[o,m]=c.useState(),[u,p]=c.useState(),[i,j]=c.useState(),[g,S]=c.useState(!1),[x,k]=c.useState(),[r,v]=c.useState(0);ve(()=>a.clientPolicies.listProfiles({includeGlobalProfiles:!0}),E=>{p(E.globalProfiles);const T=E.globalProfiles?.map(b=>({...b,global:!0})),O=E.profiles?.map(b=>({...b,global:!1})),B=T?.concat(O??[]);m(B||[]),k(JSON.stringify(B,null,2))},[r]);const h=async()=>o??[],d=E=>fs(E,"global"),[w,A]=de({titleKey:s("deleteClientProfileConfirmTitle"),messageKey:s("deleteClientProfileConfirm",{profileName:i?.name}),continueButtonLabel:s("delete"),continueButtonVariant:ee.danger,onConfirm:async()=>{const E=o?.filter(T=>T.name!==i?.name&&!T.global).map(T=>d(T));try{await a.clientPolicies.createProfiles({profiles:E,globalProfiles:u}),n(s("deleteClientSuccess"),Z.success),v(r+1)}catch(T){l(s("deleteClientError"),T)}}}),V=E=>e.jsxs(ge,{to:xs({realm:t,profileName:E.name}),children:[E.name," ",E.global&&e.jsx(tt,{color:"blue",children:s("global")})]},E.name);if(!o)return e.jsx(Pe,{});const K=async()=>{if(x)try{const E=JSON.parse(x),T=E.filter(B=>!B.global).map(B=>d(B)),O=E.filter(B=>B.global).map(B=>d(B));try{await a.clientPolicies.createProfiles({profiles:T,globalProfiles:O}),n(s("realm-settings:updateClientProfilesSuccess"),Z.success),v(r+1)}catch(B){l("realm-settings:updateClientProfilesError",B)}}catch{console.warn("Invalid json, ignoring value using {}")}};return e.jsxs(e.Fragment,{children:[e.jsx(A,{}),e.jsx(Q,{children:e.jsxs(as,{className:"kc-profiles-config-section",children:[e.jsx(He,{children:e.jsx(Ht,{headingLevel:"h1",size:"md",children:s("profilesConfigType")})}),e.jsx(He,{children:e.jsx(it,{isChecked:!g,name:"profilesView",onChange:()=>S(!1),label:s("profilesConfigTypes.formView"),id:"formView-profilesView",className:"kc-form-radio-btn pf-u-mr-sm pf-u-ml-sm","data-testid":"formView-profilesView"})}),e.jsx(He,{children:e.jsx(it,{isChecked:g,name:"profilesView",onChange:()=>S(!0),label:s("profilesConfigTypes.jsonEditor"),id:"jsonEditor-profilesView",className:"kc-editor-radio-btn","data-testid":"jsonEditor-profilesView"})})]})}),e.jsx(ze,{}),g?e.jsxs(f,{fieldId:"jsonEditor",children:[e.jsx("div",{className:"pf-u-mt-md pf-u-ml-lg",children:e.jsx(kt,{isLineNumbersVisible:!0,isLanguageLabelVisible:!0,isReadOnly:!1,code:x,language:It.json,height:"30rem",onChange:E=>{k(E??"")}})}),e.jsx(fe,{children:e.jsxs("div",{className:"pf-u-mt-md",children:[e.jsx(P,{variant:ee.primary,className:"pf-u-mr-md pf-u-ml-lg",onClick:K,"data-testid":"jsonEditor-saveBtn",children:s("save")}),e.jsx(P,{variant:ee.link,onClick:()=>{k(Ye(o))},"data-testid":"jsonEditor-reloadBtn",children:s("reload")})]})})]}):e.jsx(Ke,{ariaLabelKey:"realm-settings:profiles",searchPlaceholderKey:"realm-settings:clientProfileSearch",loader:h,toolbarItem:e.jsx(xe,{children:e.jsx(P,{id:"createProfile",component:E=>e.jsx(ge,{...E,to:gs({realm:t,tab:"profiles"})}),"data-testid":"createProfile",children:s("createClientProfile")})}),isRowDisabled:E=>E.global,actions:[{title:s("common:delete"),onRowClick:E=>{j(E),w()}}],columns:[{name:"name",displayKey:s("common:name"),cellRenderer:V},{name:"description",displayKey:s("clientProfileDescription")}],emptyState:e.jsx(Le,{message:s("emptyClientProfiles"),instructions:s("emptyClientProfilesInstructions")})},o.length)]})}const Ne=({fieldName:s,url:a})=>{const{t}=M("realm-settings"),{register:n}=_t(),l=s.substr(s.indexOf(".")+1);return e.jsx(f,{label:t(l),fieldId:l,labelIcon:e.jsx(C,{helpText:e.jsxs(rt,{i18nKey:`realm-settings-help:${l}`,children:["Default value prevents pages from being included",e.jsx(ft,{href:a,title:t("common:learnMore")})]}),fieldLabelId:l}),children:e.jsx(le,{id:l,...n(s)})})};const va=({realm:s,save:a})=>{const{t}=M(),n=he(),{setValue:l,formState:{isDirty:o},handleSubmit:m}=n,u=()=>Ce(s,l);return c.useEffect(u,[]),e.jsx(yt,{...n,children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",className:"keycloak__security-defences__form",onSubmit:m(a),children:[e.jsx(Ne,{fieldName:"browserSecurityHeaders.xFrameOptions",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options"}),e.jsx(Ne,{fieldName:"browserSecurityHeaders.contentSecurityPolicy",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy"}),e.jsx(Ne,{fieldName:"browserSecurityHeaders.contentSecurityPolicyReportOnly",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy-Report-Only"}),e.jsx(Ne,{fieldName:"browserSecurityHeaders.xContentTypeOptions",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options"}),e.jsx(Ne,{fieldName:"browserSecurityHeaders.xRobotsTag",url:"https://developers.google.com/search/docs/advanced/robots/robots_meta_tag"}),e.jsx(Ne,{fieldName:"browserSecurityHeaders.xXSSProtection",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection"}),e.jsx(Ne,{fieldName:"browserSecurityHeaders.strictTransportSecurity",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security"}),e.jsxs(fe,{children:[e.jsx(P,{variant:"primary",type:"submit","data-testid":"headers-form-tab-save",isDisabled:!o,children:t("common:save")}),e.jsx(P,{variant:"link",onClick:u,children:t("common:revert")})]})]})})},et=({name:s,style:a})=>{const{t}=M("realm-settings"),{control:n,formState:{errors:l}}=_t();return e.jsx(f,{style:a,label:t(s),fieldId:s,labelIcon:e.jsx(C,{helpText:t(`realm-settings-help:${s}`),fieldLabelId:`realm-settings:${s}`}),validated:l[s]?ue.error:ue.default,helperTextInvalid:t("common:required"),children:e.jsx(L,{name:s,defaultValue:"",control:n,rules:{required:!0},render:({field:o})=>e.jsx(q,{"data-testid":s,value:o.value,onChange:o.onChange,validated:l[s]?ue.error:ue.default})})})},ya=({realm:s,save:a})=>{const{t}=M("realm-settings"),n=he(),{setValue:l,handleSubmit:o,control:m,formState:{isDirty:u}}=n,p=Te({control:m,name:"bruteForceProtected"}),i=Te({control:m,name:"permanentLockout"}),j=()=>Ce(s,l);return c.useEffect(j,[]),e.jsx(yt,{...n,children:e.jsxs(Y,{role:"manage-realm",isHorizontal:!0,onSubmit:o(a),children:[e.jsx(f,{label:t("common:enabled"),fieldId:"bruteForceProtected",hasNoPaddingTop:!0,children:e.jsx(L,{name:"bruteForceProtected",defaultValue:!1,control:m,render:({field:g})=>e.jsx(X,{id:"bruteForceProtected",label:t("common:on"),labelOff:t("common:off"),isChecked:g.value,onChange:g.onChange})})}),p&&e.jsxs(e.Fragment,{children:[e.jsx(f,{label:t("failureFactor"),labelIcon:e.jsx(C,{helpText:t("realm-settings-help:failureFactor"),fieldLabelId:"realm-settings:failureFactor"}),fieldId:"failureFactor",children:e.jsx(L,{name:"failureFactor",defaultValue:0,control:m,rules:{required:!0},render:({field:g})=>e.jsx(ot,{type:"text",id:"failureFactor",value:g.value,onPlus:()=>g.onChange(g.value+1),onMinus:()=>g.onChange(g.value-1),onChange:S=>g.onChange(Number(S.target.value))})})}),e.jsx(f,{label:t("permanentLockout"),fieldId:"permanentLockout",hasNoPaddingTop:!0,children:e.jsx(L,{name:"permanentLockout",defaultValue:!1,control:m,render:({field:g})=>e.jsx(X,{id:"permanentLockout",label:t("common:on"),labelOff:t("common:off"),isChecked:g.value,onChange:g.onChange,"aria-label":t("permanentLockout")})})}),!i&&e.jsxs(e.Fragment,{children:[e.jsx(et,{name:"waitIncrementSeconds"}),e.jsx(et,{name:"maxFailureWaitSeconds"}),e.jsx(et,{name:"maxDeltaTimeSeconds"})]}),e.jsx(f,{label:t("quickLoginCheckMilliSeconds"),labelIcon:e.jsx(C,{helpText:t("realm-settings-help:quickLoginCheckMilliSeconds"),fieldLabelId:"realm-settings:quickLoginCheckMilliSeconds"}),fieldId:"quickLoginCheckMilliSeconds",children:e.jsx(L,{name:"quickLoginCheckMilliSeconds",defaultValue:0,control:m,render:({field:g})=>e.jsx(ot,{type:"text",id:"quickLoginCheckMilliSeconds",value:g.value,onPlus:()=>g.onChange(g.value+1),onMinus:()=>g.onChange(g.value-1),onChange:S=>g.onChange(Number(S.target.value))})})}),e.jsx(et,{name:"minimumQuickLoginWaitSeconds"})]}),e.jsxs(fe,{children:[e.jsx(P,{variant:"primary",type:"submit","data-testid":"brute-force-tab-save",isDisabled:!u,children:t("common:save")}),e.jsx(P,{variant:"link",onClick:j,children:t("common:revert")})]})]})})},Sa=({realm:s,save:a})=>{const{t}=M("realm-settings"),[n,l]=c.useState(10);return e.jsxs(Ct,{activeKey:n,onSelect:(o,m)=>l(m),children:[e.jsx(F,{id:"headers",eventKey:10,title:e.jsx(U,{children:t("headers")}),children:e.jsx(Q,{variant:"light",children:e.jsx(va,{realm:s,save:a})})}),e.jsx(F,{id:"bruteForce",eventKey:20,title:e.jsx(U,{children:t("bruteForceDetection")}),children:e.jsx(Q,{variant:"light",children:e.jsx(ya,{realm:s,save:a})})})]})},Ta=({realm:s,save:a})=>{const{t}=M("realm-settings"),{setValue:n,control:l,handleSubmit:o,formState:m}=he(),u=Te({control:l,name:"offlineSessionMaxLifespanEnabled"}),p=()=>{Ce(s,n)};return c.useEffect(p,[]),e.jsxs(Q,{variant:"light",children:[e.jsx(ie,{title:t("SSOSessionSettings"),className:"kc-sso-session-template",children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",onSubmit:o(a),children:[e.jsx(f,{label:t("SSOSessionIdle"),fieldId:"SSOSessionIdle",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:ssoSessionIdle"),fieldLabelId:"realm-settings:SSOSessionIdle"}),children:e.jsx(L,{name:"ssoSessionIdleTimeout",defaultValue:s.ssoSessionIdleTimeout,control:l,render:({field:i})=>e.jsx(q,{className:"kc-sso-session-idle","data-testid":"sso-session-idle-input",value:i.value,onChange:i.onChange,units:["minute","hour","day"]})})}),e.jsx(f,{label:t("SSOSessionMax"),fieldId:"SSOSessionMax",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:ssoSessionMax"),fieldLabelId:"realm-settings:SSOSessionMax"}),children:e.jsx(L,{name:"ssoSessionMaxLifespan",control:l,render:({field:i})=>e.jsx(q,{className:"kc-sso-session-max","data-testid":"sso-session-max-input",value:i.value,onChange:i.onChange,units:["minute","hour","day"]})})}),e.jsx(f,{label:t("SSOSessionIdleRememberMe"),fieldId:"SSOSessionIdleRememberMe",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:ssoSessionIdleRememberMe"),fieldLabelId:"realm-settings:SSOSessionIdleRememberMe"}),children:e.jsx(L,{name:"ssoSessionIdleTimeoutRememberMe",control:l,render:({field:i})=>e.jsx(q,{className:"kc-sso-session-idle-remember-me","data-testid":"sso-session-idle-remember-me-input",value:i.value,onChange:i.onChange,units:["minute","hour","day"]})})}),e.jsx(f,{label:t("SSOSessionMaxRememberMe"),fieldId:"SSOSessionMaxRememberMe",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:ssoSessionMaxRememberMe"),fieldLabelId:"realm-settings:SSOSessionMaxRememberMe"}),children:e.jsx(L,{name:"ssoSessionMaxLifespanRememberMe",control:l,render:({field:i})=>e.jsx(q,{className:"kc-sso-session-max-remember-me","data-testid":"sso-session-max-remember-me-input",value:i.value,onChange:i.onChange,units:["minute","hour","day"]})})})]})}),e.jsx(ie,{title:t("clientSessionSettings"),className:"kc-client-session-template",children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:o(a),children:[e.jsx(f,{label:t("clientSessionIdle"),fieldId:"clientSessionIdle",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:clientSessionIdle"),fieldLabelId:"realm-settings:clientSessionIdle"}),children:e.jsx(L,{name:"clientSessionIdleTimeout",control:l,render:({field:i})=>e.jsx(q,{className:"kc-client-session-idle","data-testid":"client-session-idle-input",value:i.value,onChange:i.onChange,units:["minute","hour","day"]})})}),e.jsx(f,{label:t("clientSessionMax"),fieldId:"clientSessionMax",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:clientSessionMax"),fieldLabelId:"realm-settings:clientSessionMax"}),children:e.jsx(L,{name:"clientSessionMaxLifespan",control:l,render:({field:i})=>e.jsx(q,{className:"kc-client-session-max","data-testid":"client-session-max-input",value:i.value,onChange:i.onChange,units:["minute","hour","day"]})})})]})}),e.jsx(ie,{title:t("offlineSessionSettings"),className:"kc-offline-session-template",children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:o(a),children:[e.jsx(f,{label:t("offlineSessionIdle"),fieldId:"offlineSessionIdle",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:offlineSessionIdle"),fieldLabelId:"realm-settings:offlineSessionIdle"}),children:e.jsx(L,{name:"offlineSessionIdleTimeout",control:l,render:({field:i})=>e.jsx(q,{className:"kc-offline-session-idle","data-testid":"offline-session-idle-input","aria-label":"offline-session-idle-input",value:i.value,onChange:i.onChange,units:["minute","hour","day"]})})}),e.jsx(f,{hasNoPaddingTop:!0,label:t("offlineSessionMaxLimited"),fieldId:"kc-offlineSessionMaxLimited",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:offlineSessionMaxLimited"),fieldLabelId:"realm-settings:offlineSessionMaxLimited"}),children:e.jsx(L,{name:"offlineSessionMaxLifespanEnabled",control:l,defaultValue:!1,render:({field:i})=>e.jsx(X,{id:"kc-offline-session-max","data-testid":"offline-session-max-switch","aria-label":t("offlineSessionMaxLimited"),label:t("common:enabled"),labelOff:t("common:disabled"),isChecked:i.value,onChange:i.onChange})})}),u&&e.jsx(f,{label:t("offlineSessionMax"),fieldId:"offlineSessionMax",id:"offline-session-max-label",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:offlineSessionMax"),fieldLabelId:"realm-settings:offlineSessionMax"}),children:e.jsx(L,{name:"offlineSessionMaxLifespan",control:l,render:({field:i})=>e.jsx(q,{className:"kc-offline-session-max","data-testid":"offline-session-max-input",value:i.value,onChange:i.onChange,units:["minute","hour","day"]})})})]})}),e.jsx(ie,{className:"kc-login-settings-template",title:t("loginSettings"),children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:o(a),children:[e.jsx(f,{label:t("loginTimeout"),id:"kc-login-timeout-label",fieldId:"offlineSessionIdle",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:loginTimeout"),fieldLabelId:"realm-settings:loginTimeout"}),children:e.jsx(L,{name:"accessCodeLifespanLogin",control:l,render:({field:i})=>e.jsx(q,{className:"kc-login-timeout","data-testid":"login-timeout-input","aria-label":"login-timeout-input",value:i.value,onChange:i.onChange,units:["minute","hour","day"]})})}),e.jsx(f,{label:t("loginActionTimeout"),fieldId:"loginActionTimeout",id:"login-action-timeout-label",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:loginActionTimeout"),fieldLabelId:"realm-settings:loginActionTimeout"}),children:e.jsx(L,{name:"accessCodeLifespanUserAction",control:l,render:({field:i})=>e.jsx(q,{className:"kc-login-action-timeout","data-testid":"login-action-timeout-input",value:i.value,onChange:i.onChange,units:["minute","hour","day"]})})}),e.jsxs(fe,{children:[e.jsx(P,{variant:"primary",type:"submit","data-testid":"sessions-tab-save",isDisabled:!m.isDirty,children:t("common:save")}),e.jsx(P,{variant:"link",onClick:p,children:t("common:revert")})]})]})})]})},Ca=({realm:s,save:a})=>{const{t}=M("realm-settings"),[n,l]=c.useState(!1),[o,m]=c.useState(!1),[u,p]=c.useState(!1),[i,j]=c.useState(!1),{control:g,handleSubmit:S,setValue:x}=he(),k=Ee().themes,r=()=>{Ce(s,x)};return c.useEffect(r,[]),e.jsx(Q,{variant:"light",children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:S(a),children:[e.jsx(f,{label:t("loginTheme"),fieldId:"kc-login-theme",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:loginTheme"),fieldLabelId:"realm-settings:loginTheme"}),children:e.jsx(L,{name:"loginTheme",control:g,defaultValue:"",render:({field:v})=>e.jsx(re,{toggleId:"kc-login-theme",onToggle:()=>l(!n),onSelect:(h,d)=>{v.onChange(d),l(!1)},selections:v.value,variant:pe.single,"aria-label":t("loginTheme"),isOpen:n,placeholderText:"Select a theme","data-testid":"select-login-theme",children:k.login.map((h,d)=>e.jsx(te,{selected:h.name===v.value,value:h.name,children:t(`${h.name}`)},`login-theme-${d}`))})})}),e.jsx(f,{label:t("accountTheme"),fieldId:"kc-account-theme",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:accountTheme"),fieldLabelId:"realm-settings:accountTheme"}),children:e.jsx(L,{name:"accountTheme",control:g,defaultValue:"",render:({field:v})=>e.jsx(re,{toggleId:"kc-account-theme",onToggle:()=>m(!o),onSelect:(h,d)=>{v.onChange(d),m(!1)},selections:v.value,variant:pe.single,"aria-label":t("accountTheme"),isOpen:o,placeholderText:"Select a theme","data-testid":"select-account-theme",children:k.account.map((h,d)=>e.jsx(te,{selected:h.name===v.value,value:h.name,children:t(`${h.name}`)},`account-theme-${d}`))})})}),e.jsx(f,{label:t("adminTheme"),fieldId:"kc-admin-ui-theme",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:adminUITheme"),fieldLabelId:"realm-settings:adminTheme"}),children:e.jsx(L,{name:"adminTheme",control:g,defaultValue:"",render:({field:v})=>e.jsx(re,{toggleId:"kc-admin-ui-theme",onToggle:()=>p(!u),onSelect:(h,d)=>{v.onChange(d),p(!1)},selections:v.value,variant:pe.single,"aria-label":t("adminUITheme"),isOpen:u,placeholderText:"Select a theme","data-testid":"select-admin-theme",children:k.admin.map((h,d)=>e.jsx(te,{selected:h.name===v.value,value:h.name,children:t(`${h.name}`)},`admin-theme-${d}`))})})}),e.jsx(f,{label:t("emailTheme"),fieldId:"kc-email-theme",labelIcon:e.jsx(C,{helpText:t("realm-settings-help:emailTheme"),fieldLabelId:"realm-settings:emailTheme"}),children:e.jsx(L,{name:"emailTheme",control:g,defaultValue:"",render:({field:v})=>e.jsx(re,{toggleId:"kc-email-theme",onToggle:()=>j(!i),onSelect:(h,d)=>{v.onChange(d),j(!1)},selections:v.value,variant:pe.single,"aria-label":t("emailTheme"),isOpen:i,placeholderText:"Select a theme","data-testid":"select-email-theme",children:k.email.map((h,d)=>e.jsx(te,{selected:h.name===v.value,value:h.name,children:t(`${h.name}`)},`email-theme-${d}`))})})}),e.jsxs(fe,{children:[e.jsx(P,{variant:"primary",type:"submit","data-testid":"themes-tab-save",children:t("common:save")}),e.jsx(P,{variant:"link",onClick:r,children:t("common:revert")})]})]})})},ka=({realm:s,reset:a,save:t})=>{const{t:n}=M("realm-settings"),l=Ee(),{whoAmI:o}=vt(),[m,u]=c.useState(!1),p=bs(l.providers.signature.providers),i=he(),{setValue:j,control:g}=i,S=Te({control:g,name:"offlineSessionMaxLifespanEnabled",defaultValue:s.offlineSessionMaxLifespanEnabled}),x=Te({control:g,name:"ssoSessionIdleTimeout",defaultValue:36e3}),k=Te({control:g,name:"revokeRefreshToken",defaultValue:!1});return c.useEffect(()=>{Ce(s,j)},[]),e.jsxs(Q,{variant:"light",children:[e.jsx(ie,{title:n("realm-settings:general"),className:"kc-sso-session-template",children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",onSubmit:i.handleSubmit(t),children:[e.jsx(f,{label:n("defaultSigAlg"),fieldId:"kc-default-signature-algorithm",labelIcon:e.jsx(C,{helpText:n("realm-settings-help:defaultSigAlg"),fieldLabelId:"realm-settings:algorithm"}),children:e.jsx(L,{name:"defaultSignatureAlgorithm",defaultValue:"RS256",control:i.control,render:({field:r})=>e.jsx(re,{toggleId:"kc-default-sig-alg",onToggle:()=>u(!m),onSelect:(v,h)=>{r.onChange(h.toString()),u(!1)},selections:[r.value?.toString()],variant:pe.single,"aria-label":n("defaultSigAlg"),isOpen:m,"data-testid":"select-default-sig-alg",children:p.map((v,h)=>e.jsx(te,{selected:v===r.value,value:v},`default-sig-alg-${h}`))})})}),e.jsx(f,{label:n("oAuthDeviceCodeLifespan"),fieldId:"oAuthDeviceCodeLifespan",labelIcon:e.jsx(C,{helpText:n("realm-settings-help:oAuthDeviceCodeLifespan"),fieldLabelId:"realm-settings:oAuthDeviceCodeLifespan"}),children:e.jsx(L,{name:"oauth2DeviceCodeLifespan",defaultValue:0,control:i.control,render:({field:r})=>e.jsx(q,{id:"oAuthDeviceCodeLifespan","data-testid":"oAuthDeviceCodeLifespan",value:r.value||0,onChange:r.onChange,units:["minute","hour","day"]})})}),e.jsx(f,{label:n("oAuthDevicePollingInterval"),fieldId:"oAuthDevicePollingInterval",labelIcon:e.jsx(C,{helpText:n("realm-settings-help:oAuthDevicePollingInterval"),fieldLabelId:"realm-settings:oAuthDevicePollingInterval"}),children:e.jsx(L,{name:"oauth2DevicePollingInterval",defaultValue:0,control:i.control,render:({field:r})=>e.jsx(ot,{id:"oAuthDevicePollingInterval",value:r.value,min:0,onPlus:()=>r.onChange(r.value||0+1),onMinus:()=>r.onChange(r.value||0-1),onChange:v=>{const h=Number(v.currentTarget.value);r.onChange(isNaN(h)?0:h)},placeholder:n("oAuthDevicePollingInterval")})})}),e.jsx(f,{label:n("shortVerificationUri"),fieldId:"shortVerificationUri",labelIcon:e.jsx(C,{helpText:n("realm-settings-help:shortVerificationUriTooltip"),fieldLabelId:"realm-settings:shortVerificationUri"}),children:e.jsx(le,{id:"shortVerificationUri",placeholder:n("shortVerificationUri"),...i.register("attributes.shortVerificationUri")})})]})}),e.jsx(ie,{title:n("realm-settings:refreshTokens"),className:"kc-client-session-template",children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:i.handleSubmit(t),children:[e.jsx(f,{hasNoPaddingTop:!0,label:n("revokeRefreshToken"),fieldId:"kc-revoke-refresh-token",labelIcon:e.jsx(C,{helpText:n("realm-settings-help:revokeRefreshToken"),fieldLabelId:"realm-settings:revokeRefreshToken"}),children:e.jsx(L,{name:"revokeRefreshToken",control:i.control,defaultValue:!1,render:({field:r})=>e.jsx(X,{id:"kc-revoke-refresh-token","data-testid":"revoke-refresh-token-switch","aria-label":n("revokeRefreshToken"),label:n("common:enabled"),labelOff:n("common:disabled"),isChecked:r.value,onChange:r.onChange})})}),k&&e.jsx(f,{label:n("refreshTokenMaxReuse"),labelIcon:e.jsx(C,{helpText:n("realm-settings-help:refreshTokenMaxReuse"),fieldLabelId:"realm-settings:refreshTokenMaxReuse"}),fieldId:"refreshTokenMaxReuse",children:e.jsx(L,{name:"refreshTokenMaxReuse",defaultValue:0,control:i.control,render:({field:r})=>e.jsx(ot,{type:"text",id:"refreshTokenMaxReuseMs",value:r.value,onPlus:()=>r.onChange(r.value+1),onMinus:()=>r.onChange(r.value-1),onChange:v=>r.onChange(Number(v.target.value))})})})]})}),e.jsx(ie,{title:n("realm-settings:accessTokens"),className:"kc-offline-session-template",children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:i.handleSubmit(t),children:[e.jsx(f,{label:n("accessTokenLifespan"),fieldId:"accessTokenLifespan",helperText:n("recommendedSsoTimeout",{time:Us(x,o.getLocale())}),labelIcon:e.jsx(C,{helpText:n("realm-settings-help:accessTokenLifespan"),fieldLabelId:"realm-settings:accessTokenLifespan"}),children:e.jsx(L,{name:"accessTokenLifespan",control:i.control,render:({field:r})=>e.jsx(q,{validated:r.value>x?"warning":"default",className:"kc-access-token-lifespan","data-testid":"access-token-lifespan-input","aria-label":"access-token-lifespan",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),e.jsx(f,{label:n("accessTokenLifespanImplicitFlow"),fieldId:"accessTokenLifespanImplicitFlow",labelIcon:e.jsx(C,{helpText:n("realm-settings-help:accessTokenLifespanImplicitFlow"),fieldLabelId:"realm-settings:accessTokenLifespanImplicitFlow"}),children:e.jsx(L,{name:"accessTokenLifespanForImplicitFlow",control:i.control,render:({field:r})=>e.jsx(q,{className:"kc-access-token-lifespan-implicit","data-testid":"access-token-lifespan-implicit-input",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),e.jsx(f,{label:n("clientLoginTimeout"),fieldId:"clientLoginTimeout",labelIcon:e.jsx(C,{helpText:n("realm-settings-help:clientLoginTimeout"),fieldLabelId:"realm-settings:clientLoginTimeout"}),children:e.jsx(L,{name:"accessCodeLifespan",control:i.control,render:({field:r})=>e.jsx(q,{className:"kc-client-login-timeout","data-testid":"client-login-timeout-input","aria-label":"client-login-timeout",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),S&&e.jsx(f,{label:n("offlineSessionMax"),fieldId:"offlineSessionMax",id:"offline-session-max-label",labelIcon:e.jsx(C,{helpText:n("realm-settings-help:offlineSessionMax"),fieldLabelId:"realm-settings:offlineSessionMax"}),children:e.jsx(L,{name:"offlineSessionMaxLifespan",control:i.control,render:({field:r})=>e.jsx(q,{className:"kc-offline-session-max","data-testid":"offline-session-max-input",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})})]})}),e.jsx(ie,{className:"kc-login-settings-template",title:n("actionTokens"),children:e.jsxs(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:i.handleSubmit(t),children:[e.jsx(f,{label:n("userInitiatedActionLifespan"),id:"kc-user-initiated-action-lifespan",fieldId:"userInitiatedActionLifespan",labelIcon:e.jsx(C,{helpText:n("realm-settings-help:userInitiatedActionLifespan"),fieldLabelId:"realm-settings:userInitiatedActionLifespan"}),children:e.jsx(L,{name:"actionTokenGeneratedByUserLifespan",control:i.control,render:({field:r})=>e.jsx(q,{className:"kc-user-initiated-action-lifespan","data-testid":"user-initiated-action-lifespan","aria-label":"user-initiated-action-lifespan",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),e.jsx(f,{label:n("defaultAdminInitiated"),fieldId:"defaultAdminInitiated",id:"default-admin-initiated-label",labelIcon:e.jsx(C,{helpText:n("realm-settings-help:defaultAdminInitiatedActionLifespan"),fieldLabelId:"realm-settings:defaultAdminInitiated"}),children:e.jsx(L,{name:"actionTokenGeneratedByAdminLifespan",control:i.control,render:({field:r})=>e.jsx(q,{className:"kc-default-admin-initiated","data-testid":"default-admin-initated-input","aria-label":"default-admin-initated-input",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),e.jsx(Oe,{className:"kc-override-action-tokens-subtitle",component:qs.h1,children:n("overrideActionTokens")}),e.jsx(f,{label:n("emailVerification"),fieldId:"emailVerification",id:"email-verification",children:e.jsx(L,{name:"attributes.actionTokenGeneratedByUserLifespan-verify-email",defaultValue:"",control:i.control,render:({field:r})=>e.jsx(q,{className:"kc-email-verification","data-testid":"email-verification-input",value:r.value,onChange:v=>r.onChange(v.toString()),units:["minute","hour","day"]})})}),e.jsx(f,{label:n("idpAccountEmailVerification"),fieldId:"idpAccountEmailVerification",id:"idp-acct-label",children:e.jsx(L,{name:"attributes.actionTokenGeneratedByUserLifespan-idp-verify-account-via-email",defaultValue:"",control:i.control,render:({field:r})=>e.jsx(q,{className:"kc-idp-email-verification","data-testid":"idp-email-verification-input",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),e.jsx(f,{label:n("forgotPassword"),fieldId:"forgotPassword",id:"forgot-password-label",children:e.jsx(L,{name:"attributes.actionTokenGeneratedByUserLifespan-reset-credentials",defaultValue:"",control:i.control,render:({field:r})=>e.jsx(q,{className:"kc-forgot-pw","data-testid":"forgot-pw-input",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),e.jsx(f,{label:n("executeActions"),fieldId:"executeActions",id:"execute-actions",children:e.jsx(L,{name:"attributes.actionTokenGeneratedByUserLifespan-execute-actions",defaultValue:"",control:i.control,render:({field:r})=>e.jsx(q,{className:"kc-execute-actions","data-testid":"execute-actions-input",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),e.jsxs(fe,{children:[e.jsx(P,{variant:"primary",type:"submit","data-testid":"tokens-tab-save",isDisabled:!i.formState.isDirty,children:n("common:save")}),e.jsx(P,{variant:"link",onClick:a,children:n("common:revert")})]})]})})]})},Ia=()=>{const{config:s,save:a}=Lt(),{t}=M("realm-settings"),n=$e(),{realm:l}=ae(),[o,m]=c.useState(0),[u,p]=c.useState();c.useEffect(()=>m(x=>x+1),[s]);async function i(){return s?.groups??[]}const[j,g]=de({titleKey:"realm-settings:deleteDialogTitle",children:e.jsxs(rt,{i18nKey:"realm-settings:deleteDialogDescription",children:[" ",e.jsx("strong",{children:{group:u?.name}}),"."]}),continueButtonLabel:"common:delete",continueButtonVariant:ee.danger,onConfirm(){const x=(s?.groups??[]).filter(k=>k!==u);a({...s,groups:x},{successMessageKey:"realm-settings:deleteSuccess",errorMessageKey:"realm-settings:deleteAttributeGroupError"})}});function S(x){p(x),j()}return e.jsxs(Q,{variant:"light",className:"pf-u-p-0",children:[e.jsx(g,{}),e.jsx(Ke,{loader:i,ariaLabelKey:"realm-settings:tableTitle",toolbarItem:e.jsx(xe,{children:e.jsx(P,{component:x=>e.jsx(ge,{...x,to:Dt({realm:l})}),children:t("createGroupText")})}),columns:[{name:"name",displayKey:"realm-settings:columnName",cellRenderer:x=>e.jsx(ge,{to:js({realm:l,name:x.name}),children:x.name})},{name:"displayHeader",displayKey:"realm-settings:columnDisplayName"},{name:"displayDescription",displayKey:"realm-settings:columnDisplayDescription"}],actions:[{title:t("common:delete"),onRowClick:S}],emptyState:e.jsx(Le,{message:t("emptyStateMessage"),instructions:t("emptyStateInstructions"),primaryActionText:t("createGroupText"),onPrimaryAction:()=>n(Dt({realm:l}))})},o)]})},La=["username","email"],Ea=()=>{const{config:s,save:a}=Lt(),{realm:t}=ae(),{t:n}=M("realm-settings"),l=$e(),[o,m]=c.useState("allGroups"),[u,p]=Me(),[i,j]=c.useState(s?.attributes),[g,S]=c.useState(""),x=async(d,w)=>{const A=s?.attributes.findIndex(K=>K.name===d.name);let V={};V=s?.attributes[A],s?.attributes.splice(A,1),s?.attributes.splice(w,0,V),a({attributes:s?.attributes,groups:s?.groups},{successMessageKey:"realm-settings:updatedUserProfileSuccess",errorMessageKey:"realm-settings:updatedUserProfileError"})},k=s?.attributes.filter(d=>d.name!==g),[r,v]=de({titleKey:n("deleteAttributeConfirmTitle"),messageKey:n("deleteAttributeConfirm",{attributeName:g}),continueButtonLabel:n("common:delete"),continueButtonVariant:ee.danger,onConfirm:async()=>{a({attributes:k,groups:s?.groups},{successMessageKey:"realm-settings:deleteAttributeSuccess",errorMessageKey:"realm-settings:deleteAttributeError"}),S("")}}),h=d=>e.jsx(ge,{to:Rt({realm:t,attributeName:d.name}),children:d.name},d.name);return s?.attributes?e.jsxs(e.Fragment,{children:[e.jsx(Jt,{children:e.jsxs(Fs,{children:[e.jsx(xe,{children:e.jsx(re,{width:200,"data-testid":"filter-select",isOpen:u,variant:pe.single,onToggle:p,toggleIcon:e.jsx(Yt,{}),onSelect:(d,w)=>{const A=w.toString();m(A),j(A==="allGroups"?s.attributes:s.attributes?.filter(V=>V.group===A)),p()},selections:o==="allGroups"?n(o):o,children:[e.jsx(te,{"data-testid":"all-groups",value:"allGroups",children:n("allGroups")},"allGroups"),...s.attributes.filter(d=>!!d.group).map(d=>e.jsx(te,{"data-testid":`${d.group}-option`,value:d.group},d.group))]})}),e.jsx(xe,{className:"kc-toolbar-attributesTab",children:e.jsx(P,{"data-testid":"createAttributeBtn",variant:"primary",component:d=>e.jsx(ge,{...d,to:vs({realm:t})}),children:n("createAttribute")})})]})}),e.jsx(ze,{}),e.jsx(v,{}),e.jsx(Qt,{keyField:"name",onDragFinish:async(d,w)=>{const A=s.attributes.map(T=>T.name),V=w.indexOf(d),K=A.indexOf(d),E=s.attributes[K];E.name&&x(E,V)},actions:[{title:n("common:edit"),onClick:(d,w,A)=>{l(Rt({realm:t,attributeName:A.name}))}},{title:n("common:delete"),isActionable:({name:d})=>!La.includes(d),onClick:(d,w,A)=>{S(A.name),r()}}],columns:[{name:"name",displayKey:n("attributeName"),cellRenderer:h},{name:"displayName",displayKey:n("attributeDisplayName")},{name:"group",displayKey:n("attributeGroup")}],data:i||s.attributes})]}):e.jsx(Pe,{})},Pa=()=>{const{config:s,save:a,isSaving:t}=Lt(),{t:n}=M(),{addError:l}=oe(),[o,m]=c.useState();c.useEffect(()=>u(),[s,o]);function u(){o?.setValue(s?Ye(s):"")}async function p(){const i=o?.getValue();if(i)try{await a(JSON.parse(i))}catch(j){l("realm-settings:invalidJsonError",j);return}}return e.jsxs(Q,{variant:"light",children:[e.jsx(kt,{language:It.json,height:"30rem",onEditorDidMount:i=>m(i),isLanguageLabelVisible:!0}),e.jsx(Tt,{children:e.jsxs(fe,{children:[e.jsx(P,{"data-testid":"save",variant:"primary",onClick:p,isDisabled:t,children:n("common:save")}),e.jsx(P,{variant:"link",onClick:u,isDisabled:t,children:n("common:revert")})]})})]})},wa=()=>{const{realm:s}=ae(),{t:a}=M("realm-settings"),t=m=>lt(Nt({realm:s,tab:m})),n=t("attributes"),l=t("attributes-group"),o=t("json-editor");return e.jsx(Js,{children:e.jsxs(nt,{defaultLocation:Nt({realm:s,tab:"attributes"}),mountOnEnter:!0,children:[e.jsx(F,{title:e.jsx(U,{children:a("attributes")}),"data-testid":"attributesTab",...n,children:e.jsx(Ea,{})}),e.jsx(F,{title:e.jsx(U,{children:a("attributesGroup")}),"data-testid":"attributesGroupTab",...l,children:e.jsx(Ia,{})}),e.jsx(F,{title:e.jsx(U,{children:a("jsonEditor")}),"data-testid":"jsonEditorTab",...o,children:e.jsx(Pa,{})})]})})},Aa=()=>{const{t:s}=M("realm-settings"),[a,t]=Me(),[n,l]=Me(),[o,m]=c.useState(),[u,p]=c.useState([]),[i,j]=c.useState(0),[g,S]=c.useState(0),x=()=>S(g+1),{adminClient:k}=se(),{realm:r}=ae(),{addAlert:v,addError:h}=oe(),{enabled:d}=ys();ve(()=>k.realms.getDefaultGroups({realm:r}),T=>{m(T),j(i+1)},[g]);const w=()=>Promise.resolve(o),A=async()=>{try{await Promise.all(u.map(T=>k.realms.removeDefaultGroup({realm:r,id:T.id}))),v(s("groupRemove",{count:u.length}),Z.success),p([])}catch(T){h("realm-settings:groupRemoveError",T)}x()},V=async T=>{try{await Promise.all(T.map(O=>k.realms.addDefaultGroup({realm:r,id:O.id}))),v(s("defaultGroupAdded",{count:T.length}),Z.success)}catch(O){h("realm-settings:defaultGroupAddedError",O)}x()},[K,E]=de({titleKey:s("removeConfirmTitle",{count:u.length}),messageKey:s("removeConfirm",{count:u.length}),continueButtonLabel:"common:delete",continueButtonVariant:ee.danger,onConfirm:A});return o?e.jsxs(e.Fragment,{children:[e.jsx(E,{}),n&&e.jsx(Ys,{type:"selectMany",text:{title:"realm-settings:addDefaultGroups",ok:"common:add"},onConfirm:T=>{V(T||[]),l()},onClose:l}),d&&e.jsx(Ss,{bodyContent:e.jsxs(rt,{i18nKey:"realm-settings-help:defaultGroups",children:[" ",e.jsx(ge,{to:Ot({realm:r})}),"."]}),children:e.jsx(ct,{className:"keycloak__section_intro__help",style:{paddingLeft:"var(--pf-c-page__main-section--PaddingLeft)"},children:e.jsxs(Oe,{children:[e.jsx(Qs,{})," ",s("whatIsDefaultGroups")]})})}),e.jsx(Ke,{canSelectAll:!0,onSelect:T=>p([...T]),loader:w,ariaLabelKey:"realm-settings:defaultGroups",searchPlaceholderKey:"realm-settings:searchForGroups",toolbarItem:e.jsxs(e.Fragment,{children:[e.jsx(xe,{children:e.jsx(P,{"data-testid":"openCreateGroupModal",variant:"primary",onClick:l,children:s("addGroups")})}),e.jsx(xe,{children:e.jsx(Ts,{toggle:e.jsx(Cs,{onToggle:t,isDisabled:u.length===0}),isOpen:a,isPlain:!0,dropdownItems:[e.jsx(st,{component:"button",onClick:()=>{K(),t()},children:s("common:remove")},"action")]})})]}),actions:[{title:s("common:remove"),onRowClick:T=>(p([T]),K(),Promise.resolve(!1))}],columns:[{name:"name",displayKey:"groups:groupName"},{name:"path",displayKey:"groups:path"}],emptyState:e.jsx(Le,{hasIcon:!0,message:s("noDefaultGroups"),instructions:e.jsxs(rt,{i18nKey:"realm-settings:noDefaultGroupsInstructions",children:[" ",e.jsx(ge,{className:"pf-u-font-weight-light",to:Ot({realm:r})}),"Add groups..."]}),primaryActionText:s("addGroups"),onPrimaryAction:l})},i)]}):e.jsx(Pe,{})},Da=()=>{const{t:s}=M("realm-settings"),[a,t]=c.useState(),[n,l]=c.useState(10),[o,m]=c.useState(0),{adminClient:u}=se(),{addAlert:p,addError:i}=oe(),{realm:j}=ae();if(ve(()=>u.realms.findOne({realm:j}),t,[]),!a)return e.jsx(Pe,{});const g=async S=>{const x=S;try{await u.roles.createComposite({roleId:a.defaultRole.id,realm:j},x),m(o+1),p(s("roles:addAssociatedRolesSuccess"),Z.success)}catch(k){i("roles:addAssociatedRolesError",k)}};return e.jsxs(Ct,{activeKey:n,onSelect:(S,x)=>l(x),children:[e.jsx(F,{id:"roles",eventKey:10,title:e.jsx(U,{children:s("defaultRoles")}),children:e.jsx(Xs,{name:a.defaultRole.name,id:a.defaultRole.id,type:"roles",isManager:!0,save:S=>g(S.map(x=>x.role))})},o),e.jsx(F,{id:"groups",eventKey:20,title:e.jsx(U,{children:s("defaultGroups")}),children:e.jsx(Aa,{})})]})},Ra=({save:s,onChange:a,value:t,realmName:n,refresh:l})=>{const{t:o}=M("realm-settings"),{adminClient:m}=se(),{refresh:u}=zt(),{addAlert:p,addError:i}=oe(),j=$e(),[g,S]=c.useState(!1),[x,k]=c.useState(!1),[r,v]=de({titleKey:"realm-settings:disableConfirmTitle",messageKey:"realm-settings:disableConfirm",continueButtonLabel:"common:disable",onConfirm:()=>{a(!t),s()}}),[h,d]=de({titleKey:"realm-settings:deleteConfirmTitle",messageKey:"realm-settings:deleteConfirm",continueButtonLabel:"common:delete",continueButtonVariant:ee.danger,onConfirm:async()=>{try{await m.realms.del({realm:n}),p(o("deletedSuccess"),Z.success),await u(),j(ks({realm:Is.masterRealm})),l()}catch(w){i("realm-settings:deleteError",w)}}});return e.jsxs(e.Fragment,{children:[e.jsx(v,{}),e.jsx(d,{}),e.jsx(xa,{open:g,toggleDialog:()=>S(!g)}),e.jsx(fa,{isOpen:x,onClose:()=>k(!1)}),e.jsx(As,{titleKey:n,subKey:"realm-settings:realmSettingsExplain",helpUrl:Ls.realmSettingsUrl,divider:!1,dropdownItems:[e.jsx(st,{"data-testid":"openPartialImportModal",onClick:()=>{S(!0)},children:o("partialImport")},"import"),e.jsx(st,{"data-testid":"openPartialExportModal",onClick:()=>k(!0),children:o("partialExport")},"export"),e.jsx(Es,{},"separator"),e.jsx(st,{onClick:h,children:o("common:delete")},"delete")],isEnabled:t,onToggle:w=>{w?(a(w),s()):r()}})]})},Na=({realm:s,refresh:a})=>{const{t}=M("realm-settings"),{adminClient:n}=se(),{addAlert:l,addError:o}=oe(),{realm:m}=ae(),{refresh:u}=zt(),p=$e(),i=$t(),{control:j,setValue:g,getValues:S}=he({mode:"onChange"}),[x,k]=c.useState(0),r=()=>{k(x+1)},v=(_=s)=>{Ce(_,g)};c.useEffect(v,[]);const h=async _=>{_=Ps(_),_.attributes?.["acr.loa.map"]&&typeof _.attributes["acr.loa.map"]!="string"&&(_.attributes["acr.loa.map"]=JSON.stringify(Object.fromEntries(_.attributes["acr.loa.map"].filter(({key:me})=>me!=="").map(({key:me,value:Ue})=>[me,Ue]))));try{await n.realms.update({realm:m},{...s,..._,id:_.realm}),l(t("saveSuccess"),Z.success)}catch(me){o("realm-settings:saveError",me)}m!==(_.realm||s.realm)&&(await u(),p(ut({realm:_.realm,tab:"general"}))),a()},d=_=>lt(ut({realm:m,tab:_})),w=d("general"),A=d("login"),V=d("email"),K=d("themes"),E=d("keys"),T=d("events"),O=d("localization"),B=d("security-defenses"),b=d("sessions"),N=d("tokens"),H=d("client-policies"),D=Ee().profileInfo?.disabledFeatures?.includes("CLIENT_POLICIES"),z=d("user-profile"),W=d("user-registration"),ce=_=>lt(gt({realm:m,tab:_})),be=ce("profiles"),Fe=ce("policies");return e.jsxs(e.Fragment,{children:[e.jsx(L,{name:"enabled",defaultValue:!0,control:j,render:({field:_})=>e.jsx(Ra,{value:_.value,onChange:_.onChange,realmName:m,refresh:r,save:()=>h(S())})}),e.jsx(Q,{variant:"light",className:"pf-u-p-0",children:e.jsxs(nt,{isBox:!0,mountOnEnter:!0,defaultLocation:ut({realm:m,tab:"general"}),children:[e.jsx(F,{title:e.jsx(U,{children:t("general")}),"data-testid":"rs-general-tab",...w,children:e.jsx(la,{realm:s,save:h})}),e.jsx(F,{title:e.jsx(U,{children:t("login")}),"data-testid":"rs-login-tab",...A,children:e.jsx(ga,{refresh:a,realm:s})}),e.jsx(F,{title:e.jsx(U,{children:t("email")}),"data-testid":"rs-email-tab",...V,children:e.jsx(ta,{realm:s})}),e.jsx(F,{title:e.jsx(U,{children:t("themes")}),"data-testid":"rs-themes-tab",...K,children:e.jsx(Ca,{realm:s,save:h})}),e.jsx(F,{title:e.jsx(U,{children:t("realm-settings:keys")}),"data-testid":"rs-keys-tab",...E,children:e.jsx(ua,{})}),e.jsx(F,{title:e.jsx(U,{children:t("events")}),"data-testid":"rs-realm-events-tab",...T,children:e.jsx(na,{realm:s})}),e.jsx(F,{title:e.jsx(U,{children:t("localization")}),"data-testid":"rs-localization-tab",...O,children:e.jsx(ha,{refresh:a,save:h,realm:s},x)}),e.jsx(F,{title:e.jsx(U,{children:t("securityDefences")}),"data-testid":"rs-security-defenses-tab",...B,children:e.jsx(Sa,{realm:s,save:h})}),e.jsx(F,{title:e.jsx(U,{children:t("realm-settings:sessions")}),"data-testid":"rs-sessions-tab",...b,children:e.jsx(Ta,{realm:s,save:h},x)}),e.jsx(F,{title:e.jsx(U,{children:t("realm-settings:tokens")}),"data-testid":"rs-tokens-tab",...N,children:e.jsx(ka,{save:h,realm:s})}),!D&&e.jsx(F,{title:e.jsx(U,{children:t("realm-settings:clientPolicies")}),"data-testid":"rs-clientPolicies-tab",...H,children:e.jsxs(nt,{mountOnEnter:!0,defaultLocation:gt({realm:m,tab:"profiles"}),children:[e.jsx(F,{id:"profiles","data-testid":"rs-policies-clientProfiles-tab","aria-label":t("clientProfilesSubTab"),title:e.jsx(U,{children:t("profiles")}),tooltip:e.jsx(Mt,{content:t("realm-settings:clientPoliciesProfilesHelpText")}),...be,children:e.jsx(ja,{})}),e.jsx(F,{id:"policies","data-testid":"rs-policies-clientPolicies-tab","aria-label":t("clientPoliciesSubTab"),...Fe,title:e.jsx(U,{children:t("policies")}),tooltip:e.jsx(Mt,{content:t("realm-settings:clientPoliciesPoliciesHelpText")}),children:e.jsx(ba,{})})]})}),i(qt.DeclarativeUserProfile)&&s.attributes?.userProfileEnabled==="true"&&e.jsx(F,{title:e.jsx(U,{children:t("realm-settings:userProfile")}),"data-testid":"rs-user-profile-tab",...z,children:e.jsx(wa,{})}),e.jsx(F,{title:e.jsx(U,{children:t("userRegistration")}),"data-testid":"rs-userRegistration-tab",...W,children:e.jsx(Da,{})})]})})]})};function Xn(){const{adminClient:s}=se(),{realm:a}=ws(),[t,n]=c.useState(),[l,o]=c.useState(0),m=()=>{o(l+1),n(void 0)};return ve(()=>s.realms.findOne({realm:a}),n,[l]),t?e.jsx(Na,{realm:t,refresh:m}):e.jsx(Pe,{})}export{Xn as default};
//# sourceMappingURL=RealmSettingsSection-84f0b6b5.js.map
