{"version":3,"file":"RolesList-1aa488b0.js","sources":["../../src/components/roles-list/RolesList.tsx"],"sourcesContent":["import type RealmRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/realmRepresentation\";\nimport type RoleRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/roleRepresentation\";\nimport { AlertVariant, Button, ButtonVariant } from \"@patternfly/react-core\";\nimport { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link, To, useNavigate } from \"react-router-dom\";\n\nimport { useAdminClient, useFetch } from \"../../context/auth/AdminClient\";\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\nimport { toRealmSettings } from \"../../realm-settings/routes/RealmSettings\";\nimport { emptyFormatter, upperCaseFormatter } from \"../../util\";\nimport { useAlerts } from \"../alert/Alerts\";\nimport { useConfirmDialog } from \"../confirm-dialog/ConfirmDialog\";\nimport { HelpItem } from \"ui-shared\";\nimport { KeycloakSpinner } from \"../keycloak-spinner/KeycloakSpinner\";\nimport { ListEmptyState } from \"../list-empty-state/ListEmptyState\";\nimport { Action, KeycloakDataTable } from \"../table-toolbar/KeycloakDataTable\";\n\nimport \"./RolesList.css\";\n\ntype RoleDetailLinkProps = RoleRepresentation & {\n  defaultRoleName?: string;\n  toDetail: (roleId: string) => To;\n  messageBundle?: string;\n};\n\nconst RoleDetailLink = ({\n  defaultRoleName,\n  toDetail,\n  messageBundle,\n  ...role\n}: RoleDetailLinkProps) => {\n  const { t } = useTranslation(messageBundle);\n  const { realm } = useRealm();\n\n  return role.name !== defaultRoleName ? (\n    <Link to={toDetail(role.id!)}>{role.name}</Link>\n  ) : (\n    <>\n      <Link to={toRealmSettings({ realm, tab: \"user-registration\" })}>\n        {role.name}{\" \"}\n      </Link>\n      <HelpItem\n        helpText={t(`${messageBundle}:defaultRole`)}\n        fieldLabelId=\"defaultRole\"\n      />\n    </>\n  );\n};\n\ntype RolesListProps = {\n  paginated?: boolean;\n  parentRoleId?: string;\n  messageBundle?: string;\n  isReadOnly: boolean;\n  toCreate: To;\n  toDetail: (roleId: string) => To;\n  loader?: (\n    first?: number,\n    max?: number,\n    search?: string\n  ) => Promise<RoleRepresentation[]>;\n};\n\nexport const RolesList = ({\n  loader,\n  paginated = true,\n  parentRoleId,\n  messageBundle = \"roles\",\n  toCreate,\n  toDetail,\n  isReadOnly,\n}: RolesListProps) => {\n  const { t } = useTranslation(messageBundle);\n  const navigate = useNavigate();\n  const { adminClient } = useAdminClient();\n  const { addAlert, addError } = useAlerts();\n  const { realm: realmName } = useRealm();\n  const [realm, setRealm] = useState<RealmRepresentation>();\n\n  const [selectedRole, setSelectedRole] = useState<RoleRepresentation>();\n\n  useFetch(\n    () => adminClient.realms.findOne({ realm: realmName }),\n    (realm) => {\n      setRealm(realm);\n    },\n    []\n  );\n\n  const [toggleDeleteDialog, DeleteConfirm] = useConfirmDialog({\n    titleKey: \"roles:roleDeleteConfirm\",\n    messageKey: t(\"roles:roleDeleteConfirmDialog\", {\n      selectedRoleName: selectedRole ? selectedRole!.name : \"\",\n    }),\n    continueButtonLabel: \"common:delete\",\n    continueButtonVariant: ButtonVariant.danger,\n    onConfirm: async () => {\n      try {\n        if (!parentRoleId) {\n          await adminClient.roles.delById({\n            id: selectedRole!.id!,\n          });\n        } else {\n          await adminClient.roles.delCompositeRoles({ id: parentRoleId }, [\n            selectedRole!,\n          ]);\n        }\n        setSelectedRole(undefined);\n        addAlert(t(\"roleDeletedSuccess\"), AlertVariant.success);\n      } catch (error) {\n        addError(\"roles:roleDeleteError\", error);\n      }\n    },\n  });\n\n  if (!realm) {\n    return <KeycloakSpinner />;\n  }\n\n  return (\n    <>\n      <DeleteConfirm />\n      <KeycloakDataTable\n        key={selectedRole ? selectedRole.id : \"roleList\"}\n        loader={loader!}\n        ariaLabelKey=\"roles:roleList\"\n        searchPlaceholderKey=\"roles:searchFor\"\n        isPaginated={paginated}\n        toolbarItem={\n          !isReadOnly && (\n            <Button\n              data-testid=\"create-role\"\n              component={(props) => <Link {...props} to={toCreate} />}\n            >\n              {t(\"createRole\")}\n            </Button>\n          )\n        }\n        actions={\n          isReadOnly\n            ? []\n            : [\n                {\n                  title: t(\"common:delete\"),\n                  onRowClick: (role) => {\n                    setSelectedRole(role);\n                    if (role.name === realm!.defaultRole!.name) {\n                      addAlert(\n                        t(\"defaultRoleDeleteError\"),\n                        AlertVariant.danger\n                      );\n                    } else toggleDeleteDialog();\n                  },\n                } as Action<RoleRepresentation>,\n              ]\n        }\n        columns={[\n          {\n            name: \"name\",\n            displayKey: \"roles:roleName\",\n            cellRenderer: (row) => (\n              <RoleDetailLink\n                {...row}\n                defaultRoleName={realm.defaultRole?.name}\n                toDetail={toDetail}\n                messageBundle={messageBundle}\n              />\n            ),\n          },\n          {\n            name: \"composite\",\n            displayKey: \"roles:composite\",\n            cellFormatters: [upperCaseFormatter(), emptyFormatter()],\n          },\n          {\n            name: \"description\",\n            displayKey: \"common:description\",\n            cellFormatters: [emptyFormatter()],\n          },\n        ]}\n        emptyState={\n          <ListEmptyState\n            hasIcon={true}\n            message={t(\"noRoles\")}\n            instructions={isReadOnly ? \"\" : t(\"noRolesInstructions\")}\n            primaryActionText={isReadOnly ? \"\" : t(\"createRole\")}\n            onPrimaryAction={() => navigate(toCreate)}\n          />\n        }\n      />\n    </>\n  );\n};\n"],"names":["RoleDetailLink","defaultRoleName","toDetail","messageBundle","role","t","useTranslation","realm","useRealm","jsx","Link","jsxs","Fragment","toRealmSettings","HelpItem","RolesList","loader","paginated","parentRoleId","toCreate","isReadOnly","navigate","useNavigate","adminClient","useAdminClient","addAlert","addError","useAlerts","realmName","setRealm","useState","selectedRole","setSelectedRole","useFetch","toggleDeleteDialog","DeleteConfirm","useConfirmDialog","ButtonVariant","AlertVariant","error","KeycloakDataTable","Button","props","row","upperCaseFormatter","emptyFormatter","ListEmptyState","KeycloakSpinner"],"mappings":"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"}