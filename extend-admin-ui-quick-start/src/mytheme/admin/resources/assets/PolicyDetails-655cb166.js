import{b8 as Je,b9 as ce,ba as Qe,r as x,ak as E,_ as Ze,bb as et,aw as tt,i as Y,bc as st,M as nt,bd as it,m as ot,u as D,a as M,d as U,n as H,j as e,F as O,G as $,C as P,B as w,k as Q,D as se,be as rt,v as ne,ah as ve,w as de,V as A,O as Fe,Q as G,b as at,f as lt,e as ct,X as dt,P as ut,g as pt,L as mt,aR as Ce,au as ht,A as ye}from"./index-a3421f29.js";import{u as ft}from"./ConfirmDialog-09ff7a12.js";import{F as gt}from"./FormAccess-1cceaef6.js";import{V as xt}from"./ViewHeader-832ec56e.js";import{u as Ne}from"./useParams-5abeab7d.js";import{R as Z}from"./Radio-e3ba1ffb.js";import{R as St}from"./ResourcesPolicySelect-e8d3e505.js";import{a as K,S as me,b as B,d as jt}from"./Select-0f56a9cc.js";import{h as It}from"./ClientScopeTypes-b557e5db.js";import{K as Tt}from"./KeycloakDataTable-10a62d94.js";import{L as vt}from"./PaginatingTableToolbar-08ca9efb.js";import{g as Ct}from"./utils-49fe564a.js";import{u as ue}from"./useToggle-a9cb2c55.js";import{M as yt,a as bt}from"./Modal-21c37af7.js";import{F as be}from"./filter-icon-9d72dc58.js";import{u as kt,m as Ot}from"./useLocaleSort-3efc7c31.js";import{R as he,S as fe,O as q,U as V,T as ge,P as _}from"./Td-6d4ab209.js";import{C as xe}from"./Checkbox-d00621d8.js";import{M as Se}from"./minus-circle-icon-6f9a971c.js";import{G as $t}from"./GroupPickerDialog-caf8c38d.js";import{K as ee}from"./KeycloakTextInput-e7f6e917.js";import{C as Dt,L as Rt}from"./CodeEditor-2fb93648.js";import{K as Pt}from"./KeycloakTextArea-1b518857.js";import{A as Mt,S as At}from"./AddRoleMappingModal-abb19beb.js";import{d as X,D as Et}from"./DatePicker-49a9a039.js";import{m as ie,M as wt,a as Ft,b as Nt,c as Lt}from"./MenuList-e3786b59.js";import{F as Vt,a as ke}from"./FlexItem-65b5f999.js";import{N as _t}from"./NumberInput-85f36a0d.js";import{A as qt}from"./Form-518a2cf2.js";var Ut=/\s/;function Ht(t){for(var i=t.length;i--&&Ut.test(t.charAt(i)););return i}var Gt=/^\s+/;function Kt(t){return t&&t.slice(0,Ht(t)+1).replace(Gt,"")}var Oe=0/0,Bt=/^[-+]0x[0-9a-f]+$/i,Wt=/^0b[01]+$/i,zt=/^0o[0-7]+$/i,Yt=parseInt;function $e(t){if(typeof t=="number")return t;if(Je(t))return Oe;if(ce(t)){var i=typeof t.valueOf=="function"?t.valueOf():t;t=ce(i)?i+"":i}if(typeof t!="string")return t===0?t:+t;t=Kt(t);var o=Wt.test(t);return o||zt.test(t)?Yt(t.slice(2),o?2:8):Bt.test(t)?Oe:+t}var Xt=function(){return Qe.Date.now()};const oe=Xt;var Jt="Expected a function",Qt=Math.max,Zt=Math.min;function es(t,i,o){var a,u,c,d,p,f,m=0,s=!1,l=!1,r=!0;if(typeof t!="function")throw new TypeError(Jt);i=$e(i)||0,ce(o)&&(s=!!o.leading,l="maxWait"in o,c=l?Qt($e(o.maxWait)||0,i):c,r="trailing"in o?!!o.trailing:r);function n(v){var k=a,T=u;return a=u=void 0,m=v,d=t.apply(T,k),d}function h(v){return m=v,p=setTimeout(C,i),s?n(v):d}function g(v){var k=v-f,T=v-m,R=i-k;return l?Zt(R,c-T):R}function j(v){var k=v-f,T=v-m;return f===void 0||k>=i||k<0||l&&T>=c}function C(){var v=oe();if(j(v))return I(v);p=setTimeout(C,g(v))}function I(v){return p=void 0,r&&a?n(v):(a=u=void 0,d)}function S(){p!==void 0&&clearTimeout(p),m=0,a=f=u=p=void 0}function y(){return p===void 0?d:I(oe())}function b(){var v=oe(),k=j(v);if(a=arguments,u=this,f=v,k){if(p===void 0)return h(f);if(l)return clearTimeout(p),p=setTimeout(C,i),n(f)}return p===void 0&&(p=setTimeout(C,i)),d}return b.cancel=S,b.flush=y,b}const N=" AM",L=" PM",ts=(t,i,o,a,u,c)=>{const d=[],p=new Date(new Date().setHours(0,0,0,0)),f=p.getDay();for(;p.getDay()===f;){let m=p.getHours(),s=N;i&&(m===0?m=12:m>=12&&(s=L),m>12&&(m%=12)),m=i?m.toString():m.toString().padStart(2,"0");const l=p.getMinutes().toString().padStart(2,"0"),r=`${m}${o}${l}${i?s:""}`;Ve(a,u,r,o,c)&&d.push(r),p.setMinutes(p.getMinutes()+t)}return d},F=(t,i,o,a,u)=>{const c=new Date(t);if(!isNaN(c.getDate())&&(t instanceof Date||t.includes("T"))){const d=a?`${c.getHours()>12?c.getHours()-12:c.getHours()}`:`${c.getHours()}`.padStart(2,"0"),p=`${c.getMinutes()}`.padStart(2,"0"),f=u?`${c.getSeconds()}`.padStart(2,"0"):"",m=f?`${o}${f}`:"";let s="";return a&&c.getHours()>11?s=L:a&&(s=N),`${d}${o}${p}${m}${s}`}else if(typeof t=="string"&&(t=t.trim(),t!==""&&Le(t,i,o,a))){const[,d,p,f,m=""]=i.exec(t),s=u?`${o}${f??"00"}`:"";let l="";if(a){const r=m.toUpperCase();r===N.toUpperCase().trim()?l=N:r===L.toUpperCase().trim()?l=L:l=new Date().getHours()>11?L:N}return`${d}${o}${p}${s}${l}`}return t.toString()},Le=(t,i,o,a)=>{const u=new Date(t);if(!isNaN(u.getDate())&&t.includes("T"))return!0;const c=parseInt(t.split(o)[0]),d=c>=(a?1:0)&&c<=(a?12:23);return t===""||i.test(t)&&d},De=(t,i)=>{const o=t.match(i);return o&&o.length?/pm/i.test(o[4])?parseInt(o[1])===12?parseInt(o[1]):parseInt(o[1])+12:/am/i.test(o[4])&&parseInt(o[1])===12?0:parseInt(o[1]):null},Re=(t,i)=>{const o=t.match(i);return o&&o.length?parseInt(o[2]):null},Pe=(t,i)=>{var o;const a=(o=t.match(i))===null||o===void 0?void 0:o[3];return a?parseInt(a):null},Ve=(t,i,o,a,u)=>{if(o.trim()==="")return!0;const c=re(t,a,u),d=re(o,a,u),p=re(i,a,u);return c<=d&&d<=p},re=(t,i,o)=>{const u=new RegExp(`^\\s*(\\d\\d?)${i}([0-5]\\d)${i}?([0-5]\\d)?\\s*([AaPp][Mm])?\\s*$`).exec(t);if(!u||!u.length)return;let c=u[1].padStart(2,"0");const d=u[2];let p=u[3]?`${i}${u[3]}`:"";!p&&o&&(p=`${i}00`);const f=u[4]||"";return f.toUpperCase()==="PM"&&c!=="12"?c=`${parseInt(c)+12}`:f.toUpperCase()==="AM"&&c==="12"&&(c="00"),`${c}${i}${d}${p}`};class je extends x.Component{constructor(i){super(i),this.baseComponentRef=x.createRef(),this.toggleRef=x.createRef(),this.inputRef=x.createRef(),this.menuRef=x.createRef(),this.onDocClick=s=>{var l,r,n,h;const g=(r=(l=this.toggleRef)===null||l===void 0?void 0:l.current)===null||r===void 0?void 0:r.contains(s.target),j=(h=(n=this.menuRef)===null||n===void 0?void 0:n.current)===null||h===void 0?void 0:h.contains(s.target);this.state.isTimeOptionsOpen&&!(g||j)&&this.onToggle(!1)},this.handleGlobalKeys=s=>{var l,r,n,h;const{isTimeOptionsOpen:g,focusedIndex:j,scrollIndex:C}=this.state;!((r=(l=this.inputRef)===null||l===void 0?void 0:l.current)===null||r===void 0)&&r.contains(s.target)?!g&&s.key!==E.Tab&&s.key!==E.Escape?this.onToggle(!0):g&&(s.key===E.Escape||s.key===E.Tab?this.onToggle(!1):s.key===E.Enter?j!==null?(this.focusSelection(j),s.stopPropagation()):this.onToggle(!1):(s.key===E.ArrowDown||s.key===E.ArrowUp)&&(this.focusSelection(C),this.updateFocusedIndex(0),s.preventDefault())):!((h=(n=this.menuRef)===null||n===void 0?void 0:n.current)===null||h===void 0)&&h.contains(s.target)&&(s.key===E.ArrowDown?(this.updateFocusedIndex(1),s.preventDefault()):s.key===E.ArrowUp?(this.updateFocusedIndex(-1),s.preventDefault()):(s.key===E.Escape||s.key===E.Tab)&&(this.inputRef.current.focus(),this.onToggle(!1)))},this.updateFocusedIndex=s=>{this.setState(l=>{const r=this.getOptions().length-1;let n=l.focusedIndex!==null?l.focusedIndex+s:l.scrollIndex+s;return n<0?n=r:n>r&&(n=0),this.scrollToIndex(n),{focusedIndex:n}})},this.getIndexToScroll=s=>this.props.menuAppendTo==="inline"?s>0?s-1:0:s,this.scrollToIndex=s=>{this.getOptions()[s].closest(`.${ie.menuContent}`).scrollTop=this.getOptions()[this.getIndexToScroll(s)].offsetTop},this.focusSelection=s=>{var l;const r=s!==-1?s:0;!((l=this.menuRef)===null||l===void 0)&&l.current&&this.getOptions()[r].querySelector(`.${ie.menuItem}`).focus()},this.scrollToSelection=s=>{const{delimiter:l,is24Hour:r}=this.props;let n=s.split(this.props.delimiter),h=null;if(n.length<2?(s=`${s}${l}00`,n=s.split(l)):n.length>2&&(s=F(s,this.state.timeRegex,l,!r,!1),n=s.split(l)),!r&&n.length>1&&n[1].length<2){const j=n[1].length===0?"00":n[1]+"0";s=`${n[0]}${l}${j}${new Date().getHours()>11?L:N}`}else!r&&n.length>1&&n[1].length===2&&!s.toUpperCase().includes(N.toUpperCase().trim())&&!s.toUpperCase().includes(L.toUpperCase().trim())&&(s=`${s}${new Date().getHours()>11?L:N}`);let g=this.getOptions().findIndex(j=>j.textContent===s);if(g!==-1)this.scrollToIndex(g),h=g;else if(n.length===2){let j="";r||(n[1].toUpperCase().includes("P")?j=L:n[1].toUpperCase().includes("A")&&(j=N)),s=`${n[0]}${l}00${j}`,g=this.getOptions().findIndex(C=>C.textContent===s),g!==-1&&this.scrollToIndex(g)}this.setState({focusedIndex:h,scrollIndex:g})},this.getRegExp=(s=!0)=>{const{is24Hour:l,delimiter:r}=this.props;let n=`\\s*(\\d\\d?)${r}([0-5]\\d)`;return s&&(n+=`${r}?([0-5]\\d)?`),new RegExp(`^${n}${l?"":"\\s*([AaPp][Mm])?"}\\s*$`)},this.getOptions=()=>{var s;return!((s=this.menuRef)===null||s===void 0)&&s.current?Array.from(this.menuRef.current.querySelectorAll(`.${ie.menuListItem}`)):[]},this.isValidFormat=s=>{if(this.props.validateTime)return this.props.validateTime(s);const{delimiter:l,is24Hour:r,includeSeconds:n}=this.props;return Le(s,this.getRegExp(n),l,!r)},this.isValidTime=s=>{const{delimiter:l,includeSeconds:r}=this.props,{minTimeState:n,maxTimeState:h}=this.state;return Ve(n,h,s,l,r)},this.isValid=s=>this.isValidFormat(s)&&this.isValidTime(s),this.onToggle=s=>{this.setState(l=>{const{timeRegex:r,isInvalid:n,timeState:h}=l,{delimiter:g,is24Hour:j,includeSeconds:C,onChange:I}=this.props,S=F(h,r,g,!j,C);return I&&!s&&S!==h&&I(null,S,De(S,r),Re(S,r),Pe(S,r),this.isValid(S)),{isTimeOptionsOpen:s,timeState:S,isInvalid:s?n:!this.isValid(S)}}),this.props.setIsOpen(s),s||this.inputRef.current.focus()},this.onSelect=s=>{const{timeRegex:l,timeState:r}=this.state,{delimiter:n,is24Hour:h,includeSeconds:g,setIsOpen:j}=this.props,C=F(s.target.textContent,l,n,!h,g);C!==r&&this.onInputChange(C,s),this.inputRef.current.focus(),this.setState({isTimeOptionsOpen:!1,isInvalid:!1}),j(!1)},this.onInputClick=s=>{this.state.isTimeOptionsOpen||this.onToggle(!0),s.stopPropagation()},this.onInputChange=(s,l)=>{const{onChange:r}=this.props,{timeRegex:n}=this.state;r&&r(l,s,De(s,n),Re(s,n),Pe(s,n),this.isValid(s)),this.scrollToSelection(s),this.setState({timeState:s})};const{is24Hour:o,delimiter:a,time:u,includeSeconds:c,isOpen:d}=this.props;let{minTime:p,maxTime:f}=this.props;if(p===""){const s=c?`${a}00`:"";p=o?`00${a}00${s}`:`12${a}00${s} AM`}if(f===""){const s=c?`${a}59`:"";f=o?`23${a}59${s}`:`11${a}59${s} PM`}const m=this.getRegExp();this.state={isInvalid:!1,isTimeOptionsOpen:d,timeState:F(u,m,a,!o,c),focusedIndex:null,scrollIndex:0,timeRegex:m,minTimeState:F(p,m,a,!o,c),maxTimeState:F(f,m,a,!o,c)}}componentDidMount(){document.addEventListener("mousedown",this.onDocClick),document.addEventListener("touchstart",this.onDocClick),document.addEventListener("keydown",this.handleGlobalKeys),this.setState({isInvalid:!this.isValid(this.state.timeState)})}componentWillUnmount(){document.removeEventListener("mousedown",this.onDocClick),document.removeEventListener("touchstart",this.onDocClick),document.removeEventListener("keydown",this.handleGlobalKeys)}componentDidUpdate(i,o){const{timeState:a,isTimeOptionsOpen:u,isInvalid:c,timeRegex:d}=this.state,{time:p,is24Hour:f,delimiter:m,includeSeconds:s,isOpen:l,minTime:r,maxTime:n}=this.props;if(i.isOpen!==l&&this.onToggle(l),u&&!o.isTimeOptionsOpen&&a&&!c&&this.scrollToSelection(a),m!==i.delimiter&&this.setState({timeRegex:this.getRegExp()}),p!==""&&p!==i.time){const h=F(p,d,m,!f,s);this.setState({timeState:h,isInvalid:!this.isValid(h)})}r!==""&&r!==i.minTime&&this.setState({minTimeState:F(r,d,m,!f,s)}),n!==""&&n!==i.maxTime&&this.setState({maxTimeState:F(n,d,m,!f,s)})}render(){const i=this.props,{"aria-label":o,isDisabled:a,className:u,placeholder:c,id:d,menuAppendTo:p,is24Hour:f,invalidFormatErrorMessage:m,invalidMinMaxErrorMessage:s,stepMinutes:l,width:r,delimiter:n,inputProps:h,onChange:g,setIsOpen:j,isOpen:C,time:I,validateTime:S,minTime:y,maxTime:b,includeSeconds:v,removeFindDomNode:k,zIndex:T}=i,R=Ze(i,["aria-label","isDisabled","className","placeholder","id","menuAppendTo","is24Hour","invalidFormatErrorMessage","invalidMinMaxErrorMessage","stepMinutes","width","delimiter","inputProps","onChange","setIsOpen","isOpen","time","validateTime","minTime","maxTime","includeSeconds","removeFindDomNode","zIndex"]),{timeState:W,isTimeOptionsOpen:qe,isInvalid:Ie,minTimeState:Ue,maxTimeState:He}=this.state,Ge={"--pf-c-date-picker__input--c-form-control--Width":r},Ke=ts(l,!f,n,Ue,He,v),Be=this.isValidFormat(W),te=d||et("time-picker"),We=()=>this.baseComponentRef&&this.baseComponentRef.current?this.baseComponentRef.current.parentElement:null,ze=x.createElement(wt,{ref:this.menuRef,isScrollable:!0},x.createElement(Ft,{maxMenuHeight:"200px"},x.createElement(Nt,{"aria-label":o},Ke.map((Te,Xe)=>x.createElement(Lt,{onClick:this.onSelect,key:Te,id:`${te}-option-${Xe}`},Te))))),Ye=x.createElement(tt,Object.assign({"aria-haspopup":"menu",className:Y(st.formControl),id:`${te}-input`,"aria-label":o,validated:Ie?"error":"default",placeholder:c,value:W||"",type:"text",iconVariant:"clock",onClick:this.onInputClick,onChange:this.onInputChange,autoComplete:"off",isDisabled:a,ref:this.inputRef},h));let z;switch(p){case"inline":z=()=>this.toggleRef.current;break;case"parent":z=We;break;default:z=p}return x.createElement("div",{ref:this.baseComponentRef,className:Y(X.datePicker,u)},x.createElement("div",Object.assign({className:Y(X.datePickerInput),style:Ge},R),x.createElement(nt,null,x.createElement("div",{id:te},x.createElement("div",{ref:this.toggleRef,style:{paddingLeft:"0"}},x.createElement(it,{appendTo:z,trigger:Ye,popper:ze,isVisible:qe,removeFindDomNode:k,zIndex:T})))),Ie&&x.createElement("div",{className:Y(X.datePickerHelperText,X.modifiers.error)},Be?s:m)))}}je.displayName="TimePicker";je.defaultProps={className:"",isDisabled:!1,time:"",is24Hour:!1,invalidFormatErrorMessage:"Invalid time format",invalidMinMaxErrorMessage:"Invalid time entered",placeholder:"hh:mm",delimiter:":","aria-label":"Time picker",width:"150px",menuAppendTo:"inline",stepMinutes:30,inputProps:{},minTime:"",maxTime:"",isOpen:!1,setIsOpen:()=>{},removeFindDomNode:!1,zIndex:9999};const ss={name:"CaretUpIcon",height:512,width:320,svgPath:"M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z",yOffset:0,xOffset:0},ns=ot(ss),is=({name:t,label:i,helpText:o,defaultValue:a,isRequired:u,variant:c=K.typeaheadMulti})=>{const{t:d}=D("clients"),{control:p,getValues:f,formState:{errors:m}}=M(),s=f(t),[l,r]=ue(),[n,h]=x.useState([]),[g,j]=x.useState(""),{adminClient:C}=U(),I=x.useCallback(es(j,1e3),[]);H(()=>{const y={max:20};return g&&(y.username=g),s?.length&&!g?Promise.all(s.map(b=>C.users.findOne({id:b}))):C.users.find(y)},h,[g]);const S=y=>y.filter(b=>b!==void 0).map(b=>e.jsx(B,{value:b.id,selected:s?.includes(b.id),children:b.username},b.id));return e.jsx(O,{label:d(i),isRequired:u,labelIcon:e.jsx($,{helpText:o,fieldLabelId:`clients:${i}`}),fieldId:t,validated:m[t]?"error":"default",helperTextInvalid:d("common:required"),children:e.jsx(P,{name:t,defaultValue:a,control:p,rules:u&&c===K.typeaheadMulti?{validate:y=>y.length>0}:{required:u},render:({field:y})=>e.jsx(me,{toggleId:t,variant:c,placeholderText:d("selectAUser"),onToggle:r,isOpen:l,selections:y.value,onFilter:(b,v)=>(I(v),S(n)),onSelect:(b,v)=>{const k=v.toString();if(c!==K.typeaheadMulti)y.value.includes(k)?y.onChange([]):y.onChange([k]);else{const T=y.value.find(R=>R===k)?y.value.filter(R=>R!==k):[...y.value,k];y.onChange(T)}r()},"aria-label":d(t),children:S(n)})})})},ae=["UNANIMOUS","AFFIRMATIVE","CONSENSUS"],os=({helpLabel:t,isLimited:i=!1})=>{const{t:o}=D("clients"),{control:a}=M();return e.jsx(O,{label:o("decisionStrategy"),labelIcon:e.jsx($,{helpText:o(`clients-help:${t||"decisionStrategy"}`),fieldLabelId:"clients:decisionStrategy"}),fieldId:"decisionStrategy",hasNoPaddingTop:!0,children:e.jsx(P,{name:"decisionStrategy","data-testid":"decisionStrategy",defaultValue:ae[0],control:a,render:({field:u})=>e.jsx(e.Fragment,{children:(i?ae.slice(0,2):ae).map(c=>e.jsx(Z,{id:c,"data-testid":c,isChecked:u.value===c,name:"decisionStrategy",onChange:()=>u.onChange(c),label:o(`decisionStrategies.${c}`),className:"pf-u-mb-md"},c))})})})},rs=()=>{const{t}=D("clients"),{id:i}=Ne();return e.jsxs(e.Fragment,{children:[e.jsx(O,{label:t("applyPolicy"),fieldId:"policies",labelIcon:e.jsx($,{helpText:t("clients-help:applyPolicy"),fieldLabelId:"clients:policies"}),children:e.jsx(St,{name:"policies",clientId:i})}),e.jsx(os,{helpLabel:"policyDecisionStagey"})]})},as=()=>{const{t}=D("clients"),{control:i,getValues:o,formState:{errors:a}}=M(),u=o("clients"),[c,d]=x.useState(!1),[p,f]=x.useState([]),[m,s]=x.useState(""),{adminClient:l}=U();H(async()=>{const n={max:20};return m&&(n.clientId=m,n.search=!0),u?.length&&!m?await Promise.all(u.map(h=>l.clients.findOne({id:h}))):await l.clients.find(n)},f,[m]);const r=n=>n.map(h=>e.jsx(B,{value:h.id,selected:u?.includes(h.id),children:h.clientId},h.id));return e.jsx(O,{label:t("clients"),labelIcon:e.jsx($,{helpText:t("clients-help:policyClient"),fieldLabelId:"clients:client"}),fieldId:"clients",helperTextInvalid:t("requiredClient"),validated:a.clients?"error":"default",isRequired:!0,children:e.jsx(P,{name:"clients",defaultValue:[],control:i,rules:{validate:n=>n.length>0},render:({field:n})=>e.jsx(me,{toggleId:"clients",variant:K.typeaheadMulti,onToggle:h=>d(h),isOpen:c,selections:n.value,onFilter:(h,g)=>(s(g),r(p)),onSelect:(h,g)=>{const j=g.toString();n.value.includes(j)?n.onChange(n.value.filter(C=>C!==j)):n.onChange([...n.value,j]),d(!1)},"aria-label":t("clients"),children:r(p)})})})};const ls=({clientScopes:t,clientName:i,open:o,toggleDialog:a,onAdd:u,isClientScopesConditionType:c})=>{const{t:d}=D("clients"),[p,f]=x.useState(!1),[m,s]=x.useState([]),[l,r]=x.useState("Name"),[n,h]=x.useState("All"),[g,j]=ue(),[C,I]=ue(!1),S=x.useMemo(()=>n==="OpenID Connect"?t.filter(T=>T.protocol==="openid-connect"):n==="SAML"?t.filter(T=>T.protocol==="saml"):t,[t,l,n]),y=T=>{const R=m.map(W=>({scope:W,type:T}));u(R),f(!1),a()},b=T=>{T==="Name"?r("Protocol"):T==="Protocol"&&(r("Name"),h("All")),j()},v=T=>{T==="SAML"?h("SAML"):T==="OpenID Connect"?h("OpenID Connect"):T==="All"&&h("All"),I()},k=[e.jsx(B,{value:"SAML",children:d("protocolTypes.saml")},1),e.jsx(B,{value:"OpenID Connect",children:d("protocolTypes.openIdConnect")},2),e.jsx(B,{value:"All",isPlaceholder:!0,children:d("protocolTypes.all")},3)];return e.jsx(yt,{variant:bt.medium,title:c?d("addClientScope"):d("addClientScopesTo",{clientName:i}),isOpen:o,onClose:a,actions:c?[e.jsx(w,{id:"modal-add","data-testid":"confirm",variant:Q.primary,onClick:()=>{const T=m.map(R=>({scope:R}));u(T),a()},isDisabled:m.length===0,children:d("common:add")},"add"),e.jsx(w,{id:"modal-cancel","data-testid":"cancel",variant:Q.link,onClick:()=>{s([]),a()},children:d("common:cancel")},"cancel")]:[e.jsx(se,{className:"keycloak__client-scopes-add__add-dropdown",id:"add-dropdown",direction:rt.up,isOpen:p,toggle:e.jsx(ne,{isDisabled:m.length===0,onToggle:()=>f(!p),isPrimary:!0,toggleIndicator:ns,id:"add-scope-toggle",children:d("common:add")}),dropdownItems:It(d,y)},"add-dropdown"),e.jsx(w,{id:"modal-cancel",variant:Q.link,onClick:()=>{s([]),a()},children:d("common:cancel")},"cancel")],children:e.jsx(Tt,{loader:S,ariaLabelKey:"client-scopes:chooseAMapperType",searchPlaceholderKey:l==="Name"?"client-scopes:searchFor":void 0,isSearching:l!=="Name",searchTypeComponent:e.jsx(se,{onSelect:()=>{b(l)},"data-testid":"filter-type-dropdown",toggle:e.jsx(ne,{id:"toggle-id-9",onToggle:j,toggleIndicator:ve,icon:e.jsx(be,{}),children:l}),isOpen:g,dropdownItems:[e.jsx(de,{"data-testid":"filter-type-dropdown-item",children:d(l==="Name"?"protocol":"common:name")},"filter-type")]}),toolbarItem:l==="Protocol"&&e.jsxs(e.Fragment,{children:[e.jsx(se,{onSelect:()=>{b(l)},"data-testid":"filter-type-dropdown",toggle:e.jsx(ne,{id:"toggle-id-9",onToggle:j,toggleIndicator:ve,icon:e.jsx(be,{}),children:l}),isOpen:g,dropdownItems:[e.jsx(de,{"data-testid":"filter-type-dropdown-item",children:d("common:name")},"filter-type")]}),e.jsx(me,{variant:K.single,className:"kc-protocolType-select","aria-label":"Select Input",onToggle:I,onSelect:(T,R)=>v(R.toString()),selections:n,isOpen:C,direction:jt.down,children:k})]}),canSelectAll:!0,onSelect:T=>s(T),columns:[{name:"name"},{name:"protocol",displayKey:"clients:protocol",cellRenderer:T=>Ct(d,T.protocol??"openid-connect")},{name:"description"}],emptyState:e.jsx(vt,{message:d("emptyAddClientScopes"),instructions:d("emptyAddClientScopesInstructions")})})})},cs=()=>{const{t}=D("clients"),{control:i,getValues:o,setValue:a,formState:{errors:u}}=M(),[c,d]=x.useState(!1),[p,f]=x.useState([]),[m,s]=x.useState([]),{adminClient:l}=U(),r=kt();return H(()=>l.clientScopes.find(),n=>{s(o("clientScopes").map(h=>n.find(g=>g.id===h.id))),f(r(n,Ot("name")))},[]),e.jsxs(O,{label:t("clientScopes"),labelIcon:e.jsx($,{helpText:t("clients-help:clientScopes"),fieldLabelId:"clients:clientScopes"}),fieldId:"clientScopes",helperTextInvalid:t("requiredClientScope"),validated:u.clientScopes?"error":"default",isRequired:!0,children:[e.jsx(P,{name:"clientScopes",control:i,defaultValue:[],rules:{validate:n=>n.filter(h=>h.id).length>0},render:({field:n})=>e.jsxs(e.Fragment,{children:[c&&e.jsx(ls,{clientScopes:p.filter(h=>!n.value.map(g=>g.id).includes(h.id)),isClientScopesConditionType:!0,open:c,toggleDialog:()=>d(!c),onAdd:h=>{s([...m,...h.map(g=>g.scope)]),n.onChange([...n.value,...h.map(g=>g.scope).map(g=>({id:g.id,required:!1}))])}}),e.jsx(w,{"data-testid":"select-scope-button",variant:"secondary",onClick:()=>{d(!0)},children:t("addClientScopes")})]})}),m.length>0&&e.jsxs(he,{variant:"compact",children:[e.jsx(fe,{children:e.jsxs(q,{children:[e.jsx(V,{children:t("clientScope")}),e.jsx(V,{children:t("required")}),e.jsx(V,{})]})}),e.jsx(ge,{children:m.map((n,h)=>e.jsxs(q,{children:[e.jsx(_,{children:n.name}),e.jsx(_,{children:e.jsx(P,{name:`clientScopes.${h}.required`,defaultValue:!1,control:i,render:({field:g})=>e.jsx(xe,{id:"required","data-testid":"standard",name:"required",isChecked:g.value,onChange:g.onChange})})}),e.jsx(_,{children:e.jsx(w,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e.jsx(Se,{}),onClick:()=>{a("clientScopes",[...o("clientScopes").filter(g=>g.id!==n.id)]),s([...m.filter(g=>g.id!==n.id)])}})})]},n.id))})]})]})},ds=()=>{const{t}=D("clients"),{control:i,register:o,getValues:a,setValue:u,formState:{errors:c}}=M(),d=a("groups"),[p,f]=x.useState(!1),[m,s]=x.useState([]),{adminClient:l}=U();return H(()=>d&&d.length>0?Promise.all(d.map(r=>l.groups.findOne({id:r.id}))):Promise.resolve([]),r=>{const n=r.filter(h=>h);s(n)},[]),e.jsxs(e.Fragment,{children:[e.jsx(O,{label:t("groupsClaim"),labelIcon:e.jsx($,{helpText:t("clients-help:groupsClaim"),fieldLabelId:"clients:groupsClaim"}),fieldId:"groups",children:e.jsx(ee,{type:"text",id:"groupsClaim","data-testid":"groupsClaim",...o("groupsClaim")})}),e.jsxs(O,{label:t("groups"),labelIcon:e.jsx($,{helpText:t("clients-help:policyGroups"),fieldLabelId:"clients:groups"}),fieldId:"groups",helperTextInvalid:t("requiredGroups"),validated:c.groups?"error":"default",isRequired:!0,children:[e.jsx(P,{name:"groups",control:i,defaultValue:[],rules:{validate:r=>r&&r.filter(({id:n})=>n).length>0},render:({field:r})=>e.jsxs(e.Fragment,{children:[p&&e.jsx($t,{type:"selectMany",text:{title:"clients:addGroupsToGroupPolicy",ok:"common:add"},onConfirm:n=>{r.onChange([...r.value||[],...(n||[]).map(({id:h})=>({id:h}))]),s([...m,...n||[]]),f(!1)},onClose:()=>{f(!1)},filterGroups:m}),e.jsx(w,{"data-testid":"select-group-button",variant:"secondary",onClick:()=>{f(!0)},children:t("addGroups")})]})}),m.length>0&&e.jsxs(he,{variant:"compact",children:[e.jsx(fe,{children:e.jsxs(q,{children:[e.jsx(V,{children:t("groups")}),e.jsx(V,{children:t("extendToChildren")}),e.jsx(V,{})]})}),e.jsx(ge,{children:m.map((r,n)=>e.jsxs(q,{children:[e.jsx(_,{children:r.path}),e.jsx(_,{children:e.jsx(P,{name:`groups.${n}.extendChildren`,defaultValue:!1,control:i,render:({field:h})=>e.jsx(xe,{id:"extendChildren","data-testid":"standard",name:"extendChildren",isChecked:h.value,onChange:h.onChange,isDisabled:r.subGroups?.length===0})})}),e.jsx(_,{children:e.jsx(w,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e.jsx(Se,{}),onClick:()=>{u("groups",[...(d||[]).filter(({id:h})=>h!==r.id)]),s([...m.filter(({id:h})=>h!==r.id)])}})})]},r.id))})]})]})]})},us=()=>{const{t}=D("clients"),{control:i}=M();return e.jsx(O,{label:t("code"),labelIcon:e.jsx($,{helpText:t("clients-help:policyCode"),fieldLabelId:"clients:code"}),fieldId:"code",isRequired:!0,children:e.jsx(P,{name:"code",defaultValue:"",control:i,render:({field:o})=>e.jsx(Dt,{id:"code","data-testid":"code",onChange:o.onChange,code:o.value,height:"600px",language:Rt.javascript})})})},Me=["POSITIVE","NEGATIVE"],ps=()=>{const{t}=D("clients"),{control:i}=M();return e.jsx(O,{label:t("logic"),labelIcon:e.jsx($,{helpText:t("clients-help:logic"),fieldLabelId:"clients:logic"}),fieldId:"logic",hasNoPaddingTop:!0,children:e.jsx(P,{name:"logic","data-testid":"logic",defaultValue:Me[0],control:i,render:({field:o})=>e.jsx(e.Fragment,{children:Me.map(a=>e.jsx(Z,{id:a,"data-testid":a,isChecked:o.value===a,name:"logic",onChange:()=>o.onChange(a),label:t(`logicType.${a.toLowerCase()}`),className:"pf-u-mb-md"},a))})})})},ms=({prefix:t})=>{const{t:i}=D("clients"),{register:o,formState:{errors:a}}=M();return e.jsxs(e.Fragment,{children:[e.jsx(O,{label:i("common:name"),fieldId:"kc-name",helperTextInvalid:i("common:required"),validated:a.name?A.error:A.default,isRequired:!0,labelIcon:e.jsx($,{helpText:i(`clients-help:${t}-name`),fieldLabelId:"name"}),children:e.jsx(ee,{id:"kc-name","data-testid":"name",validated:a.name?A.error:A.default,...o("name",{required:!0})})}),e.jsx(O,{label:i("common:description"),fieldId:"kc-description",labelIcon:e.jsx($,{helpText:i(`clients-help:${t}-description`),fieldLabelId:"description"}),validated:a.description?A.error:A.default,helperTextInvalid:i("common:maxLength",{length:255}),children:e.jsx(Pt,{id:"kc-description","data-testid":"description",validated:a.description?A.error:A.default,...o("description",{maxLength:255})})})]})},hs=()=>{const{t}=D("clients"),{register:i,formState:{errors:o}}=M();return e.jsxs(e.Fragment,{children:[e.jsx(O,{label:t("targetClaim"),fieldId:"targetClaim",helperTextInvalid:t("common:required"),validated:o.targetClaim?"error":"default",isRequired:!0,labelIcon:e.jsx($,{helpText:t("clients-help:targetClaim"),fieldLabelId:"clients:targetClaim"}),children:e.jsx(ee,{id:"targetClaim","data-testid":"targetClaim",validated:o.targetClaim?"error":"default",...i("targetClaim",{required:!0})})}),e.jsx(O,{label:t("regexPattern"),fieldId:"pattern",labelIcon:e.jsx($,{helpText:t("clients-help:regexPattern"),fieldLabelId:"clients:regexPattern"}),isRequired:!0,validated:o.pattern?"error":"default",helperTextInvalid:t("common:required"),children:e.jsx(ee,{id:"pattern","data-testid":"regexPattern",validated:o.pattern?"error":"default",...i("pattern",{required:!0})})})]})},fs=()=>{const{t}=D("clients"),{control:i,getValues:o,setValue:a,formState:{errors:u}}=M(),c=o("roles"),[d,p]=x.useState(!1),[f,m]=x.useState([]),{adminClient:s}=U();return H(async()=>{if(c&&c.length>0){const l=await Promise.all(c.map(r=>s.roles.findOneById({id:r.id})));return Promise.all(l.map(async r=>({role:r,client:r.clientRole?await s.clients.findOne({id:r?.containerId}):void 0})))}return Promise.resolve([])},m,[]),e.jsxs(O,{label:t("roles"),labelIcon:e.jsx($,{helpText:t("clients-help:policyRoles"),fieldLabelId:"clients:roles"}),fieldId:"roles",helperTextInvalid:t("requiredRoles"),validated:u.roles?"error":"default",isRequired:!0,children:[e.jsx(P,{name:"roles",control:i,defaultValue:[],rules:{validate:l=>l&&l.filter(r=>r.id).length>0},render:({field:l})=>e.jsxs(e.Fragment,{children:[d&&e.jsx(Mt,{id:"role",type:"roles",onAssign:r=>{l.onChange([...l.value||[],...r.map(n=>({id:n.role.id}))]),m([...f,...r]),p(!1)},onClose:()=>{p(!1)},isLDAPmapper:!0}),e.jsx(w,{"data-testid":"select-role-button",variant:"secondary",onClick:()=>{p(!0)},children:t("addRoles")})]})}),f.length>0&&e.jsxs(he,{variant:"compact",children:[e.jsx(fe,{children:e.jsxs(q,{children:[e.jsx(V,{children:t("roles")}),e.jsx(V,{children:t("required")}),e.jsx(V,{})]})}),e.jsx(ge,{children:f.map((l,r)=>e.jsxs(q,{children:[e.jsx(_,{children:e.jsx(At,{role:l.role,client:l.client})}),e.jsx(_,{children:e.jsx(P,{name:`roles.${r}.required`,defaultValue:!1,control:i,render:({field:n})=>e.jsx(xe,{id:"required","data-testid":"standard",name:"required",isChecked:n.value,onChange:n.onChange})})}),e.jsx(_,{children:e.jsx(w,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e.jsx(Se,{}),onClick:()=>{a("roles",[...(c||[]).filter(n=>n.id!==l.role.id)]),m([...f.filter(n=>n.role.id!==l.role.id)])}})})]},l.role.id))})]})]})},le=/(\d\d\d\d-\d\d-\d\d)? (\d\d?):(\d\d?)/,Ae=t=>t.toString().padStart(2,"0"),Ee=({name:t})=>{const{control:i}=M(),o=(u,c)=>{if(!c)return u;const d=u.match(le);return`${[c.getFullYear(),Ae(c.getMonth()+1),Ae(c.getDate())].join("-")} ${d?d[2]:"00"}:${d?d[3]:"00"}:00`},a=(u,c,d)=>{const p=u.match(le);return d!=null?`${p?p[1]:""} ${c}:${d<10?`0${d}`:d}:00`:u};return e.jsx(P,{name:t,defaultValue:"",control:i,rules:{required:!0},render:({field:u})=>{const c=u.value.match(le)||["","","0","00"];return e.jsxs(Fe,{hasGutter:!0,id:t,children:[e.jsx(G,{children:e.jsx(Et,{value:c[1],onChange:(d,p,f)=>{u.onChange(o(u.value,f))}})}),e.jsx(G,{children:e.jsx(je,{time:`${c[2]}:${c[3]}`,onChange:(d,p,f,m)=>u.onChange(a(u.value,f,m)),is24Hour:!0})})]})}})},we=({name:t,min:i,max:o})=>{const{control:a}=M(),u=c=>Math.min(c,o);return e.jsx(P,{name:t,defaultValue:"",control:a,render:({field:c})=>e.jsx(_t,{id:t,value:c.value,min:i,max:o,onPlus:()=>c.onChange(Number(c.value)+1),onMinus:()=>c.onChange(Number(c.value)-1),onChange:d=>{const p=Number(d.currentTarget.value);c.onChange(u(isNaN(p)?0:p))}})})},J=({name:t,...i})=>{const{t:o}=D("clients");return e.jsx(O,{label:o(t),fieldId:t,labelIcon:e.jsx($,{helpText:o(`clients-help:${t}`),fieldLabelId:`clients:${t}`}),children:e.jsxs(Fe,{hasGutter:!0,children:[e.jsx(G,{children:e.jsx(we,{name:t,...i})}),e.jsx(G,{children:o("common:to")}),e.jsx(G,{children:e.jsx(we,{name:`${t}End`,...i})})]})})},gs=()=>{const{t}=D("clients"),{getValues:i,formState:{errors:o}}=M(),[a,u]=x.useState(i("month"));return e.jsxs(e.Fragment,{children:[e.jsx(O,{label:t("repeat"),fieldId:"repeat",labelIcon:e.jsx($,{helpText:t("clients-help:repeat"),fieldLabelId:"clients:repeat"}),children:e.jsxs(Vt,{children:[e.jsx(ke,{children:e.jsx(Z,{id:"notRepeat","data-testid":"notRepeat",isChecked:!a,name:"repeat",onChange:()=>u(!1),label:t("notRepeat"),className:"pf-u-mb-md"})}),e.jsx(ke,{children:e.jsx(Z,{id:"repeat","data-testid":"repeat",isChecked:a,name:"repeat",onChange:()=>u(!0),label:t("repeat"),className:"pf-u-mb-md"})})]})}),a&&e.jsxs(e.Fragment,{children:[e.jsx(J,{name:"month",min:1,max:12}),e.jsx(J,{name:"dayMonth",min:1,max:31}),e.jsx(J,{name:"hour",min:0,max:23}),e.jsx(J,{name:"minute",min:0,max:59})]}),e.jsx(O,{label:t("startTime"),fieldId:"notBefore",labelIcon:e.jsx($,{helpText:t("clients-help:startTime"),fieldLabelId:"clients:startTime"}),isRequired:!0,helperTextInvalid:t("common:required"),validated:o.notBefore?A.error:A.default,children:e.jsx(Ee,{name:"notBefore"})}),e.jsx(O,{label:t("expireTime"),fieldId:"notOnOrAfter",labelIcon:e.jsx($,{helpText:t("clients-help:expireTime"),fieldLabelId:"clients:expireTime"}),isRequired:!0,helperTextInvalid:t("common:required"),validated:o.notOnOrAfter?A.error:A.default,children:e.jsx(Ee,{name:"notOnOrAfter"})})]})},xs=()=>{const{t}=D();return e.jsx(is,{name:"users",label:"users",helpText:t("clients-help:policyUsers"),defaultValue:[],isRequired:!0})};const pe={aggregate:rs,client:as,user:xs,"client-scope":cs,group:ds,regex:hs,role:fs,time:gs,js:us},_e=t=>t in pe;function Ss(){const{t}=D("clients"),{id:i,realm:o,policyId:a,policyType:u}=Ne(),c=at(),d=lt(),{reset:p,handleSubmit:f}=d,{adminClient:m}=U(),{addAlert:s,addError:l}=ct(),[r,n]=x.useState();H(async()=>{if(a){const I=await Promise.all([m.clients.findOnePolicy({id:i,type:u,policyId:a}),m.clients.getAssociatedPolicies({id:i,permissionId:a})]);if(!I[0])throw new Error(t("common:notFound"));return{policy:I[0],policies:I[1].map(S=>S.id)}}return{}},({policy:I,policies:S})=>{p({...I,policies:S}),n(I)},[i,u,a]);const h=async I=>{I.groups=I.groups?.filter(S=>S.id),I.clientScopes=I.clientScopes?.filter(S=>S.id),I.roles=I.roles?.filter(S=>S.id).map(S=>({...S,required:S.required||!1}));try{if(a)await m.clients.updatePolicy({id:i,type:u,policyId:a},I);else{const S=await m.clients.createPolicy({id:i,type:u},I);c(ht({realm:o,id:i,policyType:u,policyId:S.id}))}s(t((a?"update":"create")+"PolicySuccess"),ye.success)}catch(S){l("clients:policySaveError",S)}},[g,j]=ft({titleKey:"clients:deletePolicy",messageKey:"clients:deletePolicyConfirm",continueButtonLabel:"clients:confirm",onConfirm:async()=>{try{await m.clients.delPolicy({id:i,policyId:a}),s(t("policyDeletedSuccess"),ye.success),c(Ce({realm:o,clientId:i,tab:"policies"}))}catch(I){l("clients:policyDeletedError",I)}}});if(a&&!r)return e.jsx(dt,{});const C=_e(u)?pe[u]:pe.js;return e.jsxs(e.Fragment,{children:[e.jsx(j,{}),e.jsx(xt,{titleKey:a?r?.name:t("clients:createPolicyOfType",{policyType:u}),dropdownItems:a?[e.jsx(de,{"data-testid":"delete-policy",onClick:()=>g(),children:t("common:delete")},"delete")]:void 0}),e.jsx(ut,{variant:"light",children:e.jsxs(gt,{isHorizontal:!0,onSubmit:f(h),role:"view-clients",children:[e.jsxs(pt,{...d,children:[e.jsx(ms,{prefix:"policy"}),e.jsx(C,{}),e.jsx(ps,{})]}),e.jsx(qt,{children:e.jsxs("div",{className:"pf-u-mt-md",children:[e.jsx(w,{variant:Q.primary,className:"pf-u-mr-md",type:"submit","data-testid":"save",children:t("common:save")}),e.jsx(w,{variant:"link","data-testid":"cancel",component:I=>e.jsx(mt,{...I,to:Ce({realm:o,clientId:i,tab:"policies"})}),children:t("common:cancel")})]})})]})})]})}const zs=Object.freeze(Object.defineProperty({__proto__:null,default:Ss,isValidComponentType:_e},Symbol.toStringTag,{value:"Module"}));export{ls as A,os as D,zs as P,is as U,_e as i};
//# sourceMappingURL=PolicyDetails-655cb166.js.map
