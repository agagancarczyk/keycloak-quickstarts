import{u as J,b as Q,f as W,ay as Y,e as Z,d as _,r as m,R as ee,n as te,k as ie,A as b,d4 as D,d1 as k,j as e,X as re,E as se,w as ae,P as oe,F as I,V as F,B as c,L as p,G as N,df as le,dg as ne,U as ce}from"./index-a3421f29.js";import{u as de}from"./ConfirmDialog-09ff7a12.js";import{F as me}from"./FormAccess-1cceaef6.js";import{K as ue}from"./KeycloakTextArea-1b518857.js";import{K as xe}from"./KeycloakTextInput-e7f6e917.js";import{V as fe}from"./ViewHeader-832ec56e.js";import{u as pe}from"./useParams-5abeab7d.js";import"./realm-settings-section-4ed993c7.js";import{A as he}from"./Form-518a2cf2.js";import{F as Pe,a as w}from"./FlexItem-65b5f999.js";import{T as S,a as L}from"./Text-564bf299.js";import{P as ge}from"./plus-circle-icon-cb854796.js";import{e as je,D as Ce,a as be,c as ke,d as Te}from"./DataListItemRow-75e02946.js";import{T as ve}from"./trash-icon-593b2b02.js";import"./Modal-21c37af7.js";import"./copy-icon-a4fe01af.js";import"./GridItem-d34dae2e.js";import"./ToolbarContent-7b435752.js";import"./data-list-7d55714c.js";import"./grip-vertical-icon-cbeff50f.js";const ye={name:"",description:"",executors:[]};function Xe(){const{t}=J("realm-settings"),h=Q(),{handleSubmit:A,setValue:P,getValues:V,register:T,formState:{isDirty:v,errors:K},control:G}=W({defaultValues:ye,mode:"onChange"}),{fields:g,remove:R}=Y({name:"executors",control:G}),{addAlert:j,addError:C}=Z(),{adminClient:f}=_(),[d,B]=m.useState(),[s,H]=m.useState(!1),{realm:l,profileName:a}=pe(),q=ee(),O=m.useMemo(()=>q.componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[]),[u,M]=m.useState(),n=!!a,[y,z]=m.useState(0),U=()=>z(y+1);te(()=>f.clientPolicies.listProfiles({includeGlobalProfiles:!0}),i=>{B({globalProfiles:i.globalProfiles,profiles:i.profiles?.filter(x=>x.name!==a)});const o=i.globalProfiles?.find(x=>x.name===a),r=i.profiles?.find(x=>x.name===a);H(o!==void 0),P("name",o?.name??r?.name??""),P("description",o?.description??r?.description??""),P("executors",o?.executors??r?.executors??[])},[y]);const X=async i=>{const o=i;try{await f.clientPolicies.createProfiles({...d,profiles:[...d?.profiles||[],o]}),j(t(n?"realm-settings:updateClientProfileSuccess":"realm-settings:createClientProfileSuccess"),b.success),h(D({realm:l,profileName:i.name}))}catch(r){C(n?"realm-settings:updateClientProfileError":"realm-settings:createClientProfileError",r)}},[E,$]=de({titleKey:u?.name?t("deleteExecutorProfileConfirmTitle"):t("deleteClientProfileConfirmTitle"),messageKey:u?.name?t("deleteExecutorProfileConfirm",{executorName:u.name}):t("deleteClientProfileConfirm",{profileName:a}),continueButtonLabel:t("delete"),continueButtonVariant:ie.danger,onConfirm:async()=>{if(u?.name){R(u.idx);try{await f.clientPolicies.createProfiles({...d,profiles:[...d.profiles||[],V()]}),j(t("deleteExecutorSuccess"),b.success),h(D({realm:l,profileName:a}))}catch(i){C(t("deleteExecutorError"),i)}}else try{await f.clientPolicies.createProfiles(d),j(t("deleteClientSuccess"),b.success),h(k({realm:l,tab:"profiles"}))}catch(i){C(t("deleteClientError"),i)}}});return d?e.jsxs(e.Fragment,{children:[e.jsx($,{}),e.jsx(fe,{titleKey:n?a:t("newClientProfile"),badges:[{id:"global-client-profile-badge",text:s?e.jsx(se,{color:"blue",children:t("global")}):""}],divider:!0,dropdownItems:n&&!s?[e.jsx(ae,{value:"delete",onClick:E,"data-testid":"deleteClientProfileDropdown",children:t("deleteClientProfile")},"delete")]:void 0}),e.jsx(oe,{variant:"light",children:e.jsxs(me,{isHorizontal:!0,role:"view-realm",className:"pf-u-mt-lg",children:[e.jsx(I,{label:t("newClientProfileName"),fieldId:"kc-name",helperText:t("createClientProfileNameHelperText"),isRequired:!0,helperTextInvalid:t("common:required"),validated:K.name?F.error:F.default,children:e.jsx(xe,{id:"kc-name","data-testid":"client-profile-name",isReadOnly:s,...T("name",{required:!0})})}),e.jsx(I,{label:t("common:description"),fieldId:"kc-description",children:e.jsx(ue,{id:"kc-description","data-testid":"client-profile-description",isReadOnly:s,...T("description")})}),e.jsxs(he,{children:[!s&&e.jsx(c,{variant:"primary",onClick:()=>A(X)(),"data-testid":"saveCreateProfile",isDisabled:!v,children:t("common:save")}),n&&!s&&e.jsx(c,{id:"reloadProfile",variant:"link","data-testid":"reloadProfile",isDisabled:!v,onClick:U,children:t("realm-settings:reload")}),!n&&!s&&e.jsx(c,{id:"cancelCreateProfile",variant:"link",component:i=>e.jsx(p,{...i,to:k({realm:l,tab:"profiles"})}),"data-testid":"cancelCreateProfile",children:t("common:cancel")})]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs(Pe,{children:[e.jsx(w,{children:e.jsxs(S,{className:"kc-executors",component:L.h1,children:[t("executors"),e.jsx(N,{helpText:t("realm-settings:executorsHelpText"),fieldLabelId:"realm-settings:executors"})]})}),!s&&e.jsx(w,{align:{default:"alignRight"},children:e.jsx(c,{id:"addExecutor",component:i=>e.jsx(p,{...i,to:le({realm:l,profileName:a})}),variant:"link",className:"kc-addExecutor","data-testid":"addExecutor",icon:e.jsx(ge,{}),children:t("realm-settings:addExecutor")})})]}),g.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(je,{"aria-label":t("executors"),isCompact:!0,children:g.map((i,o)=>e.jsx(Ce,{"aria-labelledby":"executors-list-item",id:i.executor,children:e.jsx(be,{"data-testid":"executors-list-row",children:e.jsx(ke,{dataListCells:[e.jsxs(Te,{"data-testid":"executor-type",children:[i.configuration?e.jsx(c,{component:r=>e.jsx(p,{...r,to:ne({realm:l,profileName:a,executorName:i.executor})}),variant:"link","data-testid":"editExecutor",children:i.executor}):e.jsx("span",{className:"kc-unclickable-executor",children:i.executor}),O?.filter(r=>r.id===i.executor).map(r=>e.jsxs(m.Fragment,{children:[e.jsx(N,{helpText:r.helpText,fieldLabelId:"realm-settings:executorTypeTextHelpText"},r.id),!s&&e.jsx(c,{variant:"link",isInline:!0,icon:e.jsx(ve,{className:"kc-executor-trash-icon","data-testid":"deleteExecutor"},`executorType-trash-icon-${r.id}`),onClick:()=>{E(),M({idx:o,name:r.id})},"aria-label":t("common:remove")})]},r.id))]},"executor")]})})},i.executor))}),s&&e.jsx(c,{id:"backToClientPolicies",component:i=>e.jsx(p,{...i,to:k({realm:l,tab:"profiles"})}),variant:"primary",className:"kc-backToPolicies","data-testid":"backToClientPolicies",children:t("realm-settings:back")})]}),g.length===0&&e.jsxs(e.Fragment,{children:[e.jsx(ce,{}),e.jsx(S,{className:"kc-emptyExecutors",component:L.h6,children:t("realm-settings:emptyExecutors")})]})]})]})})]}):e.jsx(re,{})}export{Xe as default};
//# sourceMappingURL=ClientProfileForm-9d8f17ea.js.map
