import{_ as Y,r as u,i as A,bz as oe,U as Me,bv as C,aW as ge,bA as Re,l as Oe,ak as he,bB as fe,u as O,d as B,e as $,f as we,j as e,B as P,k as ye,F as Ke,V as ae,A as q,bC as H,az as ee,D as ie,a7 as ce,w as U,c as te,b as le,a_ as se,L as ne,bs as X,a8 as J,aN as Fe,bD as Be,P as je,bE as Ne,b3 as Le,aB as Ue,n as Ce,M as $e,X as qe,p as He,bF as ze,aD as Pe,bG as We,bH as be,R as Ze,af as Je,ag as Xe,bI as Qe,Z as Ye,bJ as et}from"./index-a3421f29.js";import{V as tt}from"./ViewHeader-832ec56e.js";import{a as Se}from"./resource-08ae7dbc.js";import{K as de,n as st}from"./KeycloakDataTable-10a62d94.js";import{L as ue,P as at}from"./PaginatingTableToolbar-08ca9efb.js";import{K as nt}from"./KeycloakTextInput-e7f6e917.js";import{M as Ge,a as Ee}from"./Modal-21c37af7.js";import{F as rt}from"./Form-518a2cf2.js";import{u as L}from"./useToggle-a9cb2c55.js";import{C as ot}from"./ConfirmDialog-09ff7a12.js";import{b as z}from"./ToolbarContent-7b435752.js";import{G as it,a as ct}from"./GroupPickerDialog-caf8c38d.js";import{S as lt}from"./TableToolbar-ee0c86ef.js";import{C as Ie}from"./Checkbox-d00621d8.js";import{A as dt}from"./AttributeForm-1b8e495d.js";import{R as ut}from"./AddRoleMappingModal-abb19beb.js";import{P as mt}from"./PermissionTab-c2ee2a77.js";import{j as pt}from"./joinPath-55fd24bc.js";import{$ as xe}from"./Td-6d4ab209.js";import{T as gt,a as W,b as Z}from"./Tabs-5beaba80.js";import"./Text-564bf299.js";import"./EmptyStateBody-7b4fcee1.js";import"./plus-circle-icon-cb854796.js";import"./EmptyStateSecondaryActions-08edafb5.js";import"./DataListItemRow-75e02946.js";import"./data-list-7d55714c.js";import"./grip-vertical-icon-cbeff50f.js";import"./check-fc57dbe1.js";import"./FormAccess-1cceaef6.js";import"./copy-icon-a4fe01af.js";import"./GridItem-d34dae2e.js";import"./KeyValueInput-ce08b760.js";import"./minus-icon-16876c86.js";import"./minus-circle-icon-6f9a971c.js";import"./ActionListItem-ab1a4322.js";import"./useLocaleSort-3efc7c31.js";import"./filter-icon-9d72dc58.js";import"./Trans-2fec9e72.js";import"./Card-aa3ba03c.js";import"./CardTitle-9175b04a.js";import"./CardBody-519f6395.js";import"./star-icon-6a7e7d25.js";import"./plus-icon-2a767bad.js";import"./MenuList-e3786b59.js";const ke=t=>{var{className:s="",children:a,hasNoPadding:r=!1}=t,o=Y(t,["className","children","hasNoPadding"]);return u.createElement("div",Object.assign({className:A(oe.drawerBody,r&&oe.modifiers.noPadding,s)},o),a)};ke.displayName="DrawerPanelBody";const Te=t=>{var{className:s="",children:a,hasNoPadding:r=!1}=t,o=Y(t,["className","children","hasNoPadding"]);return u.createElement(ke,{hasNoPadding:r},u.createElement("div",Object.assign({className:A(oe.drawerHead,s)},o),a))};Te.displayName="DrawerHead";const _e=t=>{var{isNested:s=!1,toolbar:a,children:r}=t,o=Y(t,["isNested","toolbar","children"]);return u.createElement(u.Fragment,null,a&&u.createElement(u.Fragment,null,a,u.createElement(Me,null)),u.createElement("ul",Object.assign({className:A("pf-c-tree-view__list"),role:s?"group":"tree"},o),r))};_e.displayName="TreeViewList";const k={badge:"pf-c-badge",modifiers:{compact:"pf-m-compact",guides:"pf-m-guides",expanded:"pf-m-expanded",noBackground:"pf-m-no-background",current:"pf-m-current",read:"pf-m-read",selectable:"pf-m-selectable",truncate:"pf-m-truncate"},themeDark:"pf-theme-dark",treeView:"pf-c-tree-view",treeViewAction:"pf-c-tree-view__action",treeViewContent:"pf-c-tree-view__content",treeViewListItem:"pf-c-tree-view__list-item",treeViewNode:"pf-c-tree-view__node",treeViewNodeCheck:"pf-c-tree-view__node-check",treeViewNodeContainer:"pf-c-tree-view__node-container",treeViewNodeContent:"pf-c-tree-view__node-content",treeViewNodeCount:"pf-c-tree-view__node-count",treeViewNodeIcon:"pf-c-tree-view__node-icon",treeViewNodeText:"pf-c-tree-view__node-text",treeViewNodeTitle:"pf-c-tree-view__node-title",treeViewNodeToggle:"pf-c-tree-view__node-toggle",treeViewNodeToggleIcon:"pf-c-tree-view__node-toggle-icon",treeViewSearch:"pf-c-tree-view__search"},ht=({name:t,title:s,id:a,isExpanded:r,defaultExpanded:o=!1,children:c=null,onSelect:d,onCheck:n,hasCheck:l=!1,checkProps:i={checked:!1},hasBadge:g=!1,customBadgeContent:y,badgeProps:m={isRead:!0},isSelectable:h=!1,isCompact:f,activeItems:N=[],itemData:T,parentItem:K,icon:S,expandedIcon:I,action:D,compareItems:M,useMemo:b})=>{const[p,G]=u.useState(o);u.useEffect(()=>{r!=null?G(r):o!=null&&G(p||o)},[r,o]);let v="button";l?v="label":h&&(v="div");const F=l||h?"button":"span",x=E=>C.createElement(F,Object.assign({className:A(k.treeViewNodeToggle),onClick:w=>{(h||l)&&G(!p),h&&w.stopPropagation()}},(l||h)&&{"aria-labelledby":`label-${E}`},{tabIndex:-1}),C.createElement("span",{className:A(k.treeViewNodeToggleIcon)},C.createElement(Oe,{"aria-hidden":"true"}))),V=E=>C.createElement("span",{className:A(k.treeViewNodeCheck)},C.createElement("input",Object.assign({type:"checkbox",onChange:w=>n&&n(w,T,K),onClick:w=>w.stopPropagation(),ref:w=>w&&(w.indeterminate=i.checked===null)},i,{checked:i.checked===null?!1:i.checked,id:E,tabIndex:-1}))),j=C.createElement("span",{className:A(k.treeViewNodeIcon)},!p&&S,p&&(I||S)),_=()=>{const E=C.createElement(C.Fragment,null,f&&s&&C.createElement("span",{className:A(k.treeViewNodeTitle)},s),h?C.createElement("button",{tabIndex:-1,className:A(k.treeViewNodeText)},t):C.createElement("span",{className:A(k.treeViewNodeText)},t));return f?C.createElement("span",{className:A(k.treeViewNodeContent)},E):E},R=C.createElement(C.Fragment,null,g&&c&&C.createElement("span",{className:A(k.treeViewNodeCount)},C.createElement(ge,Object.assign({},m),y||c.props.data.length)),g&&!c&&y!==void 0&&C.createElement("span",{className:A(k.treeViewNodeCount)},C.createElement(ge,Object.assign({},m),y)));return C.createElement("li",Object.assign({id:a,className:A(k.treeViewListItem,p&&k.modifiers.expanded)},p&&{"aria-expanded":"true"},{role:"treeitem",tabIndex:-1}),C.createElement("div",{className:A(k.treeViewContent)},C.createElement(Re,{prefix:h?"selectable-id":"checkbox-id"},E=>C.createElement(v,Object.assign({className:A(k.treeViewNode,c&&(h||l)&&k.modifiers.selectable,(!c||h)&&N&&N.length>0&&N.some(w=>M&&w&&M(w,T))?k.modifiers.current:""),onClick:w=>{l||(d&&d(w,T,K),!h&&c&&w.isDefaultPrevented()!==!0&&G(!p))}},l&&{htmlFor:E},(l||h&&c)&&{id:`label-${E}`}),C.createElement("span",{className:A(k.treeViewNodeContainer)},c&&x(E),l&&V(E),S&&j,_(),R))),D&&C.createElement("div",{className:A(k.treeViewAction)},D)),p&&c)},Ae=C.memo(ht,(t,s)=>{if(!s.useMemo)return!1;const a=t.activeItems&&t.activeItems.length>0&&t.activeItems.some(o=>t.compareItems&&o&&t.compareItems(o,t.itemData)),r=s.activeItems&&s.activeItems.length>0&&s.activeItems.some(o=>s.compareItems&&o&&s.compareItems(o,s.itemData));return!(a||r||t.name!==s.name||t.title!==s.title||t.id!==s.id||t.isExpanded!==s.isExpanded||t.defaultExpanded!==s.defaultExpanded||t.onSelect!==s.onSelect||t.onCheck!==s.onCheck||t.hasCheck!==s.hasCheck||t.checkProps!==s.checkProps||t.hasBadge!==s.hasBadge||t.customBadgeContent!==s.customBadgeContent||t.badgeProps!==s.badgeProps||t.isCompact!==s.isCompact||t.icon!==s.icon||t.expandedIcon!==s.expandedIcon||t.action!==s.action||t.parentItem!==s.parentItem||t.itemData!==s.itemData)});Ae.displayName="TreeViewListItem";class ft extends u.Component{constructor(){super(...arguments),this.displayName="TreeViewRoot",this.treeRef=u.createRef(),this.handleKeys=s=>{var a,r,o,c,d,n,l;if(!this.treeRef.current.contains(s.target))return;const i=document.activeElement,g=s.key,y=Array.from((a=this.treeRef.current)===null||a===void 0?void 0:a.getElementsByClassName("pf-c-tree-view__node")).filter(m=>!m.classList.contains("pf-m-disabled"));if(g===he.Space&&(i.click(),s.preventDefault()),xe(s,y,m=>i===m,void 0,[],void 0,!0,!0),["ArrowLeft","ArrowRight"].includes(g)){const m=(o=(r=i?.firstElementChild)===null||r===void 0?void 0:r.firstElementChild)===null||o===void 0?void 0:o.classList.contains("pf-c-tree-view__node-toggle"),h=(c=i?.closest("li"))===null||c===void 0?void 0:c.classList.contains("pf-m-expanded");if(g==="ArrowLeft")if(m&&h)i.click();else{const f=(d=i?.closest("ul"))===null||d===void 0?void 0:d.parentElement;if(f?.tagName!=="DIV"){const N=f?.querySelector("button");i.tabIndex=-1,N&&(N.tabIndex=0,N.focus())}}else if(m&&!h){i.tabIndex=-1,i.click();const f=(l=(n=i?.closest("li"))===null||n===void 0?void 0:n.querySelector("ul > li"))===null||l===void 0?void 0:l.querySelector("button");f&&(f.tabIndex=0,f.focus())}s.preventDefault()}},this.handleKeysCheckbox=s=>{var a,r,o,c,d;if(!this.treeRef.current.contains(s.target))return;const n=document.activeElement,l=s.key;l===he.Space&&(n.click(),s.preventDefault());const i=Array.from((a=this.treeRef.current)===null||a===void 0?void 0:a.getElementsByClassName("pf-c-tree-view__node"));xe(s,i,g=>g.contains(n),g=>g.querySelector("button,input"),[],void 0,!0,!0),["ArrowLeft","ArrowRight"].includes(l)&&(l==="ArrowLeft"?n?.tagName==="INPUT"?!((r=n?.parentElement)===null||r===void 0)&&r.previousSibling&&n.parentElement.previousSibling.focus():n?.previousSibling&&(((o=n.previousElementSibling)===null||o===void 0?void 0:o.tagName)==="SPAN"?n.previousSibling.firstChild.focus():n.previousSibling.focus()):n?.tagName==="INPUT"?!((c=n.parentElement)===null||c===void 0)&&c.nextSibling&&n.parentElement.nextSibling.focus():n?.nextSibling&&(((d=n.nextElementSibling)===null||d===void 0?void 0:d.tagName)==="SPAN"?n.nextSibling.firstChild.focus():n.nextSibling.focus()),s.preventDefault())},this.variantStyleModifiers={default:"",compact:k.modifiers.compact,compactNoBackground:[k.modifiers.compact,k.modifiers.noBackground]}}componentDidMount(){var s;if(fe&&window.addEventListener("keydown",this.props.hasChecks||this.props.hasSelectableNodes?this.handleKeysCheckbox:this.handleKeys),this.props.hasChecks||this.props.hasSelectableNodes){const a=this.treeRef.current.getElementsByClassName("pf-c-tree-view__node-toggle")[0];if(a&&(a.tabIndex=0),this.props.hasChecks){const r=this.treeRef.current.getElementsByTagName("INPUT")[0];r&&(r.tabIndex=0)}if(this.props.hasSelectableNodes){const r=this.treeRef.current.getElementsByClassName("pf-c-tree-view__node-text")[0];r&&(r.tabIndex=0)}}else((s=this.treeRef.current)===null||s===void 0?void 0:s.getElementsByClassName("pf-c-tree-view__node")[0]).tabIndex=0}componentWillUnmount(){fe&&window.removeEventListener("keydown",this.props.hasChecks||this.props.hasSelectableNodes?this.handleKeysCheckbox:this.handleKeys)}render(){const s=this.props,{children:a,hasChecks:r,hasGuides:o,variant:c,className:d,hasSelectableNodes:n}=s,l=Y(s,["children","hasChecks","hasGuides","variant","className","hasSelectableNodes"]);return u.createElement("div",Object.assign({className:A(k.treeView,o&&k.modifiers.guides,this.variantStyleModifiers[c],d),ref:this.treeRef},l),a)}}const me=t=>{var{data:s,isNested:a=!1,hasChecks:r=!1,hasBadges:o=!1,hasGuides:c=!1,hasSelectableNodes:d=!1,variant:n="default",defaultAllExpanded:l=!1,allExpanded:i,icon:g,expandedIcon:y,parentItem:m,onSelect:h,onCheck:f,toolbar:N,activeItems:T,compareItems:K=(b,p)=>b.id===p.id,className:S,useMemo:I}=t,D=Y(t,["data","isNested","hasChecks","hasBadges","hasGuides","hasSelectableNodes","variant","defaultAllExpanded","allExpanded","icon","expandedIcon","parentItem","onSelect","onCheck","toolbar","activeItems","compareItems","className","useMemo"]);const M=u.createElement(_e,{isNested:a,toolbar:N},s.map(b=>{var p,G;return u.createElement(Ae,Object.assign({key:((p=b.id)===null||p===void 0?void 0:p.toString())||((G=b.name)===null||G===void 0?void 0:G.toString()),name:b.name,title:b.title,id:b.id,isExpanded:i,isSelectable:d,defaultExpanded:b.defaultExpanded!==void 0?b.defaultExpanded:l,onSelect:h,onCheck:f,hasCheck:b.hasCheck!==void 0?b.hasCheck:r,checkProps:b.checkProps,hasBadge:b.hasBadge!==void 0?b.hasBadge:o,customBadgeContent:b.customBadgeContent,badgeProps:b.badgeProps,activeItems:T,parentItem:m,itemData:b,icon:b.icon!==void 0?b.icon:g,expandedIcon:b.expandedIcon!==void 0?b.expandedIcon:y,action:b.action,compareItems:K,isCompact:n==="compact"||n==="compactNoBackground",useMemo:I},b.children&&{children:u.createElement(me,{data:b.children,isNested:!0,parentItem:b,hasChecks:r,hasBadges:o,hasGuides:c,hasSelectableNodes:d,variant:n,allExpanded:i,defaultAllExpanded:l,onSelect:h,onCheck:f,activeItems:T,icon:g,expandedIcon:y})}))}));return u.createElement(u.Fragment,null,m?M:u.createElement(ft,Object.assign({hasSelectableNodes:d,hasChecks:r,hasGuides:c,variant:n,className:S},D),M))};me.displayName="TreeView";const Q=({id:t,rename:s,handleModalToggle:a,refresh:r})=>{const{t:o}=O("groups"),{adminClient:c}=B(),{addAlert:d,addError:n}=$(),{register:l,handleSubmit:i,formState:{errors:g}}=we({defaultValues:{name:s}}),y=async m=>{m.name=m.name?.trim();try{t?s?await c.groups.update({id:t},m):await c.groups.setOrCreateChild({id:t},m):await c.groups.create(m),r(s?m:void 0),a(),d(o(s?"groupUpdated":"groupCreated"),q.success)}catch(h){n("groups:couldNotCreateGroup",h)}};return e.jsx(Ge,{variant:Ee.small,title:o(s?"renameAGroup":"createAGroup"),isOpen:!0,onClose:a,actions:[e.jsx(P,{"data-testid":`${s?"rename":"create"}Group`,variant:"primary",type:"submit",form:"group-form",children:o(s?"rename":"create")},"confirm"),e.jsx(P,{id:"modal-cancel","data-testid":"cancel",variant:ye.link,onClick:()=>{a()},children:o("common:cancel")},"cancel")],children:e.jsx(rt,{id:"group-form",isHorizontal:!0,onSubmit:i(y),children:e.jsx(Ke,{name:"create-modal-group",label:o("common:name"),fieldId:"create-group-name",helperTextInvalid:o("common:required"),validated:g.name?ae.error:ae.default,isRequired:!0,children:e.jsx(nt,{"data-testid":"groupNameInput",autoFocus:!0,id:"create-group-name",validated:g.name?ae.error:ae.default,...l("name",{required:!0})})})})})},Ve=t=>{const s=t.substr(1).split("/");return s.length>1?s.splice(2):void 0},re=t=>{const s=Ve(t);return s?s[s.length-1]:void 0},pe=({selectedRows:t,show:s,toggleDialog:a,refresh:r})=>{const{t:o}=O("groups"),{adminClient:c}=B(),{addAlert:d,addError:n}=$(),l=async()=>{try{for(const i of t)await c.groups.del({id:i.id});r(),d(o("groupDeleted",{count:t.length}))}catch(i){n("groups:groupDeleteError",i)}};return e.jsx(ot,{titleKey:o("deleteConfirmTitle",{count:t.length}),messageKey:o("deleteConfirm",{count:t.length,groupName:t[0]?.name}),continueButtonLabel:"common:delete",continueButtonVariant:ye.danger,onConfirm:l,open:s,toggleDialog:a})},bt=({toggleCreate:t,toggleDelete:s,kebabDisabled:a})=>{const{t:r}=O("groups"),{currentGroup:o}=H(),{hasAccess:c}=ee(),d=c("manage-users")||o()?.access?.manage,[n,l]=L();return d?e.jsxs(e.Fragment,{children:[e.jsx(z,{children:e.jsx(P,{"data-testid":"openCreateGroupModal",variant:"primary",onClick:t,children:r("createGroup")})}),e.jsx(z,{children:e.jsx(ie,{toggle:e.jsx(ce,{onToggle:l,isDisabled:a}),isOpen:n,isPlain:!0,dropdownItems:[e.jsx(U,{component:"button",onClick:()=>{s(),l()},children:r("common:delete")},"action")]})})]}):e.jsx("div",{})},xt=async(t,s)=>{await t.groups.del({id:s.id});const{id:a}=await t.groups.create({...s,id:void 0});s.subGroups&&await Promise.all(s.subGroups.map(r=>t.groups.setOrCreateChild({id:a},{...r,id:void 0})))},vt=async(t,s,a)=>{try{await t.groups.setOrCreateChild({id:a.id},s)}catch(r){if(r.response)throw r}},De=({source:t,onClose:s,refresh:a})=>{const{t:r}=O("groups"),{adminClient:o}=B(),{addAlert:c,addError:d}=$(),n=async l=>{try{await(l?vt(o,t,l[0]):xt(o,t)),a(),c(r("moveGroupSuccess"))}catch(i){d("groups:moveGroupError",i)}};return e.jsx(it,{type:"selectOne",filterGroups:[t],text:{title:"groups:moveToGroup",ok:"groups:moveHere"},onClose:s,onConfirm:n})},ve=({refresh:t,canViewDetails:s})=>{const{t:a}=O("groups"),{adminClient:r}=B(),{realm:o}=te(),[c,d]=u.useState([]),[n,l]=u.useState(),[i,g]=L(),[y,m]=L(),[h,f]=u.useState(),{currentGroup:N}=H(),[T,K]=u.useState(0),S=()=>K(T+1),[I,D]=u.useState(),M=le(),b=se(),p=re(b.pathname),{hasAccess:G}=ee(),v=G("manage-users")||N()?.access?.manage,F=async(x,V)=>{const j={search:I||"",first:x?.toString()||"",max:V?.toString()||""};let _;if(p){const R=await r.groups.findOne({id:p});if(!R)throw new Error(a("common:notFound"));_=I?R.subGroups?.filter(E=>E.name?.includes(I)):R.subGroups}else _=await Se(r,"ui-ext/groups",{...j,global:"false"});return _||M(X({realm:o})),_||[]};return e.jsxs(e.Fragment,{children:[e.jsx(pe,{show:y,toggleDialog:m,selectedRows:c,refresh:()=>{S(),t(),d([])}}),n&&e.jsx(Q,{id:n.id,rename:n.name,refresh:()=>{S(),t()},handleModalToggle:()=>l(void 0)}),i&&e.jsx(Q,{id:c[0]?.id||p,handleModalToggle:g,refresh:()=>{d([]),S(),t()}}),h&&e.jsx(De,{source:h,refresh:()=>{f(void 0),S(),t()},onClose:()=>f(void 0)}),e.jsx(de,{onSelect:x=>d([...x]),canSelectAll:!0,loader:F,ariaLabelKey:"groups:groups",isPaginated:!0,isSearching:!!I,toolbarItem:e.jsxs(e.Fragment,{children:[e.jsx(z,{children:e.jsx(lt,{"data-testid":"group-search",placeholder:a("filterGroups"),value:I,onChange:(x,V)=>{D(V)},onSearch:S,onClear:()=>{D(""),S()}})}),e.jsx(bt,{toggleCreate:g,toggleDelete:m,kebabDisabled:c.length===0})]}),actions:v?[{title:a("rename"),onRowClick:async x=>(l(x),!1)},{title:a("moveTo"),onRowClick:async x=>(f(x),!1)},{title:a("createChildGroup"),onRowClick:async x=>(d([x]),g(),!1)},{isSeparator:!0},{title:a("common:delete"),onRowClick:async x=>(d([x]),m(),!0)}]:[],columns:[{name:"name",displayKey:"groups:groupName",cellRenderer:x=>s?e.jsx(ne,{to:`${b.pathname}/${x.id}`,onClick:()=>M(X({realm:o,id:x.id})),children:x.name},x.id):e.jsx("span",{children:x.name})}],emptyState:e.jsx(ue,{hasIcon:!0,message:a(`noGroupsInThis${p?"SubGroup":"Realm"}`),instructions:a(`noGroupsInThis${p?"SubGroup":"Realm"}Instructions`),primaryActionText:a("createGroup"),onPrimaryAction:g})},`${p}${T}`)]})},wt=({groupId:t,onClose:s})=>{const{t:a}=O("groups"),{adminClient:r}=B(),{addAlert:o,addError:c}=$(),[d,n]=u.useState([]),l=async(i,g,y)=>{const m=await r.groups.listMembers({id:t}),h={first:i,max:g+m.length,search:y||""};try{const f=await r.users.find({...h});return st(f,m,"id").slice(0,g)}catch(f){return c("groups:noUsersFoundError",f),[]}};return e.jsx(Ge,{variant:Ee.large,title:a("addMember"),isOpen:!0,onClose:s,actions:[e.jsx(P,{"data-testid":"add",variant:"primary",onClick:async()=>{try{await Promise.all(d.map(i=>r.users.addToGroup({id:i.id,groupId:t}))),s(),o(a("usersAdded",{count:d.length}),q.success)}catch(i){c("groups:usersAddedError",i)}},children:a("common:add")},"confirm"),e.jsx(P,{"data-testid":"cancel",variant:"link",onClick:s,children:a("common:cancel")},"cancel")],children:e.jsx(de,{loader:l,isPaginated:!0,ariaLabelKey:"users:title",searchPlaceholderKey:"users:searchForUser",canSelectAll:!0,onSelect:i=>n([...i]),emptyState:e.jsx(ue,{message:a("users:noUsersFound"),instructions:a("users:emptyInstructions")}),columns:[{name:"username",displayKey:"users:username"},{name:"email",displayKey:"users:email"},{name:"lastName",displayKey:"users:lastName",cellFormatters:[J()]},{name:"firstName",displayKey:"users:firstName",cellFormatters:[J()]}]})})},yt=t=>e.jsx(e.Fragment,{children:t.membership.map((s,a)=>e.jsxs(e.Fragment,{children:[e.jsx(ct,{group:s},s.id),t.membership[a+1]?", ":""]}))}),jt=t=>{const{realm:s}=te();return e.jsx(ne,{to:Fe({realm:s,id:t.id,tab:"settings"}),children:t.username},t.id)},Nt=()=>{const{t}=O("groups"),{adminClient:s}=B(),{addAlert:a,addError:r}=$(),o=se(),c=re(o.pathname),[d,n]=u.useState(!1),{currentGroup:l}=H(),[i,g]=u.useState(!1),[y,m]=u.useState(!1),[h,f]=u.useState([]),{hasAccess:N}=ee(),T=N("manage-users")||l().access.manageMembership,[K,S]=u.useState(0),I=()=>S(new Date().getTime()),D=async p=>await s.users.listGroups({id:p}),M=p=>{let G=[];for(const v of p){G.push(v);const F=M(v.subGroups);G=G.concat(F)}return G},b=async(p,G)=>{let v=await s.groups.listMembers({id:c,first:p,max:G});if(d){const x=M(l()?.subGroups);for(const V of x)v=v.concat(await s.groups.listMembers({id:V.id}));v=Be(v,V=>V.username)}const F=await Promise.all(v.map(x=>D(x.id)));return v.map((x,V)=>({...x,membership:F[V]}))};return e.jsxs(e.Fragment,{children:[i&&e.jsx(wt,{groupId:c,onClose:()=>{g(!1),I()}}),e.jsx(de,{"data-testid":"members-table",loader:b,ariaLabelKey:"groups:members",isPaginated:!0,canSelectAll:!0,onSelect:p=>f([...p]),toolbarItem:T&&e.jsxs(e.Fragment,{children:[e.jsx(z,{children:e.jsx(P,{"data-testid":"addMember",variant:"primary",onClick:()=>g(!0),children:t("addMember")})}),e.jsx(z,{children:e.jsx(Ie,{"data-testid":"includeSubGroupsCheck",label:t("includeSubGroups"),id:"kc-include-sub-groups",isChecked:d,onChange:()=>n(!d)})}),e.jsx(z,{children:e.jsx(ie,{toggle:e.jsx(ce,{onToggle:()=>m(!y),isDisabled:h.length===0}),isOpen:y,isPlain:!0,dropdownItems:[e.jsx(U,{component:"button",onClick:async()=>{try{await Promise.all(h.map(p=>s.users.delFromGroup({id:p.id,groupId:c}))),m(!1),a(t("usersLeft",{count:h.length}),q.success)}catch(p){r("groups:usersLeftError",p)}I()},children:t("leave")},"action")]})})]}),actions:T?[{title:t("leave"),onRowClick:async p=>{try{await s.users.delFromGroup({id:p.id,groupId:c}),a(t("usersLeft",{count:1}),q.success)}catch(G){r("groups:usersLeftError",G)}return!0}}]:[],columns:[{name:"username",displayKey:"common:name",cellRenderer:jt},{name:"email",displayKey:"groups:email",cellFormatters:[J()]},{name:"firstName",displayKey:"groups:firstName",cellFormatters:[J()]},{name:"lastName",displayKey:"groups:lastName",cellFormatters:[J()]},{name:"membership",displayKey:"groups:membership",cellRenderer:yt}],emptyState:e.jsx(ue,{message:t("users:noUsersFound"),instructions:T?t("users:emptyInstructions"):void 0,primaryActionText:T?t("addMember"):void 0,onPrimaryAction:()=>g(!0),secondaryActions:[{text:t("includeSubGroups"),onClick:()=>n(!0)}]})},`${c}${K}${d}`)]})},Ct=()=>{const{t}=O("groups"),{adminClient:s}=B(),{addAlert:a,addError:r}=$(),o=we({mode:"onChange"}),c=se(),d=re(c.pathname),{currentGroup:n,subGroups:l,setSubGroups:i}=H(),g=m=>Le(m||n()?.attributes);u.useEffect(()=>{o.setValue("attributes",g())},[l]);const y=async m=>{try{const h=n(),f=Ue(m.attributes);await s.groups.update({id:d},{...h,attributes:f}),i([...l.slice(0,l.length-1),{...h,attributes:f}]),a(t("groupUpdated"),q.success)}catch(h){r("groups:groupUpdateError",h)}};return e.jsx(je,{variant:Ne.light,children:e.jsx(dt,{form:o,save:y,fineGrainedAccess:n()?.access?.manage,reset:()=>o.reset({attributes:g()})})})},St=({id:t,name:s})=>{const{t:a}=O("clients"),{adminClient:r}=B(),{addAlert:o,addError:c}=$(),d=async n=>{try{const l=n.filter(i=>i.client===void 0).map(i=>i.role).flat();await r.groups.addRealmRoleMappings({id:t,roles:l}),await Promise.all(n.filter(i=>i.client!==void 0).map(i=>r.groups.addClientRoleMappings({id:t,clientUniqueId:i.client.id,roles:[i.role]}))),o(a("roleMappingUpdatedSuccess"),q.success)}catch(l){c("clients:roleMappingUpdatedError",l)}};return e.jsx(ut,{name:s,id:t,type:"groups",save:d})};const Gt=({group:t,refresh:s})=>{const{t:a}=O("groups"),[r,o]=L(),[c,d]=L(),[n,l]=L(),[i,g]=L(),[y,m]=L();return e.jsxs(e.Fragment,{children:[c&&e.jsx(Q,{id:t.id,rename:t.name,refresh:()=>{s()},handleModalToggle:d}),n&&e.jsx(Q,{id:t.id,handleModalToggle:l,refresh:s}),i&&e.jsx(De,{source:t,refresh:s,onClose:g}),e.jsx(pe,{show:y,toggleDialog:m,selectedRows:[t],refresh:s}),e.jsx(ie,{toggle:e.jsx(ce,{onToggle:o}),isOpen:r,isPlain:!0,position:ze.right,dropdownItems:[e.jsx(U,{onClick:d,children:a("rename")},"rename"),e.jsx(U,{onClick:g,children:a("moveTo")},"move"),e.jsx(U,{onClick:l,children:a("createChildGroup")},"create"),e.jsx(Pe,{},"separator"),e.jsx(U,{onClick:m,children:a("common:delete")},"delete")]})]})},Et=({refresh:t,canViewDetails:s})=>{const{t:a}=O("groups"),{adminClient:r}=B(),{realm:o}=te(),c=le(),{addAlert:d}=$(),{hasAccess:n}=ee(),[l,i]=u.useState(),[g,y]=u.useState([]),{subGroups:m,setSubGroups:h}=H(),[f,N]=u.useState(""),[T,K]=u.useState(20),[S,I]=u.useState(0),[D,M]=u.useState(!1),[b,p]=u.useState(),[G,v]=u.useState(0),F=()=>{v(G+1),t()},x=(j,_,R)=>{const E=[..._,j];return{id:pt(...E.map(w=>w.id)),name:e.jsx(He,{content:j.name,children:e.jsx("span",{children:j.name})}),children:j.subGroups&&j.subGroups.length>0?j.subGroups.map(w=>x(w,E,R)):void 0,action:(n("manage-users")||j.access?.manage)&&e.jsx(Gt,{group:j,refresh:R}),defaultExpanded:m.map(w=>w.id).includes(j.id)}};Ce(()=>Se(r,"ui-ext/groups",Object.assign({first:`${S}`,max:`${T+1}`,exact:`${D}`},f===""?null:{search:f})),j=>{y(j),i(j.map(_=>x(_,[],F)))},[G,S,T,f,D]);const V=(j,_,R,E)=>j.map(w=>{E.length>0||(w.subGroups&&w.subGroups.length>0&&V(w.subGroups,_,[...R,w],E),w.id===_&&E.push(...R,w))});return l?e.jsx(at,{count:l.length||0,first:S,max:T,onNextClick:I,onPreviousClick:I,onPerPageSelect:(j,_)=>{I(j),K(_)},inputGroupName:"searchForGroups",inputGroupPlaceholder:a("groups:searchForGroups"),inputGroupOnEnter:N,toolbarItem:e.jsxs($e,{className:"pf-u-pt-sm",children:[e.jsx(Ie,{id:"exact","data-testid":"exact-search",name:"exact",isChecked:D,onChange:j=>M(j)}),e.jsx("label",{htmlFor:"exact",className:"pf-u-pl-sm",children:a("exactSearch")})]}),children:l.length>0&&e.jsx(me,{data:l,allExpanded:f.length>0,activeItems:b?[b]:void 0,hasGuides:!0,hasSelectableNodes:!0,className:"keycloak_groups_treeview",onSelect:(j,_)=>{p(_);const R=_.id?.substring(_.id.lastIndexOf("/")+1),E=[];V(g,R,[],E),h(E),s||E.at(-1)?.access?.view?c(X({realm:o,id:_.id})):(d(a("noViewRights"),q.warning),c(X({realm:o})))}})}):e.jsx(qe,{})},It=()=>{const{t}=O(),{clear:s,remove:a,subGroups:r}=H(),{realm:o}=te(),c=se();return u.useEffect(()=>{const{pathname:d}=c;(!d.includes("/groups")||d.endsWith("/groups"))&&s()},[c]),r.length!==0?e.jsxs(We,{children:[e.jsx(be,{children:e.jsx(ne,{to:`/${o}/groups`,children:t("groups")})},"home"),r.map((d,n)=>{const l=n===r.length-1;return e.jsxs(be,{isActive:l,children:[!l&&e.jsx(ne,{to:c.pathname.substring(0,c.pathname.indexOf(d.id)+d.id.length),onClick:()=>a(d),children:d.name}),l&&(d.id==="search"?d.name:t("groups:groupDetails"))]},d.id)})]}):null};function vs(){const{t}=O("groups"),[s,a]=u.useState(0),{profileInfo:r}=Ze(),{adminClient:o}=B(),{subGroups:c,setSubGroups:d,currentGroup:n}=H(),{realm:l}=te(),[i,g]=u.useState(),[y,m]=L(),h=le(),f=se(),N=re(f.pathname),[T,K]=u.useState(0),S=()=>K(T+1),{hasAccess:I}=ee(),D=!r?.disabledFeatures?.includes("ADMIN_FINE_GRAINED_AUTHZ")&&I("manage-authorization","manage-users","manage-clients"),M=I("manage-users")||n()?.access?.manage,b=I("manage-users"),p=I("query-groups","view-users")||I("manage-users","query-groups"),G=I("view-users")||n()?.access?.viewMembers||n()?.access?.manageMembers;return Ce(async()=>{const v=Ve(f.pathname);if(v&&v.length>c.length){const x=[];for(const V of v){const j=V!=="search"?await o.groups.findOne({id:V}):{name:t("searchGroups"),id:"search"};if(j)x.push(j);else throw new Error(t("common:notFound"))}return x}return[]},v=>{v.length&&d(v)},[N]),e.jsxs(e.Fragment,{children:[e.jsx(pe,{show:y,toggleDialog:m,selectedRows:[n()],refresh:()=>{h(X({realm:l})),S()}}),i&&e.jsx(Q,{id:N,rename:i,refresh:v=>{S(),d([...c.slice(0,c.length-1),v])},handleModalToggle:()=>g(void 0)}),e.jsx(je,{variant:Ne.light,className:"pf-u-p-0",children:e.jsx(Je,{isInline:!0,isExpanded:!0,children:e.jsx(Xe,{panelContent:e.jsx(Qe,{isResizable:!0,defaultSize:"80%",minSize:"500px",children:e.jsxs(Te,{children:[e.jsx(It,{}),e.jsx(tt,{titleKey:N?n()?.name:"groups:groups",subKey:N?"":"groups:groupsDescription",helpUrl:N?"":Ye.groupsUrl,divider:!N,dropdownItems:N&&M?[e.jsx(U,{"data-testid":"renameGroupAction",onClick:()=>g(n()?.name),children:t("renameGroup")},"renameGroup"),e.jsx(U,{"data-testid":"deleteGroup",onClick:m,children:t("deleteGroup")},"deleteGroup")]:void 0}),c.length>0&&e.jsxs(gt,{inset:{default:"insetNone",md:"insetSm",xl:"insetLg","2xl":"inset2xl"},activeKey:s,onSelect:(v,F)=>a(F),isBox:!0,mountOnEnter:!0,unmountOnExit:!0,children:[e.jsx(W,{"data-testid":"groups",eventKey:0,title:e.jsx(Z,{children:t("childGroups")}),children:e.jsx(ve,{refresh:S,canViewDetails:p})}),G&&e.jsx(W,{"data-testid":"members",eventKey:1,title:e.jsx(Z,{children:t("members")}),children:e.jsx(Nt,{})}),e.jsx(W,{"data-testid":"attributes",eventKey:2,title:e.jsx(Z,{children:t("common:attributes")}),children:e.jsx(Ct,{})}),b&&e.jsx(W,{eventKey:3,"data-testid":"role-mapping-tab",title:e.jsx(Z,{children:t("roleMapping")}),children:e.jsx(St,{id:N,name:n()?.name})}),D&&e.jsx(W,{eventKey:4,"data-testid":"permissionsTab",title:e.jsx(Z,{children:t("common:permissions")}),children:e.jsx(mt,{id:N,type:"groups"})})]}),c.length===0&&e.jsx(ve,{refresh:S,canViewDetails:p})]})}),children:e.jsx(et,{children:e.jsx(Et,{refresh:S,canViewDetails:p})})})},T)})]})}export{vs as default};
//# sourceMappingURL=GroupsSection-4c83252d.js.map
