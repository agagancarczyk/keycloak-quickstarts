{"version":3,"file":"ScopeDetails-b560065c.js","sources":["../../src/clients/authorization/ScopeDetails.tsx"],"sourcesContent":["import type ScopeRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/scopeRepresentation\";\nimport {\n  ActionGroup,\n  AlertVariant,\n  Button,\n  ButtonVariant,\n  DropdownItem,\n  FormGroup,\n  PageSection,\n  ValidatedOptions,\n} from \"@patternfly/react-core\";\nimport { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link, useNavigate } from \"react-router-dom\";\n\nimport { useAlerts } from \"../../components/alert/Alerts\";\nimport { FormAccess } from \"../../components/form-access/FormAccess\";\nimport { HelpItem } from \"ui-shared\";\nimport { KeycloakTextInput } from \"../../components/keycloak-text-input/KeycloakTextInput\";\nimport { ViewHeader } from \"../../components/view-header/ViewHeader\";\nimport { useAdminClient, useFetch } from \"../../context/auth/AdminClient\";\nimport { useParams } from \"../../utils/useParams\";\nimport useToggle from \"../../utils/useToggle\";\nimport { toAuthorizationTab } from \"../routes/AuthenticationTab\";\nimport type { ScopeDetailsParams } from \"../routes/Scope\";\nimport { DeleteScopeDialog } from \"./DeleteScopeDialog\";\n\ntype FormFields = Omit<ScopeRepresentation, \"resources\">;\n\nexport default function ScopeDetails() {\n  const { t } = useTranslation(\"clients\");\n  const { id, scopeId, realm } = useParams<ScopeDetailsParams>();\n  const navigate = useNavigate();\n\n  const { adminClient } = useAdminClient();\n  const { addAlert, addError } = useAlerts();\n\n  const [deleteDialog, toggleDeleteDialog] = useToggle();\n  const [scope, setScope] = useState<ScopeRepresentation>();\n  const {\n    register,\n    reset,\n    handleSubmit,\n    formState: { errors },\n  } = useForm<FormFields>({\n    mode: \"onChange\",\n  });\n\n  useFetch(\n    async () => {\n      if (scopeId) {\n        const scope = await adminClient.clients.getAuthorizationScope({\n          id,\n          scopeId,\n        });\n        if (!scope) {\n          throw new Error(t(\"common:notFound\"));\n        }\n        return scope;\n      }\n    },\n    (scope) => {\n      setScope(scope);\n      reset({ ...scope });\n    },\n    []\n  );\n\n  const onSubmit = async (scope: ScopeRepresentation) => {\n    try {\n      if (scopeId) {\n        await adminClient.clients.updateAuthorizationScope(\n          { id, scopeId },\n          scope\n        );\n        setScope(scope);\n      } else {\n        await adminClient.clients.createAuthorizationScope(\n          { id },\n          {\n            name: scope.name!,\n            displayName: scope.displayName,\n            iconUri: scope.iconUri,\n          }\n        );\n        navigate(toAuthorizationTab({ realm, clientId: id, tab: \"scopes\" }));\n      }\n      addAlert(\n        t((scopeId ? \"update\" : \"create\") + \"ScopeSuccess\"),\n        AlertVariant.success\n      );\n    } catch (error) {\n      addError(\"clients:scopeSaveError\", error);\n    }\n  };\n\n  return (\n    <>\n      <DeleteScopeDialog\n        clientId={id}\n        open={deleteDialog}\n        toggleDialog={toggleDeleteDialog}\n        selectedScope={scope}\n        refresh={() =>\n          navigate(toAuthorizationTab({ realm, clientId: id, tab: \"scopes\" }))\n        }\n      />\n      <ViewHeader\n        titleKey={\n          scopeId ? scope?.name! : t(\"clients:createAuthorizationScope\")\n        }\n        dropdownItems={\n          scopeId\n            ? [\n                <DropdownItem\n                  key=\"delete\"\n                  data-testid=\"delete-resource\"\n                  onClick={() => toggleDeleteDialog()}\n                >\n                  {t(\"common:delete\")}\n                </DropdownItem>,\n              ]\n            : undefined\n        }\n      />\n      <PageSection variant=\"light\">\n        <FormAccess\n          isHorizontal\n          role=\"view-clients\"\n          onSubmit={handleSubmit(onSubmit)}\n        >\n          <FormGroup\n            label={t(\"common:name\")}\n            fieldId=\"name\"\n            labelIcon={\n              <HelpItem\n                helpText={t(\"clients-help:scopeName\")}\n                fieldLabelId=\"name\"\n              />\n            }\n            helperTextInvalid={t(\"common:required\")}\n            validated={\n              errors.name ? ValidatedOptions.error : ValidatedOptions.default\n            }\n            isRequired\n          >\n            <KeycloakTextInput\n              id=\"name\"\n              validated={\n                errors.name ? ValidatedOptions.error : ValidatedOptions.default\n              }\n              isRequired\n              {...register(\"name\", { required: true })}\n            />\n          </FormGroup>\n          <FormGroup\n            label={t(\"displayName\")}\n            fieldId=\"displayName\"\n            labelIcon={\n              <HelpItem\n                helpText={t(\"clients-help:scopeDisplayName\")}\n                fieldLabelId=\"displayName\"\n              />\n            }\n          >\n            <KeycloakTextInput id=\"displayName\" {...register(\"displayName\")} />\n          </FormGroup>\n          <FormGroup\n            label={t(\"iconUri\")}\n            fieldId=\"iconUri\"\n            labelIcon={\n              <HelpItem\n                helpText={t(\"clients-help:iconUri\")}\n                fieldLabelId=\"clients:iconUri\"\n              />\n            }\n          >\n            <KeycloakTextInput id=\"iconUri\" {...register(\"iconUri\")} />\n          </FormGroup>\n          <ActionGroup>\n            <div className=\"pf-u-mt-md\">\n              <Button\n                variant={ButtonVariant.primary}\n                type=\"submit\"\n                data-testid=\"save\"\n              >\n                {t(\"common:save\")}\n              </Button>\n\n              {!scope ? (\n                <Button\n                  variant=\"link\"\n                  data-testid=\"cancel\"\n                  component={(props) => (\n                    <Link\n                      {...props}\n                      to={toAuthorizationTab({\n                        realm,\n                        clientId: id,\n                        tab: \"scopes\",\n                      })}\n                    ></Link>\n                  )}\n                >\n                  {t(\"common:cancel\")}\n                </Button>\n              ) : (\n                <Button\n                  variant=\"link\"\n                  data-testid=\"revert\"\n                  onClick={() => reset({ ...scope })}\n                >\n                  {t(\"common:revert\")}\n                </Button>\n              )}\n            </div>\n          </ActionGroup>\n        </FormAccess>\n      </PageSection>\n    </>\n  );\n}\n"],"names":["ScopeDetails","useTranslation","id","scopeId","realm","useParams","navigate","useNavigate","adminClient","useAdminClient","addAlert","addError","useAlerts","deleteDialog","toggleDeleteDialog","useToggle","scope","setScope","useState","register","reset","handleSubmit","errors","useForm","useFetch","onSubmit","toAuthorizationTab","AlertVariant","error","jsxs","Fragment","jsx","DeleteScopeDialog","ViewHeader","DropdownItem","PageSection","FormAccess","FormGroup","HelpItem","ValidatedOptions","KeycloakTextInput","ActionGroup","Button","ButtonVariant","props","Link"],"mappings":"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"}