import{bp as Ae,bq as Ne,bi as Re,br as Oe,j as e,c as G,L as re,p as ye,ab as De,bs as Pe,a5 as Le,aN as _e,h as we,b2 as Ke,u as M,d as xe,R as Ue,r as h,f as fe,aq as Ve,D as ve,v as je,F as m,C as b,B as F,n as Ge,bt as Me,Z as Be,P as He,bu as ne,H as We}from"./index-a3421f29.js";import{K as v}from"./KeycloakTextInput-e7f6e917.js";import{L as Te}from"./PaginatingTableToolbar-08ca9efb.js";import{R as ze,u as Ze}from"./RoutableTabs-7f56b0c5.js";import{T as $e,l as qe,m as Je,K as be}from"./KeycloakDataTable-10a62d94.js";import{V as Xe}from"./ViewHeader-832ec56e.js";import{u as ge,F as ke}from"./useFormatDate-7fddef56.js";import{Y as Ye,N as Ce,Z as Qe}from"./Td-6d4ab209.js";import{C as es,L as ss}from"./CodeEditor-2fb93648.js";import{M as ts,a as as}from"./Modal-21c37af7.js";import{F as Se,a as U}from"./FlexItem-65b5f999.js";import{F as Fe,A as Ie}from"./Form-518a2cf2.js";import{S as se,a as te,C as P,c as g,b as ae}from"./Select-0f56a9cc.js";import{D as V}from"./DatePicker-49a9a039.js";import{T as rs}from"./Trans-2fec9e72.js";import{W as ns}from"./warning-triangle-icon-39a5897e.js";import{a as oe,b as le}from"./Tabs-5beaba80.js";import{D as os,a as ie,b as ce,c as de}from"./DescriptionListTerm-adda5202.js";import"./plus-circle-icon-cb854796.js";import"./EmptyStateBody-7b4fcee1.js";import"./EmptyStateSecondaryActions-08edafb5.js";import"./TableToolbar-ee0c86ef.js";import"./ToolbarContent-7b435752.js";import"./Text-564bf299.js";import"./star-icon-6a7e7d25.js";import"./check-fc57dbe1.js";import"./grip-vertical-icon-cbeff50f.js";import"./Checkbox-d00621d8.js";import"./copy-icon-a4fe01af.js";import"./plus-icon-2a767bad.js";import"./MenuList-e3786b59.js";function Ee(s,n){if(s==null)return{};var l=Ae(Ne(s),function(i){return[i]});return n=Re(n),Oe(s,l,function(i,_){return n(i,_[0])})}const ue=38,ls=({text:s,children:n})=>{const l=s||"",i=l.length>ue,_=l.substring(0,ue);return i?e.jsx(ye,{content:s,children:n(_+"â€¦")}):n(l)},is=s=>s.operationType==="DELETE"?!1:s.resourceType==="USER"||s.resourceType==="GROUP_MEMBERSHIP"||s.resourceType==="GROUP"||s.resourceType==="CLIENT"||s.resourceType?.startsWith("AUTHORIZATION_RESOURCE")||s.resourceType==="CLIENT_SCOPE"||s.resourceType==="AUTH_FLOW"||s.resourcePath?.startsWith("roles-by-id"),cs=new RegExp(/([0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12})/),ds=(s,n)=>{const l=cs.exec(n.resourcePath);if(!l)return console.warn("event didn't contain a valid link",n),"";const i=l[1];return n.resourceType==="CLIENT"||n.resourceType?.startsWith("AUTHORIZATION_RESOURCE")?De({realm:s,clientId:i,tab:n.resourceType==="CLIENT"?"settings":"authorization"}):n.resourceType==="GROUP"?Pe({realm:s,id:i}):n.resourceType==="CLIENT_SCOPE"?Le({realm:s,id:i,tab:"settings"}):n.resourceType==="USER"||n.resourceType==="GROUP_MEMBERSHIP"?_e({realm:s,id:i,tab:"settings"}):n.resourceType==="AUTH_FLOW"?we({realm:s,id:i,usedBy:"-"}):n.resourcePath?.startsWith("roles-by-id")?Ke({realm:s,id:i,tab:"details"}):""},us=({event:s})=>{const{realm:n}=G();return e.jsx(ls,{text:s.resourcePath,children:l=>is(s)?e.jsx(re,{to:ds(n,s),children:l}):e.jsx("span",{children:l})})},ps=s=>e.jsx(us,{event:s});const pe={resourceTypes:[],operationTypes:[],resourcePath:"",dateFrom:"",dateTo:"",authClient:"",authUser:"",authRealm:"",authIpAddress:""},me=({titleKey:s,onClose:n,children:l})=>{const{t:i}=M("events");return e.jsx(ts,{variant:as.medium,title:i(s),isOpen:!0,onClose:n,children:l})},ms=()=>{const{t:s}=M("events"),{adminClient:n}=xe(),{realm:l}=G(),i=Ue(),_=ge(),B=i.enums?.resourceType,H=i.enums?.operationType,[I,W]=h.useState(0),[z,L]=h.useState(!1),[Z,k]=h.useState(!1),[$,q]=h.useState(!1),[x,E]=h.useState({}),[y,A]=h.useState(),[f,w]=h.useState(),J={resourceTypes:s("resourceTypes"),operationTypes:s("operationTypes"),resourcePath:s("resourcePath"),dateFrom:s("dateFrom"),dateTo:s("dateTo"),authClient:s("client"),authUser:s("userId"),authRealm:s("realm"),authIpAddress:s("ipAddress")},{getValues:C,register:j,reset:N,formState:{isDirty:K},control:S}=fe({mode:"onChange",defaultValues:pe});function X(t,r){return n.realms.findAdminEvents({...x,realm:l,first:t,max:r})}function Y(){L(!1),a()}function T(){N(),a()}function Q(t){const r={...C()};delete r[t],N({...pe,...r}),a()}function ee(t,r){const d=C(),c=d[t],O=Array.isArray(c)?c.filter(D=>D!==r):c;N({...d,[t]:O}),a()}function a(){const t=Ee(C(),r=>r!==""||Array.isArray(r)&&r.length>0);E(t),W(I+1)}function o(){a()}const u=()=>e.jsxs(Se,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[e.jsxs(U,{children:[e.jsx(ve,{id:"admin-events-search-select","data-testid":"AdminEventsSearchSelector",className:"pf-u-ml-md",toggle:e.jsx(je,{"data-testid":"adminEventsSearchSelectorToggle",onToggle:t=>L(t),className:"keycloak__events_search_selector_dropdown__toggle",children:s("searchForAdminEvent")}),isOpen:z,children:e.jsxs(Fe,{isHorizontal:!0,className:"keycloak__events_search__form","data-testid":"searchForm",children:[e.jsx(m,{label:s("resourceTypes"),fieldId:"kc-resourceTypes",className:"keycloak__events_search__form_label",children:e.jsx(b,{name:"resourceTypes",control:S,render:({field:t})=>e.jsx(se,{className:"keycloak__events_search__type_select",name:"resourceTypes","data-testid":"resource-types-searchField",chipGroupProps:{numChips:1,expandedText:s("common:hide"),collapsedText:s("common:showRemaining")},variant:te.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:r=>k(r),selections:t.value,onSelect:(r,d)=>{const c=d.toString(),O=t.value.includes(c)?t.value.filter(D=>D!==c):[...t.value,c];t.onChange(O)},onClear:r=>{r.stopPropagation(),t.onChange([])},isOpen:Z,"aria-labelledby":"resourceTypes",chipGroupComponent:e.jsx(P,{children:t.value.map(r=>e.jsx(g,{onClick:d=>{d.stopPropagation(),t.onChange(t.value.filter(c=>c!==r))},children:r},r))}),children:B?.map(r=>e.jsx(ae,{value:r},r))})})}),e.jsx(m,{label:s("operationTypes"),fieldId:"kc-operationTypes",className:"keycloak__events_search__form_label",children:e.jsx(b,{name:"operationTypes",control:S,render:({field:t})=>e.jsx(se,{className:"keycloak__events_search__type_select",name:"operationTypes","data-testid":"operation-types-searchField",chipGroupProps:{numChips:1,expandedText:s("common:hide"),collapsedText:s("common:showRemaining")},variant:te.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:r=>q(r),selections:t.value,onSelect:(r,d)=>{const c=d.toString(),O=t.value.includes(c)?t.value.filter(D=>D!==c):[...t.value,c];t.onChange(O)},onClear:r=>{r.stopPropagation(),t.onChange([])},isOpen:$,"aria-labelledby":"operationTypes",chipGroupComponent:e.jsx(P,{children:t.value.map(r=>e.jsx(g,{onClick:d=>{d.stopPropagation(),t.onChange(t.value.filter(c=>c!==r))},children:r},r))}),children:H?.map(r=>e.jsx(ae,{value:r},r))})})}),e.jsx(m,{label:s("resourcePath"),fieldId:"kc-resourcePath",className:"keycloak__events_search__form_label",children:e.jsx(v,{id:"kc-resourcePath","data-testid":"resourcePath-searchField",...j("resourcePath")})}),e.jsx(m,{label:s("realm"),fieldId:"kc-realm",className:"keycloak__events_search__form_label",children:e.jsx(v,{id:"kc-realm","data-testid":"realm-searchField",...j("authRealm")})}),e.jsx(m,{label:s("client"),fieldId:"kc-client",className:"keycloak__events_search__form_label",children:e.jsx(v,{id:"kc-client","data-testid":"client-searchField",...j("authClient")})}),e.jsx(m,{label:s("user"),fieldId:"kc-user",className:"keycloak__events_search__form_label",children:e.jsx(v,{id:"kc-user","data-testid":"user-searchField",...j("authUser")})}),e.jsx(m,{label:s("ipAddress"),fieldId:"kc-ipAddress",className:"keycloak__events_search__form_label",children:e.jsx(v,{id:"kc-ipAddress","data-testid":"ipAddress-searchField",...j("authIpAddress")})}),e.jsx(m,{label:s("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:e.jsx(b,{name:"dateFrom",control:S,render:({field:t})=>e.jsx(V,{className:"pf-u-w-100",value:t.value,onChange:(r,d)=>t.onChange(d),inputProps:{id:"kc-dateFrom"}})})}),e.jsx(m,{label:s("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:e.jsx(b,{name:"dateTo",control:S,render:({field:t})=>e.jsx(V,{className:"pf-u-w-100",value:t.value,onChange:(r,d)=>t.onChange(d),inputProps:{id:"kc-dateTo"}})})}),e.jsxs(Ie,{children:[e.jsx(F,{variant:"primary",onClick:Y,"data-testid":"search-events-btn",isDisabled:!K,children:s("searchAdminEventsBtn")}),e.jsx(F,{variant:"secondary",onClick:T,isDisabled:!K,children:s("resetBtn")})]})]})}),e.jsx(F,{className:"pf-u-ml-md",onClick:o,"data-testid":"refresh-btn",children:s("refresh")})]}),e.jsx(U,{children:Object.entries(x).length>0&&e.jsx("div",{className:"keycloak__searchChips pf-u-ml-md",children:Object.entries(x).map(t=>{const[r,d]=t;return e.jsx(P,{className:"pf-u-mt-md pf-u-mr-md",categoryName:J[r],isClosable:!0,onClick:()=>Q(r),children:typeof d=="string"?e.jsx(g,{isReadOnly:!0,children:d}):d.map(c=>e.jsx(g,{onClick:()=>ee(r,c),children:c},c))},r)})})})]}),p=[[s("realm"),y?.authDetails?.realmId],[s("client"),y?.authDetails?.clientId],[s("user"),y?.authDetails?.userId],[s("ipAddress"),y?.authDetails?.ipAddress]],R=h.useMemo(()=>f?.representation?Ve(JSON.parse(f.representation)):"",[f?.representation]);return e.jsxs(e.Fragment,{children:[y&&e.jsx(me,{titleKey:"auth",onClose:()=>A(void 0),children:e.jsxs($e,{"aria-label":"authData","data-testid":"auth-dialog",variant:Ye.compact,cells:[s("attribute"),s("value")],rows:p,children:[e.jsx(qe,{}),e.jsx(Je,{})]})}),f&&e.jsx(me,{titleKey:"representation","data-testid":"representation-dialog",onClose:()=>w(void 0),children:e.jsx(es,{isLineNumbersVisible:!0,isReadOnly:!0,code:R,language:ss.json,height:"8rem"})}),e.jsx(be,{loader:X,isPaginated:!0,ariaLabelKey:"events:adminEvents",toolbarItem:u(),actions:[{title:s("auth"),onRowClick:t=>A(t)},{title:s("representation"),onRowClick:t=>w(t)}],columns:[{name:"time",displayKey:"events:time",cellRenderer:t=>_(new Date(t.time),ke)},{name:"resourcePath",displayKey:"events:resourcePath",cellRenderer:ps},{name:"resourceType",displayKey:"events:resourceType"},{name:"operationType",displayKey:"events:operationType",transforms:[Ce(10)]},{name:"",displayKey:"events:user",cellRenderer:t=>t.authDetails?.userId||""}],emptyState:e.jsx(Te,{message:s("emptyEvents"),instructions:s("emptyEventsInstructions")}),isSearching:Object.keys(x).length>0},I)]})},he={client:"",dateFrom:"",dateTo:"",user:"",type:[],authIpAddress:""},hs=s=>s.error?e.jsx(ye,{content:s.error,children:e.jsxs("span",{children:[e.jsx(ns,{color:"orange"})," ",s.type]})}):e.jsxs("span",{children:[e.jsx(We,{color:"green"})," ",s.type]}),ys=s=>e.jsxs(os,{isHorizontal:!0,className:"keycloak_eventsection_details",children:[s.details&&Object.entries(s.details).map(([n,l])=>e.jsxs(ie,{children:[e.jsx(ce,{children:n}),e.jsx(de,{children:l})]},n)),s.error&&e.jsxs(ie,{children:[e.jsx(ce,{children:"error"}),e.jsx(de,{children:s.error})]},"error")]}),_s=s=>{const{t:n}=M("events"),{realm:l}=G();return e.jsxs(e.Fragment,{children:[s.userId&&e.jsx(re,{to:_e({realm:l,id:s.userId,tab:"settings"}),children:s.userId},`link-${s.time}-${s.type}`),!s.userId&&n("noUserDetails")]})};function $s(){const{t:s}=M("events"),{adminClient:n}=xe(),{realm:l}=G(),i=ge(),[_,B]=h.useState(0),[H,I]=h.useState(!1),[W,z]=h.useState(!1),[L,Z]=h.useState(),[k,$]=h.useState({}),q={client:s("client"),dateFrom:s("dateFrom"),dateTo:s("dateTo"),user:s("userId"),type:s("eventType"),authIpAddress:s("ipAddress")},{getValues:x,register:E,reset:y,formState:{isDirty:A},control:f,handleSubmit:w}=fe({mode:"onChange",defaultValues:he});Ge(()=>n.realms.getConfigEvents({realm:l}),a=>Z(a),[]);function J(a,o){return n.realms.findEvents({...k,realm:l,first:a,max:o})}const C=a=>Ze(ne({realm:l,tab:a})),j=C("user-events"),N=C("admin-events");function K(){I(!1),T()}function S(){y(),T()}function X(a){const o={...x()};delete o[a],y({...he,...o}),T()}function Y(a,o){const u=x(),p=u[a],R=Array.isArray(p)?p.filter(t=>t!==o):p;y({...u,[a]:R}),T()}function T(){const a=Ee(x(),o=>o!==""||Array.isArray(o)&&o.length>0);$(a),B(_+1)}function Q(){T()}const ee=()=>e.jsxs(Se,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[e.jsxs(U,{children:[e.jsx(ve,{id:"user-events-search-select","data-testid":"UserEventsSearchSelector",className:"pf-u-ml-md",toggle:e.jsx(je,{"data-testid":"userEventsSearchSelectorToggle",onToggle:a=>I(a),className:"keycloak__events_search_selector_dropdown__toggle",children:s("searchForUserEvent")}),isOpen:H,children:e.jsxs(Fe,{"data-testid":"searchForm",className:"keycloak__events_search__form",onSubmit:w(K),isHorizontal:!0,children:[e.jsx(m,{label:s("userId"),fieldId:"kc-userId",className:"keycloak__events_search__form_label",children:e.jsx(v,{id:"kc-userId","data-testid":"userId-searchField",...E("user")})}),e.jsx(m,{label:s("eventType"),fieldId:"kc-eventType",className:"keycloak__events_search__form_label",children:e.jsx(b,{name:"type",control:f,render:({field:a})=>e.jsx(se,{className:"keycloak__events_search__type_select",name:"eventType","data-testid":"event-type-searchField",chipGroupProps:{numChips:1,expandedText:s("common:hide"),collapsedText:s("common:showRemaining")},variant:te.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:o=>z(o),selections:a.value,onSelect:(o,u)=>{const p=u.toString(),R=a.value.includes(p)?a.value.filter(t=>t!==p):[...a.value,p];a.onChange(R)},onClear:o=>{o.stopPropagation(),a.onChange([])},isOpen:W,"aria-labelledby":"eventType",chipGroupComponent:e.jsx(P,{children:a.value.map(o=>e.jsx(g,{onClick:u=>{u.stopPropagation(),a.onChange(a.value.filter(p=>p!==o))},children:o},o))}),children:L?.enabledEventTypes?.map(o=>e.jsx(ae,{value:o},o))})})}),e.jsx(m,{label:s("client"),fieldId:"kc-client",className:"keycloak__events_search__form_label",children:e.jsx(v,{id:"kc-client","data-testid":"client-searchField",...E("client")})}),e.jsx(m,{label:s("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:e.jsx(b,{name:"dateFrom",control:f,render:({field:a})=>e.jsx(V,{className:"pf-u-w-100",value:a.value,onChange:(o,u)=>a.onChange(u),inputProps:{id:"kc-dateFrom"}})})}),e.jsx(m,{label:s("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:e.jsx(b,{name:"dateTo",control:f,render:({field:a})=>e.jsx(V,{className:"pf-u-w-100",value:a.value,onChange:(o,u)=>a.onChange(u),inputProps:{id:"kc-dateTo"}})})}),e.jsx(m,{label:s("ipAddress"),fieldId:"kc-ipAddress",className:"keycloak__events_search__form_label",children:e.jsx(v,{id:"kc-ipAddress","data-testid":"ipAddress-searchField",...E("authIpAddress")})}),e.jsxs(Ie,{children:[e.jsx(F,{"data-testid":"search-events-btn",variant:"primary",type:"submit",isDisabled:!A,children:s("searchUserEventsBtn")}),e.jsx(F,{variant:"secondary",onClick:S,isDisabled:!A,children:s("resetBtn")})]})]})}),e.jsx(F,{className:"pf-u-ml-md",onClick:Q,"data-testid":"refresh-btn",children:s("refresh")})]}),e.jsx(U,{children:Object.entries(k).length>0&&e.jsx("div",{className:"keycloak__searchChips pf-u-ml-md",children:Object.entries(k).map(a=>{const[o,u]=a;return e.jsx(P,{className:"pf-u-mt-md pf-u-mr-md",categoryName:q[o],isClosable:!0,onClick:()=>X(o),children:typeof u=="string"?e.jsx(g,{isReadOnly:!0,children:u}):u.map(p=>e.jsx(g,{onClick:()=>Y(o,p),children:p},p))},o)})})})]});return e.jsxs(e.Fragment,{children:[e.jsx(Xe,{titleKey:"events:title",subKey:e.jsxs(rs,{i18nKey:"events:eventExplain",children:["If you want to configure user events, Admin events or Event listeners, please enter",e.jsx(re,{to:Me({realm:l,tab:"events"}),children:s("eventConfig")}),"page realm settings to configure."]}),helpUrl:Be.eventsUrl,divider:!1}),e.jsx(He,{variant:"light",className:"pf-u-p-0",children:e.jsxs(ze,{isBox:!0,defaultLocation:ne({realm:l,tab:"user-events"}),children:[e.jsx(oe,{title:e.jsx(le,{children:s("userEvents")}),...j,children:e.jsx("div",{className:"keycloak__events_table",children:e.jsx(be,{loader:J,detailColumns:[{name:"details",enabled:a=>a.details!==void 0,cellRenderer:ys}],isPaginated:!0,ariaLabelKey:"events:title",toolbarItem:ee(),columns:[{name:"time",displayKey:"events:time",cellFormatters:[Qe],cellRenderer:a=>i(new Date(a.time),ke)},{name:"userId",displayKey:"events:user",cellRenderer:_s},{name:"type",displayKey:"events:eventType",cellRenderer:hs},{name:"ipAddress",displayKey:"events:ipAddress",transforms:[Ce(10)]},{name:"clientId",displayKey:"events:client"}],emptyState:e.jsx(Te,{message:s("emptyEvents"),instructions:s("emptyEventsInstructions")}),isSearching:Object.keys(k).length>0},_)})}),e.jsx(oe,{title:e.jsx(le,{children:s("adminEvents")}),"data-testid":"admin-events-tab",...N,children:e.jsx(ms,{})})]})})]})}export{$s as default};
//# sourceMappingURL=EventsSection-a8933f14.js.map
