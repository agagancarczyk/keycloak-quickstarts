{"version":3,"file":"PermissionTab-c2ee2a77.js","sources":["../../src/components/permission-tab/PermissionTab.tsx"],"sourcesContent":["import { useState } from \"react\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport { Trans, useTranslation } from \"react-i18next\";\nimport {\n  Card,\n  CardBody,\n  CardTitle,\n  Form,\n  FormGroup,\n  PageSection,\n  Switch,\n} from \"@patternfly/react-core\";\nimport {\n  ActionsColumn,\n  TableComposable,\n  Tbody,\n  Td,\n  Th,\n  Thead,\n  Tr,\n} from \"@patternfly/react-table\";\n\nimport type { ManagementPermissionReference } from \"@keycloak/keycloak-admin-client/lib/defs/managementPermissionReference\";\nimport { useAdminClient, useFetch } from \"../../context/auth/AdminClient\";\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\nimport { toPermissionDetails } from \"../../clients/routes/PermissionDetails\";\nimport { KeycloakSpinner } from \"../../components/keycloak-spinner/KeycloakSpinner\";\nimport { HelpItem } from \"ui-shared\";\nimport useLocaleSort from \"../../utils/useLocaleSort\";\nimport { useConfirmDialog } from \"../confirm-dialog/ConfirmDialog\";\n\nimport \"./permissions-tab.css\";\n\ntype PermissionScreenType =\n  | \"clients\"\n  | \"users\"\n  | \"groups\"\n  | \"roles\"\n  | \"identityProviders\";\n\ntype PermissionsTabProps = {\n  id?: string;\n  type: PermissionScreenType;\n};\n\nexport const PermissionsTab = ({ id, type }: PermissionsTabProps) => {\n  const { t } = useTranslation(\"common\");\n  const navigate = useNavigate();\n  const { adminClient } = useAdminClient();\n  const { realm } = useRealm();\n  const [realmId, setRealmId] = useState(\"\");\n  const [permission, setPermission] = useState<ManagementPermissionReference>();\n  const localeSort = useLocaleSort();\n\n  const togglePermissionEnabled = (enabled: boolean) => {\n    switch (type) {\n      case \"clients\":\n        return adminClient.clients.updateFineGrainPermission(\n          { id: id! },\n          { enabled }\n        );\n      case \"users\":\n        return adminClient.realms.updateUsersManagementPermissions({\n          realm,\n          enabled,\n        });\n      case \"groups\":\n        return adminClient.groups.updatePermission({ id: id! }, { enabled });\n      case \"roles\":\n        return adminClient.roles.updatePermission({ id: id! }, { enabled });\n      case \"identityProviders\":\n        return adminClient.identityProviders.updatePermission(\n          { alias: id! },\n          { enabled }\n        );\n    }\n  };\n\n  useFetch(\n    () =>\n      Promise.all([\n        adminClient.clients.find({\n          search: true,\n          clientId: realm === \"master\" ? \"master-realm\" : \"realm-management\",\n        }),\n        (() => {\n          switch (type) {\n            case \"clients\":\n              return adminClient.clients.listFineGrainPermissions({ id: id! });\n            case \"users\":\n              return adminClient.realms.getUsersManagementPermissions({\n                realm,\n              });\n            case \"groups\":\n              return adminClient.groups.listPermissions({ id: id! });\n            case \"roles\":\n              return adminClient.roles.listPermissions({ id: id! });\n            case \"identityProviders\":\n              return adminClient.identityProviders.listPermissions({\n                alias: id!,\n              });\n          }\n        })(),\n      ]),\n    ([clients, permission]) => {\n      setRealmId(clients[0]?.id!);\n      setPermission(permission);\n    },\n    [id]\n  );\n\n  const [toggleDisableDialog, DisableConfirm] = useConfirmDialog({\n    titleKey: \"common:permissionsDisable\",\n    messageKey: \"common:permissionsDisableConfirm\",\n    continueButtonLabel: \"common:confirm\",\n    onConfirm: async () => {\n      const permission = await togglePermissionEnabled(false);\n      setPermission(permission);\n    },\n  });\n\n  if (!permission) {\n    return <KeycloakSpinner />;\n  }\n\n  return (\n    <PageSection variant=\"light\">\n      <DisableConfirm />\n      <Card isFlat>\n        <CardTitle>{t(\"permissions\")}</CardTitle>\n        <CardBody>\n          {t(`${type}PermissionsHint`)}\n          <Form isHorizontal className=\"pf-u-pt-md\">\n            <FormGroup\n              hasNoPaddingTop\n              className=\"permission-label\"\n              label={t(\"permissionsEnabled\")}\n              fieldId=\"permissionsEnabled\"\n              labelIcon={\n                <HelpItem\n                  helpText={t(\"clients-help:permissionsEnabled\")}\n                  fieldLabelId=\"clients:permissionsEnabled\"\n                />\n              }\n            >\n              <Switch\n                id=\"permissionsEnabled\"\n                data-testid=\"permissionSwitch\"\n                label={t(\"common:on\")}\n                labelOff={t(\"common:off\")}\n                isChecked={permission.enabled}\n                onChange={async (enabled) => {\n                  if (enabled) {\n                    const permission = await togglePermissionEnabled(enabled);\n                    setPermission(permission);\n                  } else {\n                    toggleDisableDialog();\n                  }\n                }}\n                aria-label={t(\"permissionsEnabled\")}\n              />\n            </FormGroup>\n          </Form>\n        </CardBody>\n      </Card>\n      {permission.enabled && (\n        <>\n          <Card isFlat className=\"pf-u-mt-lg\">\n            <CardTitle>{t(\"permissionsList\")}</CardTitle>\n            <CardBody>\n              <Trans i18nKey=\"common:permissionsListIntro\">\n                {\" \"}\n                <strong>\n                  {{\n                    realm:\n                      realm === \"master\" ? \"master-realm\" : \"realm-management\",\n                  }}\n                </strong>\n                .\n              </Trans>\n            </CardBody>\n          </Card>\n          <Card isFlat className=\"keycloak__permission__permission-table\">\n            <CardBody className=\"pf-u-p-0\">\n              <TableComposable\n                aria-label={t(\"permissionsList\")}\n                variant=\"compact\"\n              >\n                <Thead>\n                  <Tr>\n                    <Th id=\"permissionsScopeName\">\n                      {t(\"permissionsScopeName\")}\n                    </Th>\n                    <Th id=\"description\">{t(\"description\")}</Th>\n                  </Tr>\n                </Thead>\n                <Tbody>\n                  {localeSort(\n                    Object.entries(permission.scopePermissions || {}),\n                    ([name]) => name\n                  ).map(([name, id]) => (\n                    <Tr key={id}>\n                      <Td>\n                        <Link\n                          to={toPermissionDetails({\n                            realm,\n                            id: realmId,\n                            permissionType: \"scope\",\n                            permissionId: id,\n                          })}\n                        >\n                          {name}\n                        </Link>\n                      </Td>\n                      <Td>\n                        {t(`scopePermissions.${type}.${name}-description`)}\n                      </Td>\n                      <Td isActionCell>\n                        <ActionsColumn\n                          items={[\n                            {\n                              title: t(\"common:edit\"),\n                              onClick() {\n                                navigate(\n                                  toPermissionDetails({\n                                    realm,\n                                    id: realmId,\n                                    permissionType: \"scope\",\n                                    permissionId: id,\n                                  })\n                                );\n                              },\n                            },\n                          ]}\n                        />\n                      </Td>\n                    </Tr>\n                  ))}\n                </Tbody>\n              </TableComposable>\n            </CardBody>\n          </Card>\n        </>\n      )}\n    </PageSection>\n  );\n};\n"],"names":["PermissionsTab","id","type","t","useTranslation","navigate","useNavigate","adminClient","useAdminClient","realm","useRealm","realmId","setRealmId","useState","permission","setPermission","localeSort","useLocaleSort","togglePermissionEnabled","enabled","useFetch","clients","toggleDisableDialog","DisableConfirm","useConfirmDialog","jsxs","PageSection","jsx","Card","CardTitle","CardBody","Form","FormGroup","HelpItem","Switch","Fragment","Trans","TableComposable","Thead","Tr","Th","Tbody","name","Td","Link","toPermissionDetails","ActionsColumn","KeycloakSpinner"],"mappings":"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"}