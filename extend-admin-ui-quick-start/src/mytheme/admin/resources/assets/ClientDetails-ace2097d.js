import{_ as vt,r as c,i as Ge,ao as ln,d as Z,c as he,u as E,W as ks,R as Me,n as oe,j as e,ap as tt,F as g,G as f,a0 as on,a1 as rn,aq as Qe,a as Q,C as N,O as st,Q as ve,ad as O,S as de,B as w,a2 as Rs,f as Oe,e as re,k as ye,A as te,ar as we,L as ge,ab as As,M as Bt,p as Ut,P as xe,as as Ct,at as gt,K as Pe,au as Vt,av as cn,aw as dn,ax as un,U as He,ay as pn,az as _e,aA as mn,N as et,g as Le,aB as hn,X as Ae,D as zt,v as Es,E as Dt,T as qt,b as nt,aC as ht,w as Ye,aD as xn,a4 as at,aE as Zt,aF as Os,aG as es,aH as ws,aI as ts,aJ as Fe,V as Se,aK as gn,a7 as jn,aL as fn,aM as Ps,aN as yn,al as bn,aO as Sn,aP as vn,aQ as ss,aR as ns,aS as Cn,q as Tn,s as as,aT as In}from"./index-a3421f29.js";import{C as Gt,u as Ce}from"./ConfirmDialog-09ff7a12.js";import{K as it}from"./KeycloakTextArea-1b518857.js";import{a as lt,M as Be}from"./Modal-21c37af7.js";import{F as Te,A as fe}from"./Form-518a2cf2.js";import{S as kn,a as is,F as ce,C as Rn,b as _s}from"./FormAccess-1cceaef6.js";import{S as G,a as q,b as M}from"./Select-0f56a9cc.js";import{P as An}from"./PermissionTab-c2ee2a77.js";import{R as En}from"./RolesList-1aa488b0.js";import{R as Et,u as Ot}from"./RoutableTabs-7f56b0c5.js";import{V as On}from"./ViewHeader-832ec56e.js";import{u as Ht}from"./useParams-5abeab7d.js";import{u as be}from"./useToggle-a9cb2c55.js";import{S as Ls}from"./ScrollForm-a21fd695.js";import{K as wn}from"./KeyValueInput-ce08b760.js";import{M as Ds}from"./MultiLineInput-14187d1c.js";import{T as $t}from"./TimeSelector-a2bc30e2.js";import{L as Ee,P as Tt}from"./PaginatingTableToolbar-08ca9efb.js";import{K as It}from"./KeycloakDataTable-10a62d94.js";import{u as Wt,F as Ns}from"./useFormatDate-7fddef56.js";import{K as Y}from"./KeycloakTextInput-e7f6e917.js";import{E as Fs}from"./ExpandableSection-15721cb7.js";import{b as je,T as Pn,c as _n}from"./ToolbarContent-7b435752.js";import{T as Ks}from"./Trans-2fec9e72.js";import{T as me,a as Ms}from"./Text-564bf299.js";import{C as Ln}from"./ClientSelect-3f0fc581.js";import{F as Nt}from"./FormPanel-11cb7e22.js";import{U as Bs,i as Dn,D as Nn,A as Fn}from"./PolicyDetails-655cb166.js";import{d as Us,i as yt,g as Kn}from"./utils-49fe564a.js";import{D as ls}from"./policyRepresentation-3337b354.js";import{T as Ue,O as le,P as F,Q as ot,R as Ve,S as ze,U as z}from"./Td-6d4ab209.js";import{D as rt,a as Mn,b as Bn,c as Un}from"./DescriptionListTerm-adda5202.js";import{c as Vn}from"./camelCase-7fbe8a69.js";import{M as zn}from"./minus-circle-icon-6f9a971c.js";import{P as Vs}from"./plus-circle-icon-cb854796.js";import{E as zs,a as qs}from"./EmptyStateBody-7b4fcee1.js";import{E as qn}from"./EmptyStateSecondaryActions-08edafb5.js";import{u as Gs,m as Hs}from"./useLocaleSort-3efc7c31.js";import{D as Gn}from"./DeleteScopeDialog-976d398c.js";import{J as Hn}from"./JsonFileUpload-a913d52f.js";import{R as xt}from"./Radio-e3ba1ffb.js";import{S as $n}from"./SessionsTable-69066f36.js";import{C as Wn,a as Jn}from"./ClientDescription-be494204.js";import{L as Qn}from"./LoginSettings-2f4d45bc.js";import{P as Ft}from"./PasswordInput-85f9399f.js";import{C as St}from"./Card-aa3ba03c.js";import{C as Xe}from"./CardBody-519f6395.js";import{F as $s}from"./FileUpload-ca37c1a6.js";import{C as Yn}from"./CardHeader-457352d1.js";import{C as Xn}from"./CardTitle-9175b04a.js";import{F as Zn,a as os}from"./FlexItem-65b5f999.js";import{A as rs,e as cs,f as ea,a as ta,g as sa,C as ds}from"./ClientScopeTypes-b557e5db.js";import{S as na,a as aa,C as ia,n as la,t as oa}from"./SearchFilter-bebed391.js";import{c as pt,T as ra,a as ae,b as ie}from"./Tabs-5beaba80.js";import{Q as ca}from"./question-circle-icon-45a94074.js";import{G as da,a as us}from"./GridItem-d34dae2e.js";import{R as ua}from"./AddRoleMappingModal-abb19beb.js";import"./copy-icon-a4fe01af.js";import"./check-fc57dbe1.js";import"./star-icon-6a7e7d25.js";import"./minus-icon-16876c86.js";import"./ActionListItem-ab1a4322.js";import"./TableToolbar-ee0c86ef.js";import"./ResourcesPolicySelect-e8d3e505.js";import"./filter-icon-9d72dc58.js";import"./Checkbox-d00621d8.js";import"./GroupPickerDialog-caf8c38d.js";import"./DataListItemRow-75e02946.js";import"./data-list-7d55714c.js";import"./grip-vertical-icon-cbeff50f.js";import"./CodeEditor-2fb93648.js";import"./DatePicker-49a9a039.js";import"./MenuList-e3786b59.js";import"./NumberInput-85f36a0d.js";import"./plus-icon-2a767bad.js";import"./capitalize-e93b891e.js";import"./FileUploadForm-96efeae2.js";import"./ListItem-499ec6f9.js";import"./resource-08ae7dbc.js";import"./joinPath-55fd24bc.js";const ft={codeBlock:"pf-c-code-block",codeBlockActions:"pf-c-code-block__actions",codeBlockCode:"pf-c-code-block__code",codeBlockContent:"pf-c-code-block__content",codeBlockHeader:"pf-c-code-block__header",codeBlockPre:"pf-c-code-block__pre"},Ws=s=>{var{children:n=null,className:a,actions:t=null}=s,i=vt(s,["children","className","actions"]);return c.createElement("div",Object.assign({className:Ge(ft.codeBlock,a)},i),c.createElement("div",{className:Ge(ft.codeBlockHeader)},c.createElement("div",{className:Ge(ft.codeBlockActions)},t&&t)),c.createElement("div",{className:Ge(ft.codeBlockContent)},n))};Ws.displayName="CodeBlock";const Js=s=>{var{children:n=null,className:a}=s,t=vt(s,["children","className"]);return c.createElement("div",Object.assign({className:Ge("pf-c-code-block__actions-item",a)},t),n)};Js.displayName="CodeBlockAction";var Kt;(function(s){s.ul="ul",s.ol="ol",s.dl="dl"})(Kt||(Kt={}));const Qs=s=>{var{children:n=null,className:a="",component:t=Kt.ul,isPlain:i=!1}=s,o=vt(s,["children","className","component","isPlain"]);const l=t;return c.createElement(l,Object.assign({},o,{className:Ge(i&&ln.modifiers.plain,a)}),n)};Qs.displayName="TextList";var Mt;(function(s){s.li="li",s.dt="dt",s.dd="dd"})(Mt||(Mt={}));const Ys=s=>{var{children:n=null,className:a="",component:t=Mt.li}=s,i=vt(s,["children","className","component"]);const o=t;return c.createElement(o,Object.assign({},i,{className:Ge(a)}),n)};Ys.displayName="TextListItem";const pa=({id:s,open:n,toggleDialog:a,protocol:t="openid-connect"})=>{const{adminClient:i}=Z(),{realm:o}=he(),{t:l}=E("common"),{enabled:r}=ks(),h=Me().clientInstallations[t],[m,x]=c.useState(h[h.length-1].id),[u,d]=c.useState(),[C,j]=c.useState(!1),y=c.useMemo(()=>h.find(I=>I.id===m)??null,[m]),A=I=>I.replace(/<PrivateKeyPem>.*<\/PrivateKeyPem>/gs,`<PrivateKeyPem>${l("clients:privateKeyMask")}</PrivateKeyPem>`);return oe(async()=>{if(y?.mediaType==="application/zip")return(await fetch(`${on(i.baseUrl)}admin/realms/${o}/clients/${s}/installation/providers/${m}`,{method:"GET",headers:rn(await i.getAccessToken())})).arrayBuffer();{const I=await i.clients.getInstallationProviders({id:s,providerId:m});return typeof I=="string"?A(I):Qe(I)}},I=>d(I),[s,m]),c.useEffect(()=>d(""),[s,m]),e.jsx(Gt,{titleKey:l("clients:downloadAdaptorTitle"),continueButtonLabel:l("download"),onConfirm:()=>{tt.saveAs(new Blob([u],{type:y?.mediaType}),y?.filename)},open:n,toggleDialog:a,variant:lt.medium,children:e.jsx(Te,{children:e.jsxs(kn,{hasGutter:!0,children:[e.jsx(is,{children:e.jsx(g,{fieldId:"type",label:l("clients:formatOption"),labelIcon:e.jsx(f,{helpText:l("clients-help:downloadType"),fieldLabelId:"clients:formatOption"}),children:e.jsx(G,{toggleId:"type",isOpen:C,onToggle:I=>j(I),variant:q.single,value:m,selections:m,onSelect:(I,_)=>{x(_.toString()),j(!1)},"aria-label":"Select Input",menuAppendTo:()=>document.body,children:h.map(I=>e.jsx(M,{value:I.id,isSelected:m===I.id,description:r?I.helpText:void 0,children:I.displayType},I.id))})})}),!y?.downloadOnly&&e.jsx(is,{isFilled:!0,children:e.jsx(g,{fieldId:"details",label:l("details"),labelIcon:e.jsx(f,{helpText:l("clients-help:details"),fieldLabelId:"clients:details"}),children:e.jsx(it,{id:"details",readOnly:!0,rows:12,resizeOrientation:"vertical",value:u&&typeof u=="string"?u:"","aria-label":"text area example"})})})]})})})},ps="tokenLifespan.inherited",ms="tokenLifespan.never",hs="tokenLifespan.expires",mt=({id:s,name:n,defaultValue:a,units:t})=>{const{t:i}=E("clients"),[o,l]=c.useState(!1),[r,p]=c.useState(!1),h=()=>p(!0),m=()=>p(!1),{control:x}=Q(),u=d=>typeof d=="number"&&d!==-1||typeof d=="string"&&d!==""&&d!=="-1"||r;return e.jsx(g,{label:i(s),fieldId:s,labelIcon:e.jsx(f,{helpText:i(`clients-help:${s}`),fieldLabelId:`clients:${s}`}),children:e.jsx(N,{name:n,defaultValue:"",control:x,render:({field:d})=>e.jsxs(st,{hasGutter:!0,children:[e.jsx(ve,{children:e.jsxs(G,{variant:q.single,onToggle:l,isOpen:o,onSelect:(C,j)=>{d.onChange(j),l(!1)},selections:[u(d.value)?i(hs):d.value===""?i(ps):i(ms)],children:[e.jsx(M,{value:"",children:i(ps)}),e.jsx(M,{value:-1,children:i(ms)}),e.jsx(M,{value:60,children:i(hs)})]})}),e.jsx(ve,{children:d.value!=="-1"&&d.value!==-1&&e.jsx($t,{units:t,value:d.value===""?a:d.value,onChange:d.onChange,onFocus:h,onBlur:m,min:1,isDisabled:d.value===""})})]})})})},ma=({save:s,reset:n,protocol:a,hasConfigureAccess:t})=>{const{t:i}=E("clients"),[o,l]=c.useState(!1),[r,p]=c.useState(),{realm:h}=he(),{adminClient:m}=Z();oe(()=>m.realms.findOne({realm:h}),p,[]);const{control:x}=Q();return e.jsxs(ce,{role:"manage-realm",fineGrainedAccess:t,isHorizontal:!0,children:[a!=="openid-connect"&&e.jsx(g,{label:i("assertionLifespan"),fieldId:"assertionLifespan",labelIcon:e.jsx(f,{helpText:i("clients-help:assertionLifespan"),fieldLabelId:"clients:assertionLifespan"}),children:e.jsx(N,{name:O("attributes.saml.assertion.lifespan"),defaultValue:"",control:x,render:({field:u})=>e.jsx($t,{units:["minute","day","hour"],value:u.value,onChange:u.onChange})})}),a==="openid-connect"&&e.jsxs(e.Fragment,{children:[e.jsx(mt,{id:"accessTokenLifespan",name:O("attributes.access.token.lifespan"),defaultValue:r?.accessTokenLifespan,units:["minute","day","hour"]}),e.jsx(mt,{id:"clientSessionIdle",name:O("attributes.client.session.idle.timeout"),defaultValue:r?.clientSessionIdleTimeout,units:["minute","day","hour"]}),e.jsx(mt,{id:"clientSessionMax",name:O("attributes.client.session.max.lifespan"),defaultValue:r?.clientSessionMaxLifespan,units:["minute","day","hour"]}),e.jsx(mt,{id:"clientOfflineSessionIdle",name:O("attributes.client.offline.session.idle.timeout"),defaultValue:r?.offlineSessionIdleTimeout,units:["minute","day","hour"]}),e.jsx(mt,{id:"clientOfflineSessionMax",name:O("attributes.client.offline.session.max.lifespan"),defaultValue:r?.offlineSessionMaxLifespan,units:["minute","day","hour"]}),e.jsx(g,{label:i("oAuthMutual"),fieldId:"oAuthMutual",hasNoPaddingTop:!0,labelIcon:e.jsx(f,{helpText:i("clients-help:oAuthMutual"),fieldLabelId:"clients:oAuthMutual"}),children:e.jsx(N,{name:O("attributes.tls.client.certificate.bound.access.tokens"),defaultValue:!1,control:x,render:({field:u})=>e.jsx(de,{id:"oAuthMutual-switch",label:i("common:on"),labelOff:i("common:off"),isChecked:u.value==="true",onChange:d=>u.onChange(""+d),"aria-label":i("oAuthMutual")})})}),e.jsx(g,{label:i("keyForCodeExchange"),fieldId:"keyForCodeExchange",hasNoPaddingTop:!0,labelIcon:e.jsx(f,{helpText:i("clients-help:keyForCodeExchange"),fieldLabelId:"clients:keyForCodeExchange"}),children:e.jsx(N,{name:O("attributes.pkce.code.challenge.method"),defaultValue:"",control:x,render:({field:u})=>e.jsx(G,{toggleId:"keyForCodeExchange",variant:q.single,onToggle:l,isOpen:o,onSelect:(d,C)=>{u.onChange(C),l(!1)},selections:[u.value||i("common:choose")],children:["","S256","plain"].map(d=>e.jsx(M,{value:d,children:d||i("common:choose")},d))})})}),e.jsx(g,{label:i("pushedAuthorizationRequestRequired"),fieldId:"pushedAuthorizationRequestRequired",labelIcon:e.jsx(f,{helpText:i("clients-help:pushedAuthorizationRequestRequired"),fieldLabelId:"clients:pushedAuthorizationRequestRequired"}),children:e.jsx(N,{name:O("attributes.require.pushed.authorization.requests"),defaultValue:"false",control:x,render:({field:u})=>e.jsx(de,{id:"pushedAuthorizationRequestRequired",label:i("common:on"),labelOff:i("common:off"),isChecked:u.value==="true",onChange:d=>u.onChange(d.toString()),"aria-label":i("pushedAuthorizationRequestRequired")})})}),e.jsx(g,{label:i("acrToLoAMapping"),fieldId:"acrToLoAMapping",labelIcon:e.jsx(f,{helpText:i("clients-help:acrToLoAMapping"),fieldLabelId:"clients:acrToLoAMapping"}),children:e.jsx(wn,{name:O("attributes.acr.loa.map")})}),e.jsx(g,{label:i("defaultACRValues"),fieldId:"defaultACRValues",labelIcon:e.jsx(f,{helpText:i("clients-help:defaultACRValues"),fieldLabelId:"clients:defaultACRValues"}),children:e.jsx(Ds,{id:"defaultACRValues","aria-label":"defaultACRValues",name:O("attributes.default.acr.values"),stringify:!0})})]}),e.jsxs(fe,{children:[e.jsx(w,{variant:"secondary",onClick:s,"data-testid":"OIDCAdvancedSave",children:i("common:save")}),e.jsx(w,{variant:"link",onClick:n,"data-testid":"OIDCAdvancedRevert",children:i("common:revert")})]})]})},ha=({protocol:s,save:n,reset:a,hasConfigureAccess:t})=>{const{adminClient:i}=Z(),{t:o}=E("clients"),[l,r]=c.useState([]),[p,h]=c.useState(!1),[m,x]=c.useState(!1),{control:u}=Q();return oe(()=>i.authenticationManagement.getFlows(),d=>{let C=[...d.filter(j=>j.providerId!=="client-flow")];C=Rs(C,[j=>j.alias]),r([e.jsx(M,{value:"",children:o("common:choose")},"empty"),...C.map(j=>e.jsx(M,{value:j.id,children:j.alias},j.id))])},[]),e.jsxs(ce,{role:"manage-clients",fineGrainedAccess:t,isHorizontal:!0,children:[e.jsx(g,{label:o("browserFlow"),fieldId:"browserFlow",labelIcon:e.jsx(f,{helpText:o("clients-help:browserFlow"),fieldLabelId:"clients:browserFlow"}),children:e.jsx(N,{name:"authenticationFlowBindingOverrides.browser",defaultValue:"",control:u,render:({field:d})=>e.jsx(G,{toggleId:"browserFlow",variant:q.single,onToggle:h,isOpen:p,onSelect:(C,j)=>{d.onChange(j),h(!1)},selections:[d.value],children:l})})}),s==="openid-connect"&&e.jsx(g,{label:o("directGrant"),fieldId:"directGrant",labelIcon:e.jsx(f,{helpText:o("clients-help:directGrant"),fieldLabelId:"clients:directGrant"}),children:e.jsx(N,{name:"authenticationFlowBindingOverrides.direct_grant",defaultValue:"",control:u,render:({field:d})=>e.jsx(G,{toggleId:"directGrant",variant:q.single,onToggle:x,isOpen:m,onSelect:(C,j)=>{d.onChange(j),x(!1)},selections:[d.value],children:l})})}),e.jsxs(fe,{children:[e.jsx(w,{variant:"secondary",onClick:n,"data-testid":"OIDCAuthFlowOverrideSave",children:o("common:save")}),e.jsx(w,{variant:"link",onClick:a,"data-testid":"OIDCAuthFlowOverrideRevert",children:o("common:revert")})]})]})},xa=({clientId:s,isOpen:n,onAdded:a,onClose:t})=>{const{t:i}=E("clients"),{register:o,handleSubmit:l,formState:{isDirty:r,isValid:p}}=Oe(),{adminClient:h}=Z(),{addAlert:m,addError:x}=re();async function u({node:d}){try{await h.clients.addClusterNode({id:s,node:d}),a(d),m(i("addedNodeSuccess"),te.success)}catch(C){x("clients:addedNodeFail",C)}t()}return e.jsx(Be,{title:i("addNode"),isOpen:n,onClose:t,variant:"small",actions:[e.jsx(w,{id:"add-node-confirm",type:"submit",form:"add-host-form",isDisabled:!r||!p,children:i("common:save")},"confirm"),e.jsx(w,{id:"add-node-cancel",variant:ye.link,onClick:t,children:i("common:cancel")},"cancel")],children:e.jsx(Te,{id:"add-host-form",onSubmit:l(u),isHorizontal:!0,children:e.jsx(g,{label:i("nodeHost"),fieldId:"nodeHost",isRequired:!0,children:e.jsx(Y,{id:"nodeHost",...o("node",{required:!0}),isRequired:!0})})})})},ga=({save:s,client:{id:n,registeredNodes:a,access:t}})=>{const{t:i}=E("clients"),{control:o}=Q(),{adminClient:l}=Z(),{addAlert:r,addError:p}=re(),h=Wt(),[m,x]=c.useState(a||{}),[u,d]=c.useState(!1),[C,j]=c.useState(""),[y,A]=c.useState(!1),[I,_]=c.useState(0),U=()=>_(new Date().getTime()),X=async()=>{const L=await l.clients.testNodesAvailable({id:n});Zs(L,"testCluster",r,i)},[H,k]=Ce({titleKey:"clients:deleteNode",messageKey:i("deleteNodeBody",{node:C}),continueButtonLabel:"common:delete",continueButtonVariant:ye.danger,onConfirm:async()=>{try{await l.clients.deleteClusterNode({id:n,node:C}),x({...Object.keys(m).reduce((L,D)=>(D!==C&&(L[D]=m[D]),L),{})}),U(),r(i("deleteNodeSuccess"),te.success)}catch(L){p("clients:deleteNodeFail",L)}}});return e.jsxs(e.Fragment,{children:[e.jsx(ce,{role:"manage-clients",fineGrainedAccess:t?.configure,isHorizontal:!0,children:e.jsx(g,{label:i("nodeReRegistrationTimeout"),fieldId:"kc-node-reregistration-timeout",labelIcon:e.jsx(f,{helpText:i("clients-help:nodeReRegistrationTimeout"),fieldLabelId:"clients:nodeReRegistrationTimeout"}),children:e.jsxs(st,{hasGutter:!0,children:[e.jsx(ve,{children:e.jsx(N,{name:"nodeReRegistrationTimeout",defaultValue:"",control:o,render:({field:L})=>e.jsx($t,{value:L.value,onChange:L.onChange})})}),e.jsx(ve,{children:e.jsx(w,{variant:ye.secondary,onClick:()=>s(),children:i("common:save")})})]})})}),e.jsxs(e.Fragment,{children:[e.jsx(k,{}),e.jsx(xa,{clientId:n,isOpen:y,onAdded:L=>{m[L]=Date.now()/1e3,U()},onClose:()=>A(!1)}),e.jsx(Fs,{toggleText:i("registeredClusterNodes"),onToggle:d,isExpanded:u,children:e.jsx(It,{ariaLabelKey:"registeredClusterNodes",loader:()=>Promise.resolve(Object.entries(m||{}).map(L=>({host:L[0],registration:L[1]}))),toolbarItem:e.jsxs(e.Fragment,{children:[e.jsx(je,{children:e.jsx(w,{id:"testClusterAvailability",onClick:X,variant:ye.secondary,isDisabled:Object.keys(m).length===0,children:i("testClusterAvailability")})}),e.jsx(je,{children:e.jsx(w,{id:"registerNodeManually",onClick:()=>A(!0),variant:ye.tertiary,children:i("registerNodeManually")})})]}),actions:[{title:i("common:delete"),onRowClick:L=>{j(L.host),H()}}],columns:[{name:"host",displayKey:"clients:nodeHost"},{name:"registration",displayKey:"clients:lastRegistration",cellFormatters:[L=>L?h(new Date(parseInt(L.toString())*1e3),Ns):""]}],emptyState:e.jsx(Ee,{message:i("noNodes"),instructions:i("noNodesInstructions"),primaryActionText:i("registerNodeManually"),onPrimaryAction:()=>A(!0)})},I)})]})]})},Xs=s=>{const{t:n}=E("clients"),{register:a}=Q();return e.jsxs(e.Fragment,{children:[e.jsx(g,{label:n("logoUrl"),fieldId:"logoUrl",labelIcon:e.jsx(f,{helpText:n("clients-help:logoUrl"),fieldLabelId:"clients:logoUrl"}),children:e.jsx(Y,{id:"logoUrl",type:"url","data-testid":"logoUrl",...a(O("attributes.logoUri")),...s})}),e.jsx(g,{label:n("policyUrl"),fieldId:"policyUrl",labelIcon:e.jsx(f,{helpText:n("clients-help:policyUrl"),fieldLabelId:"clients:policyUrl"}),children:e.jsx(Y,{id:"policyUrl","data-testid":"policyUrl",type:"url",...a(O("attributes.policyUri")),...s})}),e.jsx(g,{label:n("termsOfServiceUrl"),fieldId:"termsOfServiceUrl",labelIcon:e.jsx(f,{helpText:n("clients-help:termsOfServiceUrl"),fieldLabelId:"clients:termsOfServiceUrl"}),children:e.jsx(Y,{id:"termsOfServiceUrl",type:"url","data-testid":"termsOfServiceUrl",...a(O("attributes.tosUri")),...s})})]})},ja=({save:s,reset:n,hasConfigureAccess:a})=>{const{t}=E("clients"),i=Me().providers,o=i?.clientSignature.providers,l=i?.contentencryption.providers,r=i?.cekmanagement.providers,p=i?.signature.providers,[h,m]=c.useState(!1),[x,u]=c.useState(!1),[d,C]=c.useState(!1),[j,y]=c.useState(!1),[A,I]=c.useState(!1),[_,U]=c.useState(!1),[X,H]=c.useState(!1),[k,L]=c.useState(!1),[D,T]=c.useState(!1),[b,S]=c.useState(!1),[B,P]=c.useState(!1),[se,v]=c.useState(!1),[V,ee]=c.useState(!1),[K,$]=c.useState(!1),{control:W}=Q(),Ie=[e.jsx(M,{value:"",children:t("common:choose")},"empty"),...we(o).map(R=>e.jsx(M,{value:R},R))],qe=[e.jsx(M,{value:"",children:t("common:choose")},"empty"),...we(r).map(R=>e.jsx(M,{value:R},R))],ke=[e.jsx(M,{value:"",children:t("unsigned")},"unsigned"),...we(p).map(R=>e.jsx(M,{value:R},R))],De=[e.jsx(M,{value:"",children:t("common:choose")},"empty"),...we(l).map(R=>e.jsx(M,{value:R},R))],ct=[e.jsx(M,{value:"any",children:t("common:any")},"any"),e.jsx(M,{value:"none",children:t("common:none")},"none"),...we(o).map(R=>e.jsx(M,{value:R},R))],dt=[e.jsx(M,{value:"any",children:t("common:any")},"any"),...we(r).map(R=>e.jsx(M,{value:R},R))],We=[e.jsx(M,{value:"any",children:t("common:any")},"any"),...we(l).map(R=>e.jsx(M,{value:R},R))],Je=[e.jsx(M,{value:"",children:t("common:choose")},"empty"),...we(p).map(R=>e.jsx(M,{value:R},R))],ue=["not required","request or request_uri","request only","request_uri only"].map(R=>e.jsx(M,{value:R,children:t(`requestObject.${R}`)},R));return e.jsxs(ce,{role:"manage-clients",fineGrainedAccess:a,isHorizontal:!0,children:[e.jsx(Xs,{}),e.jsx(g,{label:t("accessTokenSignatureAlgorithm"),fieldId:"accessTokenSignatureAlgorithm",labelIcon:e.jsx(f,{helpText:t("clients-help:accessTokenSignatureAlgorithm"),fieldLabelId:"clients:accessTokenSignatureAlgorithm"}),children:e.jsx(N,{name:O("attributes.access.token.signed.response.alg"),defaultValue:"",control:W,render:({field:R})=>e.jsx(G,{toggleId:"accessTokenSignatureAlgorithm",variant:q.single,onToggle:m,isOpen:h,onSelect:(pe,J)=>{R.onChange(J),m(!1)},selections:R.value,children:Ie})})}),e.jsx(g,{label:t("idTokenSignatureAlgorithm"),fieldId:"kc-id-token-signature",labelIcon:e.jsx(f,{helpText:t("clients-help:idTokenSignatureAlgorithm"),fieldLabelId:"clients:idTokenSignatureAlgorithm"}),children:e.jsx(N,{name:O("attributes.id.token.signed.response.alg"),defaultValue:"",control:W,render:({field:R})=>e.jsx(G,{toggleId:"idTokenSignatureAlgorithm",variant:q.single,onToggle:u,isOpen:x,onSelect:(pe,J)=>{R.onChange(J),u(!1)},selections:R.value,children:Ie})})}),e.jsx(g,{label:t("idTokenEncryptionKeyManagementAlgorithm"),fieldId:"idTokenEncryptionKeyManagementAlgorithm",labelIcon:e.jsx(f,{helpText:t("clients-help:idTokenEncryptionKeyManagementAlgorithm"),fieldLabelId:"clients:idTokenEncryptionKeyManagementAlgorithm"}),children:e.jsx(N,{name:O("attributes.id.token.encrypted.response.alg"),defaultValue:"",control:W,render:({field:R})=>e.jsx(G,{toggleId:"idTokenEncryptionKeyManagementAlgorithm",variant:q.single,onToggle:C,isOpen:d,onSelect:(pe,J)=>{R.onChange(J),C(!1)},selections:R.value,children:qe})})}),e.jsx(g,{label:t("idTokenEncryptionContentEncryptionAlgorithm"),fieldId:"idTokenEncryptionContentEncryptionAlgorithm",labelIcon:e.jsx(f,{helpText:t("clients-help:idTokenEncryptionContentEncryptionAlgorithm"),fieldLabelId:"clients:idTokenEncryptionContentEncryptionAlgorithm"}),children:e.jsx(N,{name:O("attributes.id.token.encrypted.response.enc"),defaultValue:"",control:W,render:({field:R})=>e.jsx(G,{toggleId:"idTokenEncryptionContentEncryptionAlgorithm",variant:q.single,onToggle:y,isOpen:j,onSelect:(pe,J)=>{R.onChange(J),y(!1)},selections:R.value,children:De})})}),e.jsx(g,{label:t("userInfoSignedResponseAlgorithm"),fieldId:"userInfoSignedResponseAlgorithm",labelIcon:e.jsx(f,{helpText:t("clients-help:userInfoSignedResponseAlgorithm"),fieldLabelId:"clients:userInfoSignedResponseAlgorithm"}),children:e.jsx(N,{name:O("attributes.user.info.response.signature.alg"),defaultValue:"",control:W,render:({field:R})=>e.jsx(G,{toggleId:"userInfoSignedResponseAlgorithm",variant:q.single,onToggle:I,isOpen:A,onSelect:(pe,J)=>{R.onChange(J),I(!1)},selections:R.value,children:ke})})}),e.jsx(g,{label:t("userInfoResponseEncryptionKeyManagementAlgorithm"),fieldId:"userInfoResponseEncryptionKeyManagementAlgorithm",labelIcon:e.jsx(f,{helpText:t("clients-help:userInfoResponseEncryptionKeyManagementAlgorithm"),fieldLabelId:"clients:userInfoResponseEncryptionKeyManagementAlgorithm"}),children:e.jsx(N,{name:O("attributes.user.info.encrypted.response.alg"),defaultValue:"",control:W,render:({field:R})=>e.jsx(G,{toggleId:"userInfoResponseEncryptionKeyManagementAlgorithm",variant:q.single,onToggle:ee,isOpen:V,onSelect:(pe,J)=>{R.onChange(J),ee(!1)},selections:R.value,children:qe})})}),e.jsx(g,{label:t("userInfoResponseEncryptionContentEncryptionAlgorithm"),fieldId:"userInfoResponseEncryptionContentEncryptionAlgorithm",labelIcon:e.jsx(f,{helpText:t("clients-help:userInfoResponseEncryptionContentEncryptionAlgorithm"),fieldLabelId:"clients:userInfoResponseEncryptionContentEncryptionAlgorithm"}),children:e.jsx(N,{name:O("attributes.user.info.encrypted.response.enc"),defaultValue:"",control:W,render:({field:R})=>e.jsx(G,{toggleId:"userInfoResponseEncryptionContentEncryptionAlgorithm",variant:q.single,onToggle:$,isOpen:K,onSelect:(pe,J)=>{R.onChange(J),$(!1)},selections:R.value,children:De})})}),e.jsx(g,{label:t("requestObjectSignatureAlgorithm"),fieldId:"requestObjectSignatureAlgorithm",labelIcon:e.jsx(f,{helpText:t("clients-help:requestObjectSignatureAlgorithm"),fieldLabelId:"clients:requestObjectSignatureAlgorithm"}),children:e.jsx(N,{name:O("attributes.request.object.signature.alg"),defaultValue:"",control:W,render:({field:R})=>e.jsx(G,{toggleId:"requestObjectSignatureAlgorithm",variant:q.single,onToggle:U,isOpen:_,onSelect:(pe,J)=>{R.onChange(J),U(!1)},selections:R.value,children:ct})})}),e.jsx(g,{label:t("requestObjectEncryption"),fieldId:"requestObjectEncryption",labelIcon:e.jsx(f,{helpText:t("clients-help:requestObjectEncryption"),fieldLabelId:"clients:requestObjectEncryption"}),children:e.jsx(N,{name:O("attributes.request.object.encryption.alg"),defaultValue:"",control:W,render:({field:R})=>e.jsx(G,{toggleId:"requestObjectEncryption",variant:q.single,onToggle:L,isOpen:k,onSelect:(pe,J)=>{R.onChange(J),L(!1)},selections:R.value,children:dt})})}),e.jsx(g,{label:t("requestObjectEncoding"),fieldId:"requestObjectEncoding",labelIcon:e.jsx(f,{helpText:t("clients-help:requestObjectEncoding"),fieldLabelId:"clients:requestObjectEncoding"}),children:e.jsx(N,{name:O("attributes.request.object.encryption.enc"),defaultValue:"",control:W,render:({field:R})=>e.jsx(G,{toggleId:"requestObjectEncoding",variant:q.single,onToggle:T,isOpen:D,onSelect:(pe,J)=>{R.onChange(J),T(!1)},selections:R.value,children:We})})}),e.jsx(g,{label:t("requestObjectRequired"),fieldId:"requestObjectRequired",labelIcon:e.jsx(f,{helpText:t("clients-help:requestObjectRequired"),fieldLabelId:"clients:requestObjectRequired"}),children:e.jsx(N,{name:O("attributes.request.object.required"),defaultValue:"",control:W,render:({field:R})=>e.jsx(G,{toggleId:"requestObjectRequired",variant:q.single,onToggle:H,isOpen:X,onSelect:(pe,J)=>{R.onChange(J),H(!1)},selections:R.value,children:ue})})}),e.jsx(g,{label:t("validRequestURIs"),fieldId:"validRequestURIs",labelIcon:e.jsx(f,{helpText:t("clients-help:validRequestURIs"),fieldLabelId:"clients:validRequestURIs"}),children:e.jsx(Ds,{name:O("attributes.request.uris"),"aria-label":t("validRequestURIs"),addButtonLabel:"clients:addRequestUri",stringify:!0})}),e.jsx(g,{label:t("authorizationSignedResponseAlg"),fieldId:"authorizationSignedResponseAlg",labelIcon:e.jsx(f,{helpText:t("clients-help:authorizationSignedResponseAlg"),fieldLabelId:"clients:authorizationSignedResponseAlg"}),children:e.jsx(N,{name:O("attributes.authorization.signed.response.alg"),defaultValue:"",control:W,render:({field:R})=>e.jsx(G,{toggleId:"authorizationSignedResponseAlg",variant:q.single,onToggle:S,isOpen:b,onSelect:(pe,J)=>{R.onChange(J),S(!1)},selections:R.value,children:Je})})}),e.jsx(g,{label:t("authorizationEncryptedResponseAlg"),fieldId:"authorizationEncryptedResponseAlg",labelIcon:e.jsx(f,{helpText:t("clients-help:authorizationEncryptedResponseAlg"),fieldLabelId:"clients:authorizationEncryptedResponseAlg"}),children:e.jsx(N,{name:O("attributes.authorization.encrypted.response.alg"),defaultValue:"",control:W,render:({field:R})=>e.jsx(G,{toggleId:"authorizationEncryptedResponseAlg",variant:q.single,onToggle:P,isOpen:B,onSelect:(pe,J)=>{R.onChange(J),P(!1)},selections:R.value,children:qe})})}),e.jsx(g,{label:t("authorizationEncryptedResponseEnc"),fieldId:"authorizationEncryptedResponseEnc",labelIcon:e.jsx(f,{helpText:t("clients-help:authorizationEncryptedResponseEnc"),fieldLabelId:"clients:authorizationEncryptedResponseEnc"}),children:e.jsx(N,{name:O("attributes.authorization.encrypted.response.enc"),defaultValue:"",control:W,render:({field:R})=>e.jsx(G,{toggleId:"authorizationEncryptedResponseEnc",variant:q.single,onToggle:v,isOpen:se,onSelect:(pe,J)=>{R.onChange(J),v(!1)},selections:R.value,children:De})})}),e.jsxs(fe,{children:[e.jsx(w,{variant:"secondary",id:"fineGrainSave",onClick:s,children:t("common:save")}),e.jsx(w,{id:"fineGrainRevert",variant:"link",onClick:n,children:t("common:revert")})]})]})},fa=({save:s,reset:n})=>{const{t:a}=E("clients"),{register:t}=Q();return e.jsxs(ce,{role:"manage-realm",isHorizontal:!0,children:[e.jsx(Xs,{}),e.jsx(g,{label:a("assertionConsumerServicePostBindingURL"),fieldId:"assertionConsumerServicePostBindingURL",labelIcon:e.jsx(f,{helpText:a("clients-help:assertionConsumerServicePostBindingURL"),fieldLabelId:"clients:assertionConsumerServicePostBindingURL"}),children:e.jsx(Y,{id:"assertionConsumerServicePostBindingURL",type:"url",...t("attributes.saml_assertion_consumer_url_post")})}),e.jsx(g,{label:a("assertionConsumerServiceRedirectBindingURL"),fieldId:"assertionConsumerServiceRedirectBindingURL",labelIcon:e.jsx(f,{helpText:a("clients-help:assertionConsumerServiceRedirectBindingURL"),fieldLabelId:"clients:assertionConsumerServiceRedirectBindingURL"}),children:e.jsx(Y,{id:"assertionConsumerServiceRedirectBindingURL",type:"url",...t("attributes.saml_assertion_consumer_url_redirect")})}),e.jsx(g,{label:a("logoutServicePostBindingURL"),fieldId:"logoutServicePostBindingURL",labelIcon:e.jsx(f,{helpText:a("clients-help:logoutServicePostBindingURL"),fieldLabelId:"clients:logoutServicePostBindingURL"}),children:e.jsx(Y,{id:"logoutServicePostBindingURL",type:"url",...t("attributes.saml_single_logout_service_url_post")})}),e.jsx(g,{label:a("logoutServiceRedirectBindingURL"),fieldId:"logoutServiceRedirectBindingURL",labelIcon:e.jsx(f,{helpText:a("clients-help:logoutServiceRedirectBindingURL"),fieldLabelId:"clients:logoutServiceRedirectBindingURL"}),children:e.jsx(Y,{id:"logoutServiceRedirectBindingURL",type:"url",...t("attributes.saml_single_logout_service_url_redirect")})}),e.jsx(g,{label:a("logoutServiceSoapBindingUrl"),fieldId:"logoutServiceSoapBindingUrl",labelIcon:e.jsx(f,{helpText:"clients-help:logoutServiceSoapBindingUrl",fieldLabelId:"clients:logoutServiceSoapBindingUrl"}),children:e.jsx(Y,{id:"logoutServiceSoapBindingUrl",type:"url",...t("attributes.saml_single_logout_service_url_soap")})}),e.jsx(g,{label:a("logoutServiceArtifactBindingUrl"),fieldId:"logoutServiceArtifactBindingUrl",labelIcon:e.jsx(f,{helpText:a("clients-help:logoutServiceArtifactBindingUrl"),fieldLabelId:"clients:logoutServiceArtifactBindingUrl"}),children:e.jsx(Y,{id:"logoutServiceArtifactBindingUrl",type:"url",...t("attributes.saml_single_logout_service_url_artifact")})}),e.jsx(g,{label:a("artifactBindingUrl"),fieldId:"artifactBindingUrl",labelIcon:e.jsx(f,{helpText:a("clients-help:artifactBindingUrl"),fieldLabelId:"clients:artifactBindingUrl"}),children:e.jsx(Y,{id:"artifactBindingUrl",type:"url",...t("attributes.saml_artifact_binding_url")})}),e.jsx(g,{label:a("artifactResolutionService"),fieldId:"artifactResolutionService",labelIcon:e.jsx(f,{helpText:a("clients-help:artifactResolutionService"),fieldLabelId:"clients:artifactResolutionService"}),children:e.jsx(Y,{id:"artifactResolutionService",type:"url",...t("attributes.saml_artifact_resolution_service_url")})}),e.jsxs(fe,{children:[e.jsx(w,{variant:"tertiary",onClick:s,children:a("common:save")}),e.jsx(w,{variant:"link",onClick:n,children:a("common:revert")})]})]})},ya=({save:s,reset:n,hasConfigureAccess:a})=>{const{t}=E("clients"),{control:i}=Q();return e.jsxs(ce,{role:"manage-clients",fineGrainedAccess:a,isHorizontal:!0,children:[e.jsx(g,{label:t("excludeSessionStateFromAuthenticationResponse"),fieldId:"excludeSessionStateFromAuthenticationResponse",hasNoPaddingTop:!0,labelIcon:e.jsx(f,{helpText:t("clients-help:excludeSessionStateFromAuthenticationResponse"),fieldLabelId:"clients:excludeSessionStateFromAuthenticationResponse"}),children:e.jsx(N,{name:O("attributes.exclude.session.state.from.auth.response"),defaultValue:"",control:i,render:({field:o})=>e.jsx(de,{id:"excludeSessionStateFromAuthenticationResponse-switch",label:t("common:on"),labelOff:t("common:off"),isChecked:o.value==="true",onChange:l=>o.onChange(l.toString()),"aria-label":t("excludeSessionStateFromAuthenticationResponse")})})}),e.jsx(g,{label:t("useRefreshTokens"),fieldId:"useRefreshTokens",hasNoPaddingTop:!0,labelIcon:e.jsx(f,{helpText:t("clients-help:useRefreshTokens"),fieldLabelId:"clients:useRefreshTokens"}),children:e.jsx(N,{name:O("attributes.use.refresh.tokens"),defaultValue:"true",control:i,render:({field:o})=>e.jsx(de,{id:"useRefreshTokens",label:t("common:on"),labelOff:t("common:off"),isChecked:o.value==="true",onChange:l=>o.onChange(l.toString()),"aria-label":t("useRefreshTokens")})})}),e.jsx(g,{label:t("useRefreshTokenForClientCredentialsGrant"),fieldId:"useRefreshTokenForClientCredentialsGrant",hasNoPaddingTop:!0,labelIcon:e.jsx(f,{helpText:t("clients-help:useRefreshTokenForClientCredentialsGrant"),fieldLabelId:"clients:useRefreshTokenForClientCredentialsGrant"}),children:e.jsx(N,{name:O("attributes.client_credentials.use_refresh_token"),defaultValue:"false",control:i,render:({field:o})=>e.jsx(de,{id:"useRefreshTokenForClientCredentialsGrant",label:t("common:on"),labelOff:t("common:off"),isChecked:o.value==="true",onChange:l=>o.onChange(l.toString()),"aria-label":t("useRefreshTokenForClientCredentialsGrant")})})}),e.jsx(g,{label:t("useLowerCaseBearerType"),fieldId:"useLowerCaseBearerType",hasNoPaddingTop:!0,labelIcon:e.jsx(f,{helpText:t("clients-help:useLowerCaseBearerType"),fieldLabelId:"clients:useLowerCaseBearerType"}),children:e.jsx(N,{name:O("attributes.token.response.type.bearer.lower-case"),defaultValue:"false",control:i,render:({field:o})=>e.jsx(de,{id:"useLowerCaseBearerType",label:t("common:on"),labelOff:t("common:off"),isChecked:o.value==="true",onChange:l=>o.onChange(l.toString()),"aria-label":t("useLowerCaseBearerType")})})}),e.jsxs(fe,{children:[e.jsx(w,{variant:"secondary",onClick:s,"data-testid":"OIDCCompatabilitySave",children:t("common:save")}),e.jsx(w,{variant:"link",onClick:n,"data-testid":"OIDCCompatabilityRevert",children:t("common:revert")})]})]})},ba=({save:s,client:{id:n,adminUrl:a,access:t}})=>{const i="notBefore",o=c.useRef(),{t:l}=E("clients"),{adminClient:r}=Z(),{realm:p}=he(),{addAlert:h}=re(),m=Wt(),{getValues:x,setValue:u,register:d}=Q(),C=(A,I)=>{u(i,A),s({messageKey:I})};c.useEffect(()=>{d(i)},[d]);const j=()=>{const A=x(i);return A>0?m(new Date(A*1e3),Ns):l("common:none")},y=async()=>{const A=await r.clients.pushRevocation({id:n});Zs(A,"notBeforePush",h,l)};return e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"pf-u-pb-lg",children:e.jsxs(Ks,{i18nKey:"clients-help:notBeforeIntro",children:["In order to successfully push setup url on",e.jsx(ge,{to:As({realm:p,clientId:n,tab:"settings"}),children:l("settings")}),"tab"]})}),e.jsxs(ce,{role:"manage-clients",fineGrainedAccess:t?.configure,isHorizontal:!0,children:[e.jsx(g,{label:l("notBefore"),fieldId:"kc-not-before",labelIcon:e.jsx(f,{helpText:l("clients-help:notBefore"),fieldLabelId:"clients:notBefore"}),children:e.jsxs(Bt,{children:[e.jsx(Y,{type:"text",id:"kc-not-before",name:"notBefore",isReadOnly:!0,value:j()}),e.jsx(w,{id:"setToNow",variant:"control",onClick:()=>{C(Date.now()/1e3,"notBeforeSetToNow")},children:l("setToNow")}),e.jsx(w,{id:"clear",variant:"control",onClick:()=>{C(0,"notBeforeNowClear")},children:l("clear")})]})}),e.jsxs(fe,{children:[!a&&e.jsx(Ut,{reference:o,content:l("clients-help:notBeforeTooltip")}),e.jsx(w,{id:"push",variant:"secondary",onClick:y,isAriaDisabled:!a,ref:o,children:l("push")})]})]})]})},Zs=(s,n,a,t)=>{const i=s.successRequests?.length||0,o=s.failedRequests?.length||0;i===0&&o===0?a(t("noAdminUrlSet"),te.warning):o>0?(a(t(n+"Success",{successNodes:s.successRequests}),te.success),a(t(n+"Fail",{failedNodes:s.failedRequests}),te.danger)):a(t(n+"Success",{successNodes:s.successRequests}),te.success)},Sa=({save:s,client:n})=>{const{t:a}=E("clients"),t="openid-connect",{setValue:i}=Q(),{publicClient:o,attributes:l,protocol:r,authenticationFlowBindingOverrides:p}=n,h=m=>{for(const x of m)i(O(`attributes.${x}`),l?.[x]||"")};return e.jsx(xe,{variant:"light",className:"pf-u-py-0",children:e.jsx(Ls,{sections:[{title:a("revocation"),isHidden:r!==t,panel:e.jsx(ba,{client:n,save:s})},{title:a("clustering"),isHidden:!o,panel:e.jsx(ga,{client:n,save:s})},{title:a("fineGrainOpenIdConnectConfiguration"),isHidden:r!==t,panel:e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"pf-u-pb-lg",children:a("clients-help:fineGrainOpenIdConnectConfiguration")}),e.jsx(ja,{save:s,reset:()=>{h(["logoUri","policyUri","tosUri","access.token.signed.response.alg","id.token.signed.response.alg","id.token.encrypted.response.alg","id.token.encrypted.response.enc","user.info.response.signature.alg","user.info.encrypted.response.alg","user.info.encrypted.response.enc","request.object.signature.alg","request.object.encryption.alg","request.object.encryption.enc","request.object.required","request.uris","authorization.signed.response.alg","authorization.encrypted.response.alg","authorization.encrypted.response.enc"])}})]})},{title:a("openIdConnectCompatibilityModes"),isHidden:r!==t,panel:e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"pf-u-pb-lg",children:a("clients-help:openIdConnectCompatibilityModes")}),e.jsx(ya,{save:()=>s(),reset:()=>h(["exclude.session.state.from.auth.response","use.refresh.tokens","client_credentials.use_refresh_token","token.response.type.bearer.lower-case"])})]})},{title:a("fineGrainSamlEndpointConfig"),isHidden:r===t,panel:e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"pf-u-pb-lg",children:a("clients-help:fineGrainSamlEndpointConfig")}),e.jsx(fa,{save:()=>s(),reset:()=>h(["logoUri","policyUri","tosUri","saml_assertion_consumer_url_post","saml_assertion_consumer_url_redirect","saml_single_logout_service_url_post","saml_single_logout_service_url_redirect","saml_single_logout_service_url_artifact","saml_artifact_binding_url","saml_artifact_resolution_service_url"])})]})},{title:a("advancedSettings"),panel:e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"pf-u-pb-lg",children:a("clients-help:advancedSettings"+Ct(r||""))}),e.jsx(ma,{protocol:r,save:()=>s(),reset:()=>{h(["saml.assertion.lifespan","access.token.lifespan","tls.client.certificate.bound.access.tokens","pkce.code.challenge.method"])}})]})},{title:a("authenticationOverrides"),panel:e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"pf-u-pb-lg",children:a("clients-help:authenticationOverrides")}),e.jsx(ha,{protocol:r,save:()=>s(),reset:()=>{i("authenticationFlowBindingOverrides.browser",p?.browser),i("authenticationFlowBindingOverrides.direct_grant",p?.direct_grant)}})]})}],borders:!0})})},va=({idx:s,rowIndex:n,outerPolicy:a,resource:t})=>{const[i,o]=c.useState(!1),{t:l}=E("clients"),{realm:r}=he(),{clientId:p}=Ht();return e.jsxs(Ue,{isExpanded:i,children:[e.jsxs(le,{children:[e.jsx(F,{expand:{rowIndex:n,isExpanded:i,onToggle:()=>o(h=>!h)}}),e.jsx(F,{"data-testid":`name-column-${t.resource}`,children:e.jsx(ge,{to:gt({realm:r,id:p,permissionType:a.policy?.type,permissionId:a.policy?.id}),children:a.policy?.name})}),e.jsx(F,{id:a.status?.toLowerCase(),children:l(a.status?.toLowerCase())}),e.jsx(F,{children:l(`${a.policy?.decisionStrategy?.toLowerCase()}`)}),e.jsx(F,{children:a.status===ls.Permit?t.policies?.[n]?.scopes?.join(", "):"-"}),e.jsx(F,{children:a.status===ls.Deny&&t.policies?.[n]?.scopes?.length?t.policies[n].scopes?.join(", "):"-"})]}),e.jsxs(le,{isExpanded:i,children:[e.jsx(F,{}),e.jsx(F,{colSpan:5,children:i&&e.jsx(ot,{children:e.jsx(rt,{isHorizontal:!0,className:"keycloak_resource_details",children:e.jsx(Pe,{children:e.jsx(Qs,{children:a.associatedPolicies?.map(h=>e.jsxs(Ys,{children:[e.jsx(ge,{to:Vt({realm:r,id:p,policyType:h.policy?.type,policyId:h.policy?.id}),children:h.policy?.name}),l("votedToStatus",{status:cn(h.status)})]},"policyDetails"))})})})})})]},`child-${t.resource}`)]},s)},Ca=({rowIndex:s,resource:n,evaluateResults:a})=>{const[t,i]=c.useState(!1),{t:o}=E("clients");return e.jsxs(Ue,{isExpanded:t,children:[e.jsxs(le,{children:[e.jsx(F,{expand:{rowIndex:s,isExpanded:t,onToggle:()=>i(l=>!l)}}),e.jsx(F,{"data-testid":`name-column-${n.resource}`,children:n.resource?.name}),e.jsx(F,{id:n.status?.toLowerCase(),children:o(`${n.status?.toLowerCase()}`)}),e.jsx(F,{children:n.allowedScopes?.length?n.allowedScopes.map(l=>l.name):"-"})]}),e.jsxs(le,{isExpanded:t,children:[e.jsx(F,{}),e.jsx(F,{colSpan:5,children:e.jsx(ot,{children:t&&e.jsx(rt,{isHorizontal:!0,className:"keycloak_resource_details",children:e.jsxs(Ve,{"aria-label":o("evaluationResults"),children:[e.jsx(ze,{children:e.jsxs(le,{children:[e.jsx(z,{}),e.jsx(z,{children:o("permission")}),e.jsx(z,{children:o("results")}),e.jsx(z,{children:o("decisionStrategy")}),e.jsx(z,{children:o("grantedScopes")}),e.jsx(z,{children:o("deniedScopes")}),e.jsx(z,{})]})}),Object.values(a[s].policies).map((l,r)=>e.jsx(va,{idx:r,rowIndex:s,outerPolicy:l,resource:n},r))]})})})})]},`child-${n.resource}`)]})},Ta=({data:s})=>{const{t:n}=E("clients"),[a,t]=be();return e.jsxs(e.Fragment,{children:[e.jsx(w,{"data-testid":"authorization-revert",onClick:t,variant:"secondary",children:n("showAuthData")}),e.jsx(Be,{variant:lt.medium,isOpen:a,"aria-label":n("authData"),header:e.jsxs(Pe,{children:[e.jsx(me,{component:Ms.h1,children:n("authData")}),e.jsx(me,{children:n("authDataDescription")})]}),onClose:t,actions:[e.jsx(w,{"data-testid":"cancel",id:"modal-cancel",onClick:t,children:n("common:cancel")},"cancel")],children:e.jsx(it,{readOnly:!0,rows:20,value:Qe(s)})})]})};function Ia(s,n){switch(n){case"STATUS_PERMITTED":return s.filter(({status:a})=>a==="PERMIT");case"STATUS_DENIED":return s.filter(({status:a})=>a==="DENY");default:return s}}const ka=({evaluateResult:s,refresh:n,back:a})=>{const{t}=E("clients"),[i,o]=be(),[l,r]=c.useState("ALL"),[p,h]=c.useState(""),[m,x]=c.useState(""),u=()=>{h(m)},d=A=>{A.key==="Enter"&&u()},C=c.useMemo(()=>Ia(s.results,l).filter(({resource:A})=>A?.name?.includes(p)??!1),[s.results,l,p]),j=s.results.length===0,y=C.length===0;return e.jsxs(xe,{children:[e.jsx(Pn,{children:e.jsxs(_n,{className:"providers-toolbar",children:[e.jsx(je,{children:e.jsxs(Bt,{children:[e.jsx(dn,{name:"inputGroupName",id:"inputGroupName",type:"search","aria-label":t("common:search"),placeholder:t("common:search"),onChange:x,onKeyDown:d}),e.jsx(w,{variant:ye.control,"aria-label":t("common:search"),onClick:()=>u(),children:e.jsx(un,{})})]})}),e.jsx(je,{children:e.jsxs(G,{width:300,"data-testid":"filter-type-select",isOpen:i,className:"kc-filter-type-select",variant:q.single,onToggle:o,onSelect:(A,I)=>{r(I),o(),n()},selections:l,children:[e.jsx(M,{"data-testid":"all-results-option",value:"ALL",isPlaceholder:!0,children:t("allResults")}),e.jsx(M,{"data-testid":"result-permit-option",value:"STATUS_PERMITTED",children:t("resultPermit")}),e.jsx(M,{"data-testid":"result-deny-option",value:"STATUS_DENIED",children:t("resultDeny")})]})})]})}),!y&&e.jsxs(Ve,{"aria-label":t("evaluationResults"),children:[e.jsx(ze,{children:e.jsxs(le,{children:[e.jsx(z,{}),e.jsx(z,{children:t("resource")}),e.jsx(z,{children:t("overallResults")}),e.jsx(z,{children:t("scopes")}),e.jsx(z,{})]})}),C.map((A,I)=>e.jsx(Ca,{rowIndex:I,resource:A,evaluateResults:s.results},I))]}),(y||j)&&e.jsxs(e.Fragment,{children:[e.jsx(He,{}),e.jsx(Ee,{isSearchVariant:!0,message:t("common:noSearchResults"),instructions:t("common:noSearchResultsInstructions")})]}),e.jsxs(fe,{className:"kc-evaluated-options",children:[e.jsx(w,{"data-testid":"authorization-eval",id:"back-btn",onClick:a,children:t("common:back")}),e.jsx(w,{"data-testid":"authorization-reevaluate",id:"reevaluate-btn",variant:"secondary",onClick:n,children:t("clients:reevaluate")}),e.jsx(Ta,{data:s.rpt})]})]})};const Ra=({name:s,rowIndex:n,attribute:a,selectableValues:t,resources:i})=>{const{t:o}=E("common"),{control:l,register:r,getValues:p}=Q(),[h,m]=c.useState([!1]),x=(j,y)=>{const A=[...h];A[j]=y,m(A)},u=c.useMemo(()=>{let j=[];return t&&(j=Us.find(y=>y.key===p().context?.[n]?.key)?.values),j},[p]),d=()=>{const j=i?.find(y=>y.name===p().resources?.[n]?.key)?.scopes;if(u?.length&&!i)return u.map(y=>e.jsx(M,{value:y.key,children:y.name},y.key));if(j?.length)return j.map(y=>e.jsx(M,{value:y.name,children:y.name},y.name))},C=j=>Vn(j).replace(/\W/g,"");return e.jsx(F,{children:i||u?.length?e.jsx(N,{name:`${s}.${n}.value`,defaultValue:[],control:l,render:({field:j})=>e.jsx(G,{toggleId:`${a.id}-value`,className:"kc-attribute-value-selectable",name:`${s}.${n}.value`,chipGroupProps:{numChips:1,expandedText:o("common:hide"),collapsedText:o("common:showRemaining")},onToggle:y=>x(n,y),isOpen:h[n],variant:q.typeahead,typeAheadAriaLabel:o("clients:selectOrTypeAKey"),placeholderText:o("clients:selectOrTypeAKey"),selections:j.value,onSelect:(y,A)=>{j.onChange(A),x(n,!1)},children:d()})}):e.jsx(Y,{id:`${C(a.key)}-value`,className:"value-input",defaultValue:a.value,"data-testid":"attribute-value-input","aria-label":o("common:value"),...r(`${s}.${n}.value`)})})},xs=({name:s,selectableValues:n,resources:a})=>{const{t}=E("common"),{control:i,watch:o}=Q(),{fields:l,append:r,remove:p}=pn({control:i,name:s}),[h,m]=c.useState([!1]),x=(d,C)=>{const j=[...h];j[d]=C,m(j)};c.useEffect(()=>{l.length||r({key:"",value:""},{shouldFocus:!1})},[l]);const u=o(`${s}.${l.length-1}.value`,"");return e.jsxs(Ve,{className:"kc-attributes__table","aria-label":"Role attribute keys and values",variant:"compact",children:[e.jsx(ze,{children:e.jsxs(le,{children:[e.jsx(z,{width:40,children:t("key")}),e.jsx(z,{width:40,children:t("value")})]})}),e.jsxs(Ue,{children:[l.map((d,C)=>e.jsxs(le,{"data-testid":"attribute-row",children:[e.jsx(F,{children:e.jsx(N,{name:`${s}.${C}.key`,defaultValue:"",control:i,render:({field:j})=>e.jsx(G,{toggleId:`${s}.${C}.key`,className:"kc-attribute-key-selectable",name:`${s}.${C}.key`,onToggle:y=>x(C,y),isOpen:h[C],variant:q.typeahead,typeAheadAriaLabel:t("clients:selectOrTypeAKey"),placeholderText:t("clients:selectOrTypeAKey"),selections:j.value,onSelect:(y,A)=>{j.onChange(A.toString()),x(C,!1)},children:n?.map(y=>e.jsx(M,{selected:y.name===j.value,value:a?y.name:y.key,children:y.name},y.key))})})}),e.jsx(Ra,{name:s,attribute:d,rowIndex:C,selectableValues:n,resources:a}),e.jsx(F,{children:e.jsx(w,{id:`${s}-minus-button-${C}`,variant:"link",className:"kc-attributes__minus-icon",onClick:()=>p(C),"aria-label":t("common:remove"),children:e.jsx(zn,{})})})]},d.id)),e.jsx(le,{children:e.jsx(F,{children:e.jsx(w,{"aria-label":t("addAttribute"),id:`${s}-plus-icon`,variant:"link",className:"kc-attributes__plus-icon",onClick:()=>{r({key:"",value:""}),m([...h,!1])},icon:e.jsx(Vs,{}),isDisabled:!u,"data-testid":"attribute-add-row",children:t("addAttribute")})})})]})]})};const Aa=({client:s})=>{const n=Oe({mode:"onChange"}),{control:a,register:t,reset:i,trigger:o,formState:{isValid:l,errors:r}}=n,{t:p}=E("clients"),{adminClient:h}=Z(),{addError:m}=re(),x=he(),[u,d]=c.useState(!1),[C,j]=c.useState(!1),[y,A]=c.useState(!1),[I,_]=c.useState(!1),[U,X]=c.useState([]),[H,k]=c.useState([]),[L,D]=c.useState(),[T,b]=c.useState([]),{hasAccess:S}=_e();if(!S("view-users"))return e.jsx(mn,{permissionNeeded:"view-users"});oe(()=>h.roles.find(),v=>{b(v)},[]),oe(()=>Promise.all([h.clients.listResources({id:s.id}),h.clients.listAllScopes({id:s.id})]),([v,V])=>{X(v),k(V)},[]);const B=async()=>{if(!await o())return;const v=n.getValues(),V=hn(v.resources),ee={roleIds:v.roleIds??[],clientId:v.client.id,userId:v.user[0],resources:U.filter(K=>Object.keys(V).includes(K.name)).map(K=>({...K,scopes:K.scopes?.filter($=>Object.values(V).flatMap(W=>W).includes($.name))})),entitlements:!1,context:{attributes:Object.fromEntries(v.context.attributes.filter(K=>K.key||K.value!=="").map(({key:K,value:$})=>[K,$]))}};try{const K=await h.clients.evaluateResource({id:s.id,realm:x.realm},ee);D(K)}catch(K){m("clients:evaluateError",K)}},P=et({control:a,name:"user",defaultValue:[]}),se=et({control:a,name:"roleIds",defaultValue:[]});return L?e.jsx(ka,{evaluateResult:L,refresh:B,back:()=>D(void 0)}):e.jsx(xe,{children:e.jsxs(Le,{...n,children:[e.jsx(Nt,{className:"kc-identity-information",title:p("clients:identityInformation"),children:e.jsxs(ce,{isHorizontal:!0,role:"view-clients",children:[e.jsx(Ln,{name:"client",label:"client",namespace:"clients",helpText:"clients-help:client",defaultValue:s.clientId}),e.jsx(Bs,{name:"user",label:"users",helpText:p("clients-help:selectUser"),defaultValue:[],variant:q.typeahead,isRequired:se?.length===0}),e.jsx(g,{label:p("roles"),labelIcon:e.jsx(f,{helpText:p("clients-help:roles"),fieldLabelId:"clients:roles"}),fieldId:"realmRole",validated:r.roleIds?"error":"default",helperTextInvalid:p("common:required"),isRequired:P.length===0,children:e.jsx(N,{name:"roleIds",control:a,defaultValue:[],rules:{validate:v=>(v||"").length>0||P.length>0},render:({field:v})=>e.jsx(G,{placeholderText:p("selectARole"),variant:q.typeaheadMulti,toggleId:"role",onToggle:j,selections:v.value,onSelect:(V,ee)=>{const K=ee.toString();v.value?.includes(K)?v.onChange(v.value.filter($=>$!==K)):v.onChange([...v.value||[],K]),j(!1)},onClear:V=>{V.stopPropagation(),v.onChange([])},"aria-label":p("realmRole"),isOpen:C,children:T.map(V=>e.jsx(M,{selected:V.name===v.value,value:V.name},V.name))})})})]})}),e.jsxs(Nt,{className:"kc-permissions",title:p("common:permissions"),children:[e.jsxs(ce,{isHorizontal:!0,role:"view-clients",children:[e.jsx(g,{label:p("applyToResourceType"),fieldId:"applyToResourceType",labelIcon:e.jsx(f,{helpText:p("clients-help:applyToResourceType"),fieldLabelId:"clients:applyToResourceType"}),children:e.jsx(de,{id:"applyToResource-switch",label:p("common:on"),labelOff:p("common:off"),isChecked:I,onChange:_,"aria-label":p("applyToResourceType")})}),I?e.jsxs(e.Fragment,{children:[e.jsx(g,{label:p("resourceType"),isRequired:!0,labelIcon:e.jsx(f,{helpText:p("clients-help:resourceType"),fieldLabelId:"clients:resourceType"}),fieldId:"client",validated:r.alias?"error":"default",helperTextInvalid:p("common:required"),children:e.jsx(Y,{id:"alias","aria-label":"resource-type","data-testid":"alias",...t("alias",{required:!0})})}),e.jsx(g,{label:p("authScopes"),labelIcon:e.jsx(f,{helpText:p("clients-help:scopesSelect"),fieldLabelId:"clients:client"}),fieldId:"authScopes",children:e.jsx(N,{name:"authScopes",defaultValue:[],control:a,render:({field:v})=>e.jsx(G,{toggleId:"authScopes",onToggle:d,onSelect:(V,ee)=>{const K=ee.toString();v.value.includes(K)?v.onChange(v.value.filter($=>$!==K)):v.onChange([...v.value,K]),d(!1)},selections:v.value,variant:q.typeaheadMulti,typeAheadAriaLabel:p("authScopes"),isOpen:u,children:H.map(V=>e.jsx(M,{selected:v.value.includes(V.name),value:V.name},V.id))})})})]}):e.jsx(g,{label:p("resourcesAndScopes"),id:"resourcesAndScopes",labelIcon:e.jsx(f,{helpText:p("clients-help:contextualAttributes"),fieldLabelId:"resourcesAndScopes"}),fieldId:"resourcesAndScopes",children:e.jsx(xs,{selectableValues:U.map(v=>({name:v.name,key:v._id})),resources:U,name:"resources"})}),e.jsx(Fs,{toggleText:p("contextualInfo"),onToggle:()=>A(!y),isExpanded:y,children:e.jsx(g,{label:p("contextualAttributes"),id:"contextualAttributes",labelIcon:e.jsx(f,{helpText:p("clients-help:contextualAttributes"),fieldLabelId:"contextualAttributes"}),helperTextInvalid:p("common:required"),fieldId:"contextualAttributes",children:e.jsx(xs,{selectableValues:Us,name:"context.attributes"})})})]}),e.jsxs(fe,{children:[e.jsx(w,{"data-testid":"authorization-eval",id:"authorization-eval",className:"pf-u-mr-md",isDisabled:!l,onClick:()=>B(),children:p("evaluate")}),e.jsx(w,{"data-testid":"authorization-revert",id:"authorization-revert",className:"pf-u-mr-md",variant:"link",onClick:()=>i(),children:p("common:revert")})]})]})]})})};const Ea=()=>{const{t:s}=E("clients"),{adminClient:n}=Z(),{clientId:a}=Ht(),{addAlert:t,addError:i}=re(),[o,l]=c.useState(),[r,p]=c.useState();oe(()=>n.clients.exportResource({id:a}),m=>{l(JSON.stringify(m,null,2)),p(m)},[]);const h=()=>{try{tt.saveAs(new Blob([Qe(r)],{type:"application/json"}),"test-authz-config.json"),t(s("exportAuthDetailsSuccess"),te.success)}catch(m){i("exportAuthDetailsError",m)}};return o?e.jsx(xe,{children:e.jsxs(ce,{isHorizontal:!0,role:"view-realm",className:"pf-u-mt-lg",children:[e.jsx(g,{label:s("authDetails"),labelIcon:e.jsx(f,{helpText:s("clients-help:authDetails"),fieldLabelId:"clients:authDetails"}),fieldId:"client",children:e.jsx(it,{id:"authorizationDetails",readOnly:!0,resizeOrientation:"vertical",value:o,"aria-label":s("authDetails")})}),e.jsxs(fe,{children:[e.jsx(w,{"data-testid":"authorization-export-download",onClick:()=>h(),children:s("common:download")}),e.jsx(w,{"data-testid":"authorization-export-copy",variant:"secondary",onClick:async()=>{try{await navigator.clipboard.writeText(o),t(s("copied"),te.success)}catch(m){i(s("copyError"),m)}},children:s("copy")})]})]})}):e.jsx(Ae,{})};const Jt=({types:s,search:n,onSearch:a,isResource:t=!1})=>{const{t:i}=E("clients"),{register:o,control:l,reset:r,formState:{isDirty:p},handleSubmit:h}=Oe({mode:"onChange"}),[m,x]=be(),[u,d]=be(),C=y=>{x(),a(y)};c.useEffect(()=>r(n),[n]);const j=y=>[e.jsx(M,{value:"",children:i("allTypes")},"empty"),...(s||[]).map(A=>e.jsx(M,{selected:A.type===y,value:A.type,children:A.name},A.type))];return e.jsx(zt,{"data-testid":"searchdropdown_dorpdown",className:"pf-u-ml-md",toggle:e.jsx(Es,{onToggle:x,className:"keycloak__client_authentication__searchdropdown",children:i("searchForPermission")}),isOpen:m,children:e.jsxs(Te,{isHorizontal:!0,className:"keycloak__client_authentication__searchdropdown_form",onSubmit:h(C),children:[e.jsx(g,{label:i("common:name"),fieldId:"name",children:e.jsx(Y,{id:"name","data-testid":"searchdropdown_name",...o("name")})}),t&&e.jsxs(e.Fragment,{children:[e.jsx(g,{label:i("common:type"),fieldId:"type",children:e.jsx(Y,{id:"type","data-testid":"searchdropdown_type",...o("type")})}),e.jsx(g,{label:i("uris"),fieldId:"uri",children:e.jsx(Y,{id:"uri","data-testid":"searchdropdown_uri",...o("uri")})}),e.jsx(g,{label:i("owner"),fieldId:"owner",children:e.jsx(Y,{id:"owner","data-testid":"searchdropdown_owner",...o("owner")})})]}),!t&&e.jsx(g,{label:i("resource"),fieldId:"resource",children:e.jsx(Y,{id:"resource","data-testid":"searchdropdown_resource",...o("resource")})}),e.jsx(g,{label:i("scope"),fieldId:"scope",children:e.jsx(Y,{id:"scope","data-testid":"searchdropdown_scope",...o("scope")})}),!t&&e.jsx(g,{label:i("common:type"),fieldId:"type",children:e.jsx(N,{name:"type",defaultValue:"",control:l,render:({field:y})=>e.jsx(G,{toggleId:"type",onToggle:d,onSelect:(A,I)=>{A.stopPropagation(),y.onChange(I),d()},selections:y.value||i("allTypes"),variant:q.single,"aria-label":i("common:type"),isOpen:u,children:j(y.value)})})}),e.jsxs(fe,{children:[e.jsx(w,{variant:"primary",type:"submit","data-testid":"search-btn",isDisabled:!p,children:i("common:search")}),e.jsx(w,{variant:"link","data-testid":"revert-btn",onClick:()=>a({}),children:i("common:clear")})]})]})})},Qt=({array:s})=>{const{t:n}=E("clients");return!s||s.length<=1?null:e.jsx(Dt,{color:"blue",children:n("common:more",{count:s.length-1})})};function Oa(s){return e.jsx($e,{...s})}function $e({name:s,array:n,convert:a,link:t}){const{t:i}=E("clients");return e.jsxs(Mn,{children:[e.jsx(Bn,{children:i(s)}),e.jsxs(Un,{children:[n?.map(o=>{const l=typeof o=="string"?o:a(o);return t?e.jsx(ge,{to:t(o),className:"pf-u-pr-sm",children:l},l):e.jsx("span",{className:"pf-u-pr-sm",children:l},l)}),n?.length===0&&e.jsx("i",{children:i("common:none")})]})]})}const gs=({permissionType:s,disabled:n=!1,clientId:a})=>{const{t}=E("clients"),{realm:i}=he(),o=nt();return e.jsx(w,{"data-testid":`create-${s}`,className:n?"keycloak__permissions__empty_state ":"pf-u-m-sm",variant:"secondary",onClick:()=>!n&&o(ht({realm:i,id:a,permissionType:s})),children:t(`create${Ct(s)}BasedPermission`)})},js=({permissionType:s,disabled:n,...a})=>{const{t}=E("clients");return n?e.jsx(Ut,{content:t(`no${Ct(s)}CreateHint`),children:e.jsx(gs,{...a,disabled:n,permissionType:s})}):e.jsx(gs,{...a,disabled:n,permissionType:s})},wa=({clientId:s,isResourceEnabled:n,isScopeEnabled:a})=>{const{t}=E("clients");return e.jsxs(zs,{"data-testid":"empty-state",variant:"large",children:[e.jsx(qn,{icon:Vs}),e.jsx(qt,{headingLevel:"h1",size:"lg",children:t("emptyPermissions")}),e.jsx(qs,{children:t("emptyPermissionInstructions")}),e.jsx(js,{permissionType:"resource",disabled:n,clientId:s}),e.jsx("br",{}),e.jsx(js,{permissionType:"scope",disabled:a,clientId:s})]})};const Pa=({row:s})=>e.jsxs(e.Fragment,{children:[s.associatedPolicies?.[0]?.name," ",e.jsx(Qt,{array:s.associatedPolicies})]}),_a=({clientId:s})=>{const{t:n}=E("clients"),a=nt(),{adminClient:t}=Z(),{addAlert:i,addError:o}=re(),{realm:l}=he(),[r,p]=c.useState(),[h,m]=c.useState(),[x,u]=c.useState(),[d,C]=c.useState(),[j,y]=be(),[A,I]=c.useState({}),[_,U]=c.useState(0),X=()=>U(_+1),[H,k]=c.useState(10),[L,D]=c.useState(0);oe(async()=>{const P=await t.clients.findPermissions({first:L,max:H+1,id:s,...A});return await Promise.all(P.map(async se=>{const v=await t.clients.getAssociatedPolicies({id:s,permissionId:se.id});return{...se,associatedPolicies:v,isExpanded:!1}}))},p,[_,A,L,H]),oe(async()=>{const P={first:0,max:1},[se,v,V]=await Promise.all([t.clients.listPolicyProviders({id:s}),t.clients.listResources({...P,id:s}),t.clients.listAllScopes({...P,id:s})]);return{policies:se.filter(ee=>ee.type==="resource"||ee.type==="scope"),resources:v.length!==1,scopes:V.length!==1}},({policies:P,resources:se,scopes:v})=>{u(P),C({resources:se,scopes:v})},[]);const[T,b]=Ce({titleKey:"clients:deletePermission",messageKey:n("deletePermissionConfirm",{permission:h?.name}),continueButtonVariant:ye.danger,continueButtonLabel:"clients:confirm",onConfirm:async()=>{try{await t.clients.delPermission({id:s,type:h?.type,permissionId:h?.id}),i(n("permissionDeletedSuccess"),te.success),X()}catch(P){o("clients:permissionDeletedError",P)}}});if(!r)return e.jsx(Ae,{});const S=r.length===0,B=Object.keys(A).length!==0;return e.jsxs(xe,{variant:"light",className:"pf-u-p-0",children:[e.jsx(b,{}),(!S||B)&&e.jsx(Tt,{count:r.length,first:L,max:H,onNextClick:D,onPreviousClick:D,onPerPageSelect:(P,se)=>{D(P),k(se)},toolbarItem:e.jsxs(e.Fragment,{children:[e.jsx(je,{children:e.jsx(Jt,{types:x,search:A,onSearch:I})}),e.jsx(je,{children:e.jsx(zt,{toggle:e.jsx(Es,{onToggle:y,isPrimary:!0,"data-testid":"permissionCreateDropdown",children:n("createPermission")}),isOpen:j,dropdownItems:[e.jsx(Ye,{"data-testid":"create-resource",isDisabled:d?.resources,component:"button",onClick:()=>a(ht({realm:l,id:s,permissionType:"resource"})),children:n("createResourceBasedPermission")},"createResourceBasedPermission"),e.jsx(xn,{},"separator"),e.jsxs(Ye,{"data-testid":"create-scope",isDisabled:d?.scopes,component:"button",onClick:()=>a(ht({realm:l,id:s,permissionType:"scope"})),children:[n("createScopeBasedPermission"),d?.scopes&&e.jsx(at,{className:"pf-u-mt-sm",variant:"warning",isInline:!0,isPlain:!0,title:n("noScopeCreateHint")})]},"createScopeBasedPermission")]})})]}),children:!S&&e.jsxs(Ve,{"aria-label":n("resources"),variant:"compact",children:[e.jsx(ze,{children:e.jsxs(le,{children:[e.jsx(z,{}),e.jsx(z,{children:n("common:name")}),e.jsx(z,{children:n("common:type")}),e.jsx(z,{children:n("associatedPolicy")}),e.jsx(z,{children:n("common:description")}),e.jsx(z,{})]})}),r.map((P,se)=>e.jsxs(Ue,{isExpanded:P.isExpanded,children:[e.jsxs(le,{children:[e.jsx(F,{expand:{rowIndex:se,isExpanded:P.isExpanded,onToggle:(v,V)=>{const ee=r.map((K,$)=>$===V?{...K,isExpanded:!K.isExpanded}:K);p(ee)}}}),e.jsx(F,{"data-testid":`name-column-${P.name}`,children:e.jsx(ge,{to:gt({realm:l,id:s,permissionType:P.type,permissionId:P.id}),children:P.name})}),e.jsx(F,{children:x?.find(v=>v.type===P.type)?.name}),e.jsx(F,{children:e.jsx(Pa,{row:P})}),e.jsx(F,{children:P.description}),e.jsx(F,{actions:{items:[{title:n("common:delete"),onClick:async()=>{m(P),T()}}]}})]}),e.jsxs(le,{isExpanded:P.isExpanded,children:[e.jsx(F,{}),e.jsx(F,{colSpan:5,children:e.jsx(ot,{children:P.isExpanded&&e.jsx(rt,{isHorizontal:!0,className:"keycloak_resource_details",children:e.jsx($e,{name:"associatedPolicy",array:P.associatedPolicies,convert:v=>v.name,link:v=>Vt({id:s,realm:l,policyId:v.id,policyType:v.type})})})})})]},`child-${P.id}`)]},P.id))]})}),S&&!B&&e.jsx(wa,{clientId:s,isResourceEnabled:d?.resources,isScopeEnabled:d?.scopes}),S&&B&&e.jsx(Ee,{isSearchVariant:!0,message:n("common:noSearchResults"),instructions:n("common:noSearchResultsInstructions")})]})},fs=({policyProviders:s,onSelect:n,toggleDialog:a})=>{const{t}=E("clients"),i=Gs(),o=c.useMemo(()=>s?i(s,Hs("name")):[],[s]);return e.jsx(Be,{"aria-labelledby":t("addPredefinedMappers"),variant:lt.medium,header:e.jsxs(Pe,{children:[e.jsx(me,{component:Ms.h1,children:t("chooseAPolicyType")}),e.jsx(me,{children:t("chooseAPolicyTypeInstructions")})]}),isOpen:!0,onClose:a,children:e.jsxs(Ve,{"aria-label":t("policies"),variant:"compact",children:[e.jsx(ze,{children:e.jsxs(le,{children:[e.jsx(z,{children:t("common:name")}),e.jsx(z,{children:t("common:description")})]})}),e.jsx(Ue,{children:o.map(l=>e.jsxs(le,{"data-testid":l.type,onRowClick:()=>n(l),isHoverable:!0,children:[e.jsx(F,{children:l.name}),e.jsx(F,{children:Dn(l.type)&&t(`policyProvider.${l.type}`)})]},l.type))})]})})},La=({row:s})=>e.jsxs(e.Fragment,{children:[s.dependentPolicies?.[0]?.name," ",e.jsx(Qt,{array:s.dependentPolicies})]}),Da=({clientId:s})=>{const{t:n}=E("clients"),{adminClient:a}=Z(),{addAlert:t,addError:i}=re(),{realm:o}=he(),l=nt(),[r,p]=c.useState(),[h,m]=c.useState(),[x,u]=c.useState(),[d,C]=c.useState(0),j=()=>C(d+1),[y,A]=c.useState(10),[I,_]=c.useState(0),[U,X]=c.useState({}),[H,k]=be();oe(async()=>{const S=await a.clients.listPolicies({first:I,max:y+1,id:s,permission:"false",...U});return await Promise.all([a.clients.listPolicyProviders({id:s}),...(S||[]).map(async B=>{const P=await a.clients.listDependentPolicies({id:s,policyId:B.id});return{...B,dependentPolicies:P,isExpanded:!1}})])},([S,...B])=>{u(S.filter(P=>P.type!=="resource"&&P.type!=="scope")),p(B)},[d,U,I,y]);const[L,D]=Ce({titleKey:"clients:deletePolicy",children:e.jsxs(e.Fragment,{children:[n("deletePolicyConfirm"),h?.dependentPolicies&&h.dependentPolicies.length>0&&e.jsx(at,{variant:"warning",isInline:!0,isPlain:!0,title:n("deletePolicyWarning"),className:"pf-u-pt-lg",children:e.jsx("p",{className:"pf-u-pt-xs",children:h.dependentPolicies.map(S=>e.jsx("strong",{className:"pf-u-pr-md",children:S.name},S.id))})})]}),continueButtonLabel:"clients:confirm",onConfirm:async()=>{try{await a.clients.delPolicy({id:s,policyId:h?.id}),t(n("policyDeletedSuccess"),te.success),j()}catch(S){i("clients:policyDeletedError",S)}}});if(!r)return e.jsx(Ae,{});const T=r.length===0,b=Object.keys(U).length!==0;return e.jsxs(xe,{variant:"light",className:"pf-u-p-0",children:[e.jsx(D,{}),(!T||b)&&e.jsxs(e.Fragment,{children:[H&&e.jsx(fs,{policyProviders:x,onSelect:S=>l(Zt({id:s,realm:o,policyType:S.type})),toggleDialog:k}),e.jsx(Tt,{count:r.length,first:I,max:y,onNextClick:_,onPreviousClick:_,onPerPageSelect:(S,B)=>{_(S),A(B)},toolbarItem:e.jsxs(e.Fragment,{children:[e.jsx(je,{children:e.jsx(Jt,{types:x,search:U,onSearch:X})}),e.jsx(je,{children:e.jsx(w,{"data-testid":"createPolicy",onClick:k,children:n("createPolicy")})})]}),children:!T&&e.jsxs(Ve,{"aria-label":n("resources"),variant:"compact",children:[e.jsx(ze,{children:e.jsxs(le,{children:[e.jsx(z,{}),e.jsx(z,{children:n("common:name")}),e.jsx(z,{children:n("common:type")}),e.jsx(z,{children:n("dependentPermission")}),e.jsx(z,{children:n("common:description")}),e.jsx(z,{})]})}),r.map((S,B)=>e.jsxs(Ue,{isExpanded:S.isExpanded,children:[e.jsxs(le,{children:[e.jsx(F,{expand:{rowIndex:B,isExpanded:S.isExpanded,onToggle:(P,se)=>{const v=r.map((V,ee)=>ee===se?{...V,isExpanded:!V.isExpanded}:V);p(v)}}}),e.jsx(F,{"data-testid":`name-column-${S.name}`,children:e.jsx(ge,{to:Vt({realm:o,id:s,policyType:S.type,policyId:S.id}),children:S.name})}),e.jsx(F,{children:Ct(S.type)}),e.jsx(F,{children:e.jsx(La,{row:S})}),e.jsx(F,{children:S.description}),e.jsx(F,{actions:{items:[{title:n("common:delete"),onClick:async()=>{m(S),L()}}]}})]}),e.jsxs(le,{isExpanded:S.isExpanded,children:[e.jsx(F,{}),e.jsx(F,{colSpan:4,children:e.jsx(ot,{children:S.isExpanded&&e.jsx(rt,{isHorizontal:!0,className:"keycloak_resource_details",children:e.jsx($e,{name:"dependentPermission",array:S.dependentPolicies,convert:P=>P.name,link:P=>gt({realm:o,id:s,permissionId:P.id,permissionType:P.type})})})})})]},`child-${S.id}`)]},S.id))]})})]}),T&&b&&e.jsx(Ee,{isSearchVariant:!0,message:n("common:noSearchResults"),instructions:n("common:noSearchResultsInstructions")}),T&&!b&&e.jsxs(e.Fragment,{children:[H&&e.jsx(fs,{policyProviders:x?.filter(S=>S.type!=="aggregate"),onSelect:S=>l(Zt({id:s,realm:o,policyType:S.type})),toggleDialog:k}),e.jsx(Ee,{message:n("emptyPolicies"),instructions:n("emptyPoliciesInstructions"),primaryActionText:n("createPolicy"),onPrimaryAction:k})]})]})};const Na=({id:s,clientId:n,uris:a})=>{const{adminClient:t}=Z(),{realm:i}=he(),[o,l]=c.useState(),[r,p]=c.useState();return oe(()=>Promise.all([t.clients.listScopesByResource({id:n,resourceName:s}),t.clients.listPermissionsByResource({id:n,resourceId:s})]),([h,m])=>{l(h),p(m)},[]),!r||!o?e.jsx(Ae,{}):e.jsxs(rt,{isHorizontal:!0,className:"keycloak_resource_details",children:[e.jsx(Oa,{name:"uris",array:a}),e.jsx($e,{name:"scopes",array:o,convert:h=>h.name,link:h=>Os({id:n,realm:i,scopeId:h.id})}),e.jsx($e,{name:"associatedPermissions",array:r,convert:h=>h.name,link:h=>gt({id:n,realm:i,permissionId:h.id,permissionType:"resource"})})]})},Fa=({row:s})=>e.jsxs(e.Fragment,{children:[s.uris?.[0]," ",e.jsx(Qt,{array:s.uris})]}),Ka=({clientId:s})=>{const{t:n}=E("clients"),a=nt(),{adminClient:t}=Z(),{addAlert:i,addError:o}=re(),{realm:l}=he(),[r,p]=c.useState(),[h,m]=c.useState(),[x,u]=c.useState(),[d,C]=c.useState(0),j=()=>C(d+1),[y,A]=c.useState(10),[I,_]=c.useState(0),[U,X]=c.useState({});oe(()=>{const b={first:I,max:y+1,deep:!1,...U};return t.clients.listResources({...b,id:s})},b=>p(b.map(S=>({...S,isExpanded:!1}))),[d,U,I,y]);const H=async b=>t.clients.listPermissionsByResource({id:s,resourceId:b}),[k,L]=Ce({titleKey:"clients:deleteResource",children:e.jsxs(e.Fragment,{children:[n("deleteResourceConfirm"),x?.length&&e.jsx(at,{variant:"warning",isInline:!0,isPlain:!0,title:n("deleteResourceWarning"),className:"pf-u-pt-lg",children:e.jsx("p",{className:"pf-u-pt-xs",children:x.map(b=>e.jsx("strong",{className:"pf-u-pr-md",children:b.name},b.id))})})]}),continueButtonLabel:"clients:confirm",onConfirm:async()=>{try{await t.clients.delResource({id:s,resourceId:h?._id}),i(n("resourceDeletedSuccess"),te.success),j()}catch(b){o("clients:resourceDeletedError",b)}}});if(!r)return e.jsx(Ae,{});const D=r.length===0,T=Object.keys(U).length!==0;return e.jsxs(xe,{variant:"light",className:"pf-u-p-0",children:[e.jsx(L,{}),(!D||T)&&e.jsx(Tt,{count:r.length,first:I,max:y,onNextClick:_,onPreviousClick:_,onPerPageSelect:(b,S)=>{_(b),A(S)},toolbarItem:e.jsxs(e.Fragment,{children:[e.jsx(je,{children:e.jsx(Jt,{search:U,onSearch:X,isResource:!0})}),e.jsx(je,{children:e.jsx(w,{"data-testid":"createResource",component:b=>e.jsx(ge,{...b,to:es({realm:l,id:s})}),children:n("createResource")})})]}),children:!D&&e.jsxs(Ve,{"aria-label":n("resources"),variant:"compact",children:[e.jsx(ze,{children:e.jsxs(le,{children:[e.jsx(z,{}),e.jsx(z,{children:n("common:name")}),e.jsx(z,{children:n("displayName")}),e.jsx(z,{children:n("common:type")}),e.jsx(z,{children:n("owner")}),e.jsx(z,{children:n("uris")}),e.jsx(z,{}),e.jsx(z,{})]})}),r.map((b,S)=>e.jsxs(Ue,{isExpanded:b.isExpanded,children:[e.jsxs(le,{children:[e.jsx(F,{expand:{rowIndex:S,isExpanded:b.isExpanded,onToggle:(B,P)=>{const se=r.map((v,V)=>V===P?{...v,isExpanded:!v.isExpanded}:v);p(se)}}}),e.jsx(F,{"data-testid":`name-column-${b.name}`,children:e.jsx(ge,{to:ws({realm:l,id:s,resourceId:b._id}),children:b.name})}),e.jsx(F,{children:b.displayName}),e.jsx(F,{children:b.type}),e.jsx(F,{children:b.owner?.name}),e.jsx(F,{children:e.jsx(Fa,{row:b})}),e.jsx(F,{width:10,children:e.jsx(w,{variant:"link",component:B=>e.jsx(ge,{...B,to:ht({realm:l,id:s,permissionType:"resource",selectedId:b._id})}),children:n("createPermission")})}),e.jsx(F,{actions:{items:[{title:n("common:delete"),onClick:async()=>{m(b),u(await H(b._id)),k()}}]}})]}),e.jsxs(le,{isExpanded:b.isExpanded,children:[e.jsx(F,{}),e.jsx(F,{colSpan:4,children:e.jsx(ot,{children:b.isExpanded&&e.jsx(Na,{clientId:s,id:b._id,uris:b.uris})})})]},`child-${b._id}`)]},b._id))]})}),D&&T&&e.jsx(Ee,{isSearchVariant:!0,message:n("common:noSearchResults"),instructions:n("common:noSearchResultsInstructions")}),D&&!T&&e.jsx(Ee,{message:n("emptyResources"),instructions:n("emptyResourcesInstructions"),primaryActionText:n("createResource"),onPrimaryAction:()=>a(es({realm:l,id:s}))})]})},Ma=({clientId:s})=>{const{t:n}=E("clients"),a=nt(),{adminClient:t}=Z(),{realm:i}=he(),[o,l]=be(),[r,p]=c.useState(),[h,m]=c.useState(),[x,u]=c.useState([]),[d,C]=c.useState(0),j=()=>C(d+1),[y,A]=c.useState(10),[I,_]=c.useState(0),[U,X]=c.useState("");oe(()=>{const T={first:I,max:y+1,deep:!1,name:U};return t.clients.listAllScopes({...T,id:s})},T=>{p(T.map(b=>({...b,isLoaded:!1}))),u(T.map(b=>({id:b.id,isExpanded:!1})))},[d,U,I,y]);const H=T=>r?.find(b=>b.id===T),k=T=>x.find(b=>b.id===T)?.isExpanded||!1;if(oe(()=>{const T=x.filter(b=>b.isExpanded).map(({id:b})=>H(b)).filter(b=>!b.isLoaded);return Promise.all(T.map(async b=>{const[S,B]=await Promise.all([t.clients.listAllResourcesByScope({id:s,scopeId:b.id}),t.clients.listAllPermissionsByScope({id:s,scopeId:b.id})]);return{...b,resources:S,permissions:B,isLoaded:!0}}))},T=>{let b=[...r||[]];T.forEach(S=>{const B=r?.findIndex(P=>S.id===P.id);b=[...b.slice(0,B),S,...b.slice(B+1)]}),p(b)},[x]),!r)return e.jsx(Ae,{});const L=r.length===0,D=U!=="";return e.jsxs(xe,{variant:"light",className:"pf-u-p-0",children:[e.jsx(Gn,{clientId:s,open:o,toggleDialog:l,selectedScope:h,refresh:j}),(!L||D)&&e.jsx(Tt,{count:r.length,first:I,max:y,onNextClick:_,onPreviousClick:_,onPerPageSelect:(T,b)=>{_(T),A(b)},inputGroupName:"search",inputGroupPlaceholder:n("searchByName"),inputGroupOnEnter:X,toolbarItem:e.jsx(je,{children:e.jsx(w,{"data-testid":"createAuthorizationScope",component:T=>e.jsx(ge,{...T,to:ts({realm:i,id:s})}),children:n("createAuthorizationScope")})}),children:!L&&e.jsxs(Ve,{"aria-label":n("scopes"),variant:"compact",children:[e.jsx(ze,{children:e.jsxs(le,{children:[e.jsx(z,{}),e.jsx(z,{children:n("common:name")}),e.jsx(z,{children:n("displayName")}),e.jsx(z,{}),e.jsx(z,{})]})}),r.map((T,b)=>e.jsxs(Ue,{isExpanded:k(T.id),children:[e.jsxs(le,{children:[e.jsx(F,{expand:{rowIndex:b,isExpanded:k(T.id),onToggle:(S,B,P)=>{u([...x.slice(0,B),{id:T.id,isExpanded:P},...x.slice(B+1)])}}}),e.jsx(F,{"data-testid":`name-column-${T.name}`,children:e.jsx(ge,{to:Os({realm:i,id:s,scopeId:T.id}),children:T.name})}),e.jsx(F,{children:T.displayName}),e.jsx(F,{width:10,children:e.jsx(w,{variant:"link",component:S=>e.jsx(ge,{...S,to:ht({realm:i,id:s,permissionType:"scope",selectedId:T.id})}),children:n("createPermission")})}),e.jsx(F,{isActionCell:!0,actions:{items:[{title:n("common:delete"),onClick:()=>{m(T),l()}}]}})]}),e.jsxs(le,{isExpanded:k(T.id),children:[e.jsx(F,{}),e.jsx(F,{colSpan:4,children:e.jsx(ot,{children:k(T.id)&&T.isLoaded?e.jsxs(rt,{isHorizontal:!0,className:"keycloak_resource_details",children:[e.jsx($e,{name:"resources",array:T.resources,convert:S=>S.name,link:S=>ws({id:s,realm:i,resourceId:S._id})}),e.jsx($e,{name:"associatedPermissions",array:T.permissions,convert:S=>S.name,link:S=>gt({id:s,realm:i,permissionId:S.id,permissionType:S.type})})]}):e.jsx(Ae,{})})})]},`child-${T.id}`)]},T.id))]})}),L&&!D&&e.jsx(Ee,{message:n("emptyAuthorizationScopes"),instructions:n("emptyAuthorizationInstructions"),onPrimaryAction:()=>a(ts({id:s,realm:i})),primaryActionText:n("createAuthorizationScope")}),L&&D&&e.jsx(Ee,{isSearchVariant:!0,message:n("common:noSearchResults"),instructions:n("common:noSearchResultsInstructions")})]})},Yt=({name:s,save:n,reset:a,isActive:t=!0,...i})=>{const{t:o}=E("common");return e.jsxs(fe,{...i,children:[e.jsx(w,{isDisabled:!t,"data-testid":s+"Save",onClick:n,type:n?"button":"submit",children:o("save")}),e.jsx(w,{isDisabled:!t,"data-testid":s+"Revert",variant:"link",onClick:a,children:o("revert")})]})},Ba=({onConfirm:s,closeDialog:n})=>{const{t:a}=E("clients"),[t,i]=c.useState({});return e.jsxs(Be,{title:a("import"),isOpen:!0,variant:"small",onClose:n,actions:[e.jsx(w,{id:"modal-confirm",onClick:()=>{s(t),n()},"data-testid":"confirm",children:a("confirm")},"confirm"),e.jsx(w,{"data-testid":"cancel",id:"modal-cancel",variant:ye.link,onClick:()=>{n()},children:a("common:cancel")},"cancel")],children:[e.jsx(Te,{children:e.jsx(Hn,{id:"import-resource",onChange:i})}),Object.keys(t).length!==0&&e.jsxs(e.Fragment,{children:[e.jsx(He,{}),e.jsx("p",{className:"pf-u-my-lg",children:a("importResources")}),e.jsxs(Te,{isHorizontal:!0,children:[e.jsx(g,{label:a("policyEnforcementMode"),labelIcon:e.jsx(f,{helpText:a("clients-help:policyEnforcementMode"),fieldLabelId:"clients:policyEnforcementMode"}),fieldId:"policyEnforcementMode",hasNoPaddingTop:!0,children:e.jsx(xt,{id:"policyEnforcementMode",name:"policyEnforcementMode",label:a(`policyEnforcementModes.${t.policyEnforcementMode}`),isChecked:!0,isDisabled:!0,className:"pf-u-mb-md"})}),e.jsx(g,{label:a("decisionStrategy"),labelIcon:e.jsx(f,{helpText:a("clients-help:decisionStrategy"),fieldLabelId:"clients:decisionStrategy"}),fieldId:"decisionStrategy",hasNoPaddingTop:!0,children:e.jsx(xt,{id:"decisionStrategy",name:"decisionStrategy",isChecked:!0,isDisabled:!0,label:a(`decisionStrategies.${t.decisionStrategy}`),className:"pf-u-mb-md"})}),e.jsx(g,{hasNoPaddingTop:!0,label:a("allowRemoteResourceManagement"),fieldId:"allowRemoteResourceManagement",labelIcon:e.jsx(f,{helpText:a("allowRemoteResourceManagement"),fieldLabelId:"clients:allowRemoteResourceManagement"}),children:e.jsx(de,{id:"allowRemoteResourceManagement",label:a("common:on"),labelOff:a("common:off"),isChecked:t.allowRemoteResourceManagement,isDisabled:!0,"aria-label":a("allowRemoteResourceManagement")})})]}),e.jsx("div",{className:"pf-u-mt-md",children:Object.entries(t).filter(([,o])=>Array.isArray(o)).map(([o,l])=>e.jsxs(c.Fragment,{children:[e.jsx(He,{}),e.jsx("p",{className:"pf-u-my-sm",children:e.jsxs("strong",{children:[l.length," ",a(o)]})})]},o))}),e.jsx(He,{}),e.jsx(at,{variant:"warning",className:"pf-u-mt-lg",isInline:!0,title:a("importWarning")})]})]})},ys=["ENFORCING","PERMISSIVE","DISABLED"],Ua=({clientId:s})=>{const{t:n}=E("clients"),[a,t]=c.useState(),[i,o]=be(),l=Oe({}),{control:r,reset:p,handleSubmit:h}=l,{adminClient:m}=Z(),{addAlert:x,addError:u}=re();oe(()=>m.clients.getResourceServer({id:s}),j=>{t(j),p(j)},[]);const d=async j=>{try{await m.clients.importResource({id:s},j),x(n("importResourceSuccess"),te.success),p({...j})}catch(y){u("clients:importResourceError",y)}},C=async j=>{try{await m.clients.updateResourceServer({id:s},j),x(n("updateResourceSuccess"),te.success)}catch(y){u("clients:resourceSaveError",y)}};return a?e.jsxs(xe,{variant:"light",children:[i&&e.jsx(Ba,{onConfirm:d,closeDialog:o}),e.jsxs(ce,{role:"view-clients",isHorizontal:!0,onSubmit:h(C),children:[e.jsx(g,{label:n("import"),fieldId:"import",labelIcon:e.jsx(f,{helpText:n("clients-help:import"),fieldLabelId:"clients:import"}),children:e.jsx(w,{variant:"secondary",onClick:o,children:n("import")})}),e.jsx(He,{}),e.jsx(g,{label:n("policyEnforcementMode"),labelIcon:e.jsx(f,{helpText:n("clients-help:policyEnforcementMode"),fieldLabelId:"clients:policyEnforcementMode"}),fieldId:"policyEnforcementMode",hasNoPaddingTop:!0,children:e.jsx(N,{name:"policyEnforcementMode","data-testid":"policyEnforcementMode",defaultValue:ys[0],control:r,render:({field:j})=>e.jsx(e.Fragment,{children:ys.map(y=>e.jsx(xt,{id:y,"data-testid":y,isChecked:j.value===y,name:"policyEnforcementMode",onChange:()=>j.onChange(y),label:n(`policyEnforcementModes.${y}`),className:"pf-u-mb-md"},y))})})}),e.jsx(Le,{...l,children:e.jsx(Nn,{isLimited:!0})}),e.jsx(g,{hasNoPaddingTop:!0,label:n("allowRemoteResourceManagement"),fieldId:"allowRemoteResourceManagement",labelIcon:e.jsx(f,{helpText:n("clients-help:allowRemoteResourceManagement"),fieldLabelId:"clients:allowRemoteResourceManagement"}),children:e.jsx(N,{name:"allowRemoteResourceManagement","data-testid":"allowRemoteResourceManagement",defaultValue:!1,control:r,render:({field:j})=>e.jsx(de,{id:"allowRemoteResourceManagement",label:n("common:on"),labelOff:n("common:off"),isChecked:j.value,onChange:j.onChange,"aria-label":n("allowRemoteResourceManagement")})})}),e.jsx(Yt,{name:"authenticationSettings",reset:()=>p(a),isActive:!0})]})]}):e.jsx(Ae,{})},Va=({client:s})=>{const{adminClient:n}=Z(),{t:a}=E("sessions"),t=async(i,o)=>{const l=p=>h=>h.map(m=>({type:p,...m}));return(await Promise.all([n.clients.listSessions({id:s.id,first:i,max:o}).then(l(a("sessions:sessionsType.regularSSO"))),n.clients.listOfflineSessions({id:s.id,first:i,max:o}).then(l(a("sessions:sessionsType.offline")))])).flat()};return e.jsx(xe,{variant:"light",className:"pf-u-p-0",children:e.jsx($n,{loader:t,hiddenColumns:["clients"],emptyInstructions:a("noSessionsForClient")})})},Ke=({name:s,label:n})=>{const{t:a}=E("clients"),{control:t}=Q();return e.jsx(g,{hasNoPaddingTop:!0,label:a(n),fieldId:n,labelIcon:e.jsx(f,{helpText:a(`clients-help:${n}`),fieldLabelId:`clients:${n}`}),children:e.jsx(N,{name:s,defaultValue:"false",control:t,render:({field:i})=>e.jsx(de,{id:s,"data-testid":n,label:a("common:on"),labelOff:a("common:off"),isChecked:i.value==="true",onChange:o=>i.onChange(o.toString()),"aria-label":a(n)})})})},za=()=>{const{t:s}=E("clients"),{control:n}=Q(),[a,t]=c.useState(!1);return e.jsxs(ce,{isHorizontal:!0,role:"manage-clients",className:"keycloak__capability-config__form",children:[e.jsx(g,{label:s("nameIdFormat"),fieldId:"nameIdFormat",labelIcon:e.jsx(f,{helpText:s("clients-help:nameIdFormat"),fieldLabelId:"clients:nameIdFormat"}),children:e.jsx(N,{name:"attributes.saml_name_id_format",defaultValue:"username",control:n,render:({field:i})=>e.jsx(G,{toggleId:"samlNameIdFormat",onToggle:t,onSelect:(o,l)=>{i.onChange(l.toString()),t(!1)},selections:i.value,variant:q.single,"aria-label":s("nameIdFormat"),isOpen:a,children:["username","email","transient","persistent"].map(o=>e.jsx(M,{selected:o===i.value,value:o},o))})})}),e.jsx(Ke,{name:"attributes.saml_force_name_id_format",label:"forceNameIdFormat"}),e.jsx(Ke,{name:O("attributes.saml.force.post.binding"),label:"forcePostBinding"}),e.jsx(Ke,{name:O("attributes.saml.artifact.binding"),label:"forceArtifactBinding"}),e.jsx(Ke,{name:O("attributes.saml.authnstatement"),label:"includeAuthnStatement"}),e.jsx(Ke,{name:O("attributes.saml.onetimeuse.condition"),label:"includeOneTimeUseCondition"}),e.jsx(Ke,{name:O("attributes.saml.server.signature.keyinfo.ext"),label:"optimizeLookup"})]})},bs=["RSA_SHA1","RSA_SHA256","RSA_SHA256_MGF1","RSA_SHA512","RSA_SHA512_MGF1","DSA_SHA1"],Ss=["NONE","KEY_ID","CERT_SUBJECT"],wt=[{name:"EXCLUSIVE",value:"http://www.w3.org/2001/10/xml-exc-c14n#"},{name:"EXCLUSIVE_WITH_COMMENTS",value:"http://www.w3.org/2001/10/xml-exc-c14n#WithComments"},{name:"INCLUSIVE",value:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315"},{name:"INCLUSIVE_WITH_COMMENTS",value:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments"}],qa=()=>{const{t:s}=E("clients"),[n,a]=c.useState(!1),[t,i]=c.useState(!1),[o,l]=c.useState(!1),{control:r,watch:p}=Q(),h=p(O("attributes.saml.server.signature")),m=p(O("attributes.saml.assertion.signature"));return e.jsxs(ce,{isHorizontal:!0,role:"manage-clients",className:"keycloak__capability-config__form",children:[e.jsx(Ke,{name:O("attributes.saml.server.signature"),label:"signDocuments"}),e.jsx(Ke,{name:O("attributes.saml.assertion.signature"),label:"signAssertions"}),(h==="true"||m==="true")&&e.jsxs(e.Fragment,{children:[e.jsx(g,{label:s("signatureAlgorithm"),fieldId:"signatureAlgorithm",labelIcon:e.jsx(f,{helpText:s("clients-help:signatureAlgorithm"),fieldLabelId:"clients:signatureAlgorithm"}),children:e.jsx(N,{name:O("attributes.saml.signature.algorithm"),defaultValue:bs[0],control:r,render:({field:x})=>e.jsx(G,{toggleId:"signatureAlgorithm",onToggle:a,onSelect:(u,d)=>{x.onChange(d.toString()),a(!1)},selections:x.value,variant:q.single,"aria-label":s("signatureAlgorithm"),isOpen:n,children:bs.map(u=>e.jsx(M,{selected:u===x.value,value:u},u))})})}),e.jsx(g,{label:s("signatureKeyName"),fieldId:"signatureKeyName",labelIcon:e.jsx(f,{helpText:s("clients-help:signatureKeyName"),fieldLabelId:"clients:signatureKeyName"}),children:e.jsx(N,{name:O("attributes.saml.server.signature.keyinfo.xmlSigKeyInfoKeyNameTransformer"),defaultValue:Ss[0],control:r,render:({field:x})=>e.jsx(G,{toggleId:"signatureKeyName",onToggle:i,onSelect:(u,d)=>{x.onChange(d.toString()),i(!1)},selections:x.value,variant:q.single,"aria-label":s("signatureKeyName"),isOpen:t,children:Ss.map(u=>e.jsx(M,{selected:u===x.value,value:u},u))})})}),e.jsx(g,{label:s("canonicalization"),fieldId:"canonicalization",labelIcon:e.jsx(f,{helpText:s("clients-help:canonicalization"),fieldLabelId:"clients:canonicalization"}),children:e.jsx(N,{name:"attributes.saml_signature_canonicalization_method",defaultValue:wt[0].value,control:r,render:({field:x})=>e.jsx(G,{toggleId:"canonicalization",onToggle:l,onSelect:(u,d)=>{x.onChange(d.toString()),l(!1)},selections:wt.find(u=>u.value===x.value)?.name,variant:q.single,"aria-label":s("canonicalization"),isOpen:o,children:wt.map(u=>e.jsx(M,{selected:u.value===x.value,value:u.value,children:u.name},u.name))})})})]})]})},Ga=({client:s,save:n,reset:a})=>{const{t}=E("clients"),{register:i,watch:o}=Q(),{hasAccess:l}=_e(),r=l("manage-clients")||s.access?.configure,p=o("protocol");return e.jsxs(ce,{isHorizontal:!0,fineGrainedAccess:s.access?.configure,role:"manage-clients",children:[!s.bearerOnly&&e.jsx(Qn,{protocol:p}),p!=="saml"&&e.jsx(g,{label:t("adminURL"),fieldId:"kc-admin-url",labelIcon:e.jsx(f,{helpText:t("clients-help:adminURL"),fieldLabelId:"clients:adminURL"}),children:e.jsx(Y,{id:"kc-admin-url",type:"url",...i("adminUrl")})}),s.bearerOnly&&e.jsx(Yt,{className:"keycloak__form_actions",name:"settings",save:n,reset:a,isActive:!r})]})},Ha=({access:s})=>{const{t:n}=E("clients"),{register:a,control:t,watch:i}=Q(),[o,l]=c.useState(!1),r=Me().themes.login,p=i("consentRequired"),h=i(O("attributes.display.on.consent.screen"));return e.jsxs(ce,{isHorizontal:!0,fineGrainedAccess:s,role:"manage-clients",children:[e.jsx(g,{label:n("loginTheme"),labelIcon:e.jsx(f,{helpText:n("clients-help:loginTheme"),fieldLabelId:"clients:loginTheme"}),fieldId:"loginTheme",children:e.jsx(N,{name:"attributes.login_theme",defaultValue:"",control:t,render:({field:m})=>e.jsx(G,{toggleId:"loginTheme",onToggle:l,onSelect:(x,u)=>{m.onChange(u.toString()),l(!1)},selections:m.value||n("common:choose"),variant:q.single,"aria-label":n("loginTheme"),isOpen:o,children:[e.jsx(M,{value:"",children:n("common:choose")},"empty"),...r.map(x=>e.jsx(M,{selected:x.name===m.value,value:x.name},x.name))]})})}),e.jsx(g,{label:n("consentRequired"),labelIcon:e.jsx(f,{helpText:n("clients-help:consentRequired"),fieldLabelId:"clients:consentRequired"}),fieldId:"kc-consent",hasNoPaddingTop:!0,children:e.jsx(N,{name:"consentRequired",defaultValue:!1,control:t,render:({field:m})=>e.jsx(de,{id:"kc-consent-switch",label:n("common:on"),labelOff:n("common:off"),isChecked:m.value,onChange:m.onChange,"aria-label":n("consentRequired")})})}),e.jsx(g,{label:n("displayOnClient"),labelIcon:e.jsx(f,{helpText:n("clients-help:displayOnClient"),fieldLabelId:"clients:displayOnClient"}),fieldId:"kc-display-on-client",hasNoPaddingTop:!0,children:e.jsx(N,{name:O("attributes.display.on.consent.screen"),defaultValue:!1,control:t,render:({field:m})=>e.jsx(de,{id:"kc-display-on-client-switch",label:n("common:on"),labelOff:n("common:off"),isChecked:m.value==="true",onChange:x=>m.onChange(""+x),isDisabled:!p,"aria-label":n("displayOnClient")})})}),e.jsx(g,{label:n("consentScreenText"),labelIcon:e.jsx(f,{helpText:n("clients-help:consentScreenText"),fieldLabelId:"clients:consentScreenText"}),fieldId:"kc-consent-screen-text",children:e.jsx(it,{id:"kc-consent-screen-text",...a(O("attributes.consent.screen.text")),isDisabled:!(p&&h==="true")})})]})},$a=({save:s,reset:n,client:{access:a}})=>{const{t}=E("clients"),{register:i,control:o,watch:l,formState:{errors:r}}=Q(),{hasAccess:p}=_e(),h=p("manage-clients")||a?.configure,m=l("protocol"),x=l("frontchannelLogout");return e.jsxs(ce,{isHorizontal:!0,fineGrainedAccess:a?.configure,role:"manage-clients",children:[e.jsx(g,{label:t("frontchannelLogout"),labelIcon:e.jsx(f,{helpText:t("clients-help:frontchannelLogout"),fieldLabelId:"clients:frontchannelLogout"}),fieldId:"kc-frontchannelLogout",hasNoPaddingTop:!0,children:e.jsx(N,{name:"frontchannelLogout",defaultValue:!0,control:o,render:({field:u})=>e.jsx(de,{id:"kc-frontchannelLogout-switch",label:t("common:on"),labelOff:t("common:off"),isChecked:u.value,onChange:u.onChange,"aria-label":t("frontchannelLogout")})})}),m==="openid-connect"&&x&&e.jsx(g,{label:t("frontchannelLogoutUrl"),fieldId:"frontchannelLogoutUrl",labelIcon:e.jsx(f,{helpText:t("clients-help:frontchannelLogoutUrl"),fieldLabelId:"clients:frontchannelLogoutUrl"}),helperTextInvalid:r.attributes?.[Fe("frontchannel.logout.url")]?.message,validated:r.attributes?.[Fe("frontchannel.logout.url")]?.message?Se.error:Se.default,children:e.jsx(Y,{id:"frontchannelLogoutUrl",type:"url",...i(O("attributes.frontchannel.logout.url"),{validate:u=>(u.startsWith("https://")||u.startsWith("http://"))&&!u.includes("*")||u===""||t("frontchannelUrlInvalid").toString()}),validated:r.attributes?.[Fe("frontchannel.logout.url")]?.message?Se.error:Se.default})}),m==="openid-connect"&&e.jsxs(e.Fragment,{children:[e.jsx(g,{label:t("backchannelLogoutUrl"),fieldId:"backchannelLogoutUrl",labelIcon:e.jsx(f,{helpText:t("clients-help:backchannelLogoutUrl"),fieldLabelId:"clients:backchannelLogoutUrl"}),helperTextInvalid:r.attributes?.[Fe("backchannel.logout.url")]?.message,validated:r.attributes?.[Fe("backchannel.logout.url")]?.message?Se.error:Se.default,children:e.jsx(Y,{id:"backchannelLogoutUrl",type:"url",...i(O("attributes.backchannel.logout.url"),{validate:u=>(u.startsWith("https://")||u.startsWith("http://"))&&!u.includes("*")||u===""||t("backchannelUrlInvalid").toString()}),validated:r.attributes?.[Fe("backchannel.logout.url")]?.message?Se.error:Se.default})}),e.jsx(g,{label:t("backchannelLogoutSessionRequired"),labelIcon:e.jsx(f,{helpText:t("clients-help:backchannelLogoutSessionRequired"),fieldLabelId:"clients:backchannelLogoutSessionRequired"}),fieldId:"backchannelLogoutSessionRequired",hasNoPaddingTop:!0,children:e.jsx(N,{name:O("attributes.backchannel.logout.session.required"),defaultValue:"true",control:o,render:({field:u})=>e.jsx(de,{id:"backchannelLogoutSessionRequired",label:t("common:on"),labelOff:t("common:off"),isChecked:u.value==="true",onChange:d=>u.onChange(d.toString()),"aria-label":t("backchannelLogoutSessionRequired")})})}),e.jsx(g,{label:t("backchannelLogoutRevokeOfflineSessions"),labelIcon:e.jsx(f,{helpText:t("clients-help:backchannelLogoutRevokeOfflineSessions"),fieldLabelId:"clients:backchannelLogoutRevokeOfflineSessions"}),fieldId:"backchannelLogoutRevokeOfflineSessions",hasNoPaddingTop:!0,children:e.jsx(N,{name:O("attributes.backchannel.logout.revoke.offline.tokens"),defaultValue:"false",control:o,render:({field:u})=>e.jsx(de,{id:"backchannelLogoutRevokeOfflineSessions",label:t("common:on"),labelOff:t("common:off"),isChecked:u.value==="true",onChange:d=>u.onChange(d.toString()),"aria-label":t("backchannelLogoutRevokeOfflineSessions")})})})]}),e.jsx(Yt,{className:"keycloak__form_actions",name:"settings",save:s,reset:n,isActive:h})]})},Wa=s=>{const{t:n}=E("clients"),{watch:a}=Q(),t=a("protocol"),{client:i}=s;return e.jsx(Ls,{className:"pf-u-px-lg pf-u-pb-lg",sections:[{title:n("generalSettings"),panel:e.jsx(Te,{isHorizontal:!0,children:e.jsx(Wn,{protocol:i.protocol,hasConfigureAccess:i.access?.configure})})},{title:n("accessSettings"),panel:e.jsx(Ga,{...s})},{title:n("samlCapabilityConfig"),isHidden:t!=="saml"||i.bearerOnly,panel:e.jsx(za,{})},{title:n("signatureAndEncryption"),isHidden:t!=="saml"||i.bearerOnly,panel:e.jsx(qa,{})},{title:n("capabilityConfig"),isHidden:t!=="openid-connect"||i.bearerOnly,panel:e.jsx(Jn,{})},{title:n("loginSettings"),isHidden:i.bearerOnly,panel:e.jsx(Ha,{access:i.access?.configure})},{title:n("logoutSettings"),isHidden:i.bearerOnly,panel:e.jsx($a,{...s})}]})},en=({id:s,label:n,text:a,variant:t="plain"})=>{const{t:i}=E("clients"),o=gn(),[l,r]=c.useState(0),p=c.useMemo(()=>{switch(l){case 0:return i("copyToClipboard");case 1:return i("copySuccess");case 2:return i("clipboardCopyError")}},[l]);c.useEffect(()=>{if(l!==0)return o(()=>r(0),1e3)},[l]);const h=async m=>{try{await navigator.clipboard.writeText(m),r(1)}catch{r(2)}};return e.jsx(Rn,{id:`copy-button-${s}`,textId:n,"aria-label":i("copyToClipboard"),onClick:()=>h(a),exitDelay:600,variant:t,children:p})},vs=({id:s,buttonLabel:n,client:a,secret:t,toggle:i})=>{const{t:o}=E("clients"),l=Q(),{hasAccess:r}=_e(),p=r("manage-clients")||a.access?.configure;return e.jsxs(st,{hasGutter:!0,children:[e.jsx(ve,{isFilled:!0,children:e.jsxs(Bt,{children:[e.jsx(Ft,{id:s,value:t,isReadOnly:!0}),e.jsx(en,{id:s,text:t,label:"clientSecret",variant:"control"})]})}),e.jsx(ve,{children:e.jsx(w,{variant:"secondary",isDisabled:l.formState.isDirty||!p,onClick:i,children:o(n)})})]})},Cs=({time:s})=>{const{t:n}=E("clients"),a=Wt(),t=i=>i?n("secretExpiresOn",{time:a(new Date(i*1e3),{dateStyle:"full",timeStyle:"long"})}):void 0;return e.jsx("div",{className:"pf-u-my-md",children:t(s)})},Ja=({client:s,secret:n,toggle:a})=>{const{t}=E("clients"),{adminClient:i}=Z(),{addAlert:o,addError:l}=re(),[r,p]=c.useState(s.attributes?.["client.secret.rotated"]),h=s.attributes?.["client.secret.expiration.time"],m=s.attributes?.["client.secret.rotated.expiration.time"],x=C=>new Date().getTime()>=C*1e3,[u,d]=Ce({titleKey:"clients:invalidateRotatedSecret",messageKey:"clients:invalidateRotatedSecretExplain",continueButtonLabel:"common:confirm",onConfirm:async()=>{try{await i.clients.invalidateSecret({id:s.id}),p(void 0),o(t("invalidateRotatedSuccess"))}catch(C){l("clients:invalidateRotatedError",C)}}});return e.jsxs(e.Fragment,{children:[e.jsx(d,{}),e.jsxs(g,{label:t("clientSecret"),fieldId:"kc-client-secret",className:"pf-u-my-md",children:[e.jsx(vs,{id:"kc-client-secret",client:s,secret:n,toggle:a,buttonLabel:"regenerate"}),e.jsx(Cs,{time:h}),x(h)&&e.jsx(at,{variant:"warning",isInline:!0,title:t("secretHasExpired")})]}),r&&e.jsxs(g,{label:t("secretRotated"),fieldId:"secretRotated",children:[e.jsx(vs,{id:"secretRotated",client:s,secret:r,toggle:u,buttonLabel:"invalidateSecret"}),e.jsx(Cs,{time:m})]})]})},Qa=()=>{const{control:s}=Q(),n=we(Me().providers.clientSignature.providers),{t:a}=E("clients"),[t,i]=c.useState(!1);return e.jsx(g,{label:a("signatureAlgorithm"),fieldId:"kc-signature-algorithm",labelIcon:e.jsx(f,{helpText:a("clients-help:signature-algorithm"),fieldLabelId:"clients:signatureAlgorithm"}),children:e.jsx(N,{name:O("attributes.token.endpoint.auth.signing.alg"),defaultValue:"",control:s,render:({field:o})=>e.jsxs(G,{maxHeight:200,toggleId:"kc-signature-algorithm",onToggle:i,onSelect:(l,r)=>{o.onChange(r.toString()),i(!1)},selections:o.value||a("anyAlgorithm"),variant:q.single,"aria-label":a("signatureAlgorithm"),isOpen:t,children:[e.jsx(M,{selected:o.value==="",value:"",children:a("anyAlgorithm")},"any"),e.jsx(e.Fragment,{children:n.map(l=>e.jsx(M,{selected:l===o.value,value:l},l))})]})})})},Ya=()=>{const{t:s}=E("clients"),{register:n,control:a,formState:{errors:t}}=Q();return e.jsxs(e.Fragment,{children:[e.jsx(g,{label:s("allowRegexComparison"),labelIcon:e.jsx(f,{helpText:s("clients-help:allowRegexComparison"),fieldLabelId:"clients:allowRegexComparison"}),fieldId:"allowRegexComparison",hasNoPaddingTop:!0,children:e.jsx(N,{name:O("attributes.x509.allow.regex.pattern.comparison"),defaultValue:"false",control:a,render:({field:i})=>e.jsx(de,{id:"allowRegexComparison",label:s("common:on"),labelOff:s("common:off"),isChecked:i.value==="true",onChange:o=>i.onChange(o.toString()),"aria-label":s("allowRegexComparison")})})}),e.jsx(g,{label:s("subject"),fieldId:"kc-subject",labelIcon:e.jsx(f,{helpText:s("clients-help:subject"),fieldLabelId:"clients:subject"}),helperTextInvalid:s("common:required"),validated:t.attributes?.[Fe("x509.subjectdn")]?Se.error:Se.default,isRequired:!0,children:e.jsx(Y,{type:"text",id:"kc-subject",validated:t.attributes?.[Fe("x509.subjectdn")]?Se.error:Se.default,...n(O("attributes.x509.subjectdn"),{required:!0})})})]})};const Xa=({client:s,save:n,refresh:a})=>{const{t}=E("clients"),{adminClient:i}=Z(),{addAlert:o,addError:l}=re(),r=s.id,[p,h]=c.useState([]),{control:m,formState:{isDirty:x},handleSubmit:u}=Q(),d=et({control:m,name:"clientAuthenticatorType",defaultValue:""}),[C,j]=c.useState(""),[y,A]=c.useState(""),[I,_]=c.useState(!1);oe(()=>Promise.all([i.authenticationManagement.getClientAuthenticatorProviders(),i.clients.getClientSecret({id:r})]),([b,S])=>{h(b),j(S.value)},[]);async function U(b,S){try{const B=await b(r);return o(t(`${S}Success`),te.success),B}catch(B){l(`clients:${S}Error`,B)}}const X=async()=>{const b=await U(S=>i.clients.generateNewClientSecret({id:S}),"clientSecret");j(b?.value||""),a()},[H,k]=Ce({titleKey:"clients:confirmClientSecretTitle",messageKey:"clients:confirmClientSecretBody",continueButtonLabel:"common:yes",cancelButtonLabel:"common:no",onConfirm:X}),L=async()=>{const b=await U(S=>i.clients.generateRegistrationAccessToken({id:S}),"accessToken");A(b?.registrationAccessToken||"")},[D,T]=Ce({titleKey:"clients:confirmAccessTokenTitle",messageKey:"clients:confirmAccessTokenBody",continueButtonLabel:"common:yes",cancelButtonLabel:"common:no",onConfirm:L});return e.jsx(xe,{children:e.jsxs(ce,{onSubmit:u(n),isHorizontal:!0,className:"pf-u-mt-md",role:"manage-clients",fineGrainedAccess:s.access?.configure,children:[e.jsx(k,{}),e.jsx(T,{}),e.jsxs(St,{isFlat:!0,children:[e.jsxs(Xe,{children:[e.jsx(g,{label:t("clientAuthenticator"),fieldId:"kc-client-authenticator-type",labelIcon:e.jsx(f,{helpText:t("clients-help:client-authenticator-type"),fieldLabelId:"clients:clientAuthenticator"}),children:e.jsx(N,{name:"clientAuthenticatorType",control:m,defaultValue:"",render:({field:b})=>e.jsx(G,{toggleId:"kc-client-authenticator-type",required:!0,onToggle:_,onSelect:(S,B)=>{b.onChange(B),_(!1)},selections:b.value,variant:q.single,"aria-label":t("clientAuthenticator"),isOpen:I,children:p.map(S=>e.jsx(M,{selected:S.id===b.value,value:S.id,children:S.displayName},S.id))})})}),(d==="client-jwt"||d==="client-secret-jwt")&&e.jsx(Qa,{}),d==="client-jwt"&&e.jsx(at,{variant:"info",isInline:!0,className:"kc-signedJWTAlert",title:t("signedJWTConfirm")}),d==="client-x509"&&e.jsx(Ya,{}),e.jsx(fe,{children:e.jsx(w,{variant:"primary",type:"submit",isDisabled:!x,children:t("common:save")})})]}),(d==="client-secret"||d==="client-secret-jwt")&&e.jsx(He,{}),(d==="client-secret"||d==="client-secret-jwt")&&e.jsx(Xe,{children:e.jsx(Ja,{client:s,secret:C,toggle:H})})]}),e.jsx(St,{isFlat:!0,children:e.jsx(Xe,{children:e.jsx(g,{label:t("registrationAccessToken"),fieldId:"kc-access-token",labelIcon:e.jsx(f,{helpText:t("clients-help:registration-access-token"),fieldLabelId:"clients:registrationAccessToken"}),children:e.jsxs(st,{hasGutter:!0,children:[e.jsx(ve,{isFilled:!0,children:e.jsx(_s,{id:"kc-access-token",isReadOnly:!0,children:y})}),e.jsx(ve,{children:e.jsx(w,{variant:"secondary",onClick:D,children:t("regenerate")})})]})})})})]})})},Ts=({id:s,keyInfo:n})=>{const{t:a}=E("clients");return e.jsx(it,{readOnly:!0,rows:5,id:s,"data-testid":"certificate",value:n?.certificate,"aria-label":a("certificate")})},Xt=({keyInfo:s,plain:n=!1})=>{const{t:a}=E("clients"),t=c.useId();return n?e.jsx(Ts,{id:t,keyInfo:s}):e.jsx(g,{label:a("certificate"),fieldId:t,labelIcon:e.jsx(f,{helpText:a("clients-help:certificate"),fieldLabelId:`clients:${t}`}),children:e.jsx(Ts,{id:t,keyInfo:s})})},tn=({hidePassword:s=!1,isSaml:n=!1})=>{const{t:a}=E("clients"),{register:t,formState:{errors:i}}=Q();return e.jsxs(e.Fragment,{children:[e.jsx(g,{label:a("keyAlias"),fieldId:"keyAlias",isRequired:!0,labelIcon:e.jsx(f,{helpText:a("clients-help:keyAlias"),fieldLabelId:"clients:keyAlias"}),helperTextInvalid:a("common:required"),validated:i.keyAlias?"error":"default",children:e.jsx(Y,{"data-testid":"keyAlias",id:"keyAlias",validated:i.keyAlias?"error":"default",...t("keyAlias",{required:!0})})}),!s&&e.jsx(g,{label:a("keyPassword"),fieldId:"keyPassword",isRequired:!0,labelIcon:e.jsx(f,{helpText:a("clients-help:keyPassword"),fieldLabelId:"clients:keyPassword"}),helperTextInvalid:a("common:required"),validated:i.keyPassword?"error":"default",children:e.jsx(Ft,{"data-testid":"keyPassword",id:"keyPassword",validated:i.keyPassword?"error":"default",...t("keyPassword",{required:!0})})}),n&&e.jsx(g,{label:a("realmCertificateAlias"),fieldId:"realmCertificateAlias",labelIcon:e.jsx(f,{helpText:a("clients-help:realmCertificateAlias"),fieldLabelId:"clients:realmCertificateAlias"}),children:e.jsx(Y,{"data-testid":"realmCertificateAlias",id:"realmCertificateAlias",...t("realmAlias")})}),e.jsx(g,{label:a("storePassword"),fieldId:"storePassword",isRequired:!0,labelIcon:e.jsx(f,{helpText:a("clients-help:storePassword"),fieldLabelId:"clients:storePassword"}),helperTextInvalid:a("common:required"),validated:i.storePassword?"error":"default",children:e.jsx(Ft,{"data-testid":"storePassword",id:"storePassword",validated:i.storePassword?"error":"default",...t("storePassword",{required:!0})})})]})},Is="Certificate PEM",Za=new Map([["PKCS12","p12"],["JKS","jks"],["BCFKS","bcfks"]]),sn=s=>Za.get(s),kt=({isSaml:s=!1,hasPem:n=!1,useFile:a=!1})=>{const{t}=E("clients"),[i,o]=c.useState(),[l,r]=c.useState(!1),{control:p,watch:h}=Q(),m=h("format"),{cryptoInfo:x}=Me(),u=[...x?.supportedKeystoreTypes??[],...n?Is:[]];return e.jsxs(Te,{className:"pf-u-pt-lg",children:[e.jsx(g,{label:t("archiveFormat"),labelIcon:e.jsx(f,{helpText:t("clients-help:archiveFormat"),fieldLabelId:"clients:archiveFormat"}),fieldId:"archiveFormat",children:e.jsx(N,{name:"format",defaultValue:u[0],control:p,render:({field:d})=>e.jsx(G,{toggleId:"archiveFormat",onToggle:r,onSelect:(C,j)=>{d.onChange(j.toString()),r(!1)},selections:d.value,variant:q.single,"aria-label":t("archiveFormat"),isOpen:l,children:u.map(C=>e.jsx(M,{selected:C===d.value,value:C},C))})})}),a&&e.jsx(g,{label:t("importFile"),labelIcon:e.jsx(f,{helpText:t("clients-help:importFile"),fieldLabelId:"clients:importFile"}),fieldId:"importFile",children:e.jsx(N,{name:"file",defaultValue:"",control:p,render:({field:d})=>e.jsx($s,{id:"importFile",value:d.value,filename:i,browseButtonText:t("browse"),onChange:(C,j)=>{o(j),d.onChange(C)}})})}),m!==Is&&e.jsx(tn,{hidePassword:a,isSaml:s})]})},ei=({clientId:s,save:n,toggleDialog:a})=>{const{t}=E("clients"),i=Oe({defaultValues:{keyAlias:s},mode:"onChange"}),{handleSubmit:o,formState:{isValid:l}}=i;return e.jsxs(Be,{variant:lt.medium,title:t("generateKeys"),isOpen:!0,onClose:a,actions:[e.jsx(w,{id:"modal-confirm","data-testid":"confirm",isDisabled:!l,onClick:()=>{o(r=>{n(r),a()})()},children:t("generate")},"confirm"),e.jsx(w,{id:"modal-cancel","data-testid":"cancel",variant:ye.link,onClick:()=>{a()},children:t("common:cancel")},"cancel")],children:[e.jsx(Pe,{children:e.jsx(me,{children:t("clients-help:generateKeysDescription")})}),e.jsx(Le,{...i,children:e.jsx(kt,{})})]})},ti=({save:s,toggleDialog:n})=>{const{t:a}=E("clients"),t=Oe(),{control:i,handleSubmit:o}=t,[l,r]=c.useState(!1),p=Me().cryptoInfo?.supportedKeystoreTypes??[],h=p.concat(["Certificate PEM","Public Key PEM","JSON Web Key Set"]),m=et({control:i,name:"keystoreFormat",defaultValue:h[0]});return e.jsxs(Be,{variant:lt.medium,title:a("generateKeys"),isOpen:!0,onClose:n,actions:[e.jsx(w,{id:"modal-confirm","data-testid":"confirm",onClick:()=>{o(x=>{s(x),n()})()},children:a("import")},"confirm"),e.jsx(w,{id:"modal-cancel","data-testid":"cancel",variant:ye.link,onClick:()=>{n()},children:a("common:cancel")},"cancel")],children:[e.jsx(Pe,{children:e.jsx(me,{children:a("clients-help:generateKeysDescription")})}),e.jsxs(Te,{className:"pf-u-pt-lg",children:[e.jsx(g,{label:a("archiveFormat"),labelIcon:e.jsx(f,{helpText:a("clients-help:archiveFormat"),fieldLabelId:"clients:archiveFormat"}),fieldId:"archiveFormat",children:e.jsx(N,{name:"keystoreFormat",control:i,defaultValue:h[0],render:({field:x})=>e.jsx(G,{toggleId:"archiveFormat",onToggle:r,onSelect:(u,d)=>{x.onChange(d),r(!1)},selections:x.value,variant:q.single,"aria-label":a("archiveFormat"),isOpen:l,children:h.map(u=>e.jsx(M,{selected:u===x.value,value:u},u))})})}),p.includes(m)&&e.jsx(Le,{...t,children:e.jsx(tn,{hidePassword:!0})}),e.jsx(g,{label:a("importFile"),fieldId:"importFile",children:e.jsx(N,{name:"file",control:i,defaultValue:{filename:""},render:({field:x})=>e.jsx($s,{id:"importFile",value:x.value.value,filename:x.value.filename,onChange:(u,d)=>x.onChange({value:u,filename:d})})})})]})]})},Pt="jwt.credential",si=({clientId:s,save:n,hasConfigureAccess:a})=>{const{t}=E("clients"),{control:i,register:o,getValues:l,formState:{isDirty:r}}=Q(),{adminClient:p}=Z(),{addAlert:h,addError:m}=re(),[x,u]=c.useState(),[d,C,j]=be(),[y,A,I]=be(),[_,U]=c.useState(0),X=()=>U(_+1),H=et({control:i,name:O("attributes.use.jwks.url"),defaultValue:"false"});oe(()=>p.clients.getKeyInfo({id:s,attr:Pt}),D=>u(D),[_]);const k=async D=>{try{const T=await p.clients.generateAndDownloadKey({id:s,attr:Pt},D);tt.saveAs(new Blob([T],{type:"application/octet-stream"}),`keystore.${sn(D.format??"")}`),h(t("generateSuccess"),te.success),X()}catch(T){m("clients:generateError",T)}},L=async D=>{try{const T=new FormData,{file:b,...S}=D;for(const[B,P]of Object.entries(S))T.append(B,P);T.append("file",b.value),await p.clients.uploadCertificate({id:s,attr:Pt},T),h(t("importSuccess"),te.success),X()}catch(T){m("clients:importError",T)}};return e.jsxs(xe,{variant:"light",className:"keycloak__form",children:[d&&e.jsx(ei,{clientId:l("clientId"),toggleDialog:C,save:k}),y&&e.jsx(ti,{toggleDialog:A,save:L}),e.jsxs(St,{isFlat:!0,children:[e.jsx(Yn,{children:e.jsx(Xn,{children:t("jwksUrlConfig")})}),e.jsx(Xe,{children:e.jsx(Pe,{children:e.jsx(me,{children:t("keysIntro")})})}),e.jsx(Xe,{children:e.jsxs(ce,{role:"manage-clients",fineGrainedAccess:a,isHorizontal:!0,children:[e.jsx(g,{hasNoPaddingTop:!0,label:t("useJwksUrl"),fieldId:"useJwksUrl",labelIcon:e.jsx(f,{helpText:t("clients-help:useJwksUrl"),fieldLabelId:"clients:useJwksUrl"}),children:e.jsx(N,{name:O("attributes.use.jwks.url"),control:i,render:({field:D})=>e.jsx(de,{"data-testid":"useJwksUrl",id:"useJwksUrl-switch",label:t("common:on"),labelOff:t("common:off"),isChecked:D.value==="true",onChange:T=>D.onChange(`${T}`),"aria-label":t("useJwksUrl")})})}),H!=="true"&&(x?e.jsx(Xt,{plain:!0,keyInfo:x}):"No client certificate configured"),H==="true"&&e.jsx(g,{label:t("jwksUrl"),fieldId:"jwksUrl",labelIcon:e.jsx(f,{helpText:t("clients-help:jwksUrl"),fieldLabelId:"clients:jwksUrl"}),children:e.jsx(Y,{id:"jwksUrl",type:"url",...o(O("attributes.jwks.url"))})}),e.jsxs(fe,{children:[e.jsx(w,{"data-testid":"saveKeys",onClick:n,isDisabled:!r,children:t("common:save")}),e.jsx(w,{"data-testid":"generate",variant:"secondary",onClick:()=>j(!0),children:t("generateNewKeys")}),e.jsx(w,{"data-testid":"import",variant:"secondary",onClick:()=>I(!0),isDisabled:H==="true",children:t("import")})]})]})})]})]})},ni=({clientId:s,close:n})=>{const{t:a}=E("clients"),{realm:t}=he(),{adminClient:i}=Z(),{addAlert:o,addError:l}=re(),r=Oe({defaultValues:{realmAlias:t}}),p=async h=>{try{const m=await i.clients.downloadKey({id:s,attr:"saml.signing"},h);tt.saveAs(new Blob([m],{type:"application/octet-stream"}),`keystore.${sn(h.format??"")}`),o(a("samlKeysExportSuccess")),n()}catch(m){l("clients:samlKeysExportError",m)}};return e.jsx(Be,{variant:"medium",title:a("exportSamlKeyTitle"),isOpen:!0,onClose:n,actions:[e.jsx(w,{id:"modal-confirm","data-testid":"confirm",type:"submit",form:"export-saml-key-form",children:a("common:export")},"confirm"),e.jsx(w,{id:"modal-cancel","data-testid":"cancel",variant:"link",onClick:()=>{n()},children:a("common:cancel")},"cancel")],children:e.jsx(Te,{id:"export-saml-key-form",className:"pf-u-pt-lg",onSubmit:r.handleSubmit(p),children:e.jsx(Le,{...r,children:e.jsx(kt,{isSaml:!0})})})})},nn=async(s,n,a,t,i)=>{try{const o=new FormData,{file:l,...r}=s;Object.entries(r).map(([p,h])=>o.append(p==="format"?"keystoreFormat":p,h.toString())),o.append("file",l),await t.clients.uploadKey({id:n,attr:a},o),i()}catch(o){i(o)}},ai=({id:s,attr:n,onClose:a,onCancel:t})=>{const{t:i}=E("clients"),[o,l]=c.useState(!1),[r,p]=c.useState(),h=Oe({mode:"onChange"}),{handleSubmit:m,formState:{isValid:x}}=h,{adminClient:u}=Z(),{addAlert:d,addError:C}=re(),j=A=>{nn(A,s,n,u,I=>{I?C("clients:importError",I):d(i("importSuccess"),te.success)})},y=async()=>{try{const A=await u.clients.generateKey({id:s,attr:n});p(A),tt.saveAs(new Blob([A.privateKey],{type:"application/octet-stream"}),"private.key"),d(i("generateSuccess"),te.success)}catch(A){C("clients:generateError",A)}};return e.jsx(Be,{variant:lt.medium,"aria-labelledby":i("enableClientSignatureRequired"),header:e.jsxs(Pe,{children:[e.jsx(qt,{headingLevel:"h1",children:i("enableClientSignatureRequired")}),e.jsx(me,{children:i("enableClientSignatureRequiredExplain")})]}),isOpen:!0,onClose:a,actions:[e.jsx(w,{id:"modal-confirm","data-testid":"confirm",variant:"primary",isDisabled:!x&&!r,onClick:()=>{o&&m(j)(),a()},children:i("confirm")},"confirm"),e.jsx(w,{id:"modal-cancel","data-testid":"cancel",variant:ye.link,onClick:t,children:i("common:cancel")},"cancel")],children:e.jsxs(Le,{...h,children:[e.jsxs(Te,{isHorizontal:!0,children:[e.jsx(g,{label:i("selectMethod"),fieldId:"selectMethod",hasNoPaddingTop:!0,children:e.jsxs(Zn,{children:[e.jsx(os,{children:e.jsx(xt,{isChecked:!o,name:"selectMethodType",onChange:()=>l(!1),label:i("selectMethodType.generate"),id:"selectMethodType-generate"})}),e.jsx(os,{children:e.jsx(xt,{isChecked:o,name:"selectMethodType",onChange:()=>l(!0),label:i("selectMethodType.import"),id:"selectMethodType-import"})})]})}),!o&&e.jsx(g,{label:i("certificate"),fieldId:"certificate",labelIcon:e.jsx(f,{helpText:i("clients-help:certificate"),fieldLabelId:"clients:certificate"}),children:e.jsxs(st,{hasGutter:!0,children:[e.jsx(ve,{isFilled:!0,children:e.jsx(Xt,{plain:!0,keyInfo:r})}),e.jsx(ve,{children:e.jsx(w,{variant:"secondary","data-testid":"generate",onClick:y,children:i("generate")})})]})})]}),o&&e.jsx(kt,{useFile:!0})]})})},ii=({id:s,attr:n,onClose:a})=>{const{t}=E("clients"),i=Q(),{handleSubmit:o}=i,{adminClient:l}=Z(),{addAlert:r,addError:p}=re(),h=m=>{nn(m,s,n,l,x=>{x?p("clients:importError",x):r(t("importSuccess"),te.success)})};return e.jsx(Gt,{open:!0,toggleDialog:a,continueButtonLabel:"clients:import",titleKey:"clients:importKey",onConfirm:()=>{o(h)(),a()},children:e.jsx(Le,{...i,children:e.jsx(kt,{useFile:!0,hasPem:!0})})})},_t=["saml.signing","saml.encryption"],Ze={"saml.signing":{name:O("attributes.saml.client.signature"),title:"signingKeysConfig",key:"clientSignature"},"saml.encryption":{name:O("attributes.saml.encrypt"),title:"encryptionKeysConfig",key:"encryptAssertions"}},li=({clientId:s,keyInfo:n,attr:a,onChanged:t,onGenerate:i,onImport:o})=>{const{t:l}=E("clients"),{control:r,watch:p}=Q(),h=Ze[a].title,m=Ze[a].key,x=Ze[a].name,[u,d]=be(),C=p(x);return e.jsxs(e.Fragment,{children:[u&&e.jsx(ni,{clientId:s,close:d}),e.jsxs(Nt,{title:l(h),className:"kc-form-panel__panel",children:[e.jsx(Pe,{className:"pf-u-pb-lg",children:e.jsx(me,{children:l(`${h}Explain`)})}),e.jsx(ce,{role:"manage-clients",isHorizontal:!0,children:e.jsx(g,{labelIcon:e.jsx(f,{helpText:l(`clients-help:${m}`),fieldLabelId:`clients:${m}`}),label:l(m),fieldId:m,hasNoPaddingTop:!0,children:e.jsx(N,{name:x,control:r,defaultValue:"false",render:({field:j})=>e.jsx(de,{"data-testid":m,id:m,label:l("common:on"),labelOff:l("common:off"),isChecked:j.value==="true",onChange:y=>{const A=y.toString();A==="true"?(t(a),j.onChange(A)):i(a,!1)},"aria-label":l(m)})})})})]}),n?.certificate&&C==="true"&&e.jsx(St,{isFlat:!0,children:e.jsx(Xe,{className:"kc-form-panel__body",children:e.jsxs(Te,{isHorizontal:!0,children:[e.jsx(Xt,{keyInfo:n}),e.jsxs(fe,{children:[e.jsx(w,{variant:"secondary",onClick:()=>i(a,!0),children:l("regenerate")}),e.jsx(w,{variant:"secondary",onClick:()=>o(a),children:l("importKey")}),e.jsx(w,{variant:"tertiary",onClick:d,children:l("common:export")})]})]})})})]})},oi=({clientId:s,save:n})=>{const{t:a}=E("clients"),[t,i]=c.useState(),[o,l]=c.useState(),[r,p]=c.useState(),[h,m]=c.useState(),[x,u]=c.useState(0),{setValue:d}=Q(),{adminClient:C}=Z(),{addAlert:j,addError:y}=re();oe(()=>Promise.all(_t.map(k=>C.clients.getKeyInfo({id:s,attr:k}))),k=>l(k),[x]);const A=async k=>{const L=_t.indexOf(k);try{const D=[...o||[]];D[L]=await C.clients.generateKey({id:s,attr:k}),l(D),tt.saveAs(new Blob([D[L].privateKey],{type:"application/octet-stream"}),"private.key"),j(a("generateSuccess"),te.success)}catch(D){y("clients:generateError",D)}},I=r?Ze[r].key:"",[_,U]=Ce({titleKey:a("disableSigning",{key:a(I)}),messageKey:a("disableSigningExplain",{key:a(I)}),continueButtonLabel:"common:yes",cancelButtonLabel:"common:no",onConfirm:()=>{d(Ze[r].name,"false"),n()}}),[X,H]=Ce({titleKey:"clients:reGenerateSigning",messageKey:"clients:reGenerateSigningExplain",continueButtonLabel:"common:yes",cancelButtonLabel:"common:no",onConfirm:()=>{A(r)}});return e.jsxs(xe,{variant:"light",className:"keycloak__form",children:[t&&e.jsx(ai,{id:s,attr:t,onClose:()=>{i(void 0),n(),u(x+1)},onCancel:()=>{d(Ze[r].name,"false"),i(void 0)}}),e.jsx(U,{}),e.jsx(H,{}),_t.map((k,L)=>e.jsxs(c.Fragment,{children:[h===k&&e.jsx(ii,{id:s,attr:k,onClose:()=>m(void 0)}),e.jsx(li,{clientId:s,keyInfo:o?.[L],attr:k,onChanged:i,onGenerate:(D,T)=>{p(D),T?X():_()},onImport:()=>m(k)})]},k))]})},bt="dedicated",ri=({clientId:s,refresh:n,fineGrainedAccess:a,...t})=>{const{t:i}=E("clients"),{adminClient:o}=Z(),{addAlert:l,addError:r}=re(),{hasAccess:p}=_e(),h=x=>x.id===bt,m=p("manage-clients")||a;return e.jsx(ta,{isDisabled:h(t)||!m,clientScope:t,type:t.type,onSelect:async x=>{try{await sa(o,s,t,t.type,x),l(i("clientScopeSuccess"),te.success),n()}catch(u){r("clients:clientScopeError",u)}}})},ci=({clientId:s,protocol:n,clientName:a,fineGrainedAccess:t})=>{const{t:i}=E("clients"),{adminClient:o}=Z(),{addAlert:l,addError:r}=re(),{realm:p}=he(),h=Gs(),[m,x]=c.useState("name"),[u,d]=c.useState(rs.none),[C,j]=c.useState(!1),[y,A]=c.useState(),[I,_]=c.useState([]),U=v=>_(v.filter(({id:V})=>V!==bt)),[X,H]=c.useState(!1),[k,L]=c.useState(0),D=()=>L(k+1),T=v=>v.id===bt,{hasAccess:b}=_e(),S=b("manage-clients")||t,B=async(v,V,ee)=>{const K=await o.clients.listDefaultClientScopes({id:s}),$=await o.clients.listOptionalClientScopes({id:s}),W=await o.clientScopes.find(),Ie=ue=>W.find(R=>ue===R.id),qe=$.map(ue=>{const R=Ie(ue.id);return{...ue,type:ds.optional,description:R?.description}}),ke=K.map(ue=>{const R=Ie(ue.id);return{...ue,type:ds.default,description:R?.description}}),De=[...qe,...ke],ct=De.map(ue=>ue.name);A(W.filter(ue=>!ct.includes(ue.name)).filter(ue=>ue.protocol===n));const dt=m==="name"?la(ee):oa(u),We=Number(v),Je=h(De.filter(dt),Hs("name"));return S&&Je.unshift({id:bt,name:i("dedicatedScopeName",{clientName:a}),type:rs.none,description:i("dedicatedScopeDescription")}),Je.slice(We,We+Number(V))},[P,se]=Ce({titleKey:i("client-scopes:deleteClientScope",{count:I.length,name:I[0]?.name}),messageKey:"client-scopes:deleteConfirm",continueButtonLabel:"common:delete",continueButtonVariant:ye.danger,onConfirm:async()=>{try{await cs(o,s,I[0],I[0].type),l(i("clientScopeRemoveSuccess"),te.success),D()}catch(v){r("clients:clientScopeRemoveError",v)}}});return e.jsxs(e.Fragment,{children:[y&&e.jsx(Fn,{clientScopes:y,clientName:a,open:C,toggleDialog:()=>j(!C),onAdd:async v=>{try{await Promise.all(v.map(async V=>await ea(o,s,V.scope,V.type))),l(i("clientScopeSuccess"),te.success),D()}catch(V){r("clients:clientScopeError",V)}}}),e.jsx(It,{loader:B,ariaLabelKey:"clients:clientScopeList",searchPlaceholderKey:m==="name"?"clients:searchByName":void 0,canSelectAll:!0,isPaginated:!0,isSearching:m==="type",onSelect:v=>U([...v]),searchTypeComponent:e.jsx(na,{searchType:m,onSelect:v=>x(v)}),toolbarItem:e.jsxs(e.Fragment,{children:[e.jsx(aa,{searchType:m,type:u,onSelect:v=>x(v),onType:v=>{d(v),D()}}),S&&e.jsxs(e.Fragment,{children:[e.jsx(se,{}),e.jsx(je,{children:e.jsx(w,{onClick:()=>j(!0),children:i("addClientScope")})}),e.jsx(je,{children:e.jsx(ia,{clientId:s,selectedRows:I,refresh:D})}),e.jsx(je,{children:e.jsx(zt,{toggle:e.jsx(jn,{onToggle:()=>H(!X)}),isOpen:X,isPlain:!0,dropdownItems:[e.jsx(Ye,{isDisabled:I.length===0,onClick:async()=>{try{await Promise.all(I.map(v=>cs(o,s,{...v},v.type))),H(!1),U([]),l(i("clients:clientScopeRemoveSuccess")),D()}catch(v){r("clients:clientScopeRemoveError",v)}},children:i("common:remove")},"deleteAll")]})})]})]}),columns:[{name:"name",displayKey:"clients:assignedClientScope",cellRenderer:v=>T(v)?e.jsx(ge,{to:fn({realm:p,clientId:s}),children:v.name}):v.name},{name:"type",displayKey:"clients:assignedType",cellRenderer:v=>e.jsx(ri,{clientId:s,refresh:D,...v})},{name:"description"}],actions:S?[{title:i("common:remove"),onRowClick:async v=>(U([v]),P(),!0)}]:[],emptyState:e.jsx(Ee,{message:i("clients:emptyClientScopes"),instructions:i("clients:emptyClientScopesInstructions"),primaryActionText:i("clients:emptyClientScopesPrimaryAction"),onPrimaryAction:()=>j(!0)})},k)]})},Lt=({text:s,user:n,label:a})=>{const{t}=E("clients");return n?e.jsx(Ws,{id:a,actions:e.jsx(Js,{children:e.jsx(en,{id:"code",text:s,label:a})}),children:e.jsx(it,{id:`text-area-${a}`,rows:20,value:s})}):e.jsxs(zs,{variant:"large",id:a,children:[e.jsx(qt,{headingLevel:"h2",size:"lg",children:t(`${a}No`)}),e.jsx(qs,{children:t(`${a}IsDisabled`)})]})};const di=({protocolMappers:s})=>{const[n,a]=c.useState(0);return c.useEffect(()=>{a(n+1)},[s]),e.jsx(It,{loader:()=>Promise.resolve(s),ariaLabelKey:"clients:effectiveProtocolMappers",searchPlaceholderKey:"clients:searchForProtocol",columns:[{name:"mapperName",displayKey:"common:name"},{name:"containerName",displayKey:"clients:parentClientScope"},{name:"type.category",displayKey:"common:category"},{name:"type.priority",displayKey:"common:priority"}]},n)},ui=({effectiveRoles:s})=>{const[n,a]=c.useState(0);return c.useEffect(()=>{a(n+1)},[s]),e.jsx(It,{loader:()=>Promise.resolve(s),ariaLabelKey:"client:effectiveRoleScopeMappings",searchPlaceholderKey:"clients:searchForRole",columns:[{name:"name",displayKey:"clients:role"},{name:"containerId",displayKey:"clients:origin"}]},n)},pi=({clientId:s,protocol:n})=>{const a="openid",{t}=E("clients"),{enabled:i}=ks(),{adminClient:o}=Z(),{realm:l}=he(),r=Me().protocolMapperTypes[n],[p,h]=c.useState([]),[m,x]=c.useState(!1),[u,d]=c.useState([a]),[C,j]=c.useState(0),[y,A]=c.useState(""),I=()=>A(`${new Date().getTime()}`),[_,U]=c.useState([]),[X,H]=c.useState([]),[k,L]=c.useState(""),[D,T]=c.useState(""),[b,S]=c.useState(""),B=c.useRef(null),P=c.useRef(null),se=c.useRef(null),v=c.useRef(null),V=c.useRef(null),ee=Oe();return oe(()=>o.clients.listOptionalClientScopes({id:s}),K=>h(K),[]),oe(async()=>{const K=u.join(" "),$=await o.clients.evaluatePermission({id:s,roleContainer:l,scope:K,type:"granted"});return{mapperList:await o.clients.evaluateListProtocolMapper({id:s,scope:K}),effectiveRoles:$}},({mapperList:K,effectiveRoles:$})=>{U($),K.map(W=>{W.type=r.filter(Ie=>Ie.id===W.protocolMapper)[0]}),H(K),I()},[u]),oe(async()=>{const K=u.join(" "),$=ee.getValues("user");return $?await Promise.all([o.clients.evaluateGenerateAccessToken({id:s,userId:$[0],scope:K}),o.clients.evaluateGenerateUserInfo({id:s,userId:$[0],scope:K}),o.clients.evaluateGenerateIdToken({id:s,userId:$[0],scope:K})]):[]},([K,$,W])=>{L(Qe(K)),T(Qe($)),S(Qe(W))},[ee.getValues("user"),u]),e.jsxs(e.Fragment,{children:[e.jsxs(xe,{variant:"light",children:[i&&e.jsx(Pe,{className:"keycloak__section_intro__help",children:e.jsxs(me,{children:[e.jsx(ca,{})," ",t("clients-help:evaluateExplain")]})}),e.jsxs(Te,{isHorizontal:!0,children:[e.jsx(g,{label:t("scopeParameter"),fieldId:"scopeParameter",labelIcon:e.jsx(f,{helpText:t("clients-help:scopeParameter"),fieldLabelId:"clients:scopeParameter"}),children:e.jsxs(st,{hasGutter:!0,children:[e.jsx(ve,{isFilled:!0,children:e.jsx(G,{toggleId:"scopeParameter",variant:q.typeaheadMulti,typeAheadAriaLabel:t("scopeParameter"),onToggle:()=>x(!m),isOpen:m,selections:u,onSelect:(K,$)=>{const W=$;u.includes(W)?W!==a&&d(u.filter(Ie=>Ie!==W)):d([...u,W])},"aria-labelledby":t("scopeParameter"),placeholderText:t("scopeParameterPlaceholder"),children:p.map((K,$)=>e.jsx(M,{value:K.name},$))})}),e.jsx(ve,{children:e.jsx(_s,{className:"keycloak__scopes_evaluate__clipboard-copy",children:u.join(" ")})})]})}),e.jsx(Le,{...ee,children:e.jsx(Bs,{name:"user",label:"users",helpText:t("clients-help:user"),defaultValue:"",variant:q.typeahead,isRequired:!0})})]})]}),e.jsxs(da,{hasGutter:!0,className:"keycloak__scopes_evaluate__tabs",children:[e.jsxs(us,{span:8,children:[e.jsx(pt,{"aria-labelledby":"pf-tab-0-effectiveProtocolMappers",eventKey:0,id:"effectiveProtocolMappers",ref:B,children:e.jsx(di,{protocolMappers:X})}),e.jsx(pt,{"aria-labelledby":"pf-tab-0-effectiveRoleScopeMappings",eventKey:1,id:"effectiveRoleScopeMappings",ref:P,hidden:!0,children:e.jsx(ui,{effectiveRoles:_})}),e.jsx(pt,{"aria-labelledby":t("generatedAccessToken"),eventKey:2,id:"tab-generated-access-token",ref:se,hidden:!0,children:e.jsx(Lt,{text:k,user:ee.getValues("user"),label:"generatedAccessToken"})}),e.jsx(pt,{"aria-labelledby":t("generatedIdToken"),eventKey:3,id:"tab-generated-id-token",ref:v,hidden:!0,children:e.jsx(Lt,{text:b,user:ee.getValues("user"),label:"generatedIdToken"})}),e.jsx(pt,{"aria-labelledby":t("generatedUserInfo"),eventKey:4,id:"tab-generated-user-info",ref:V,hidden:!0,children:e.jsx(Lt,{text:D,user:ee.getValues("user"),label:"generatedUserInfo"})})]}),e.jsx(us,{span:4,children:e.jsxs(ra,{id:"tabs",isVertical:!0,activeKey:C,onSelect:(K,$)=>j($),children:[e.jsx(ae,{id:"effectiveProtocolMappers","aria-controls":"effectiveProtocolMappers",eventKey:0,title:e.jsxs(ie,{children:[t("effectiveProtocolMappers")," ",e.jsx(f,{fieldLabelId:"clients:effectiveProtocolMappers",helpText:t("clients-help:effectiveProtocolMappers"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:B}),e.jsx(ae,{id:"effectiveRoleScopeMappings","aria-controls":"effectiveRoleScopeMappings",eventKey:1,title:e.jsxs(ie,{children:[t("effectiveRoleScopeMappings")," ",e.jsx(f,{fieldLabelId:"clients:effectiveRoleScopeMappings",helpText:t("clients-help:effectiveRoleScopeMappings"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:P}),e.jsx(ae,{id:"generatedAccessToken","aria-controls":"generatedAccessToken",eventKey:2,title:e.jsxs(ie,{children:[t("generatedAccessToken")," ",e.jsx(f,{fieldLabelId:"clients:generatedAccessToken",helpText:t("clients-help:generatedAccessToken"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:se}),e.jsx(ae,{id:"generatedIdToken","aria-controls":"generatedIdToken",eventKey:3,title:e.jsxs(ie,{children:[t("generatedIdToken")," ",e.jsx(f,{fieldLabelId:"clients:generatedIdToken",helpText:t("clients-help:generatedIdToken"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:v}),e.jsx(ae,{id:"generatedUserInfo","aria-controls":"generatedUserInfo",eventKey:4,title:e.jsxs(ie,{children:[t("generatedUserInfo")," ",e.jsx(f,{fieldLabelId:"clients:generatedUserInfo",helpText:t("clients-help:generatedUserInfo"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:V})]},y)})]})]})};const mi=({client:s})=>{const{t:n}=E("clients"),{adminClient:a}=Z(),{addAlert:t,addError:i}=re(),{realm:o}=he(),[l,r]=c.useState(),{hasAccess:p}=_e(),h=p("manage-clients");oe(()=>a.clients.getServiceAccountUser({id:s.id}),x=>r(x),[]);const m=async x=>{try{const u=x.filter(d=>d.client===void 0).map(d=>d.role).flat();await a.users.addRealmRoleMappings({id:l?.id,roles:u}),await Promise.all(x.filter(d=>d.client!==void 0).map(d=>a.users.addClientRoleMappings({id:l?.id,clientUniqueId:d.client.id,roles:[d.role]}))),t(n("roleMappingUpdatedSuccess"),te.success)}catch(u){i("clients:roleMappingUpdatedError",u)}};return l?e.jsxs(e.Fragment,{children:[e.jsxs(xe,{className:"pf-u-pb-0",children:[e.jsx(Ps,{className:"pf-c-alert__icon keycloak--service-account--info-text"}),e.jsx("span",{className:"pf-u-pl-sm",children:e.jsxs(Ks,{i18nKey:"clients-help:manageServiceAccountUser",children:["",e.jsx(ge,{to:yn({realm:o,id:l.id,tab:"settings"}),children:{link:l.username}})]})})]}),e.jsx(ua,{name:s.clientId,id:l.id,type:"users",isManager:h||s.access?.configure,save:m})]}):e.jsx(Ae,{})},hi=({onChange:s,value:n,save:a,client:t,toggleDownloadDialog:i,toggleDeleteDialog:o})=>{const{t:l}=E("clients"),[r,p]=Ce({titleKey:"clients:disableConfirmTitle",messageKey:"clients:disableConfirm",continueButtonLabel:"common:disable",onConfirm:()=>{s(!n),a()}}),h=c.useMemo(()=>{const d=Kn(l,t.protocol??"openid-connect");return[{text:t.bearerOnly?e.jsx(Ut,{"data-testid":"bearer-only-explainer-tooltip",content:l("explainBearerOnly"),children:e.jsx(Dt,{"data-testid":"bearer-only-explainer-label",icon:e.jsx(Ps,{}),children:d})}):e.jsx(Dt,{children:d})}]},[t,l]),{hasAccess:m}=_e(),x=m("manage-clients")||t.access?.configure,u=[e.jsx(Ye,{onClick:i,children:l("downloadAdapterConfig")},"download"),e.jsx(Ye,{onClick:()=>Cn(t),children:l("common:export")},"export"),...!yt(t)&&x?[e.jsx(He,{},"divider"),e.jsx(Ye,{"data-testid":"delete-client",onClick:o,children:l("common:delete")},"delete")]:[]];return e.jsxs(e.Fragment,{children:[e.jsx(p,{}),e.jsx(On,{titleKey:t.clientId,subKey:"clients:clientsExplain",badges:h,divider:!1,isReadOnly:!x,helpTextKey:"clients-help:enableDisable",dropdownItems:u,isEnabled:n,onToggle:d=>{d?(s(d),a()):r()}})]})};function Ul(){const{t:s}=E("clients"),{adminClient:n}=Z(),{addAlert:a,addError:t}=re(),{realm:i}=he(),{profileInfo:o}=Me(),{hasAccess:l}=_e(),r=l("manage-authorization"),p=!o?.disabledFeatures?.includes("ADMIN_FINE_GRAINED_AUTHZ")&&r,h=l("manage-clients"),m=l("view-clients"),x=l("view-users"),u=l("query-users"),d=nt(),[C,j]=be(),[y,A]=be(),I=Oe(),{clientId:_}=Ht(),[U,X]=c.useState(0),H=et({control:I.control,name:"clientAuthenticatorType",defaultValue:"client-secret"}),[k,L]=c.useState(),D=async()=>{const ne=await n.clients.listRoles({id:_});return Rs(ne,ut=>ut.name?.toUpperCase())},T=ne=>Ot(As({realm:i,clientId:_,tab:ne})),b=T("settings"),S=T("keys"),B=T("credentials"),P=T("roles"),se=T("clientScopes"),v=T("authorization"),V=T("serviceAccount"),ee=T("sessions"),K=T("permissions"),$=T("advanced"),W=ne=>Ot(ss({realm:i,clientId:_,tab:ne})),Ie=W("setup"),qe=W("evaluate"),ke=ne=>Ot(ns({realm:i,clientId:_,tab:ne})),De=ke("settings"),ct=ke("resources"),dt=ke("scopes"),We=ke("policies"),Je=ke("permissions"),ue=ke("evaluate"),R=ke("export"),[pe,J]=Ce({titleKey:"clients:clientDeleteConfirmTitle",messageKey:"clients:clientDeleteConfirm",continueButtonLabel:"common:delete",continueButtonVariant:ye.danger,onConfirm:async()=>{try{await n.clients.del({id:_}),a(s("clientDeletedSuccess"),te.success),d(bn({realm:i}))}catch(ne){t("clients:clientDeleteError",ne)}}}),Rt=ne=>{I.reset({...ne}),Tn(ne,I.setValue),ne.attributes?.["acr.loa.map"]&&I.setValue(O("attributes.acr.loa.map"),Object.entries(JSON.parse(ne.attributes["acr.loa.map"])).flatMap(([ut,At])=>({key:ut,value:At})))};oe(()=>n.clients.findOne({id:_}),ne=>{if(!ne)throw new Error(s("common:notFound"));L(In(ne)),Rt(ne)},[_,U]);const Ne=async({confirmed:ne=!1,messageKey:ut="clientSaveSuccess"}={confirmed:!1,messageKey:"clientSaveSuccess"})=>{if(!await I.trigger())return;if(!k?.publicClient&&k?.clientAuthenticatorType!==H&&!ne){A();return}const At=as(I.getValues()),jt=as(At);jt.attributes?.["acr.loa.map"]&&(jt.attributes["acr.loa.map"]=JSON.stringify(Object.fromEntries(jt.attributes["acr.loa.map"].filter(({key:Re})=>Re!=="").map(({key:Re,value:an})=>[Re,an]))));try{const Re={...k,...jt};Re.clientId=Re.clientId?.trim(),await n.clients.update({id:_},Re),Rt(Re),L(Re),a(s(ut),te.success)}catch(Re){t("clients:clientSaveError",Re)}};return k?e.jsxs(e.Fragment,{children:[e.jsx(Gt,{continueButtonLabel:"common:yes",cancelButtonLabel:"common:no",titleKey:s("changeAuthenticatorConfirmTitle",{clientAuthenticatorType:H}),open:y,toggleDialog:A,onConfirm:()=>Ne({confirmed:!0}),children:e.jsx(e.Fragment,{children:s("changeAuthenticatorConfirm",{clientAuthenticatorType:H})})}),e.jsx(J,{}),C&&e.jsx(pa,{id:k.id,protocol:k.protocol,open:!0,toggleDialog:j}),e.jsx(N,{name:"enabled",control:I.control,defaultValue:!0,render:({field:ne})=>e.jsx(hi,{value:ne.value,onChange:ne.onChange,client:k,save:Ne,toggleDeleteDialog:pe,toggleDownloadDialog:j})}),e.jsx(xe,{variant:"light",className:"pf-u-p-0",children:e.jsx(Le,{...I,children:e.jsxs(Et,{"data-testid":"client-tabs","aria-label":"client-tabs",isBox:!0,mountOnEnter:!0,children:[e.jsx(ae,{id:"settings","data-testid":"clientSettingsTab",title:e.jsx(ie,{children:s("common:settings")}),...b,children:e.jsx(Wa,{client:k,save:()=>Ne(),reset:()=>Rt(k)})}),(!k.publicClient&&!yt(k)||k.protocol==="saml")&&e.jsxs(ae,{id:"keys","data-testid":"keysTab",title:e.jsx(ie,{children:s("keys")}),...S,children:[k.protocol==="openid-connect"&&e.jsx(si,{clientId:_,save:Ne,hasConfigureAccess:k.access?.configure}),k.protocol==="saml"&&e.jsx(oi,{clientId:_,save:Ne})]}),!k.publicClient&&!yt(k)&&(m||k.access?.configure)&&e.jsx(ae,{id:"credentials",title:e.jsx(ie,{children:s("credentials")}),...B,children:e.jsx(Xa,{client:k,save:Ne,refresh:()=>X(U+1)},U)}),e.jsx(ae,{id:"roles","data-testid":"rolesTab",title:e.jsx(ie,{children:s("roles")}),...P,children:e.jsx(En,{loader:D,paginated:!1,messageBundle:"clients",toCreate:Sn({realm:i,clientId:k.id}),toDetail:ne=>vn({realm:i,clientId:k.id,id:ne,tab:"details"}),isReadOnly:!(h||k.access?.configure)})}),!yt(k)&&!k.bearerOnly&&u&&e.jsx(ae,{id:"clientScopes","data-testid":"clientScopesTab",title:e.jsx(ie,{children:s("clientScopes")}),...se,children:e.jsxs(Et,{defaultLocation:ss({realm:i,clientId:_,tab:"setup"}),children:[e.jsx(ae,{id:"setup",title:e.jsx(ie,{children:s("setup")}),...Ie,children:e.jsx(ci,{clientName:k.clientId,clientId:_,protocol:k.protocol,fineGrainedAccess:k.access?.manage})}),e.jsx(ae,{id:"evaluate",title:e.jsx(ie,{children:s("evaluate")}),...qe,children:e.jsx(pi,{clientId:_,protocol:k.protocol})})]})}),k.authorizationServicesEnabled&&r&&e.jsx(ae,{id:"authorization","data-testid":"authorizationTab",title:e.jsx(ie,{children:s("authorization")}),...v,children:e.jsxs(Et,{mountOnEnter:!0,unmountOnExit:!0,defaultLocation:ns({realm:i,clientId:_,tab:"settings"}),children:[e.jsx(ae,{id:"settings","data-testid":"authorizationSettings",title:e.jsx(ie,{children:s("settings")}),...De,children:e.jsx(Ua,{clientId:_})}),e.jsx(ae,{id:"resources","data-testid":"authorizationResources",title:e.jsx(ie,{children:s("resources")}),...ct,children:e.jsx(Ka,{clientId:_})}),e.jsx(ae,{id:"scopes","data-testid":"authorizationScopes",title:e.jsx(ie,{children:s("scopes")}),...dt,children:e.jsx(Ma,{clientId:_})}),e.jsx(ae,{id:"policies","data-testid":"authorizationPolicies",title:e.jsx(ie,{children:s("policies")}),...We,children:e.jsx(Da,{clientId:_})}),e.jsx(ae,{id:"permissions","data-testid":"authorizationPermissions",title:e.jsx(ie,{children:s("common:permissions")}),...Je,children:e.jsx(_a,{clientId:_})}),e.jsx(ae,{id:"evaluate","data-testid":"authorizationEvaluate",title:e.jsx(ie,{children:s("evaluate")}),...ue,children:e.jsx(Aa,{client:k,save:Ne})}),e.jsx(ae,{id:"export","data-testid":"authorizationExport",title:e.jsx(ie,{children:s("common:export")}),...R,children:e.jsx(Ea,{})})]})}),k.serviceAccountsEnabled&&x&&e.jsx(ae,{id:"serviceAccount","data-testid":"serviceAccountTab",title:e.jsx(ie,{children:s("serviceAccount")}),...V,children:e.jsx(mi,{client:k})}),e.jsx(ae,{id:"sessions","data-testid":"sessionsTab",title:e.jsx(ie,{children:s("sessions")}),...ee,children:e.jsx(Va,{client:k})}),p&&(h||k.access?.manage)&&e.jsx(ae,{id:"permissions","data-testid":"permissionsTab",title:e.jsx(ie,{children:s("common:permissions")}),...K,children:e.jsx(An,{id:k.id,type:"clients"})}),e.jsx(ae,{id:"advanced","data-testid":"advancedTab",title:e.jsx(ie,{children:s("advanced")}),...$,children:e.jsx(Sa,{save:Ne,client:k})})]})})})]}):e.jsx(Ae,{})}export{Ul as default};
//# sourceMappingURL=ClientDetails-ace2097d.js.map
