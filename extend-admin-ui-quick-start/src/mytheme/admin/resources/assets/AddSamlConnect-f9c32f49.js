import{u as h,d as j,c as I,a as S,j as e,T as E,F as f,G as y,aU as F,a0 as P,a1 as T,b as A,f as C,e as k,P as w,g as D,B as g,L,bK as U,A as x,bL as V}from"./index-a3421f29.js";import{F as G}from"./FormAccess-1cceaef6.js";import{V as $}from"./ViewHeader-832ec56e.js";import{F as K}from"./FileUploadForm-96efeae2.js";import{K as q}from"./KeycloakTextInput-e7f6e917.js";import{D as z}from"./DiscoveryEndpointField-1ac4d0ed.js";import{D as B,S as H}from"./SamlGeneralSettings-6ba43280.js";import{A as O}from"./Form-518a2cf2.js";import"./copy-icon-a4fe01af.js";import"./GridItem-d34dae2e.js";import"./Text-564bf299.js";import"./ToolbarContent-7b435752.js";import"./FileUpload-ca37c1a6.js";import"./CodeEditor-2fb93648.js";import"./EmptyStateBody-7b4fcee1.js";import"./EmptyStateSecondaryActions-08edafb5.js";import"./Modal-21c37af7.js";import"./KeycloakTextArea-1b518857.js";import"./discovery-settings-095f2617.js";import"./ExpandableSection-15721cb7.js";import"./Select-0f56a9cc.js";import"./check-fc57dbe1.js";import"./star-icon-6a7e7d25.js";import"./NumberInput-85f36a0d.js";import"./minus-icon-16876c86.js";import"./plus-icon-2a767bad.js";import"./DisplayOrder-43d5f15a.js";const R=()=>{const{t:r}=h("identity-providers"),m="saml",{adminClient:o}=j(),{realm:n}=I(),{setValue:p,register:u,setError:l,clearErrors:c,formState:{errors:i}}=S(),v=t=>{Object.entries(t).map(([d,s])=>p(`config.${d}`,s))},a=async t=>{if(c("discoveryError"),!t)return;const d=new FormData;d.append("providerId",m),d.append("file",new Blob([t]));try{const s=await fetch(`${P(o.baseUrl)}admin/realms/${n}/identity-provider/import-config`,{method:"POST",body:d,headers:T(await o.getAccessToken())});if(s.ok){const b=await s.json();v(b)}else l("discoveryError",{type:"manual",message:s.statusText})}catch(s){l("discoveryError",{type:"manual",message:s.message})}};return e.jsxs(e.Fragment,{children:[e.jsx(E,{headingLevel:"h4",size:"xl",className:"kc-form-panel__title",children:r("samlSettings")}),e.jsx(f,{label:r("serviceProviderEntityId"),fieldId:"kc-service-provider-entity-id",labelIcon:e.jsx(y,{helpText:r("identity-providers-help:serviceProviderEntityId"),fieldLabelId:"identity-providers:serviceProviderEntityId"}),isRequired:!0,helperTextInvalid:r("common:required"),validated:i.config?.entityId?"error":"default",children:e.jsx(q,{"data-testid":"serviceProviderEntityId",id:"kc-service-provider-entity-id",validated:i.config?.entityId?"error":"default",defaultValue:`${F.authServerUrl}/realms/${n}`,...u("config.entityId",{required:!0})})}),e.jsx(z,{id:"saml",fileUpload:e.jsx(f,{label:r("importConfig"),fieldId:"kc-import-config",labelIcon:e.jsx(y,{helpText:r("identity-providers-help:importConfig"),fieldLabelId:"identity-providers:importConfig"}),validated:i.discoveryError?"error":"default",helperTextInvalid:i.discoveryError?.message,children:e.jsx(K,{id:"kc-import-config",extension:".xml",hideDefaultPreview:!0,unWrap:!0,validated:i.discoveryError?"error":"default",onChange:t=>a(t)})}),children:t=>e.jsx(B,{readOnly:t})})]})};function xe(){const{t:r}=h("identity-providers"),m=A(),o="saml",n=C({defaultValues:{alias:o,config:{allowCreate:"true"}}}),{handleSubmit:p,formState:{isDirty:u}}=n,{adminClient:l}=j(),{addAlert:c}=k(),{realm:i}=I(),v=async a=>{delete a.discoveryEndpoint;try{await l.identityProviders.create({...a,providerId:o}),c(r("createSuccess"),x.success),m(V({realm:i,providerId:o,alias:a.alias,tab:"settings"}))}catch(t){c(r("createError",{error:t.response?.data?.errorMessage||t}),x.danger)}};return e.jsxs(e.Fragment,{children:[e.jsx($,{titleKey:r("addSamlProvider")}),e.jsx(w,{variant:"light",children:e.jsx(D,{...n,children:e.jsxs(G,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:p(v),children:[e.jsx(H,{id:o}),e.jsx(R,{}),e.jsxs(O,{children:[e.jsx(g,{isDisabled:!u,variant:"primary",type:"submit","data-testid":"createProvider",children:r("common:add")}),e.jsx(g,{variant:"link","data-testid":"cancel",component:a=>e.jsx(L,{...a,to:U({realm:i})}),children:r("common:cancel")})]})]})})})]})}export{xe as default};
//# sourceMappingURL=AddSamlConnect-f9c32f49.js.map
