import{u as y,d as I,e as B,c as h,b as Y,r as j,k as E,A as Z,j as e,B as R,L as k,aV as V,R as ie,z as q,n as ae,an as J,am as N,G as W,az as Q,Z as oe,P as re,al as O,aS as ce,ab as le,aW as de,a8 as U,aX as me,aY as ue}from"./index-a3421f29.js";import{u as F}from"./ConfirmDialog-09ff7a12.js";import{V as pe,F as ye}from"./ViewHeader-832ec56e.js";import{K as M}from"./KeycloakDataTable-10a62d94.js";import{j as $}from"./joinPath-55fd24bc.js";import{L as he}from"./PaginatingTableToolbar-08ca9efb.js";import{u as xe,F as _}from"./useFormatDate-7fddef56.js";import{V as ge,N as T,W as ee}from"./Td-6d4ab209.js";import{i as fe,g as je}from"./utils-49fe564a.js";import{R as te,u as se}from"./RoutableTabs-7f56b0c5.js";import{u as Ce}from"./useToggle-a9cb2c55.js";import{u as be,m as Te}from"./useLocaleSort-3efc7c31.js";import{M as De,a as Ae}from"./Modal-21c37af7.js";import{e as ke,D as z,a as G,c as H,d as v}from"./DataListItemRow-75e02946.js";import{b as w}from"./ToolbarContent-7b435752.js";import{a as D,b as A}from"./Tabs-5beaba80.js";import"./Text-564bf299.js";import"./EmptyStateBody-7b4fcee1.js";import"./plus-circle-icon-cb854796.js";import"./EmptyStateSecondaryActions-08edafb5.js";import"./TableToolbar-ee0c86ef.js";import"./Form-518a2cf2.js";import"./star-icon-6a7e7d25.js";import"./check-fc57dbe1.js";import"./grip-vertical-icon-cbeff50f.js";import"./Checkbox-d00621d8.js";import"./data-list-7d55714c.js";import"./plus-icon-2a767bad.js";import"./MenuList-e3786b59.js";const Re=()=>({className:ge.modifiers.wrap}),Ie=({rootUrl:t,baseUrl:s},n)=>s?.startsWith("http")?s:(t==="${authBaseUrl}"||t==="${authAdminUrl}")&&s?t.replace(/\$\{(authAdminUrl|authBaseUrl)\}/,$(n,s)):t?.startsWith("http")?s?$(t,s):t:s,Le=()=>{const{t}=y("clients"),{adminClient:s}=I(),{addAlert:n,addError:r}=B(),{realm:a}=h(),c=xe(),u=Y(),[l,i]=j.useState(),C=async()=>{try{return await s.realms.getClientsInitialAccess({realm:a})}catch{return[]}},[p,x]=F({titleKey:"clients:tokenDeleteConfirmTitle",messageKey:t("tokenDeleteConfirm",{id:l?.id}),continueButtonLabel:"common:delete",continueButtonVariant:E.danger,onConfirm:async()=>{try{await s.realms.delClientsInitialAccess({realm:a,id:l.id}),n(t("tokenDeleteSuccess"),Z.success),i(void 0)}catch(o){r("clients:tokenDeleteError",o)}}});return e.jsxs(e.Fragment,{children:[e.jsx(x,{}),e.jsx(M,{ariaLabelKey:"clients:initialAccessToken",searchPlaceholderKey:"clients:searchInitialAccessToken",loader:C,toolbarItem:e.jsx(R,{component:o=>e.jsx(k,{...o,to:V({realm:a})}),children:t("common:create")}),actions:[{title:t("common:delete"),onRowClick:o=>{i(o),p()}}],columns:[{name:"id",displayKey:"common:id"},{name:"timestamp",displayKey:"clients:timestamp",cellRenderer:o=>c(new Date(o.timestamp*1e3),_)},{name:"expiration",displayKey:"clients:expires",cellRenderer:o=>c(new Date(o.timestamp*1e3+o.expiration*1e3),_)},{name:"count",displayKey:"clients:count"},{name:"remainingCount",displayKey:"clients:remainingCount",transforms:[Re]}],emptyState:e.jsx(he,{message:t("noTokens"),instructions:t("noTokensInstructions"),primaryActionText:t("common:create"),onPrimaryAction:()=>u(V({realm:a}))})},l?.id)]})},Ke=({onConfirm:t,toggleDialog:s})=>{const{t:n}=y("clients"),r=ie(),a=Object.keys(r.providers?.["client-registration-policy"].providers||[]),c=r.componentTypes?.["org.keycloak.services.clientregistration.policy.ClientRegistrationPolicy"],u=be(),l=j.useMemo(()=>u(c?.filter(i=>a.includes(i.id))||[],Te("id")),[a,c]);return e.jsx(De,{variant:Ae.medium,title:n("chooseAPolicyProvider"),isOpen:!0,onClose:s,children:e.jsxs(ke,{onSelectDataListItem:i=>{t(i),s()},"aria-label":n("addPredefinedMappers"),isCompact:!0,children:[e.jsx(z,{"aria-label":n("headerName"),id:"header",children:e.jsx(G,{children:e.jsx(H,{dataListCells:[n("common:name"),n("common:description")].map(i=>e.jsx(v,{style:{fontWeight:700},children:i},i))})})}),l.map(i=>e.jsx(z,{"aria-label":i.id,"data-testid":i.id,id:i.id,children:e.jsx(G,{children:e.jsx(H,{dataListCells:[e.jsx(v,{width:2,children:i.id},`name-${i.id}`),e.jsx(v,{width:4,children:i.helpText},`description-${i.id}`)]})})},i.id))]})})},Pe=t=>{const{realm:s}=h(),{subTab:n}=q();return e.jsx(k,{to:J({realm:s,subTab:n||"anonymous",providerId:t.providerId,id:t.id}),children:t.name},t.id)},X=({subType:t})=>{const{t:s}=y("clients"),{subTab:n}=q(),r=Y(),{adminClient:a}=I(),{addAlert:c,addError:u}=B(),{realm:l}=h(),[i,C]=j.useState([]),[p,x]=j.useState(),[o,g]=Ce();ae(()=>a.components.find({type:"org.keycloak.services.clientregistration.policy.ClientRegistrationPolicy"}),d=>C(d.filter(P=>P.subType===t)),[p]);const[L,K]=F({titleKey:"clients:clientRegisterPolicyDeleteConfirmTitle",messageKey:s("clientRegisterPolicyDeleteConfirm",{name:p?.name}),continueButtonLabel:"common:delete",continueButtonVariant:E.danger,onConfirm:async()=>{try{await a.components.del({realm:l,id:p?.id}),c(s("clientRegisterPolicyDeleteSuccess")),x(void 0)}catch(d){u("clients:clientRegisterPolicyDeleteError",d)}}});return e.jsxs(e.Fragment,{children:[o&&e.jsx(Ke,{onConfirm:d=>r(J({realm:l,subTab:n||"anonymous",providerId:d})),toggleDialog:g}),e.jsx(K,{}),e.jsx(M,{ariaLabelKey:"clients:initialAccessToken",searchPlaceholderKey:"clients:searchInitialAccessToken",loader:i,toolbarItem:e.jsx(w,{children:e.jsx(R,{"data-testid":"createPolicy",onClick:g,children:s("createPolicy")})}),actions:[{title:s("common:delete"),onRowClick:d=>{x(d),L()}}],columns:[{name:"name",displayKey:"common:name",cellRenderer:Pe},{name:"providerId",displayKey:"clients:providerId"}]})]})},Se=()=>{const{t}=y("clients"),{realm:s}=h(),n=c=>se(N({realm:s,subTab:c})),r=n("anonymous"),a=n("authenticated");return e.jsxs(te,{defaultLocation:N({realm:s,subTab:"anonymous"}),mountOnEnter:!0,children:[e.jsx(D,{"data-testid":"anonymous",title:e.jsxs(A,{children:[t("anonymousAccessPolicies")," ",e.jsx(W,{fieldLabelId:"",helpText:t("clients-help:anonymousAccessPolicies"),noVerticalAlign:!1,unWrap:!0})]}),...r,children:e.jsx(X,{subType:"anonymous"})}),e.jsx(D,{"data-testid":"authenticated",title:e.jsxs(A,{children:[t("authenticatedAccessPolicies")," ",e.jsx(W,{fieldLabelId:"",helpText:t("clients-help:authenticatedAccessPolicies"),noVerticalAlign:!1,unWrap:!0})]}),...a,children:e.jsx(X,{subType:"authenticated"})})]})},ve=t=>{const{t:s}=y("clients"),{realm:n}=h();return e.jsxs(k,{to:le({realm:n,clientId:t.id,tab:"settings"}),children:[t.clientId,!t.enabled&&e.jsx(de,{isRead:!0,className:"pf-u-ml-sm",children:s("common:disabled")},`${t.id}-disabled`)]},t.id)},we=t=>e.jsx(ee,{wrapModifier:"truncate",children:U()(t.name)}),Be=t=>e.jsx(ee,{wrapModifier:"truncate",children:U()(t.description)}),Ee=t=>{const{adminClient:s}=I(),n=Ie(t,s.baseUrl);return n?e.jsx(ye,{href:n}):"â€”"},Fe=()=>{const{t}=y("clients"),{realm:s}=h(),{hasAccess:n}=Q();return n("manage-clients")?e.jsxs(e.Fragment,{children:[e.jsx(w,{children:e.jsx(R,{component:a=>e.jsx(k,{...a,to:me({realm:s})}),children:t("createClient")})}),e.jsx(w,{children:e.jsx(R,{component:a=>e.jsx(k,{...a,to:ue({realm:s})}),variant:"link","data-testid":"importClient",children:t("importClient")})})]}):e.jsx("span",{})};function ut(){const{t}=y("clients"),{addAlert:s,addError:n}=B(),{adminClient:r}=I(),{realm:a}=h(),[c,u]=j.useState(0),l=()=>u(new Date().getTime()),[i,C]=j.useState(),{hasAccess:p}=Q(),x=p("manage-clients"),o=async(m,f,b)=>{const S={first:m,max:f};return b&&(S.clientId=b,S.search=!0),await r.clients.find({...S})},g=m=>se(O({realm:a,tab:m})),L=g("list"),K=g("initial-access-token"),d=g("client-registration"),[P,ne]=F({titleKey:t("clientDelete",{clientId:i?.clientId}),messageKey:"clients:clientDeleteConfirm",continueButtonLabel:"common:delete",continueButtonVariant:E.danger,onConfirm:async()=>{try{await r.clients.del({id:i.id}),s(t("clientDeletedSuccess"),Z.success),l()}catch(m){n("clients:clientDeleteError",m)}}});return e.jsxs(e.Fragment,{children:[e.jsx(pe,{titleKey:"clients:clientList",subKey:"clients:clientsExplain",helpUrl:oe.clientsUrl,divider:!1}),e.jsx(re,{variant:"light",className:"pf-u-p-0",children:e.jsxs(te,{mountOnEnter:!0,isBox:!0,defaultLocation:O({realm:a,tab:"list"}),children:[e.jsxs(D,{"data-testid":"list",title:e.jsx(A,{children:t("clientsList")}),...L,children:[e.jsx(ne,{}),e.jsx(M,{loader:o,isPaginated:!0,ariaLabelKey:"clients:clientList",searchPlaceholderKey:"clients:searchForClient",toolbarItem:e.jsx(Fe,{}),actionResolver:m=>{const f=m.data,b=[{title:t("common:export"),onClick(){ce(f)}}];return!fe(f)&&(x||f.access?.configure)&&b.push({title:t("common:delete"),onClick(){C(f),P()}}),b},columns:[{name:"clientId",displayKey:"common:clientId",transforms:[T(20)],cellRenderer:ve},{name:"clientName",displayKey:"common:clientName",transforms:[T(20)],cellRenderer:we},{name:"protocol",displayKey:"common:type",transforms:[T(10)],cellRenderer:m=>je(t,m.protocol??"openid-connect")},{name:"description",displayKey:"common:description",transforms:[T(30)],cellRenderer:Be},{name:"baseUrl",displayKey:"clients:homeURL",transforms:[T(20)],cellRenderer:Ee}]},c)]}),e.jsx(D,{"data-testid":"initialAccessToken",title:e.jsx(A,{children:t("initialAccessToken")}),...K,children:e.jsx(Le,{})}),e.jsx(D,{"data-testid":"registration",title:e.jsx(A,{children:t("clientRegistration")}),...d,children:e.jsx(Se,{})})]})})]})}export{ut as default};
//# sourceMappingURL=ClientsSection-154fe9a4.js.map
