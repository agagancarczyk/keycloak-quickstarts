{"version":3,"file":"AddRoleMappingModal-abb19beb.js","sources":["../../src/components/role-mapping/queries.ts","../../src/components/role-mapping/RoleMapping.tsx","../../src/components/role-mapping/AddRoleMappingModal.tsx"],"sourcesContent":["import type RoleRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/roleRepresentation\";\nimport type MappingsRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/mappingsRepresentation\";\nimport type { ClientScopes } from \"@keycloak/keycloak-admin-client/lib/resources/clientScopes\";\nimport type { Groups } from \"@keycloak/keycloak-admin-client/lib/resources/groups\";\nimport type { Roles } from \"@keycloak/keycloak-admin-client/lib/resources/roles\";\nimport type { Users } from \"@keycloak/keycloak-admin-client/lib/resources/users\";\nimport type { Clients } from \"@keycloak/keycloak-admin-client/lib/resources/clients\";\nimport type KeycloakAdminClient from \"@keycloak/keycloak-admin-client\";\n\nimport { Row } from \"./RoleMapping\";\n\nexport type ResourcesKey = keyof KeycloakAdminClient;\n\ntype DeleteFunctions =\n  | keyof Pick<Groups, \"delClientRoleMappings\" | \"delRealmRoleMappings\">\n  | keyof Pick<ClientScopes, \"delClientScopeMappings\" | \"delRealmScopeMappings\">\n  | keyof Pick<Roles, \"delCompositeRoles\">;\n\ntype ListEffectiveFunction =\n  | keyof Pick<Groups, \"listRoleMappings\" | \"listAvailableRealmRoleMappings\">\n  | keyof Pick<\n      ClientScopes,\n      | \"listScopeMappings\"\n      | \"listAvailableRealmScopeMappings\"\n      | \"listCompositeClientScopeMappings\"\n    >\n  | keyof Pick<Roles, \"getCompositeRoles\" | \"getCompositeRolesForClient\">\n  | keyof Pick<\n      Users,\n      \"listCompositeClientRoleMappings\" | \"listCompositeRealmRoleMappings\"\n    >;\n\ntype ListAvailableFunction =\n  | keyof Pick<\n      Groups,\n      \"listAvailableClientRoleMappings\" | \"listAvailableRealmRoleMappings\"\n    >\n  | keyof Pick<\n      ClientScopes,\n      \"listAvailableClientScopeMappings\" | \"listAvailableRealmScopeMappings\"\n    >\n  | keyof Pick<Roles, \"find\">\n  | keyof Pick<Clients, \"listRoles\">;\n\ntype FunctionMapping = {\n  delete: DeleteFunctions[];\n  listAvailable: ListAvailableFunction[];\n  listEffective: ListEffectiveFunction[];\n};\n\ntype ResourceMapping = Partial<Record<ResourcesKey, FunctionMapping>>;\nconst groupFunctions: FunctionMapping = {\n  delete: [\"delClientRoleMappings\", \"delRealmRoleMappings\"],\n  listEffective: [\n    \"listRoleMappings\",\n    \"listCompositeRealmRoleMappings\",\n    \"listCompositeClientRoleMappings\",\n  ],\n  listAvailable: [\n    \"listAvailableClientRoleMappings\",\n    \"listAvailableRealmRoleMappings\",\n  ],\n};\n\nconst clientFunctions: FunctionMapping = {\n  delete: [\"delClientScopeMappings\", \"delRealmScopeMappings\"],\n  listEffective: [\n    \"listScopeMappings\",\n    \"listAvailableRealmScopeMappings\",\n    \"listCompositeClientScopeMappings\",\n  ],\n  listAvailable: [\n    \"listAvailableClientScopeMappings\",\n    \"listAvailableRealmScopeMappings\",\n  ],\n};\n\nconst mapping: ResourceMapping = {\n  groups: groupFunctions,\n  users: groupFunctions,\n  clientScopes: clientFunctions,\n  clients: clientFunctions,\n  roles: {\n    delete: [\"delCompositeRoles\", \"delCompositeRoles\"],\n    listEffective: [\n      \"getCompositeRoles\",\n      \"getCompositeRoles\",\n      \"getCompositeRolesForClient\",\n    ],\n    listAvailable: [\"listRoles\", \"find\"],\n  },\n};\n\ntype queryType =\n  | DeleteFunctions\n  | ListAvailableFunction\n  | ListEffectiveFunction;\n\nconst castAdminClient = (\n  adminClient: KeycloakAdminClient,\n  resource: ResourcesKey\n) =>\n  adminClient[resource] as unknown as {\n    [index in queryType]: (...params: any) => Promise<RoleRepresentation[]>;\n  };\n\nconst applyQuery = (\n  adminClient: KeycloakAdminClient,\n  type: ResourcesKey,\n  query: queryType,\n  ...params: object[]\n): Promise<RoleRepresentation[]> =>\n  castAdminClient(adminClient, type)[query](...params);\n\nexport const deleteMapping = (\n  adminClient: KeycloakAdminClient,\n  type: ResourcesKey,\n  id: string,\n  rows: Row[]\n) =>\n  rows.map((row) => {\n    const role = { id: row.role.id!, name: row.role.name! };\n    const query = mapping[type]?.delete[row.client ? 0 : 1]!;\n\n    return applyQuery(\n      adminClient,\n      type,\n      query,\n      {\n        id,\n        clientUniqueId: row.client?.id,\n        client: row.client?.id,\n        roles: [role],\n      },\n      [role]\n    );\n  });\n\nexport const getMapping = async (\n  adminClient: KeycloakAdminClient,\n  type: ResourcesKey,\n  id: string\n): Promise<MappingsRepresentation> => {\n  const query = mapping[type]!.listEffective[0];\n  const result = applyQuery(adminClient, type, query, { id });\n  if (type !== \"roles\") {\n    return result as MappingsRepresentation;\n  }\n  const roles = await result;\n  const clientRoles = await Promise.all(\n    roles\n      .filter((r) => r.clientRole)\n      .map(async (role) => {\n        const client = await adminClient.clients.findOne({\n          id: role.containerId!,\n        });\n\n        role.containerId = client?.clientId;\n        return { ...client, mappings: [role] };\n      })\n  );\n\n  return {\n    clientMappings: clientRoles,\n    realmMappings: roles.filter((r) => !r.clientRole),\n  };\n};\n\nexport const getEffectiveRoles = async (\n  adminClient: KeycloakAdminClient,\n  type: ResourcesKey,\n  id: string\n): Promise<Row[]> => {\n  const query = mapping[type]!.listEffective[1];\n  if (type !== \"roles\") {\n    return (await applyQuery(adminClient, type, query, { id })).map((role) => ({\n      role,\n    }));\n  }\n  const roles = await applyQuery(adminClient, type, query, { id });\n  const parentRoles = await Promise.all(\n    roles\n      .filter((r) => r.composite)\n      .map((r) => applyQuery(adminClient, type, query, { id: r.id }))\n  );\n  return [...roles, ...parentRoles.flat()].map((role) => ({ role }));\n};\n\nexport const getAvailableRoles = async (\n  adminClient: KeycloakAdminClient,\n  type: ResourcesKey,\n  params: Record<string, string | number>\n): Promise<Row[]> => {\n  const query = mapping[type]!.listAvailable[1];\n  return (await applyQuery(adminClient, type, query, params)).map((role) => ({\n    role,\n  }));\n};\n","import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  AlertVariant,\n  Badge,\n  Button,\n  ButtonVariant,\n  Checkbox,\n  ToolbarItem,\n} from \"@patternfly/react-core\";\nimport { cellWidth } from \"@patternfly/react-table\";\n\nimport type ClientRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/clientRepresentation\";\nimport type RoleRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/roleRepresentation\";\nimport type KeycloakAdminClient from \"@keycloak/keycloak-admin-client\";\nimport { AddRoleMappingModal } from \"./AddRoleMappingModal\";\nimport { Action, KeycloakDataTable } from \"../table-toolbar/KeycloakDataTable\";\nimport { emptyFormatter, upperCaseFormatter } from \"../../util\";\nimport { useAlerts } from \"../alert/Alerts\";\nimport { useConfirmDialog } from \"../confirm-dialog/ConfirmDialog\";\nimport { useAdminClient } from \"../../context/auth/AdminClient\";\nimport { ListEmptyState } from \"../list-empty-state/ListEmptyState\";\nimport { deleteMapping, getEffectiveRoles, getMapping } from \"./queries\";\nimport { getEffectiveClientRoles } from \"./resource\";\n\nimport \"./role-mapping.css\";\n\nexport type CompositeRole = RoleRepresentation & {\n  parent: RoleRepresentation;\n  isInherited?: boolean;\n};\n\nexport type Row = {\n  client?: ClientRepresentation;\n  role: RoleRepresentation | CompositeRole;\n  id?: string; // KeycloakDataTable expects an id for the row\n};\n\nexport const mapRoles = (\n  assignedRoles: Row[],\n  effectiveRoles: Row[],\n  hide: boolean\n) => [\n  ...(hide\n    ? assignedRoles.map((row) => ({\n        ...row,\n        role: {\n          ...row.role,\n          isInherited: false,\n        },\n      }))\n    : effectiveRoles.map((row) => ({\n        ...row,\n        role: {\n          ...row.role,\n          isInherited:\n            assignedRoles.find((r) => r.role.id === row.role.id) === undefined,\n        },\n      }))),\n];\n\nexport const ServiceRole = ({ role, client }: Row) => (\n  <>\n    {client?.clientId && (\n      <Badge isRead className=\"keycloak-admin--role-mapping__client-name\">\n        {client.clientId}\n      </Badge>\n    )}\n    {role.name}\n  </>\n);\n\nexport type ResourcesKey = keyof KeycloakAdminClient;\n\ntype RoleMappingProps = {\n  name: string;\n  id: string;\n  type: ResourcesKey;\n  isManager?: boolean;\n  save: (rows: Row[]) => Promise<void>;\n};\n\nexport const RoleMapping = ({\n  name,\n  id,\n  type,\n  isManager = true,\n  save,\n}: RoleMappingProps) => {\n  const { t } = useTranslation(type);\n  const { adminClient } = useAdminClient();\n  const { addAlert, addError } = useAlerts();\n\n  const [key, setKey] = useState(0);\n  const refresh = () => setKey(key + 1);\n\n  const [hide, setHide] = useState(true);\n  const [showAssign, setShowAssign] = useState(false);\n  const [selected, setSelected] = useState<Row[]>([]);\n\n  const assignRoles = async (rows: Row[]) => {\n    await save(rows);\n    refresh();\n  };\n\n  const loader = async () => {\n    let effectiveRoles: Row[] = [];\n    let effectiveClientRoles: Row[] = [];\n    if (!hide) {\n      effectiveRoles = await getEffectiveRoles(adminClient, type, id);\n\n      effectiveClientRoles = (\n        await getEffectiveClientRoles({\n          adminClient,\n          type,\n          id,\n        })\n      ).map((e) => ({\n        client: { clientId: e.client, id: e.clientId },\n        role: { id: e.id, name: e.role, description: e.description },\n      }));\n    }\n\n    const roles = await getMapping(adminClient, type, id);\n    const realmRolesMapping =\n      roles.realmMappings?.map((role) => ({ role })) || [];\n    const clientMapping = Object.values(roles.clientMappings || {})\n      .map((client) =>\n        client.mappings.map((role: RoleRepresentation) => ({\n          client: { clientId: client.client, ...client },\n          role,\n        }))\n      )\n      .flat();\n\n    return [\n      ...mapRoles(\n        [...realmRolesMapping, ...clientMapping],\n        [...effectiveClientRoles, ...effectiveRoles],\n        hide\n      ),\n    ];\n  };\n\n  const [toggleDeleteDialog, DeleteConfirm] = useConfirmDialog({\n    titleKey: \"clients:removeMappingTitle\",\n    messageKey: t(\"clients:removeMappingConfirm\", { count: selected.length }),\n    continueButtonLabel: \"common:remove\",\n    continueButtonVariant: ButtonVariant.danger,\n    onConfirm: async () => {\n      try {\n        await Promise.all(deleteMapping(adminClient, type, id, selected));\n        addAlert(t(\"clients:clientScopeRemoveSuccess\"), AlertVariant.success);\n        refresh();\n      } catch (error) {\n        addError(\"clients:clientScopeRemoveError\", error);\n      }\n    },\n  });\n\n  return (\n    <>\n      {showAssign && (\n        <AddRoleMappingModal\n          id={id}\n          type={type}\n          name={name}\n          onAssign={assignRoles}\n          onClose={() => setShowAssign(false)}\n        />\n      )}\n      <DeleteConfirm />\n      <KeycloakDataTable\n        data-testid=\"assigned-roles\"\n        key={`${id}${key}`}\n        loader={loader}\n        canSelectAll\n        onSelect={(rows) => setSelected(rows)}\n        searchPlaceholderKey=\"clients:searchByName\"\n        ariaLabelKey=\"clients:clientScopeList\"\n        isRowDisabled={(value) =>\n          (value.role as CompositeRole).isInherited || false\n        }\n        toolbarItem={\n          <>\n            <ToolbarItem>\n              <Checkbox\n                label={t(\"common:hideInheritedRoles\")}\n                id=\"hideInheritedRoles\"\n                data-testid=\"hideInheritedRoles\"\n                isChecked={hide}\n                onChange={(check) => {\n                  setHide(check);\n                  refresh();\n                }}\n              />\n            </ToolbarItem>\n            {isManager && (\n              <>\n                <ToolbarItem>\n                  <Button\n                    data-testid=\"assignRole\"\n                    onClick={() => setShowAssign(true)}\n                  >\n                    {t(\"common:assignRole\")}\n                  </Button>\n                </ToolbarItem>\n                <ToolbarItem>\n                  <Button\n                    variant=\"link\"\n                    data-testid=\"unAssignRole\"\n                    onClick={toggleDeleteDialog}\n                    isDisabled={selected.length === 0}\n                  >\n                    {t(\"common:unAssignRole\")}\n                  </Button>\n                </ToolbarItem>\n              </>\n            )}\n          </>\n        }\n        actions={\n          isManager\n            ? [\n                {\n                  title: t(\"common:unAssignRole\"),\n                  onRowClick: async (role) => {\n                    setSelected([role]);\n                    toggleDeleteDialog();\n                    return false;\n                  },\n                } as Action<Awaited<ReturnType<typeof loader>>[0]>,\n              ]\n            : []\n        }\n        columns={[\n          {\n            name: \"role.name\",\n            displayKey: t(\"common:name\"),\n            transforms: [cellWidth(30)],\n            cellRenderer: ServiceRole,\n          },\n          {\n            name: \"role.isInherited\",\n            displayKey: t(\"common:inherent\"),\n            cellFormatters: [upperCaseFormatter(), emptyFormatter()],\n          },\n          {\n            name: \"role.description\",\n            displayKey: t(\"common:description\"),\n            cellFormatters: [emptyFormatter()],\n          },\n        ]}\n        emptyState={\n          <ListEmptyState\n            message={t(\"noRoles\")}\n            instructions={t(\"noRolesInstructions\")}\n            primaryActionText={t(\"common:assignRole\")}\n            onPrimaryAction={() => setShowAssign(true)}\n          />\n        }\n      />\n    </>\n  );\n};\n","import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  Button,\n  Dropdown,\n  DropdownItem,\n  DropdownToggle,\n  Modal,\n  ModalVariant,\n  ToolbarItem,\n} from \"@patternfly/react-core\";\nimport { FilterIcon } from \"@patternfly/react-icons\";\n\nimport { KeycloakDataTable } from \"../table-toolbar/KeycloakDataTable\";\nimport { useAdminClient } from \"../../context/auth/AdminClient\";\nimport useLocaleSort from \"../../utils/useLocaleSort\";\nimport { ResourcesKey, Row, ServiceRole } from \"./RoleMapping\";\nimport { getAvailableRoles } from \"./queries\";\nimport { getAvailableClientRoles } from \"./resource\";\nimport { ListEmptyState } from \"../list-empty-state/ListEmptyState\";\n\ntype AddRoleMappingModalProps = {\n  id: string;\n  type: ResourcesKey;\n  name?: string;\n  isRadio?: boolean;\n  onAssign: (rows: Row[]) => void;\n  onClose: () => void;\n  isLDAPmapper?: boolean;\n};\n\ntype FilterType = \"roles\" | \"clients\";\n\nexport const AddRoleMappingModal = ({\n  id,\n  name,\n  type,\n  isRadio = false,\n  isLDAPmapper,\n  onAssign,\n  onClose,\n}: AddRoleMappingModalProps) => {\n  const { t } = useTranslation(type);\n  const { adminClient } = useAdminClient();\n\n  const [searchToggle, setSearchToggle] = useState(false);\n\n  const [filterType, setFilterType] = useState<FilterType>(\"roles\");\n  const [selectedRows, setSelectedRows] = useState<Row[]>([]);\n  const [key, setKey] = useState(0);\n  const refresh = () => setKey(key + 1);\n\n  const localeSort = useLocaleSort();\n  const compareRow = ({ role: { name } }: Row) => name?.toUpperCase();\n\n  const loader = async (\n    first?: number,\n    max?: number,\n    search?: string\n  ): Promise<Row[]> => {\n    const params: Record<string, string | number> = {\n      first: first!,\n      max: max!,\n    };\n\n    if (search) {\n      params.search = search;\n    }\n\n    const roles = await getAvailableRoles(adminClient, type, { ...params, id });\n    const sorted = localeSort(roles, compareRow);\n    return sorted.map((row) => {\n      return {\n        role: row.role,\n        id: row.role.id,\n      };\n    });\n  };\n\n  const clientRolesLoader = async (\n    first?: number,\n    max?: number,\n    search?: string\n  ): Promise<Row[]> => {\n    const roles = await getAvailableClientRoles({\n      adminClient,\n      id,\n      type,\n      first: first || 0,\n      max: max || 10,\n      search,\n    });\n\n    return localeSort(\n      roles.map((e) => ({\n        client: { clientId: e.client, id: e.clientId },\n        role: { id: e.id, name: e.role, description: e.description },\n        id: e.id,\n      })),\n      ({ client: { clientId }, role: { name } }) => `${clientId}${name}`\n    );\n  };\n\n  return (\n    <Modal\n      variant={ModalVariant.large}\n      title={\n        isLDAPmapper\n          ? t(\"common:assignRole\")\n          : t(\"common:assignRolesTo\", { client: name })\n      }\n      isOpen\n      onClose={onClose}\n      actions={[\n        <Button\n          data-testid=\"assign\"\n          key=\"confirm\"\n          isDisabled={selectedRows.length === 0}\n          variant=\"primary\"\n          onClick={() => {\n            onAssign(selectedRows);\n            onClose();\n          }}\n        >\n          {t(\"common:assign\")}\n        </Button>,\n        <Button\n          data-testid=\"cancel\"\n          key=\"cancel\"\n          variant=\"link\"\n          onClick={onClose}\n        >\n          {t(\"common:cancel\")}\n        </Button>,\n      ]}\n    >\n      <KeycloakDataTable\n        key={key}\n        onSelect={(rows) => setSelectedRows([...rows])}\n        searchPlaceholderKey=\"clients:searchByRoleName\"\n        isPaginated={!(filterType === \"roles\" && type === \"users\")}\n        searchTypeComponent={\n          <ToolbarItem>\n            <Dropdown\n              onSelect={() => {\n                setFilterType(filterType === \"roles\" ? \"clients\" : \"roles\");\n                setSearchToggle(false);\n                refresh();\n              }}\n              data-testid=\"filter-type-dropdown\"\n              toggle={\n                <DropdownToggle\n                  onToggle={setSearchToggle}\n                  icon={<FilterIcon />}\n                >\n                  {filterType === \"roles\"\n                    ? t(\"common:filterByRoles\")\n                    : t(\"common:filterByClients\")}\n                </DropdownToggle>\n              }\n              isOpen={searchToggle}\n              dropdownItems={[\n                <DropdownItem key=\"filter-type\" data-testid={filterType}>\n                  {filterType === \"roles\"\n                    ? t(\"common:filterByClients\")\n                    : t(\"common:filterByRoles\")}\n                </DropdownItem>,\n              ]}\n            />\n          </ToolbarItem>\n        }\n        canSelectAll\n        isRadio={isRadio}\n        loader={filterType === \"roles\" ? loader : clientRolesLoader}\n        ariaLabelKey=\"clients:roles\"\n        columns={[\n          {\n            name: \"name\",\n            cellRenderer: ServiceRole,\n          },\n          {\n            name: \"role.description\",\n            displayKey: \"common:description\",\n          },\n        ]}\n        emptyState={\n          <ListEmptyState\n            message={t(\"noRoles\")}\n            instructions={t(\"common:noRealmRolesToAssign\")}\n            secondaryActions={[\n              {\n                text: t(\"common:filterByClients\"),\n                onClick: () => {\n                  setFilterType(\"clients\");\n                  refresh();\n                },\n              },\n            ]}\n          />\n        }\n      />\n    </Modal>\n  );\n};\n"],"names":["groupFunctions","clientFunctions","mapping","castAdminClient","adminClient","resource","applyQuery","type","query","params","deleteMapping","id","rows","row","role","getMapping","result","roles","r","client","getEffectiveRoles","parentRoles","getAvailableRoles","mapRoles","assignedRoles","effectiveRoles","hide","ServiceRole","jsxs","Fragment","Badge","RoleMapping","name","isManager","save","t","useTranslation","useAdminClient","addAlert","addError","useAlerts","key","setKey","useState","refresh","setHide","showAssign","setShowAssign","selected","setSelected","assignRoles","loader","effectiveClientRoles","getEffectiveClientRoles","e","realmRolesMapping","clientMapping","toggleDeleteDialog","DeleteConfirm","useConfirmDialog","ButtonVariant","AlertVariant","error","jsx","AddRoleMappingModal","KeycloakDataTable","value","ToolbarItem","Checkbox","check","Button","cellWidth","upperCaseFormatter","emptyFormatter","ListEmptyState","isRadio","isLDAPmapper","onAssign","onClose","searchToggle","setSearchToggle","filterType","setFilterType","selectedRows","setSelectedRows","localeSort","useLocaleSort","compareRow","first","max","search","clientRolesLoader","getAvailableClientRoles","clientId","Modal","ModalVariant","Dropdown","DropdownToggle","FilterIcon","DropdownItem"],"mappings":"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"}