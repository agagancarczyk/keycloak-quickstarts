{"version":3,"file":"DiscoveryEndpointField-1ac4d0ed.js","sources":["../../src/identity-providers/component/DiscoveryEndpointField.tsx"],"sourcesContent":["import { FormGroup, Switch } from \"@patternfly/react-core\";\nimport { ReactNode, useEffect, useState } from \"react\";\nimport { useFormContext } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { HelpItem } from \"ui-shared\";\nimport { KeycloakTextInput } from \"../../components/keycloak-text-input/KeycloakTextInput\";\nimport { useAdminClient } from \"../../context/auth/AdminClient\";\nimport environment from \"../../environment\";\n\ntype DiscoveryEndpointFieldProps = {\n  id: string;\n  fileUpload: ReactNode;\n  children: (readOnly: boolean) => ReactNode;\n};\n\nexport const DiscoveryEndpointField = ({\n  id,\n  fileUpload,\n  children,\n}: DiscoveryEndpointFieldProps) => {\n  const { t } = useTranslation(\"identity-providers\");\n\n  const { adminClient } = useAdminClient();\n\n  const {\n    setValue,\n    register,\n    setError,\n    watch,\n    clearErrors,\n    formState: { errors },\n  } = useFormContext();\n  const discoveryUrl = watch(\"discoveryEndpoint\");\n\n  const [discovery, setDiscovery] = useState(true);\n  const [discovering, setDiscovering] = useState(false);\n  const [discoveryResult, setDiscoveryResult] =\n    useState<Record<string, string>>();\n\n  const setupForm = (result: Record<string, string>) => {\n    Object.keys(result).map((k) => setValue(`config.${k}`, result[k]));\n  };\n\n  useEffect(() => {\n    if (!discoveryUrl) {\n      setDiscovering(false);\n      return;\n    }\n\n    (async () => {\n      clearErrors(\"discoveryError\");\n      try {\n        const result = await adminClient.identityProviders.importFromUrl({\n          providerId: id,\n          fromUrl: discoveryUrl,\n        });\n        setupForm(result);\n        setDiscoveryResult(result);\n      } catch (error) {\n        setError(\"discoveryError\", {\n          type: \"manual\",\n          message: (error as Error).message,\n        });\n      }\n\n      setDiscovering(false);\n    })();\n  }, [discovering]);\n\n  return (\n    <>\n      <FormGroup\n        label={t(\n          id === \"oidc\" ? \"useDiscoveryEndpoint\" : \"useEntityDescriptor\"\n        )}\n        fieldId=\"kc-discovery-endpoint\"\n        labelIcon={\n          <HelpItem\n            helpText={`identity-providers-help:${\n              id === \"oidc\" ? \"useDiscoveryEndpoint\" : \"useEntityDescriptor\"\n            }`}\n            fieldLabelId=\"identity-providers:discoveryEndpoint\"\n          />\n        }\n      >\n        <Switch\n          id=\"kc-discovery-endpoint-switch\"\n          label={t(\"common:on\")}\n          labelOff={t(\"common:off\")}\n          isChecked={discovery}\n          onChange={(checked) => {\n            clearErrors(\"discoveryError\");\n            setDiscovery(checked);\n          }}\n          aria-label={t(\n            id === \"oidc\" ? \"useDiscoveryEndpoint\" : \"useEntityDescriptor\"\n          )}\n        />\n      </FormGroup>\n      {discovery && (\n        <FormGroup\n          label={t(\n            id === \"oidc\" ? \"discoveryEndpoint\" : \"samlEntityDescriptor\"\n          )}\n          fieldId=\"kc-discovery-endpoint\"\n          labelIcon={\n            <HelpItem\n              helpText={`identity-providers-help:${\n                id === \"oidc\" ? \"discoveryEndpoint\" : \"samlEntityDescriptor\"\n              }`}\n              fieldLabelId=\"identity-providers:discoveryEndpoint\"\n            />\n          }\n          validated={\n            errors.discoveryError || errors.discoveryEndpoint\n              ? \"error\"\n              : !discoveryResult\n              ? \"default\"\n              : \"success\"\n          }\n          helperTextInvalid={\n            errors.discoveryEndpoint\n              ? t(\"common:required\")\n              : t(\"noValidMetaDataFound\", {\n                  error: errors.discoveryError?.message,\n                })\n          }\n          isRequired\n        >\n          <KeycloakTextInput\n            type=\"url\"\n            data-testid=\"discoveryEndpoint\"\n            id=\"kc-discovery-endpoint\"\n            placeholder={\n              id === \"oidc\"\n                ? \"https://hostname/auth/realms/master/.well-known/openid-configuration\"\n                : \"\"\n            }\n            validated={\n              errors.discoveryError || errors.discoveryEndpoint\n                ? \"error\"\n                : !discoveryResult\n                ? \"default\"\n                : \"success\"\n            }\n            customIconUrl={\n              discovering\n                ? environment.resourceUrl + \"/discovery-load-indicator.svg\"\n                : \"\"\n            }\n            {...register(\"discoveryEndpoint\", {\n              required: true,\n              onBlur: () => setDiscovering(true),\n            })}\n          />\n        </FormGroup>\n      )}\n      {!discovery && fileUpload}\n      {discovery && !errors.discoveryError && children(true)}\n      {!discovery && children(false)}\n    </>\n  );\n};\n"],"names":["DiscoveryEndpointField","id","fileUpload","children","t","useTranslation","adminClient","useAdminClient","setValue","register","setError","watch","clearErrors","errors","useFormContext","discoveryUrl","discovery","setDiscovery","useState","discovering","setDiscovering","discoveryResult","setDiscoveryResult","setupForm","result","k","useEffect","error","jsxs","Fragment","jsx","FormGroup","HelpItem","Switch","checked","KeycloakTextInput","environment"],"mappings":"gJAgBO,MAAMA,EAAyB,CAAC,CACrC,GAAAC,EACA,WAAAC,EACA,SAAAC,CACF,IAAmC,CACjC,KAAM,CAAE,EAAAC,CAAA,EAAMC,EAAe,oBAAoB,EAE3C,CAAE,YAAAC,GAAgBC,IAElB,CACJ,SAAAC,EACA,SAAAC,EACA,SAAAC,EACA,MAAAC,EACA,YAAAC,EACA,UAAW,CAAE,OAAAC,CAAO,GAClBC,EAAe,EACbC,EAAeJ,EAAM,mBAAmB,EAExC,CAACK,EAAWC,CAAY,EAAIC,WAAS,EAAI,EACzC,CAACC,EAAaC,CAAc,EAAIF,WAAS,EAAK,EAC9C,CAACG,EAAiBC,CAAkB,EACxCJ,EAAiC,SAAA,EAE7BK,EAAaC,GAAmC,CACpD,OAAO,KAAKA,CAAM,EAAE,IAAKC,GAAMjB,EAAS,UAAUiB,IAAKD,EAAOC,CAAC,CAAC,CAAC,CAAA,EAGnEC,OAAAA,EAAAA,UAAU,IAAM,CACd,GAAI,CAACX,EAAc,CACjBK,EAAe,EAAK,EACpB,QAGD,SAAY,CACXR,EAAY,gBAAgB,EACxB,GAAA,CACF,MAAMY,EAAS,MAAMlB,EAAY,kBAAkB,cAAc,CAC/D,WAAYL,EACZ,QAASc,CAAA,CACV,EACDQ,EAAUC,CAAM,EAChBF,EAAmBE,CAAM,QAClBG,GACPjB,EAAS,iBAAkB,CACzB,KAAM,SACN,QAAUiB,EAAgB,OAAA,CAC3B,CACH,CAEAP,EAAe,EAAK,CAAA,IACnB,EACF,CAACD,CAAW,CAAC,EAIZS,EAAA,KAAAC,WAAA,CAAA,SAAA,CAAAC,EAAA,IAACC,EAAA,CACC,MAAO3B,EACLH,IAAO,OAAS,uBAAyB,qBAC3C,EACA,QAAQ,wBACR,UACE6B,EAAA,IAACE,EAAA,CACC,SAAU,2BACR/B,IAAO,OAAS,uBAAyB,wBAE3C,aAAa,sCAAA,CACf,EAGF,SAAA6B,EAAA,IAACG,EAAA,CACC,GAAG,+BACH,MAAO7B,EAAE,WAAW,EACpB,SAAUA,EAAE,YAAY,EACxB,UAAWY,EACX,SAAWkB,GAAY,CACrBtB,EAAY,gBAAgB,EAC5BK,EAAaiB,CAAO,CACtB,EACA,aAAY9B,EACVH,IAAO,OAAS,uBAAyB,qBAC3C,CAAA,CACF,CAAA,CACF,EACCe,GACCc,EAAA,IAACC,EAAA,CACC,MAAO3B,EACLH,IAAO,OAAS,oBAAsB,sBACxC,EACA,QAAQ,wBACR,UACE6B,EAAA,IAACE,EAAA,CACC,SAAU,2BACR/B,IAAO,OAAS,oBAAsB,yBAExC,aAAa,sCAAA,CACf,EAEF,UACEY,EAAO,gBAAkBA,EAAO,kBAC5B,QACCQ,EAED,UADA,UAGN,kBACER,EAAO,kBACHT,EAAE,iBAAiB,EACnBA,EAAE,uBAAwB,CACxB,MAAOS,EAAO,gBAAgB,OAAA,CAC/B,EAEP,WAAU,GAEV,SAAAiB,EAAA,IAACK,EAAA,CACC,KAAK,MACL,cAAY,oBACZ,GAAG,wBACH,YACElC,IAAO,OACH,uEACA,GAEN,UACEY,EAAO,gBAAkBA,EAAO,kBAC5B,QACCQ,EAED,UADA,UAGN,cACEF,EACIiB,EAAY,YAAc,gCAC1B,GAEL,GAAG3B,EAAS,oBAAqB,CAChC,SAAU,GACV,OAAQ,IAAMW,EAAe,EAAI,CAAA,CAClC,CAAA,CACH,CAAA,CACF,EAED,CAACJ,GAAad,EACdc,GAAa,CAACH,EAAO,gBAAkBV,EAAS,EAAI,EACpD,CAACa,GAAab,EAAS,EAAK,CAC/B,CAAA,CAAA,CAEJ"}