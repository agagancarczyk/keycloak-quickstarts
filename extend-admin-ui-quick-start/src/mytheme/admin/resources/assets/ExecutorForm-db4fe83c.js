import{u as _,b as q,e as J,r as l,R as Q,d as U,f as W,n as X,j as t,P as Y,F as Z,G as b,C as $,g as ee,B as g,L as S,d4 as h,A as te}from"./index-a3421f29.js";import{D as oe}from"./DynamicComponents-72877b30.js";import{F as re}from"./FormAccess-1cceaef6.js";import{V as se}from"./ViewHeader-832ec56e.js";import{u as V}from"./useParams-5abeab7d.js";import{S as ie,a as ae,b as ce}from"./Select-0f56a9cc.js";import{A as ne}from"./Form-518a2cf2.js";import"./ClientSelect-3f0fc581.js";import"./FileUpload-ca37c1a6.js";import"./CodeEditor-2fb93648.js";import"./copy-icon-a4fe01af.js";import"./EmptyStateBody-7b4fcee1.js";import"./EmptyStateSecondaryActions-08edafb5.js";import"./GroupPickerDialog-caf8c38d.js";import"./PaginatingTableToolbar-08ca9efb.js";import"./plus-circle-icon-cb854796.js";import"./TableToolbar-ee0c86ef.js";import"./ToolbarContent-7b435752.js";import"./DataListItemRow-75e02946.js";import"./data-list-7d55714c.js";import"./grip-vertical-icon-cbeff50f.js";import"./Modal-21c37af7.js";import"./ActionListItem-ab1a4322.js";import"./FlexItem-65b5f999.js";import"./minus-circle-icon-6f9a971c.js";import"./MultiLineInput-14187d1c.js";import"./PasswordInput-85f9399f.js";import"./KeycloakTextInput-e7f6e917.js";import"./useToggle-a9cb2c55.js";import"./AddRoleMappingModal-abb19beb.js";import"./KeycloakDataTable-10a62d94.js";import"./Td-6d4ab209.js";import"./star-icon-6a7e7d25.js";import"./check-fc57dbe1.js";import"./Checkbox-d00621d8.js";import"./useLocaleSort-3efc7c31.js";import"./resource-08ae7dbc.js";import"./joinPath-55fd24bc.js";import"./filter-icon-9d72dc58.js";import"./ConfirmDialog-09ff7a12.js";import"./KeycloakTextArea-1b518857.js";import"./GridItem-d34dae2e.js";import"./Text-564bf299.js";const k={config:{},executor:""};function Ze(){const{t:i}=_("realm-settings"),F=q(),{realm:u,profileName:c}=V(),{executorName:n}=V(),{addAlert:A,addError:C}=J(),[I,P]=l.useState(!1),G=Q(),{adminClient:T}=U(),p=G.componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[d,H]=l.useState([]),[N,O]=l.useState([]),[E,B]=l.useState([]),[D,L]=l.useState([]),x=W({defaultValues:k}),{control:R,reset:j,handleSubmit:w}=x,r=!!n,v=e=>{const o=e.find(a=>a.name===c)?.executors?.find(a=>a.executor===n);o&&j({config:o.configuration})};X(()=>T.clientPolicies.listProfiles({includeGlobalProfiles:!0}),e=>{B(e.globalProfiles),L(e.profiles),v(e.profiles),v(e.globalProfiles)},[]);const z=async()=>{const e=x.getValues(),s=D.map(o=>{if(o.name!==c)return o;const a=(o.executors??[]).concat({executor:e.executor,configuration:e.config||{}});if(r){const m=o.executors.find(M=>M.executor===n);m.configuration={...m.configuration,...e.config}}return r?o:{...o,executors:a}});try{await T.clientPolicies.createProfiles({profiles:s,globalProfiles:E}),A(i(r?"realm-settings:updateExecutorSuccess":"realm-settings:addExecutorSuccess"),te.success),F(h({realm:u,profileName:c}))}catch(o){C(r?"realm-settings:updateExecutorError":"realm-settings:addExecutorError",o)}},f=E.find(e=>e.name===c),y=p?.find(e=>e.id===n),K=y?.properties.map(e=>{const s=r?e.defaultValue:"";return{...e,defaultValue:s}});return t.jsxs(t.Fragment,{children:[t.jsx(se,{titleKey:r?n:i("addExecutor"),divider:!0}),t.jsxs(Y,{variant:"light",children:[t.jsxs(re,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",isReadOnly:!!f,children:[t.jsx(Z,{label:i("executorType"),fieldId:"kc-executorType",labelIcon:d.length>0&&d[0].helpText!==""?t.jsx(b,{helpText:d[0].helpText,fieldLabelId:"realm-settings:executorTypeHelpText"}):r?t.jsx(b,{helpText:y?.helpText,fieldLabelId:"realm-settings:executorTypeHelpText"}):void 0,children:t.jsx($,{name:"executor",defaultValue:"",control:R,render:({field:e})=>t.jsx(ie,{toggleId:"kc-executor",placeholderText:"Select an executor",onToggle:s=>P(s),onSelect:(s,o)=>{j({...k,executor:o.toString()});const a=p?.filter(m=>m.id===o);H(a??[]),O(a?.[0].properties??[]),P(!1)},selections:r?n:e.value,variant:ae.single,"data-testid":"executorType-select","aria-label":i("executorType"),isOpen:I,maxHeight:580,isDisabled:r,children:p?.map(s=>t.jsx(ce,{selected:s.id===e.value,value:s.id,description:s.helpText},s.id))})})}),t.jsx(ee,{...x,children:t.jsx(oe,{properties:r?K:N})}),!f&&t.jsxs(ne,{children:[t.jsx(g,{variant:"primary",onClick:()=>w(z)(),"data-testid":"addExecutor-saveBtn",children:i(r?"common:save":"common:add")}),t.jsx(g,{variant:"link",component:e=>t.jsx(S,{...e,to:h({realm:u,profileName:c})}),"data-testid":"addExecutor-cancelBtn",children:i("common:cancel")})]})]}),r&&f&&t.jsx("div",{className:"kc-backToProfile",children:t.jsx(g,{component:e=>t.jsx(S,{...e,to:h({realm:u,profileName:c})}),variant:"primary",children:i("realm-settings:back")})})]})]})}export{Ze as default};
//# sourceMappingURL=ExecutorForm-db4fe83c.js.map
