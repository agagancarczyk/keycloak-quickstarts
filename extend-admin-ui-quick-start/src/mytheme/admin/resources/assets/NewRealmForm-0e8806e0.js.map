{"version":3,"file":"NewRealmForm-0e8806e0.js","sources":["../../src/realm/add/NewRealmForm.tsx"],"sourcesContent":["import type RealmRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/realmRepresentation\";\nimport {\n  ActionGroup,\n  Button,\n  FormGroup,\n  PageSection,\n  Switch,\n} from \"@patternfly/react-core\";\nimport { useState } from \"react\";\nimport { Controller, useForm } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { useNavigate } from \"react-router-dom\";\n\nimport { useAlerts } from \"../../components/alert/Alerts\";\nimport { FormAccess } from \"../../components/form-access/FormAccess\";\nimport { JsonFileUpload } from \"../../components/json-file-upload/JsonFileUpload\";\nimport { KeycloakTextInput } from \"../../components/keycloak-text-input/KeycloakTextInput\";\nimport { ViewHeader } from \"../../components/view-header/ViewHeader\";\nimport { useAdminClient } from \"../../context/auth/AdminClient\";\nimport { useRealms } from \"../../context/RealmsContext\";\nimport { useWhoAmI } from \"../../context/whoami/WhoAmI\";\nimport { toDashboard } from \"../../dashboard/routes/Dashboard\";\nimport { convertFormValuesToObject, convertToFormValues } from \"../../util\";\n\nexport default function NewRealmForm() {\n  const { t } = useTranslation(\"realm\");\n  const navigate = useNavigate();\n  const { refresh, whoAmI } = useWhoAmI();\n  const { refresh: refreshRealms } = useRealms();\n  const { adminClient } = useAdminClient();\n  const { addAlert, addError } = useAlerts();\n  const [realm, setRealm] = useState<RealmRepresentation>();\n\n  const {\n    register,\n    handleSubmit,\n    control,\n    setValue,\n    formState: { errors },\n  } = useForm<RealmRepresentation>({ mode: \"onChange\" });\n\n  const handleFileChange = (obj?: object) => {\n    const defaultRealm = { id: \"\", realm: \"\", enabled: true };\n    convertToFormValues(obj || defaultRealm, setValue);\n    setRealm(obj || defaultRealm);\n  };\n\n  const save = async (fields: RealmRepresentation) => {\n    try {\n      await adminClient.realms.create({\n        ...realm,\n        ...convertFormValuesToObject(fields),\n      });\n      addAlert(t(\"saveRealmSuccess\"));\n\n      refresh();\n      await refreshRealms();\n      navigate(toDashboard({ realm: fields.realm }));\n    } catch (error) {\n      addError(\"realm:saveRealmError\", error);\n    }\n  };\n\n  return (\n    <>\n      <ViewHeader titleKey=\"realm:createRealm\" subKey=\"realm:realmExplain\" />\n      <PageSection variant=\"light\">\n        <FormAccess\n          isHorizontal\n          onSubmit={handleSubmit(save)}\n          role=\"view-realm\"\n          isReadOnly={!whoAmI.canCreateRealm()}\n        >\n          <JsonFileUpload\n            id=\"kc-realm-filename\"\n            allowEditingUploadedText\n            onChange={handleFileChange}\n          />\n          <FormGroup\n            label={t(\"realmName\")}\n            isRequired\n            fieldId=\"kc-realm-name\"\n            validated={errors.realm ? \"error\" : \"default\"}\n            helperTextInvalid={errors.realm?.message}\n          >\n            <KeycloakTextInput\n              isRequired\n              id=\"kc-realm-name\"\n              validated={errors.realm ? \"error\" : \"default\"}\n              {...register(\"realm\", {\n                required: { value: true, message: t(\"common:required\") },\n                pattern: {\n                  value: /^[a-zA-Z0-9-_]+$/,\n                  message: t(\"invalidRealmName\"),\n                },\n              })}\n            />\n          </FormGroup>\n          <FormGroup label={t(\"enabled\")} fieldId=\"kc-realm-enabled-switch\">\n            <Controller\n              name=\"enabled\"\n              defaultValue={true}\n              control={control}\n              render={({ field }) => (\n                <Switch\n                  id=\"kc-realm-enabled-switch\"\n                  name=\"enabled\"\n                  label={t(\"common:on\")}\n                  labelOff={t(\"common:off\")}\n                  isChecked={field.value}\n                  onChange={field.onChange}\n                  aria-label={t(\"enabled\")}\n                />\n              )}\n            />\n          </FormGroup>\n          <ActionGroup>\n            <Button variant=\"primary\" type=\"submit\">\n              {t(\"common:create\")}\n            </Button>\n            <Button variant=\"link\" onClick={() => navigate(-1)}>\n              {t(\"common:cancel\")}\n            </Button>\n          </ActionGroup>\n        </FormAccess>\n      </PageSection>\n    </>\n  );\n}\n"],"names":["NewRealmForm","t","useTranslation","navigate","useNavigate","refresh","whoAmI","useWhoAmI","refreshRealms","useRealms","adminClient","useAdminClient","addAlert","addError","useAlerts","realm","setRealm","useState","register","handleSubmit","control","setValue","errors","useForm","handleFileChange","obj","defaultRealm","convertToFormValues","save","fields","convertFormValuesToObject","toDashboard","error","jsxs","Fragment","jsx","ViewHeader","PageSection","FormAccess","JsonFileUpload","FormGroup","KeycloakTextInput","Controller","field","Switch","ActionGroup","Button"],"mappings":"otBAwBA,SAAwBA,IAAe,CACrC,KAAM,CAAE,EAAAC,CAAA,EAAMC,EAAe,OAAO,EAC9BC,EAAWC,IACX,CAAE,QAAAC,EAAS,OAAAC,CAAO,EAAIC,EAAU,EAChC,CAAE,QAASC,CAAc,EAAIC,EAAU,EACvC,CAAE,YAAAC,GAAgBC,IAClB,CAAE,SAAAC,EAAU,SAAAC,CAAS,EAAIC,EAAU,EACnC,CAACC,EAAOC,CAAQ,EAAIC,EAA8B,SAAA,EAElD,CACJ,SAAAC,EACA,aAAAC,EACA,QAAAC,EACA,SAAAC,EACA,UAAW,CAAE,OAAAC,CAAO,CAClB,EAAAC,EAA6B,CAAE,KAAM,UAAY,CAAA,EAE/CC,EAAoBC,GAAiB,CACzC,MAAMC,EAAe,CAAE,GAAI,GAAI,MAAO,GAAI,QAAS,IAC/BC,EAAAF,GAAOC,EAAcL,CAAQ,EACjDL,EAASS,GAAOC,CAAY,CAAA,EAGxBE,EAAO,MAAOC,GAAgC,CAC9C,GAAA,CACI,MAAAnB,EAAY,OAAO,OAAO,CAC9B,GAAGK,EACH,GAAGe,EAA0BD,CAAM,CAAA,CACpC,EACQjB,EAAAX,EAAE,kBAAkB,CAAC,EAEtBI,IACR,MAAMG,EAAc,EACpBL,EAAS4B,EAAY,CAAE,MAAOF,EAAO,KAAO,CAAA,CAAC,QACtCG,GACPnB,EAAS,uBAAwBmB,CAAK,CACxC,CAAA,EAGF,OAEIC,EAAA,KAAAC,WAAA,CAAA,SAAA,CAAAC,EAAA,IAACC,EAAW,CAAA,SAAS,oBAAoB,OAAO,qBAAqB,EACrED,EAAAA,IAACE,EAAY,CAAA,QAAQ,QACnB,SAAAJ,EAAA,KAACK,EAAA,CACC,aAAY,GACZ,SAAUnB,EAAaS,CAAI,EAC3B,KAAK,aACL,WAAY,CAACtB,EAAO,eAAe,EAEnC,SAAA,CAAA6B,EAAA,IAACI,EAAA,CACC,GAAG,oBACH,yBAAwB,GACxB,SAAUf,CAAA,CACZ,EACAW,EAAA,IAACK,EAAA,CACC,MAAOvC,EAAE,WAAW,EACpB,WAAU,GACV,QAAQ,gBACR,UAAWqB,EAAO,MAAQ,QAAU,UACpC,kBAAmBA,EAAO,OAAO,QAEjC,SAAAa,EAAA,IAACM,EAAA,CACC,WAAU,GACV,GAAG,gBACH,UAAWnB,EAAO,MAAQ,QAAU,UACnC,GAAGJ,EAAS,QAAS,CACpB,SAAU,CAAE,MAAO,GAAM,QAASjB,EAAE,iBAAiB,CAAE,EACvD,QAAS,CACP,MAAO,mBACP,QAASA,EAAE,kBAAkB,CAC/B,CAAA,CACD,CAAA,CACH,CAAA,CACF,QACCuC,EAAU,CAAA,MAAOvC,EAAE,SAAS,EAAG,QAAQ,0BACtC,SAAAkC,EAAA,IAACO,EAAA,CACC,KAAK,UACL,aAAc,GACd,QAAAtB,EACA,OAAQ,CAAC,CAAE,MAAAuB,CAAA,IACTR,EAAA,IAACS,EAAA,CACC,GAAG,0BACH,KAAK,UACL,MAAO3C,EAAE,WAAW,EACpB,SAAUA,EAAE,YAAY,EACxB,UAAW0C,EAAM,MACjB,SAAUA,EAAM,SAChB,aAAY1C,EAAE,SAAS,CAAA,CACzB,CAAA,CAAA,EAGN,SACC4C,EACC,CAAA,SAAA,CAAAV,EAAAA,IAACW,GAAO,QAAQ,UAAU,KAAK,SAC5B,SAAA7C,EAAE,eAAe,EACpB,EACAkC,EAAAA,IAACW,EAAO,CAAA,QAAQ,OAAO,QAAS,IAAM3C,EAAS,EAAE,EAC9C,SAAEF,EAAA,eAAe,CACpB,CAAA,CAAA,EACF,CAAA,CAAA,CAAA,EAEJ,CACF,CAAA,CAAA,CAEJ"}