import{u as se,d as te,e as re,c as ae,b as oe,r as a,R as ne,az as ie,n as le,k as b,A as E,j as e,X as ce,B as g,D as me,a7 as de,w as A,Z as ue,P as pe,dy as I,M as he,aw as xe,ax as fe,K as be,a8 as y,L as ge,aN as ye,E as R,aM as je,p as Ue,cp as ke,dz as Te}from"./index-a3421f29.js";import{u as w}from"./ConfirmDialog-09ff7a12.js";import{L as Se}from"./PaginatingTableToolbar-08ca9efb.js";import{K as Ce}from"./KeycloakDataTable-10a62d94.js";import{V as Fe}from"./ViewHeader-832ec56e.js";import{P as Ke}from"./PermissionTab-c2ee2a77.js";import{R as De,u as Ee}from"./RoutableTabs-7f56b0c5.js";import{c as Ae}from"./resource-08ae7dbc.js";import"./user-section-4ed993c7.js";import{b as m,T as Ie,a as Re}from"./ToolbarContent-7b435752.js";import{a as N,b as v}from"./Tabs-5beaba80.js";import{E as we}from"./EmptyStateBody-7b4fcee1.js";import{T as Ne}from"./Text-564bf299.js";import{W as ve}from"./warning-triangle-icon-39a5897e.js";import"./Modal-21c37af7.js";import"./plus-circle-icon-cb854796.js";import"./EmptyStateSecondaryActions-08edafb5.js";import"./TableToolbar-ee0c86ef.js";import"./Form-518a2cf2.js";import"./Td-6d4ab209.js";import"./star-icon-6a7e7d25.js";import"./check-fc57dbe1.js";import"./grip-vertical-icon-cbeff50f.js";import"./Checkbox-d00621d8.js";import"./useLocaleSort-3efc7c31.js";import"./Trans-2fec9e72.js";import"./Card-aa3ba03c.js";import"./CardTitle-9175b04a.js";import"./CardBody-519f6395.js";import"./joinPath-55fd24bc.js";import"./plus-icon-2a767bad.js";import"./MenuList-e3786b59.js";function hs(){const{t}=se("users"),{adminClient:o}=te(),{addAlert:j,addError:i}=re(),{realm:n}=ae(),P=oe(),[d,L]=a.useState(),[V,B]=a.useState(),[U,_]=a.useState(),[O,u]=a.useState(!1),[l,p]=a.useState([]),{profileInfo:M}=ne(),[k,z]=a.useState(0),c=()=>z(k+1),{hasAccess:G}=ie(),H=G("query-users");le(async()=>{const s={type:"org.keycloak.storage.UserStorageProvider"};try{return await Promise.all([o.components.find(s),o.realms.findOne({realm:n})])}catch{return[[],{}]}},([s,r])=>{L(s.filter(x=>x.config?.enabled[0]==="true")),_(r)},[]);const T=s=>Ee(I({realm:n,tab:s})),W=T("list"),Z=T("permissions"),q=s=>e.jsx(ge,{to:ye({realm:n,id:s.id,tab:"settings"}),children:s.username},s.username),X=async(s,r,x)=>{const K={first:s,max:r},f=x||V||"";if(f&&(K.search=f),!C&&!f)return[];try{return await Ae({adminClient:o,briefRepresentation:!0,...K})}catch(D){return d?.length?i("users:noUsersFoundErrorStorage",D):i("users:noUsersFoundError",D),[]}},[$,J]=w({titleKey:"users:unlockAllUsers",messageKey:"users:unlockUsersConfirm",continueButtonLabel:"users:unlock",onConfirm:async()=>{try{await o.attackDetection.delAll(),c(),j(t("unlockUsersSuccess"),E.success)}catch(s){i("users:unlockUsersError",s)}}}),[h,Q]=w({titleKey:"users:deleteConfirm",messageKey:t("deleteConfirmDialog",{count:l.length}),continueButtonLabel:"delete",continueButtonVariant:b.danger,onConfirm:async()=>{try{for(const s of l)await o.users.del({id:s.id});p([]),c(),j(t("userDeletedSuccess"),E.success)}catch(s){i("users:userDeletedError",s)}}}),Y=s=>e.jsxs(e.Fragment,{children:[!s.enabled&&e.jsx(R,{color:"red",icon:e.jsx(je,{}),children:t("disabled")},s.id),s.bruteForceStatus?.disabled&&e.jsx(R,{color:"orange",icon:e.jsx(ve,{}),children:t("temporaryLocked")},s.id),s.enabled&&!s.bruteForceStatus?.disabled&&"â€”"]}),ee=s=>e.jsxs(e.Fragment,{children:[!s.emailVerified&&e.jsx(Ue,{content:e.jsx(e.Fragment,{children:t("notVerified")}),children:e.jsx(ke,{className:"keycloak__user-section__email-verified"})},`email-verified-${s.id}`)," ",y()(s.email)]}),S=()=>P(Te({realm:n}));if(!d||!U)return e.jsx(ce,{});const C=!(d.length>0),F=e.jsxs(e.Fragment,{children:[e.jsx(m,{children:e.jsx(g,{"data-testid":"add-user",onClick:S,children:t("addUser")})}),U.bruteForceProtected?e.jsx(m,{children:e.jsx(me,{toggle:e.jsx(de,{onToggle:s=>u(s)}),isOpen:O,isPlain:!0,dropdownItems:[e.jsx(A,{component:"button",isDisabled:l.length===0,onClick:()=>{h(),u(!1)},children:t("deleteUser")},"deleteUser"),e.jsx(A,{component:"button",onClick:()=>{$(),u(!1)},children:t("unlockAllUsers")},"unlock")]})}):e.jsx(m,{children:e.jsx(g,{variant:b.link,onClick:h,"data-testid":"delete-user-btn",isDisabled:l.length===0,children:t("deleteUser")})})]});return e.jsxs(e.Fragment,{children:[e.jsx(Q,{}),e.jsx(J,{}),e.jsx(Fe,{titleKey:"users:title",subKey:"users:usersExplain",helpUrl:ue.usersUrl,divider:!1}),e.jsx(pe,{"data-testid":"users-page",variant:"light",className:"pf-u-p-0",children:e.jsxs(De,{"data-testid":"user-tabs",defaultLocation:I({realm:n,tab:"list"}),isBox:!0,mountOnEnter:!0,children:[e.jsx(N,{id:"list","data-testid":"listTab",title:e.jsx(v,{children:t("userList")}),...W,children:e.jsx(Ce,{loader:X,isPaginated:!0,ariaLabelKey:"users:title",searchPlaceholderKey:"users:searchForUser",canSelectAll:!0,onSelect:s=>p([...s]),emptyState:C?e.jsx(Se,{message:t("noUsersFound"),instructions:t("emptyInstructions"),primaryActionText:t("createNewUser"),onPrimaryAction:S}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{children:e.jsxs(Re,{children:[e.jsx(m,{children:e.jsxs(he,{children:[e.jsx(xe,{name:"search-input",type:"search","aria-label":t("search"),placeholder:t("users:searchForUser"),onChange:s=>{B(s)},onKeyDown:s=>{s.key==="Enter"&&c()}}),e.jsx(g,{variant:b.control,"aria-label":t("common:search"),onClick:c,children:e.jsx(fe,{})})]})}),F]})}),e.jsx(we,{"data-testid":"empty-state",variant:"large",children:e.jsx(be,{className:"kc-search-users-text",children:e.jsx(Ne,{children:t("searchForUserDescription")})})})]}),toolbarItem:H?F:void 0,actionResolver:s=>{const r=s.data;return r.access?.manage?[{title:t("common:delete"),onClick:()=>{p([r]),h()}}]:[]},columns:[{name:"username",displayKey:"users:username",cellRenderer:q},{name:"email",displayKey:"users:email",cellRenderer:ee},{name:"lastName",displayKey:"users:lastName",cellFormatters:[y()]},{name:"firstName",displayKey:"users:firstName",cellFormatters:[y()]},{name:"status",displayKey:"users:status",cellRenderer:Y}]},k)}),!M?.disabledFeatures?.includes("ADMIN_FINE_GRAINED_AUTHZ")&&e.jsx(N,{id:"permissions","data-testid":"permissionsTab",title:e.jsx(v,{children:t("common:permissions")}),...Z,children:e.jsx(Ke,{type:"users"})})]})})]})}export{hs as default};
//# sourceMappingURL=UsersSection-853186b2.js.map
