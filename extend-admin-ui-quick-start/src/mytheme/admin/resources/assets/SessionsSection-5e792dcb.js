import{u as D,e as E,c as K,d as P,f as V,r as l,n as q,j as e,B as C,k as I,K as M,F as U,V as b,cX as L,A as r,w as N,Z as H,P as z}from"./index-a3421f29.js";import{u as G}from"./ConfirmDialog-09ff7a12.js";import{V as X}from"./ViewHeader-832ec56e.js";import{K as Z}from"./KeycloakTextInput-e7f6e917.js";import{M as _,a as $}from"./Modal-21c37af7.js";import{F as J}from"./Form-518a2cf2.js";import{S as Q}from"./SessionsTable-69066f36.js";import{S as W,b as A}from"./Select-0f56a9cc.js";import{F as Y}from"./filter-icon-9d72dc58.js";import"./Text-564bf299.js";import"./ToolbarContent-7b435752.js";import"./PaginatingTableToolbar-08ca9efb.js";import"./plus-circle-icon-cb854796.js";import"./EmptyStateBody-7b4fcee1.js";import"./EmptyStateSecondaryActions-08edafb5.js";import"./TableToolbar-ee0c86ef.js";import"./KeycloakDataTable-10a62d94.js";import"./Td-6d4ab209.js";import"./star-icon-6a7e7d25.js";import"./check-fc57dbe1.js";import"./grip-vertical-icon-cbeff50f.js";import"./Checkbox-d00621d8.js";import"./useFormatDate-7fddef56.js";import"./ListItem-499ec6f9.js";const ee=({handleModalToggle:o,save:c})=>{const{t:s}=D("sessions"),{addAlert:a}=E(),{realm:i}=K(),{adminClient:m}=P(),{register:g,handleSubmit:h,formState:{errors:y}}=V(),[x,v]=l.useState(),[f,B]=l.useState(0),j=()=>{B(new Date().getTime())};q(()=>m.realms.findOne({realm:i}),t=>{v(t)},[f]);const O=(t,S)=>{const k=t.successRequests?.length||0,w=t.failedRequests?.length||0;k===0&&w===0?a(s("clients:noAdminUrlSet"),r.warning):w>0?(a(s("clients:"+S+"Success",{successNodes:t.successRequests}),r.success),a(s("clients:"+S+"Fail",{failedNodes:t.failedRequests}),r.danger)):a(s("clients:"+S+"Success",{successNodes:t.successRequests}),r.success)},p=async()=>{try{await m.realms.update({realm:i},{realm:i,notBefore:Date.now()/1e3}),a(s("notBeforeSuccess"),r.success)}catch(t){a(s("setToNowError",{error:t}),r.danger)}},R=async()=>{try{await m.realms.update({realm:i},{realm:i,notBefore:0}),a(s("notBeforeClearedSuccess"),r.success),j()}catch(t){a(s("notBeforeError",{error:t}),r.danger)}},T=async()=>{const t=await m.realms.pushRevocation({realm:i});O(t,"notBeforePush"),j()};return e.jsxs(_,{variant:$.small,title:s("revocation"),isOpen:!0,onClose:o,actions:[e.jsx(C,{"data-testid":"set-to-now-button",variant:"tertiary",onClick:()=>{p(),o()},form:"revocation-modal-form",children:s("setToNow")},"set-to-now"),e.jsx(C,{"data-testid":"clear-not-before-button",variant:"tertiary",onClick:()=>{R(),o()},form:"revocation-modal-form",children:s("clear")},"clear"),e.jsx(C,{"data-testid":"modal-test-connection-button",variant:"secondary",onClick:()=>{T(),o()},form:"revocation-modal-form",children:s("push")},"push"),e.jsx(C,{id:"modal-cancel","data-testid":"cancel",variant:I.link,onClick:()=>{o()},children:s("common:cancel")},"cancel")],children:[e.jsx(M,{className:"kc-revocation-description-text",children:s("revocationDescription")}),e.jsx(J,{id:"revocation-modal-form",isHorizontal:!0,onSubmit:h(c),children:e.jsx(U,{className:"kc-revocation-modal-form-group",label:s("notBefore"),name:"notBefore",fieldId:"not-before",validated:y.email?b.error:b.default,children:e.jsx(Z,{"data-testid":"not-before-input",autoFocus:!0,isReadOnly:!0,value:x?.notBefore===0?s("none"):new Date(x?.notBefore*1e3).toString(),type:"text",id:"not-before",...g("notBefore",{required:!0,pattern:L}),validated:y.email?b.error:b.default})})})]})};function Be(){const{t:o}=D("sessions"),{adminClient:c}=P(),[s,a]=l.useState(0),i=()=>a(s+1),{addError:m}=E(),{realm:g}=K(),[h,y]=l.useState(!1),[x,v]=l.useState(!1),[f,B]=l.useState("all"),[j,O]=l.useState(!1),p=()=>{y(!h)};async function R(n){return(await Promise.all(n.map(u=>c.clients.listSessions({id:u.id})))).flat()}async function T(n){return(await Promise.all(n.map(u=>c.clients.listOfflineSessions({id:u.id})))).flat()}const t=async()=>{const n=await c.realms.getClientSessionStats({realm:g}),[d,u]=await Promise.all([f!=="offline"?R(n):[],f!=="regular"?T(n):[]]);return O(d.length===0&&u.length===0),[...d.map(F=>({type:o("sessionsType.regularSSO"),...F})),...u.map(F=>({type:o("sessionsType.offline"),...F}))]},[S,k]=G({titleKey:"sessions:logoutAllSessions",messageKey:"sessions:logoutAllDescription",continueButtonLabel:"common:confirm",onConfirm:async()=>{try{await c.realms.logoutAll({realm:g}),i()}catch(n){m("sessions:logoutAllSessionsError",n)}}}),w=[e.jsx(N,{"data-testid":"revocation",component:"button",onClick:()=>p(),children:o("revocation")},"toggle-modal"),e.jsx(N,{"data-testid":"logout-all",component:"button",isDisabled:j,onClick:S,children:o("signOutAllActiveSessions")},"delete-role")];return e.jsxs(e.Fragment,{children:[e.jsx(k,{}),e.jsx(X,{dropdownItems:w,titleKey:"sessions:title",subKey:"sessions:sessionExplain",helpUrl:H.sessionsUrl}),e.jsxs(z,{variant:"light",className:"pf-u-p-0",children:[h&&e.jsx(ee,{handleModalToggle:p,save:()=>{p()}}),e.jsx(Q,{loader:t,filter:e.jsxs(W,{"data-testid":"filter-session-type-select",isOpen:x,onToggle:n=>v(n),toggleIcon:e.jsx(Y,{}),onSelect:(n,d)=>{B(d),i(),v(!1)},selections:f,children:[e.jsx(A,{"data-testid":"all-sessions-option",value:"all",children:o("sessionsType.allSessions")}),e.jsx(A,{"data-testid":"regular-sso-option",value:"regular",children:o("sessionsType.regularSSO")}),e.jsx(A,{"data-testid":"offline-option",value:"offline",children:o("sessionsType.offline")})]})},s)]})]})}export{Be as default};
//# sourceMappingURL=SessionsSection-5e792dcb.js.map
