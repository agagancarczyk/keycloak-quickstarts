import{_ as Pe,r as I,i as we,I as pe,u as S,f as K,d as k,e as $,c as O,j as e,B as C,k as U,F as P,C as E,A as F,J as Te,H as He,K as Ce,b as Be,g as de,h as Se,P as H,G as w,M as be,q as _e,s as Ee,N as Ke,V as R,S as Y,a as Re,O as Ge,Q as xe,R as ke,U as ze,T as Ye,W as We,n as ue,X as me,Y as J,Z as Xe,t as ye,L as Ne,$ as Qe,E as Je,a0 as Ze,a1 as et,a2 as tt}from"./index-a3421f29.js";import{u as at}from"./ConfirmDialog-09ff7a12.js";import{L as nt}from"./PaginatingTableToolbar-08ca9efb.js";import{R as it,u as ot}from"./RoutableTabs-7f56b0c5.js";import{K as Fe}from"./KeycloakDataTable-10a62d94.js";import{V as st}from"./ViewHeader-832ec56e.js";import{u as Oe,m as lt}from"./useLocaleSort-3efc7c31.js";import{u as W}from"./useToggle-a9cb2c55.js";import{f as rt}from"./resource-08ae7dbc.js";import{M as he,a as Me}from"./Modal-21c37af7.js";import{T as le,a as ct}from"./Text-564bf299.js";import{N as dt}from"./NameDescription-49e50e8d.js";import{F as Le,A as ee}from"./Form-518a2cf2.js";import{F as te}from"./FormAccess-1cceaef6.js";import{K as X}from"./KeycloakTextInput-e7f6e917.js";import{S as B,a as Q,b as D,C as ut,c as mt}from"./Select-0f56a9cc.js";import{T as Ve}from"./TimeSelector-a2bc30e2.js";import{R as fe}from"./Radio-e3ba1ffb.js";import{N as re}from"./NumberInput-85f36a0d.js";import{M as ht}from"./minus-circle-icon-6f9a971c.js";import{s as pt,E as bt,a as xt}from"./EmptyStateBody-7b4fcee1.js";import{T as yt,a as ft,b as De}from"./ToolbarContent-7b435752.js";import{E as jt}from"./EmptyStateSecondaryActions-08edafb5.js";import{P as gt}from"./plus-circle-icon-cb854796.js";import{M as At}from"./MultiLineInput-14187d1c.js";import{Q as vt}from"./question-circle-icon-45a94074.js";import{T as It,a as L,b as V}from"./Tabs-5beaba80.js";import{D as Pt}from"./DraggableTable-40ed6015.js";import{T as wt}from"./Trans-2fec9e72.js";var Z;(function(a){a.default="default",a.plain="plain"})(Z||(Z={}));const ce=a=>{var{className:i="",component:t="span",children:n,variant:c=Z.default}=a,s=Pe(a,["className","component","children","variant"]);const p=t;return I.createElement(p,Object.assign({className:we(pe.inputGroupText,c===Z.plain&&pe.modifiers.plain,i)},s),n)};ce.displayName="InputGroupText";const $e=a=>{var{children:i,className:t=""}=a,n=Pe(a,["children","className"]);return I.createElement("div",Object.assign({className:we(pt.emptyStatePrimary,t)},n),i)};$e.displayName="EmptyStatePrimary";const Tt=({flowAlias:a,onClose:i})=>{const{t}=S("authentication"),{control:n,handleSubmit:c}=K(),{adminClient:s}=k(),{addAlert:p,addError:d}=$(),{realm:m}=O(),[h,y]=W(),f=async({bindingType:o})=>{const u=await s.realms.findOne({realm:m});try{await s.realms.update({realm:m},{...u,[o]:a}),p(t("updateFlowSuccess"),F.success)}catch(b){d("authentication:updateFlowError",b)}i()};return e.jsx(he,{title:t("bindFlow"),variant:"small",onClose:i,actions:[e.jsx(C,{"data-testid":"save",type:"submit",form:"bind-form",children:t("common:save")},"confirm"),e.jsx(C,{"data-testid":"cancel",variant:U.link,onClick:i,children:t("common:cancel")},"cancel")],isOpen:!0,children:e.jsx(Le,{id:"bind-form",isHorizontal:!0,onSubmit:c(f),children:e.jsx(P,{label:t("chooseBindingType"),fieldId:"chooseBindingType",children:e.jsx(E,{name:"bindingType",defaultValue:"browserFlow",control:n,render:({field:o})=>e.jsx(B,{toggleId:"chooseBindingType",onToggle:y,onSelect:(u,b)=>{o.onChange(b.toString()),y()},selections:o.value,variant:Q.single,isOpen:h,menuAppendTo:"parent",children:[...z.keys()].filter(u=>u!=="dockerAuthenticationFlow").map(u=>{const b=z.get(u);return e.jsx(D,{selected:u===z.get(u),value:u,children:t(`flow.${b}`)},u)})})})})})})};const ae=({label:a})=>e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"keycloak_authentication-section__usedby"})," ",a]}),Ct=({id:a,isSpecificClient:i,onClose:t})=>{const{t:n}=S("authentication"),{adminClient:c}=k(),s=async(p,d,m)=>(await rt({adminClient:c,id:a,type:i?"clients":"idp",first:p||0,max:d||10,search:m})).map(y=>({name:y}));return e.jsx(he,{header:e.jsxs(Ce,{children:[e.jsx(le,{component:ct.h1,children:n("flowUsedBy")}),e.jsx(le,{children:n("flowUsedByDescription",{value:n(i?"clients":"identiyProviders")})})]}),variant:Me.medium,isOpen:!0,onClose:t,actions:[e.jsx(C,{"data-testid":"cancel",id:"modal-cancel",onClick:t,children:n("common:close")},"cancel")],children:e.jsx(Fe,{loader:s,isPaginated:!0,ariaLabelKey:"authentication:usedBy",searchPlaceholderKey:"common:search",columns:[{name:"name"}]})})},St=({authType:{id:a,usedBy:i},realm:t})=>{const{t:n}=S("authentication"),[c,s]=W(),p=Object.entries(t).find(d=>d[1]===i?.values[0])?.[0];return e.jsxs(e.Fragment,{children:[c&&e.jsx(Ct,{id:a,onClose:s,isSpecificClient:i?.type==="SPECIFIC_CLIENTS"}),(i?.type==="SPECIFIC_PROVIDERS"||i?.type==="SPECIFIC_CLIENTS")&&(i.values.length<=8?e.jsx(Te,{"aria-label":n("usedBy"),bodyContent:e.jsxs("div",{children:[n("appliedBy"+(i.type==="SPECIFIC_CLIENTS"?"Clients":"Providers"))," ",i.values.map((d,m)=>e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:d}),m<i.values.length-1?", ":""]}))]},`usedBy-${a}-${i.values}`),children:e.jsx(C,{variant:"link",className:"keycloak__used-by__popover-button",children:e.jsx(ae,{label:n(`used.${i.type}`)})})},a):e.jsx(C,{variant:"link",className:"keycloak__used-by__popover-button",onClick:s,children:e.jsx(ae,{label:n(`used.${i.type}`)})})),i?.type==="DEFAULT"&&e.jsx(ae,{label:n(`flow.${z.get(p)}`)}),!i?.type&&n("used.notInUse")]})},_t=({name:a,description:i,toggleDialog:t,onComplete:n})=>{const{t:c}=S("authentication"),s=K({mode:"onChange"}),{setValue:p,getValues:d,handleSubmit:m}=s,{adminClient:h}=k(),{addAlert:y,addError:f}=$(),o=Be(),{realm:u}=O();I.useEffect(()=>{p("alias",c("copyOf",{name:a})),p("description",i)},[a,i]);const b=async()=>{const g=d();try{await h.authenticationManagement.copyFlow({flow:a,newName:g.alias});const x=(await h.authenticationManagement.getFlows()).find(T=>T.alias===g.alias);g.description!==i&&(x.description=g.description,await h.authenticationManagement.updateFlow({flowId:x.id},x)),y(c("copyFlowSuccess"),F.success),o(Se({realm:u,id:x.id,usedBy:"notInUse",builtIn:x.builtIn?"builtIn":void 0}))}catch(x){f("authentication:copyFlowError",x)}n()};return e.jsx(he,{title:c("duplicateFlow"),onClose:t,variant:Me.small,actions:[e.jsx(C,{"data-testid":"confirm",type:"submit",form:"duplicate-flow-form",children:c("duplicate")},"confirm"),e.jsx(C,{"data-testid":"cancel",variant:U.link,onClick:t,children:c("common:cancel")},"cancel")],isOpen:!0,children:e.jsx(de,{...s,children:e.jsx(Le,{id:"duplicate-flow-form",onSubmit:m(b),isHorizontal:!0,children:e.jsx(dt,{})})})})},je=["poll","ping"],ne=10,ie=600,oe=0,se=600,Et=({realm:a,realmUpdated:i})=>{const{t}=S("authentication"),{control:n,register:c,handleSubmit:s,setValue:p,formState:{errors:d,isValid:m,isDirty:h}}=K({mode:"onChange"}),{adminClient:y}=k(),{realm:f}=O(),{addAlert:o,addError:u}=$(),[b,g]=I.useState(!1),[x,T]=I.useState(!1),A=l=>_e(l,p);I.useEffect(()=>A(a),[]);const j=async l=>{try{await y.realms.update({realm:f},Ee(l));const r=await y.realms.findOne({realm:f});i(r),A(r),o(t("updateCibaSuccess"),F.success)}catch(r){u("authentication:updateCibaError",r)}};return e.jsx(H,{variant:"light",children:e.jsxs(te,{role:"manage-realm",isHorizontal:!0,onSubmit:s(j),children:[e.jsx(P,{fieldId:"cibaBackchannelTokenDeliveryMode",label:t("cibaBackchannelTokenDeliveryMode"),labelIcon:e.jsx(w,{helpText:t("authentication-help:cibaBackchannelTokenDeliveryMode"),fieldLabelId:"authentication:cibaBackchannelTokenDeliveryMode"}),children:e.jsx(E,{name:"attributes.cibaBackchannelTokenDeliveryMode",defaultValue:je[0],control:n,render:({field:l})=>e.jsx(B,{toggleId:"cibaBackchannelTokenDeliveryMode",onSelect:(r,_)=>{g(!1),l.onChange(_.toString())},selections:l.value,variant:Q.single,isOpen:b,onToggle:r=>g(r),children:je.map(r=>e.jsx(D,{value:r,selected:r===l.value,children:t(`cibaBackhannelTokenDeliveryModes.${r}`)},r))})})}),e.jsx(P,{fieldId:"cibaExpiresIn",label:t("cibaExpiresIn"),labelIcon:e.jsx(w,{helpText:t("authentication-help:cibaExpiresIn"),fieldLabelId:"authentication:cibaExpiresIn"}),validated:d.attributes?.cibaExpiresIn?"error":"default",helperTextInvalid:d.attributes?.cibaExpiresIn?.message,isRequired:!0,children:e.jsxs(be,{children:[e.jsx(X,{id:"cibaExpiresIn",type:"number",min:ne,max:ie,...c("attributes.cibaExpiresIn",{min:{value:ne,message:t("common:greaterThan",{value:ne})},max:{value:ie,message:t("common:lessThan",{value:ie})},required:{value:!0,message:t("common:required")}}),validated:d.attributes?.cibaExpiresIn?"error":"default"}),e.jsx(ce,{variant:"plain",children:t("common:times:seconds")})]})}),e.jsx(P,{fieldId:"cibaInterval",label:t("cibaInterval"),labelIcon:e.jsx(w,{helpText:t("authentication-help:cibaInterval"),fieldLabelId:"authentication:cibaInterval"}),validated:d.attributes?.cibaInterval?"error":"default",helperTextInvalid:d.attributes?.cibaInterval?.message,isRequired:!0,children:e.jsxs(be,{children:[e.jsx(X,{id:"cibaInterval",type:"number",min:oe,max:se,...c("attributes.cibaInterval",{min:{value:oe,message:t("common:greaterThan",{value:oe})},max:{value:se,message:t("common:lessThan",{value:se})},required:{value:!0,message:t("common:required")}}),validated:d.attributes?.cibaInterval?"error":"default"}),e.jsx(ce,{variant:"plain",children:t("common:times:seconds")})]})}),e.jsx(P,{fieldId:"cibaAuthRequestedUserHint",label:t("cibaAuthRequestedUserHint"),labelIcon:e.jsx(w,{helpText:t("authentication-help:cibaAuthRequestedUserHint"),fieldLabelId:"authentication:cibaAuthRequestedUserHint"}),children:e.jsxs(B,{toggleId:"cibaAuthRequestedUserHint",selections:"login_hint",isOpen:x,onToggle:l=>T(l),isDisabled:!0,children:[e.jsx(D,{value:"login_hint",children:"login_hint"}),e.jsx(D,{value:"id_token_hint",children:"id_token_hint"}),e.jsx(D,{value:"login_hint_token",children:"login_hint_token"})]})}),e.jsxs(ee,{children:[e.jsx(C,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!m||!h,children:t("common:save")}),e.jsx(C,{"data-testid":"reload",variant:U.link,onClick:()=>A({...a}),children:t("common:reload")})]})]})})};const q=["totp","hotp"],ge=["SHA1","SHA256","SHA512"],Ae=[6,8],Rt=({realm:a,realmUpdated:i})=>{const{t}=S("authentication"),{control:n,reset:c,handleSubmit:s,formState:{isValid:p,isDirty:d,errors:m}}=K({mode:"onChange",defaultValues:a}),{adminClient:h}=k(),{realm:y}=O(),{addAlert:f,addError:o}=$(),u=Oe(),[b,g]=W(),x=Ke({name:"otpPolicyType",control:n,defaultValue:q[0]}),T=l=>c(l);I.useEffect(()=>T(a),[]);const A=I.useMemo(()=>{const l=(a.otpSupportedApplications??[]).map(r=>t(`otpSupportedApplications.${r}`));return u(l,r=>r)},[a.otpSupportedApplications]),j=async l=>{try{await h.realms.update({realm:y},l);const r=await h.realms.findOne({realm:y});i(r),T(r),f(t("updateOtpSuccess"),F.success)}catch(r){o("authentication:updateOtpError",r)}};return e.jsx(H,{variant:"light",children:e.jsxs(te,{role:"manage-realm",isHorizontal:!0,onSubmit:s(j),className:"keycloak__otp_policies_authentication__form",children:[e.jsx(P,{label:t("otpType"),labelIcon:e.jsx(w,{helpText:t("authentication-help:otpType"),fieldLabelId:"authentication:otpType"}),hasNoPaddingTop:!0,children:e.jsx(E,{name:"otpPolicyType","data-testid":"otpPolicyType",defaultValue:q[0],control:n,render:({field:l})=>e.jsx(e.Fragment,{children:q.map(r=>e.jsx(fe,{id:r,"data-testid":r,isChecked:l.value===r,name:"otpPolicyType",onChange:()=>l.onChange(r),label:t(`policyType.${r}`),className:"keycloak__otp_policies_authentication__policy-type"},r))})})}),e.jsx(P,{label:t("otpHashAlgorithm"),labelIcon:e.jsx(w,{helpText:t("authentication-help:otpHashAlgorithm"),fieldLabelId:"authentication:otpHashAlgorithm"}),fieldId:"otpHashAlgorithm",children:e.jsx(E,{name:"otpPolicyAlgorithm",defaultValue:`Hmac${ge[0]}`,control:n,render:({field:l})=>e.jsx(B,{toggleId:"otpHashAlgorithm",onToggle:g,onSelect:(r,_)=>{l.onChange(_.toString()),g()},selections:l.value,variant:Q.single,isOpen:b,children:ge.map(r=>e.jsx(D,{selected:`Hmac${r}`===l.value,value:`Hmac${r}`,children:r},r))})})}),e.jsx(P,{label:t("otpPolicyDigits"),labelIcon:e.jsx(w,{helpText:t("authentication-help:otpPolicyDigits"),fieldLabelId:"authentication:otpPolicyDigits"}),hasNoPaddingTop:!0,children:e.jsx(E,{name:"otpPolicyDigits","data-testid":"otpPolicyDigits",defaultValue:Ae[0],control:n,render:({field:l})=>e.jsx(e.Fragment,{children:Ae.map(r=>e.jsx(fe,{id:`digit-${r}`,"data-testid":`digit-${r}`,isChecked:l.value===r,name:"otpPolicyDigits",onChange:()=>l.onChange(r),label:r,className:"keycloak__otp_policies_authentication__number-of-digits"},r))})})}),e.jsx(P,{label:t("lookAhead"),labelIcon:e.jsx(w,{helpText:t("authentication-help:lookAhead"),fieldLabelId:"authentication:lookAhead"}),fieldId:"lookAhead",children:e.jsx(E,{name:"otpPolicyLookAheadWindow",defaultValue:1,control:n,render:({field:l})=>{const _=l.value??1,N=v=>l.onChange(Math.max(v,0));return e.jsx(re,{id:"lookAhead",value:_,min:0,onPlus:()=>N(_+1),onMinus:()=>N(_-1),onChange:v=>{const M=Number(v.currentTarget.value);N(isNaN(M)?0:M)}})}})}),x===q[0]&&e.jsx(P,{label:t("otpPolicyPeriod"),fieldId:"otpPolicyPeriod",helperTextInvalid:t("otpPolicyPeriodErrorHint"),validated:m.otpPolicyPeriod?R.error:R.default,labelIcon:e.jsx(w,{helpText:t("authentication-help:otpPolicyPeriod"),fieldLabelId:"authentication:otpPolicyPeriod"}),children:e.jsx(E,{name:"otpPolicyPeriod",defaultValue:30,control:n,rules:{min:1,max:120},render:({field:l})=>{const r=l.value??30;return e.jsx(Ve,{id:"otpPolicyPeriod","data-testid":"otpPolicyPeriod",value:r,onChange:l.onChange,units:["second","minute"],validated:m.otpPolicyPeriod?R.error:R.default})}})}),x===q[1]&&e.jsx(P,{label:t("initialCounter"),fieldId:"initialCounter",helperTextInvalid:t("initialCounterErrorHint"),validated:m.otpPolicyInitialCounter?R.error:R.default,labelIcon:e.jsx(w,{helpText:t("authentication-help:initialCounter"),fieldLabelId:"authentication:initialCounter"}),children:e.jsx(E,{name:"otpPolicyInitialCounter",defaultValue:30,control:n,rules:{min:1,max:120},render:({field:l})=>{const _=l.value??30,N=v=>l.onChange(Math.max(v,1));return e.jsx(re,{id:"initialCounter",value:_,min:1,onPlus:()=>N(_+1),onMinus:()=>N(_-1),onChange:v=>{const M=Number(v.currentTarget.value);N(isNaN(M)?30:M)}})}})}),e.jsx(P,{label:t("supportedApplications"),labelIcon:e.jsx(w,{helpText:t("authentication-help:supportedApplications"),fieldLabelId:"authentication:supportedApplications"}),children:e.jsx(ut,{"data-testid":"supportedApplications",children:A.map(l=>e.jsx(mt,{isReadOnly:!0,children:l},l))})}),x===q[0]&&e.jsx(P,{label:t("otpPolicyCodeReusable"),fieldId:"otpPolicyCodeReusable",labelIcon:e.jsx(w,{helpText:t("authentication-help:otpPolicyCodeReusable"),fieldLabelId:"authentication:otpPolicyCodeReusable"}),children:e.jsx(E,{name:"otpPolicyCodeReusable",defaultValue:!0,control:n,render:({field:l})=>e.jsx(Y,{id:"otpPolicyCodeReusable",label:t("common:on"),labelOff:t("common:off"),isChecked:l.value,onChange:l.onChange})})}),e.jsxs(ee,{children:[e.jsx(C,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!p||!d,children:t("common:save")}),e.jsx(C,{"data-testid":"reload",variant:U.link,onClick:()=>c({...a}),children:t("common:reload")})]})]})})};const kt=({policy:{id:a,configType:i,defaultValue:t,displayName:n},onRemove:c})=>{const{t:s}=S("authentication"),{control:p,register:d,formState:{errors:m}}=Re();return e.jsx(P,{label:n,fieldId:a,isRequired:!0,helperTextInvalid:s("common:required"),validated:m[a]?R.error:R.default,labelIcon:e.jsx(w,{helpText:s(`authentication-help:passwordPolicies.${a}`),fieldLabelId:`authentication:${a}`}),children:e.jsxs(Ge,{children:[e.jsxs(xe,{isFilled:!0,children:[i&&i!=="int"&&e.jsx(X,{id:a,"data-testid":a,...d(a,{required:!0}),defaultValue:t,validated:m[a]?R.error:R.default}),i==="int"&&e.jsx(E,{name:a,defaultValue:Number.parseInt(t||"0"),control:p,render:({field:h})=>{const f=u=>h.onChange(Math.max(u,0)),o=Number(h.value);return e.jsx(re,{id:a,value:o,min:0,onPlus:()=>f(o+1),onMinus:()=>f(o-1),onChange:u=>{const b=Number(u.currentTarget.value);f(isNaN(b)?0:b)},className:"keycloak__policies_authentication__number-field"})}}),!i&&e.jsx(Y,{id:a,label:s("common:on"),labelOff:s("common:off"),isChecked:!0,isDisabled:!0,"aria-label":n})]}),e.jsx(xe,{children:e.jsx(C,{"data-testid":`remove-${a}`,variant:"link",className:"keycloak__policies_authentication__minus-icon",onClick:()=>c(a),"aria-label":s("common:remove"),children:e.jsx(ht,{})})})]})})},Ue=" and ",Nt=(a,i)=>a.map(t=>`${t.id}(${i[t.id]})`).join(Ue),Ft=(a,i)=>a.split(Ue).map(Ot).reduce((t,{id:n,value:c})=>{const s=i.find(p=>p.id===n);return s?t.concat({...s,value:c}):t},[]);function Ot(a){const i=a.indexOf("(");if(i===-1)return{id:a.trim()};const t=a.substring(0,i).trim(),n=a.lastIndexOf(")");if(n===-1)return{id:t};const c=a.substring(i+1,n).trim();return{id:t,value:c}}const ve=({onSelect:a,selectedPolicies:i})=>{const{t}=S("authentication"),{passwordPolicies:n}=ke(),[c,s]=I.useState(!1),p=I.useMemo(()=>n?.filter(d=>i.find(m=>m.id===d.id)===void 0),[i]);return e.jsx(B,{width:300,onSelect:(d,m)=>{a(m),s(!1)},onToggle:d=>s(d),isOpen:c,selections:t("addPolicy"),isDisabled:p?.length===0,children:p?.map(d=>e.jsx(D,{value:d,children:d.displayName},d.id))})},Mt=({realm:a,realmUpdated:i})=>{const{t}=S("authentication"),{passwordPolicies:n}=ke(),{adminClient:c}=k(),{addAlert:s,addError:p}=$(),{realm:d}=O(),[m,h]=I.useState([]),y=A=>{h([...m,A]),u(A.id,A.defaultValue,{shouldDirty:!0})},f=K({defaultValues:{}}),{handleSubmit:o,setValue:u,reset:b,formState:{isDirty:g}}=f,x=A=>{b();const j=Ft(A.passwordPolicy||"",n);j.forEach(l=>{u(l.id,l.value)}),h(j)};I.useEffect(()=>x(a),[]);const T=async A=>{const j={...a,passwordPolicy:Nt(m,A)};try{await c.realms.update({realm:d},j),i(j),x(j),s(t("updatePasswordPolicySuccess"),F.success)}catch(l){p("authentication:updatePasswordPolicyError",l)}};return e.jsxs(H,{variant:"light",className:"pf-u-p-0",children:[(m.length!==0||a.passwordPolicy)&&e.jsxs(e.Fragment,{children:[e.jsx(yt,{children:e.jsx(ft,{children:e.jsx(De,{children:e.jsx(ve,{onSelect:y,selectedPolicies:m})})})}),e.jsx(ze,{}),e.jsx(H,{variant:"light",children:e.jsx(de,{...f,children:e.jsxs(te,{className:"keycloak__policies_authentication__form",role:"manage-realm",isHorizontal:!0,onSubmit:o(T),children:[m.map((A,j)=>e.jsx(kt,{policy:A,onRemove:l=>{h(m.filter(r=>r.id!==l)),u(A.id,"",{shouldDirty:!0})}},`${A.id}-${j}`)),e.jsxs(ee,{children:[e.jsx(C,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!g,children:t("common:save")}),e.jsx(C,{"data-testid":"reload",variant:U.link,onClick:()=>x(a),children:t("common:reload")})]})]})})})]}),!m.length&&!a.passwordPolicy&&e.jsxs(bt,{"data-testid":"empty-state",variant:"large",children:[e.jsx(jt,{icon:gt}),e.jsx(Ye,{headingLevel:"h1",size:"lg",children:t("noPasswordPolicies")}),e.jsx(xt,{children:t("noPasswordPoliciesInstructions")}),e.jsx($e,{children:e.jsx(ve,{onSelect:y,selectedPolicies:[]})})]})]})};const Lt=["ES256","ES384","ES512","RS256","RS384","RS512","RS1"],Vt=["not specified","none","indirect","direct"],Dt=["not specified","platform","cross-platform"],$t=["not specified","Yes","No"],Ut=["not specified","required","preferred","discouraged"],G=({name:a,label:i,options:t,labelPrefix:n,isMultiSelect:c=!1})=>{const{t:s}=S("authentication"),{control:p}=Re(),[d,m]=I.useState(!1);return e.jsx(P,{label:s(i),labelIcon:e.jsx(w,{helpText:s(`authentication-help:${i}`),fieldLabelId:`authentication:${i}`}),fieldId:a,children:e.jsx(E,{name:a,defaultValue:t[0],control:p,render:({field:h})=>e.jsx(B,{toggleId:a,onToggle:m,onSelect:(y,f)=>{if(c){const o=h.value.find(u=>u===f)?h.value.filter(u=>u!==f):[...h.value,f];h.onChange(o)}else h.onChange(f.toString()),m(!1)},selections:n?s(`${n}.${h.value}`):h.value,variant:c?Q.typeaheadMulti:Q.single,"aria-label":s(a),typeAheadAriaLabel:s(a),isOpen:d,children:t.map(y=>e.jsx(D,{selected:y===h.value,value:y,children:n?s(`${n}.${y}`):y},y))})})})},Ie=({realm:a,realmUpdated:i,isPasswordLess:t=!1})=>{const{t:n}=S("authentication"),{adminClient:c}=k(),{addAlert:s,addError:p}=$(),{realm:d}=O(),{enabled:m}=We(),h=K({mode:"onChange"}),{control:y,register:f,setValue:o,handleSubmit:u,formState:{isDirty:b,errors:g}}=h,x=t?"webAuthnPolicyPasswordless":"webAuthnPolicy",T=j=>_e(j,o);I.useEffect(()=>T(a),[]);const A=async j=>{const l=Ee(j);try{await c.realms.update({realm:d},l),i(l),T(l),s(n("webAuthnUpdateSuccess"),F.success)}catch(r){p("authentication:webAuthnUpdateError",r)}};return e.jsxs(H,{variant:"light",children:[m&&e.jsx(Te,{bodyContent:n(`authentication-help:${x}FormHelp`),children:e.jsx(Ce,{className:"keycloak__section_intro__help",children:e.jsxs(le,{children:[e.jsx(vt,{})," ",n("authentication-help:webauthnIntro")]})})}),e.jsxs(te,{role:"manage-realm",isHorizontal:!0,onSubmit:u(A),className:"keycloak__webauthn_policies_authentication__form",children:[e.jsx(P,{label:n("webAuthnPolicyRpEntityName"),fieldId:"webAuthnPolicyRpEntityName",helperTextInvalid:n("common:required"),validated:g.webAuthnPolicyRpEntityName?"error":"default",isRequired:!0,labelIcon:e.jsx(w,{helpText:n("authentication-help:webAuthnPolicyRpEntityName"),fieldLabelId:"authentication:webAuthnPolicyRpEntityName"}),children:e.jsx(X,{id:"webAuthnPolicyRpEntityName","data-testid":"webAuthnPolicyRpEntityName",validated:g.webAuthnPolicyRpEntityName?"error":"default",...f(`${x}RpEntityName`,{required:!0})})}),e.jsxs(de,{...h,children:[e.jsx(G,{name:`${x}SignatureAlgorithms`,label:"webAuthnPolicySignatureAlgorithms",options:Lt,isMultiSelect:!0}),e.jsx(P,{label:n("webAuthnPolicyRpId"),labelIcon:e.jsx(w,{helpText:n("authentication-help:webAuthnPolicyRpId"),fieldLabelId:"authentication:webAuthnPolicyRpId"}),fieldId:"webAuthnPolicyRpId",children:e.jsx(X,{id:"webAuthnPolicyRpId","data-testid":"webAuthnPolicyRpId",...f(`${x}RpId`)})}),e.jsx(G,{name:`${x}AttestationConveyancePreference`,label:"webAuthnPolicyAttestationConveyancePreference",options:Vt,labelPrefix:"attestationPreference"}),e.jsx(G,{name:`${x}AuthenticatorAttachment`,label:"webAuthnPolicyAuthenticatorAttachment",options:Dt,labelPrefix:"authenticatorAttachment"}),e.jsx(G,{name:`${x}RequireResidentKey`,label:"webAuthnPolicyRequireResidentKey",options:$t,labelPrefix:"residentKey"}),e.jsx(G,{name:`${x}UserVerificationRequirement`,label:"webAuthnPolicyUserVerificationRequirement",options:Ut,labelPrefix:"userVerify"}),e.jsx(P,{label:n("webAuthnPolicyCreateTimeout"),fieldId:"webAuthnPolicyCreateTimeout",helperTextInvalid:n("webAuthnPolicyCreateTimeoutHint"),validated:g.webAuthnPolicyCreateTimeout?"error":"default",labelIcon:e.jsx(w,{helpText:n("authentication-help:webAuthnPolicyCreateTimeout"),fieldLabelId:"authentication:webAuthnPolicyCreateTimeout"}),children:e.jsx(E,{name:`${x}CreateTimeout`,defaultValue:0,control:y,rules:{min:0,max:31536},render:({field:j})=>e.jsx(Ve,{"data-testid":"webAuthnPolicyCreateTimeout","aria-label":n("webAuthnPolicyCreateTimeout"),value:j.value,onChange:j.onChange,units:["second","minute","hour"],validated:g.webAuthnPolicyCreateTimeout?"error":"default"})})}),e.jsx(P,{label:n("webAuthnPolicyAvoidSameAuthenticatorRegister"),fieldId:"webAuthnPolicyAvoidSameAuthenticatorRegister",labelIcon:e.jsx(w,{helpText:n("authentication-help:webAuthnPolicyAvoidSameAuthenticatorRegister"),fieldLabelId:"authentication:webAuthnPolicyAvoidSameAuthenticatorRegister"}),children:e.jsx(E,{name:`${x}AvoidSameAuthenticatorRegister`,defaultValue:!1,control:y,render:({field:j})=>e.jsx(Y,{id:"webAuthnPolicyAvoidSameAuthenticatorRegister",label:n("common:on"),labelOff:n("common:off"),isChecked:j.value,onChange:j.onChange,"aria-label":n("webAuthnPolicyAvoidSameAuthenticatorRegister")})})}),e.jsx(P,{label:n("webAuthnPolicyAcceptableAaguids"),fieldId:"webAuthnPolicyAcceptableAaguids",labelIcon:e.jsx(w,{helpText:n("authentication-help:webAuthnPolicyAcceptableAaguids"),fieldLabelId:"authentication:webAuthnPolicyAcceptableAaguids"}),children:e.jsx(At,{name:`${x}AcceptableAaguids`,"aria-label":n("webAuthnPolicyAcceptableAaguids"),addButtonLabel:"authentication:addAaguids"})})]}),e.jsxs(ee,{children:[e.jsx(C,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!b,children:n("common:save")}),e.jsx(C,{"data-testid":"reload",variant:U.link,onClick:()=>T(a),children:n("common:reload")})]})]})]})},qt=()=>{const{t:a}=S("authentication"),[i,t]=I.useState(1),{adminClient:n}=k(),{realm:c}=O(),[s,p]=I.useState();return ue(async()=>{const d=await n.realms.findOne({realm:c});if(!d)throw new Error(a("common:notFound"));return d},d=>{p(d)},[]),s?e.jsxs(It,{activeKey:i,onSelect:(d,m)=>t(m),mountOnEnter:!0,unmountOnExit:!0,children:[e.jsx(L,{id:"passwordPolicy",eventKey:1,title:e.jsx(V,{children:a("passwordPolicy")}),children:e.jsx(Mt,{realm:s,realmUpdated:p})}),e.jsx(L,{id:"otpPolicy",eventKey:2,title:e.jsx(V,{children:a("otpPolicy")}),children:e.jsx(Rt,{realm:s,realmUpdated:p})}),e.jsx(L,{id:"webauthnPolicy",eventKey:3,title:e.jsx(V,{children:a("webauthnPolicy")}),children:e.jsx(Ie,{realm:s,realmUpdated:p})}),e.jsx(L,{id:"webauthnPasswordlessPolicy",eventKey:4,title:e.jsx(V,{children:a("webauthnPasswordlessPolicy")}),children:e.jsx(Ie,{realm:s,realmUpdated:p,isPasswordLess:!0})}),e.jsx(L,{"data-testid":"tab-ciba-policy",eventKey:5,title:e.jsx(V,{children:a("cibaPolicy")}),children:e.jsx(Et,{realm:s,realmUpdated:p})})]}):e.jsx(me,{})},Ht=()=>{const{t:a}=S("authentication"),{adminClient:i}=k(),{addAlert:t,addError:n}=$(),[c,s]=I.useState(),[p,d]=I.useState(0),m=()=>d(p+1);ue(async()=>{const[o,u]=await Promise.all([i.authenticationManagement.getRequiredActions(),i.authenticationManagement.getUnregisteredRequiredActions()]);return[...o.map(b=>({name:b.name,enabled:b.enabled,defaultAction:b.defaultAction,data:b})),...u.map(b=>({name:b.name,enabled:!1,defaultAction:!1,data:b}))]},o=>s(o),[p]);const h=o=>!("alias"in o),y=async(o,u)=>{try{u in o?(o[u]=!o[u],await i.authenticationManagement.updateRequiredAction({alias:o.alias},o)):h(o)&&await i.authenticationManagement.registerRequiredAction({name:o.name,providerId:o.providerId}),m(),t(a("updatedRequiredActionSuccess"),F.success)}catch(b){n("authentication:updatedRequiredActionError",b)}},f=async(o,u)=>{try{const b=o.alias;for(let g=0;g<Math.abs(u);g++)u>0?await i.authenticationManagement.lowerRequiredActionPriority({alias:b}):await i.authenticationManagement.raiseRequiredActionPriority({alias:b});m(),t(a("updatedRequiredActionSuccess"),F.success)}catch(b){n("authentication:updatedRequiredActionError",b)}};return c?e.jsx(Pt,{keyField:"name",onDragFinish:async(o,u)=>{const b=c.map(j=>j.name),g=u.indexOf(o),x=b.indexOf(o),T=c[x].data;if(!T.alias)return;const A=g-x;f(T,A)},columns:[{name:"name",displayKey:"authentication:requiredActions"},{name:"enabled",displayKey:"common:enabled",cellRenderer:o=>e.jsx(Y,{id:`enable-${J(o.name)}`,label:a("common:on"),labelOff:a("common:off"),isChecked:o.enabled,onChange:()=>{y(o.data,"enabled")},"aria-label":J(o.name)})},{name:"default",displayKey:"authentication:setAsDefaultAction",thTooltipText:"authentication-help:authDefaultActionTooltip",cellRenderer:o=>e.jsx(Y,{id:`default-${J(o.name)}`,label:a("common:on"),isDisabled:!o.enabled,labelOff:o.enabled?a("common:off"):a("disabledOff"),isChecked:o.defaultAction,onChange:()=>{y(o.data,"defaultAction")},"aria-label":J(o.name)})}],data:c}):e.jsx(me,{})};const z=new Map([["browserFlow","browser"],["registrationFlow","registration"],["directGrantFlow","direct grant"],["resetCredentialsFlow","reset credentials"],["clientAuthenticationFlow","clients"],["dockerAuthenticationFlow","docker auth"]]),Bt=({id:a,alias:i,usedBy:t,builtIn:n})=>{const{t:c}=S("authentication"),{realm:s}=O();return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{to:Se({realm:s,id:a,usedBy:t?.type||"notInUse",builtIn:n?"builtIn":void 0}),children:i},`link-${a}`)," ",n&&e.jsx(Je,{children:c("buildIn")},`label-${a}`)]})};function Kt(){const{t:a}=S("authentication"),{adminClient:i}=k(),{realm:t}=O(),[n,c]=I.useState(0),s=()=>{x(void 0),c(n+1)},{addAlert:p,addError:d}=$(),m=Oe(),[h,y]=I.useState(),[f,o]=W(),[u,b]=W(),[g,x]=I.useState();ue(()=>i.realms.findOne({realm:t}),x,[n]);const T=async()=>{const M=await(await fetch(`${Ze(i.baseUrl)}admin/realms/${t}/ui-ext/authentication-management/flows`,{method:"GET",headers:et(await i.getAccessToken())})).json();return M?tt(m(M,lt("alias")),qe=>qe.usedBy?.type):[]},A=v=>ot(ye({realm:t,tab:v})),j=A("flows"),l=A("required-actions"),r=A("policies"),[_,N]=at({titleKey:"authentication:deleteConfirmFlow",children:e.jsxs(wt,{i18nKey:"authentication:deleteConfirmFlowMessage",children:[" ",e.jsx("strong",{children:{flow:h?h.alias:""}}),"."]}),continueButtonLabel:"common:delete",continueButtonVariant:U.danger,onConfirm:async()=>{try{await i.authenticationManagement.deleteFlow({flowId:h.id}),s(),p(a("deleteFlowSuccess"),F.success)}catch(v){d("authentication:deleteFlowError",v)}}});return g?e.jsxs(e.Fragment,{children:[e.jsx(N,{}),f&&e.jsx(_t,{name:h?h.alias:"",description:h?.description,toggleDialog:o,onComplete:()=>{s(),o()}}),u&&e.jsx(Tt,{onClose:()=>{b(),s()},flowAlias:h?.alias}),e.jsx(st,{titleKey:"authentication:title",subKey:"authentication:authenticationExplain",helpUrl:Xe.authenticationUrl,divider:!1}),e.jsx(H,{variant:"light",className:"pf-u-p-0",children:e.jsxs(it,{isBox:!0,defaultLocation:ye({realm:t,tab:"flows"}),children:[e.jsx(L,{"data-testid":"flows",title:e.jsx(V,{children:a("flows")}),...j,children:e.jsx(Fe,{loader:T,ariaLabelKey:"authentication:title",searchPlaceholderKey:"authentication:searchForFlow",toolbarItem:e.jsx(De,{children:e.jsx(C,{component:v=>e.jsx(Ne,{...v,to:Qe({realm:t})}),children:a("createFlow")})}),actionResolver:({data:v})=>[{title:a("duplicate"),onClick:()=>{o(),y(v)}},...v.usedBy?.type!=="DEFAULT"?[{title:a("bindFlow"),onClick:()=>{b(),y(v)}}]:[],...!v.builtIn&&!v.usedBy?[{title:a("common:delete"),onClick:()=>{y(v),_()}}]:[]],columns:[{name:"alias",displayKey:"authentication:flowName",cellRenderer:v=>e.jsx(Bt,{...v})},{name:"usedBy",displayKey:"authentication:usedBy",cellRenderer:v=>e.jsx(St,{authType:v,realm:g})},{name:"description",displayKey:"common:description"}],emptyState:e.jsx(nt,{message:a("emptyEvents"),instructions:a("emptyEventsInstructions")})},n)}),e.jsx(L,{"data-testid":"requiredActions",title:e.jsx(V,{children:a("requiredActions")}),...l,children:e.jsx(Ht,{})}),e.jsx(L,{"data-testid":"policies",title:e.jsx(V,{children:a("policies")}),...r,children:e.jsx(qt,{})})]})})]}):e.jsx(me,{})}const Aa=Object.freeze(Object.defineProperty({__proto__:null,REALM_FLOWS:z,default:Kt},Symbol.toStringTag,{value:"Module"}));export{Aa as A,Tt as B,_t as D};
//# sourceMappingURL=AuthenticationSection-d711df15.js.map
