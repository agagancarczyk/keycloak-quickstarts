import{u as N,a as B,r as u,d as V,n as k,j as e,F as l,G as c,C as D,e as E,f as U,b as G,a4 as q,A as F,aR as L,X as z,w as H,P as W,g as X,V as v,S as J,B as P,k as Q,L as Y,s as Z,aH as $,q as ee}from"./index-a3421f29.js";import{u as se}from"./ConfirmDialog-09ff7a12.js";import{F as te}from"./FormAccess-1cceaef6.js";import{K as ae}from"./KeyValueInput-ce08b760.js";import{K as b}from"./KeycloakTextInput-e7f6e917.js";import{M as re}from"./MultiLineInput-14187d1c.js";import{V as ne}from"./ViewHeader-832ec56e.js";import{u as oe}from"./useParams-5abeab7d.js";import{S as ie,a as le,b as ce}from"./Select-0f56a9cc.js";import{A as de}from"./Form-518a2cf2.js";import"./Modal-21c37af7.js";import"./copy-icon-a4fe01af.js";import"./GridItem-d34dae2e.js";import"./minus-icon-16876c86.js";import"./minus-circle-icon-6f9a971c.js";import"./ActionListItem-ab1a4322.js";import"./plus-circle-icon-cb854796.js";import"./EmptyStateBody-7b4fcee1.js";import"./Text-564bf299.js";import"./ToolbarContent-7b435752.js";import"./check-fc57dbe1.js";import"./star-icon-6a7e7d25.js";const me=({clientId:s})=>{const{t:d}=N("clients"),{control:y}=B(),[S,w]=u.useState(!1),[p,A]=u.useState(),[i,h]=u.useState(""),{adminClient:I}=V();k(()=>{const a={id:s,first:0,max:20,deep:!1,name:i};return I.clients.listAllScopes(a)},A,[i]);const x=a=>a?.map(n=>e.jsx(ce,{value:n,children:n.name},n.id));return e.jsx(l,{label:d("authorizationScopes"),labelIcon:e.jsx(c,{helpText:d("clients-help:scopes"),fieldLabelId:"clients:scopes"}),fieldId:"scopes",children:e.jsx(D,{name:"scopes",defaultValue:[],control:y,render:({field:a})=>e.jsx(ie,{toggleId:"scopes",variant:le.typeaheadMulti,chipGroupProps:{numChips:3,expandedText:d("common:hide"),collapsedText:d("common:showRemaining")},onToggle:w,isOpen:S,selections:a.value.map(n=>n.name),onFilter:(n,m)=>(h(m),x(p)),onSelect:(n,m)=>{const g=typeof m=="string"?m:m.name,C=a.value.find(r=>r.name===g)?a.value.filter(r=>r.name!==g):[...a.value,m];a.onChange(C)},onClear:n=>{n.stopPropagation(),h(""),a.onChange([])},typeAheadAriaLabel:d("authorizationScopes"),children:x(p)})})})};function ke(){const{t:s}=N("clients"),[d,y]=u.useState(),[S,w]=u.useState(),[p,A]=u.useState(),{adminClient:i}=V(),{addAlert:h,addError:I}=E(),x=U({mode:"onChange"}),{register:a,formState:{errors:n},control:m,setValue:g,handleSubmit:C}=x,{id:r,resourceId:o,realm:T}=oe(),R=G(),M=(t={})=>{ee(t,g)};k(()=>Promise.all([i.clients.findOne({id:r}),o?i.clients.getResource({id:r,resourceId:o}):Promise.resolve(void 0),o?i.clients.listPermissionsByResource({id:r,resourceId:o}):Promise.resolve(void 0)]),([t,f,j])=>{if(!t)throw new Error(s("common:notFound"));y(t),A(j),w(f),M(f)},[]);const O=async t=>{const f=Z(t);try{if(o)await i.clients.updateResource({id:r,resourceId:o},f);else{const j=await i.clients.createResource({id:r},f);R($({realm:T,id:r,resourceId:j._id}))}h(s((o?"update":"create")+"ResourceSuccess"),F.success)}catch(j){I("clients:resourceSaveError",j)}},[_,K]=se({titleKey:"clients:deleteResource",children:e.jsxs(e.Fragment,{children:[s("deleteResourceConfirm"),p?.length!==0&&e.jsx(q,{variant:"warning",isInline:!0,isPlain:!0,title:s("deleteResourceWarning"),className:"pf-u-pt-lg",children:e.jsx("p",{className:"pf-u-pt-xs",children:p?.map(t=>e.jsx("strong",{className:"pf-u-pr-md",children:t.name},t.id))})})]}),continueButtonLabel:"clients:confirm",onConfirm:async()=>{try{await i.clients.delResource({id:r,resourceId:o}),h(s("resourceDeletedSuccess"),F.success),R(L({realm:T,clientId:r,tab:"resources"}))}catch(t){I("clients:resourceDeletedError",t)}}});return d?e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsx(ne,{titleKey:o?S?.name:"clients:createResource",dropdownItems:o?[e.jsx(H,{"data-testid":"delete-resource",onClick:()=>_(),children:s("common:delete")},"delete")]:void 0}),e.jsx(W,{variant:"light",children:e.jsx(X,{...x,children:e.jsxs(te,{isHorizontal:!0,role:"view-clients",className:"keycloak__resource-details__form",onSubmit:C(O),children:[e.jsx(l,{label:s("owner"),fieldId:"owner",labelIcon:e.jsx(c,{helpText:s("clients-help:owner"),fieldLabelId:"clients:owner"}),children:e.jsx(b,{id:"owner",value:d.clientId,isReadOnly:!0})}),e.jsx(l,{label:s("common:name"),fieldId:"name",labelIcon:e.jsx(c,{helpText:s("clients-help:resourceName"),fieldLabelId:"name"}),helperTextInvalid:s("common:required"),validated:n.name?v.error:v.default,isRequired:!0,children:e.jsx(b,{id:"name",validated:n.name?v.error:v.default,...a("name",{required:!0})})}),e.jsx(l,{label:s("displayName"),fieldId:"displayName",labelIcon:e.jsx(c,{helpText:s("clients-help:displayName"),fieldLabelId:"name"}),children:e.jsx(b,{id:"displayName",...a("displayName")})}),e.jsx(l,{label:s("type"),fieldId:"type",labelIcon:e.jsx(c,{helpText:s("clients-help:type"),fieldLabelId:"type"}),children:e.jsx(b,{id:"type",...a("type")})}),e.jsx(l,{label:s("uris"),fieldId:"uris",labelIcon:e.jsx(c,{helpText:s("clients-help:uris"),fieldLabelId:"clients:uris"}),children:e.jsx(re,{name:"uris",type:"url","aria-label":s("uris"),addButtonLabel:"clients:addUri"})}),e.jsx(me,{clientId:r}),e.jsx(l,{label:s("iconUri"),fieldId:"iconUri",labelIcon:e.jsx(c,{helpText:s("clients-help:iconUri"),fieldLabelId:"clients:iconUri"}),children:e.jsx(b,{id:"iconUri",type:"url",...a("icon_uri")})}),e.jsx(l,{hasNoPaddingTop:!0,label:s("ownerManagedAccess"),labelIcon:e.jsx(c,{helpText:s("clients-help:ownerManagedAccess"),fieldLabelId:"clients:ownerManagedAccess"}),fieldId:"ownerManagedAccess",children:e.jsx(D,{name:"ownerManagedAccess",control:m,defaultValue:!1,render:({field:t})=>e.jsx(J,{id:"ownerManagedAccess",label:s("common:on"),labelOff:s("common:off"),isChecked:t.value,onChange:t.onChange,"aria-label":s("ownerManagedAccess")})})}),e.jsx(l,{hasNoPaddingTop:!0,label:s("resourceAttribute"),labelIcon:e.jsx(c,{helpText:s("clients-help:resourceAttribute"),fieldLabelId:"clients:resourceAttribute"}),fieldId:"resourceAttribute",children:e.jsx(ae,{name:"attributes"})}),e.jsx(de,{children:e.jsxs("div",{className:"pf-u-mt-md",children:[e.jsx(P,{variant:Q.primary,type:"submit","data-testid":"save",children:s("common:save")}),e.jsx(P,{variant:"link","data-testid":"cancel",component:t=>e.jsx(Y,{...t,to:L({realm:T,clientId:r,tab:"resources"})}),children:s("common:cancel")})]})})]})})})]}):e.jsx(z,{})}export{ke as default};
//# sourceMappingURL=ResourceDetails-da2a3b31.js.map
