import{f as H,r as y,d as N,b as U,c as $,u as z,e as W,n as X,k as _,A,dn as V,N as J,j as e,X as Q,w as I,P as Y,F as f,G as T,V as L,C as Z,g as ee,B as K,s as re,q as te}from"./index-a3421f29.js";import{u as ae}from"./ConfirmDialog-09ff7a12.js";import{D as oe}from"./DynamicComponents-72877b30.js";import{F as pe}from"./FormAccess-1cceaef6.js";import{K as l}from"./KeycloakTextInput-e7f6e917.js";import{V as se}from"./ViewHeader-832ec56e.js";import{u as ne}from"./useParams-5abeab7d.js";import{S as ie,a as de,b as me}from"./Select-0f56a9cc.js";import{F as le,A as ce}from"./Form-518a2cf2.js";import"./Modal-21c37af7.js";import"./ClientSelect-3f0fc581.js";import"./FileUpload-ca37c1a6.js";import"./CodeEditor-2fb93648.js";import"./copy-icon-a4fe01af.js";import"./EmptyStateBody-7b4fcee1.js";import"./EmptyStateSecondaryActions-08edafb5.js";import"./GroupPickerDialog-caf8c38d.js";import"./PaginatingTableToolbar-08ca9efb.js";import"./plus-circle-icon-cb854796.js";import"./TableToolbar-ee0c86ef.js";import"./ToolbarContent-7b435752.js";import"./DataListItemRow-75e02946.js";import"./data-list-7d55714c.js";import"./grip-vertical-icon-cbeff50f.js";import"./ActionListItem-ab1a4322.js";import"./FlexItem-65b5f999.js";import"./minus-circle-icon-6f9a971c.js";import"./MultiLineInput-14187d1c.js";import"./PasswordInput-85f9399f.js";import"./useToggle-a9cb2c55.js";import"./AddRoleMappingModal-abb19beb.js";import"./KeycloakDataTable-10a62d94.js";import"./Td-6d4ab209.js";import"./star-icon-6a7e7d25.js";import"./check-fc57dbe1.js";import"./Checkbox-d00621d8.js";import"./useLocaleSort-3efc7c31.js";import"./resource-08ae7dbc.js";import"./joinPath-55fd24bc.js";import"./filter-icon-9d72dc58.js";import"./KeycloakTextArea-1b518857.js";import"./GridItem-d34dae2e.js";import"./Text-564bf299.js";function tr(){const o=H(),[s,P]=y.useState(),[g,q]=y.useState(),{adminClient:d}=N(),{id:x,mapperId:p}=ne(),c=U(),{realm:h}=$(),{t}=z("user-federation"),{addAlert:j,addError:k}=W(),[b,v]=y.useState(!1),[D,E]=y.useState(0),G=()=>E(D+1);X(async()=>{const r=await d.components.listSubComponents({id:x,type:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper"});if(p&&p!=="new"){const a=await d.components.findOne({id:p});return{components:r,fetchedMapper:a}}return{components:r}},({components:r,fetchedMapper:a})=>{if(P(a),q(r),p!=="new"&&!a)throw new Error(t("common:notFound"));a&&w(a)},[]);const w=r=>{te(r,o.setValue)},O=async r=>{const a=re(r),m={...a,config:Object.entries(a.config||{}).reduce((u,[B,S])=>(u[B]=Array.isArray(S)?S:[S],u),{})};try{p==="new"?(await d.components.create(m),c(V({realm:h,id:r.parentId,tab:"mappers"}))):await d.components.update({id:p},m),w(m),j(t(p==="new"?"common:mappingCreatedSuccess":"common:mappingUpdatedSuccess"),A.success)}catch(u){k(p==="new"?"common:mappingCreatedError":"common:mappingUpdatedError",u)}},C=async r=>{try{const a=await d.userStorageProvider.mappersSync({parentId:s?.parentId||"",id:p,direction:r});j(t("syncLDAPGroupsSuccessful",{result:a.status}))}catch(a){k("user-federation:syncLDAPGroupsError",a)}G()},[M,R]=ae({titleKey:"common:deleteMappingTitle",messageKey:"common:deleteMappingConfirm",continueButtonLabel:"common:delete",continueButtonVariant:_.danger,onConfirm:async()=>{try{await d.components.del({id:s.id}),j(t("common:mappingDeletedSuccess"),A.success),c(V({id:x,realm:h,tab:"mappers"}))}catch(r){k("common:mappingDeletedError",r)}}}),F=J({control:o.control,name:"providerId"});if(!g)return e.jsx(Q,{});const n=p==="new",i=g.find(r=>r.id===F);return e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsx(se,{titleKey:s?s.name:t("common:createNewMapper"),dropdownItems:n?void 0:[e.jsx(I,{onClick:M,children:t("common:delete")},"delete"),i?.metadata.fedToKeycloakSyncSupported&&e.jsx(I,{onClick:()=>C("fedToKeycloak"),children:t("syncLDAPGroupsToKeycloak")},"fedSync"),i?.metadata.keycloakToFedSyncSupported&&e.jsx(I,{onClick:()=>{C("keycloakToFed")},children:t("syncKeycloakGroupsToLDAP")},"ldapSync")]},D),e.jsxs(Y,{variant:"light",isFilled:!0,children:[e.jsxs(pe,{role:"manage-realm",isHorizontal:!0,children:[!n&&e.jsx(f,{label:t("common:id"),fieldId:"kc-ldap-mapper-id",children:e.jsx(l,{isDisabled:!0,id:"kc-ldap-mapper-id","data-testid":"ldap-mapper-id",...o.register("id")})}),e.jsxs(f,{label:t("common:name"),labelIcon:e.jsx(T,{helpText:t("user-federation-help:nameHelp"),fieldLabelId:"name"}),fieldId:"kc-ldap-mapper-name",isRequired:!0,children:[e.jsx(l,{isDisabled:!n,isRequired:!0,id:"kc-ldap-mapper-name","data-testid":"ldap-mapper-name",validated:o.formState.errors.name?L.error:L.default,...o.register("name",{required:!0})}),e.jsx(l,{hidden:!0,defaultValue:n?x:s?s.parentId:"",id:"kc-ldap-parentId","data-testid":"ldap-mapper-parentId",...o.register("parentId")}),e.jsx(l,{hidden:!0,defaultValue:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper",id:"kc-ldap-provider-type","data-testid":"ldap-mapper-provider-type",...o.register("providerType")})]}),n?e.jsx(f,{label:t("common:mapperType"),labelIcon:e.jsx(T,{helpText:i?.helpText?i.helpText:t("user-federation-help:mapperTypeHelp"),fieldLabelId:"mapperType"}),fieldId:"kc-providerId",isRequired:!0,children:e.jsx(Z,{name:"providerId",defaultValue:"",control:o.control,"data-testid":"ldap-mapper-type-select",render:({field:r})=>e.jsx(ie,{toggleId:"kc-providerId",required:!0,onToggle:()=>v(!b),isOpen:b,onSelect:(a,m)=>{r.onChange(m),v(!1)},selections:r.value,variant:de.typeahead,children:g.map(a=>e.jsx(me,{value:a.id},a.id))})})}):e.jsx(f,{label:t("common:mapperType"),labelIcon:e.jsx(T,{helpText:i?.helpText?i.helpText:t("user-federation-help:mapperTypeHelp"),fieldLabelId:"mapperType"}),fieldId:"kc-ldap-mapper-type",isRequired:!0,children:e.jsx(l,{isDisabled:!n,isRequired:!0,id:"kc-ldap-mapper-type","data-testid":"ldap-mapper-type-fld",...o.register("providerId")})}),e.jsx(ee,{...o,children:!!F&&e.jsx(oe,{properties:i?.properties})})]}),e.jsx(le,{onSubmit:o.handleSubmit(()=>O(o.getValues())),children:e.jsxs(ce,{children:[e.jsx(K,{isDisabled:!o.formState.isDirty,variant:"primary",type:"submit","data-testid":"ldap-mapper-save",children:t("common:save")}),e.jsx(K,{variant:"link",onClick:()=>c(n?-1:`/${h}/user-federation/ldap/${s.parentId}/mappers`),"data-testid":"ldap-mapper-cancel",children:t("common:cancel")})]})})]})]})}export{tr as default};
//# sourceMappingURL=LdapMapperDetails-f77fb96f.js.map
