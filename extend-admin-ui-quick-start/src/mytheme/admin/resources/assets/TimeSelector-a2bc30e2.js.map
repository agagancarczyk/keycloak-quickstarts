{"version":3,"file":"TimeSelector-a2bc30e2.js","sources":["../../src/components/time-selector/TimeSelector.tsx"],"sourcesContent":["import { useEffect, useMemo, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  DropdownProps,\n  Select,\n  SelectOption,\n  SelectVariant,\n  Split,\n  SplitItem,\n  TextInput,\n  TextInputProps,\n} from \"@patternfly/react-core\";\n\nexport type Unit = \"second\" | \"minute\" | \"hour\" | \"day\";\n\ntype TimeUnit = { unit: Unit; label: string; multiplier: number };\n\nconst allTimes: TimeUnit[] = [\n  { unit: \"second\", label: \"times.seconds\", multiplier: 1 },\n  { unit: \"minute\", label: \"times.minutes\", multiplier: 60 },\n  { unit: \"hour\", label: \"times.hours\", multiplier: 3600 },\n  { unit: \"day\", label: \"times.days\", multiplier: 86400 },\n];\n\nexport type TimeSelectorProps = TextInputProps &\n  Pick<DropdownProps, \"menuAppendTo\"> & {\n    value: number;\n    units?: Unit[];\n    onChange: (time: number | string) => void;\n    className?: string;\n  };\n\nexport const getTimeUnit = (value: number) =>\n  allTimes.reduce(\n    (v, time) =>\n      value % time.multiplier === 0 && v.multiplier < time.multiplier\n        ? time\n        : v,\n    allTimes[0]\n  );\n\nexport const toHumanFormat = (value: number, locale: string) => {\n  const timeUnit = getTimeUnit(value);\n  const formatter = new Intl.NumberFormat(locale, {\n    style: \"unit\",\n    unit: timeUnit.unit,\n    unitDisplay: \"long\",\n  });\n  return formatter.format(value / timeUnit.multiplier);\n};\n\nexport const TimeSelector = ({\n  value,\n  units = [\"second\", \"minute\", \"hour\", \"day\"],\n  onChange,\n  className,\n  min,\n  menuAppendTo,\n  ...rest\n}: TimeSelectorProps) => {\n  const { t } = useTranslation(\"common\");\n\n  const times = useMemo(\n    () => units.map((unit) => allTimes.find((time) => time.unit === unit)!),\n    [units]\n  );\n\n  const defaultMultiplier = useMemo(\n    () => allTimes.find((time) => time.unit === units[0])?.multiplier,\n    [units]\n  );\n\n  const [timeValue, setTimeValue] = useState<\"\" | number>(\"\");\n  const [multiplier, setMultiplier] = useState(defaultMultiplier);\n  const [open, setOpen] = useState(false);\n\n  useEffect(() => {\n    const multiplier = getTimeUnit(value).multiplier;\n\n    if (value) {\n      setMultiplier(multiplier);\n      setTimeValue(value / multiplier);\n    } else {\n      setTimeValue(value);\n      setMultiplier(defaultMultiplier);\n    }\n  }, [value]);\n\n  const updateTimeout = (\n    timeout: \"\" | number,\n    times: number | undefined = multiplier\n  ) => {\n    if (timeout !== \"\") {\n      onChange(timeout * (times || 1));\n      setTimeValue(timeout);\n    } else {\n      onChange(\"\");\n    }\n  };\n\n  return (\n    <Split hasGutter className={className}>\n      <SplitItem>\n        <TextInput\n          {...rest}\n          type=\"number\"\n          aria-label=\"kc-time\"\n          min={min || 0}\n          value={timeValue}\n          className={`${className}-input`}\n          onChange={(value) => {\n            updateTimeout(\"\" === value ? value : parseInt(value));\n          }}\n        />\n      </SplitItem>\n      <SplitItem id={`${className}-select-menu`}>\n        <Select\n          variant={SelectVariant.single}\n          aria-label={t(\"unitLabel\")}\n          className={`${className}-select`}\n          onSelect={(_, value) => {\n            setMultiplier(value as number);\n            updateTimeout(timeValue, value as number);\n            setOpen(false);\n          }}\n          menuAppendTo={menuAppendTo}\n          selections={[multiplier]}\n          onToggle={() => {\n            setOpen(!open);\n          }}\n          isOpen={open}\n          isDisabled={rest.isDisabled}\n        >\n          {times.map((time) => (\n            <SelectOption\n              id={time.label}\n              key={time.label}\n              value={time.multiplier}\n            >\n              {t(time.label)}\n            </SelectOption>\n          ))}\n        </Select>\n      </SplitItem>\n    </Split>\n  );\n};\n"],"names":["allTimes","getTimeUnit","value","v","time","toHumanFormat","locale","timeUnit","TimeSelector","units","onChange","className","min","menuAppendTo","rest","t","useTranslation","times","useMemo","unit","defaultMultiplier","timeValue","setTimeValue","useState","multiplier","setMultiplier","open","setOpen","useEffect","updateTimeout","timeout","jsxs","Split","jsx","SplitItem","TextInput","Select","SelectVariant","_","SelectOption"],"mappings":"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"}