{"version":3,"file":"DetailProvider-bb073b03.js","sources":["../../src/clients/registration/DetailProvider.tsx"],"sourcesContent":["import ComponentRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentRepresentation\";\nimport ComponentTypeRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentTypeRepresentation\";\nimport {\n  ActionGroup,\n  Button,\n  ButtonVariant,\n  DropdownItem,\n  FormGroup,\n  PageSection,\n  ValidatedOptions,\n} from \"@patternfly/react-core\";\nimport { useState } from \"react\";\nimport { FormProvider, useForm, useWatch } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport { useAlerts } from \"../../components/alert/Alerts\";\nimport { useConfirmDialog } from \"../../components/confirm-dialog/ConfirmDialog\";\nimport { DynamicComponents } from \"../../components/dynamic/DynamicComponents\";\nimport { FormAccess } from \"../../components/form-access/FormAccess\";\nimport { HelpItem } from \"ui-shared\";\nimport { KeycloakSpinner } from \"../../components/keycloak-spinner/KeycloakSpinner\";\nimport { KeycloakTextInput } from \"../../components/keycloak-text-input/KeycloakTextInput\";\nimport { ViewHeader } from \"../../components/view-header/ViewHeader\";\nimport { useAdminClient, useFetch } from \"../../context/auth/AdminClient\";\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\nimport { useParams } from \"../../utils/useParams\";\nimport {\n  RegistrationProviderParams,\n  toRegistrationProvider,\n} from \"../routes/AddRegistrationProvider\";\nimport { toClientRegistration } from \"../routes/ClientRegistration\";\n\nexport default function DetailProvider() {\n  const { t } = useTranslation(\"clients\");\n  const { id, providerId, subTab } = useParams<RegistrationProviderParams>();\n  const navigate = useNavigate();\n  const form = useForm<ComponentRepresentation>({\n    defaultValues: { providerId },\n  });\n  const {\n    register,\n    control,\n    handleSubmit,\n    reset,\n    formState: { errors },\n  } = form;\n\n  const { adminClient } = useAdminClient();\n  const { realm } = useRealm();\n  const { addAlert, addError } = useAlerts();\n  const [provider, setProvider] = useState<ComponentTypeRepresentation>();\n  const [parentId, setParentId] = useState(\"\");\n\n  useFetch(\n    async () =>\n      await Promise.all([\n        adminClient.realms.getClientRegistrationPolicyProviders({ realm }),\n        adminClient.realms.findOne({ realm }),\n        id ? adminClient.components.findOne({ id }) : Promise.resolve(),\n      ]),\n    ([providers, realm, data]) => {\n      setProvider(providers.find((p) => p.id === providerId));\n      setParentId(realm?.id || \"\");\n      reset(data || { providerId });\n    },\n    []\n  );\n\n  const providerName = useWatch({ control, defaultValue: \"\", name: \"name\" });\n\n  const onSubmit = async (component: ComponentRepresentation) => {\n    if (component.config)\n      Object.entries(component.config).forEach(\n        ([key, value]) =>\n          (component.config![key] = Array.isArray(value) ? value : [value])\n      );\n    try {\n      const updatedComponent = {\n        ...component,\n        subType: subTab,\n        parentId,\n        providerType:\n          \"org.keycloak.services.clientregistration.policy.ClientRegistrationPolicy\",\n        providerId,\n      };\n      if (id) {\n        await adminClient.components.update({ id }, updatedComponent);\n      } else {\n        const { id } = await adminClient.components.create(updatedComponent);\n        navigate(toRegistrationProvider({ id, realm, subTab, providerId }));\n      }\n      addAlert(t(`provider${id ? \"Updated\" : \"Create\"}Success`));\n    } catch (error) {\n      addError(`clients:provider${id ? \"Updated\" : \"Create\"}Error`, error);\n    }\n  };\n\n  const [toggleDeleteDialog, DeleteConfirm] = useConfirmDialog({\n    titleKey: \"clients:clientRegisterPolicyDeleteConfirmTitle\",\n    messageKey: t(\"clientRegisterPolicyDeleteConfirm\", {\n      name: providerName,\n    }),\n    continueButtonLabel: \"common:delete\",\n    continueButtonVariant: ButtonVariant.danger,\n    onConfirm: async () => {\n      try {\n        await adminClient.components.del({\n          realm,\n          id: id!,\n        });\n        addAlert(t(\"clientRegisterPolicyDeleteSuccess\"));\n        navigate(toClientRegistration({ realm, subTab }));\n      } catch (error) {\n        addError(\"clients:clientRegisterPolicyDeleteError\", error);\n      }\n    },\n  });\n\n  if (!provider) {\n    return <KeycloakSpinner />;\n  }\n\n  return (\n    <>\n      <ViewHeader\n        titleKey={id ? providerName! : \"clients:createPolicy\"}\n        subKey={id}\n        dropdownItems={\n          id\n            ? [\n                <DropdownItem\n                  data-testid=\"delete\"\n                  key=\"delete\"\n                  onClick={toggleDeleteDialog}\n                >\n                  {t(\"common:delete\")}\n                </DropdownItem>,\n              ]\n            : undefined\n        }\n      />\n      <DeleteConfirm />\n      <PageSection variant=\"light\">\n        <FormAccess\n          role=\"manage-clients\"\n          isHorizontal\n          onSubmit={handleSubmit(onSubmit)}\n        >\n          <FormGroup label={t(\"provider\")} fieldId=\"provider\">\n            <KeycloakTextInput\n              id=\"providerId\"\n              data-testid=\"providerId\"\n              {...register(\"providerId\")}\n              readOnly\n            />\n          </FormGroup>\n          <FormGroup\n            label={t(\"common:name\")}\n            fieldId=\"kc-name\"\n            helperTextInvalid={t(\"common:required\")}\n            validated={\n              errors.name ? ValidatedOptions.error : ValidatedOptions.default\n            }\n            labelIcon={\n              <HelpItem\n                helpText={t(\"clients-help:clientPolicyName\")}\n                fieldLabelId=\"kc-name\"\n              />\n            }\n            isRequired\n          >\n            <KeycloakTextInput\n              id=\"kc-name\"\n              data-testid=\"name\"\n              validated={\n                errors.name ? ValidatedOptions.error : ValidatedOptions.default\n              }\n              {...register(\"name\", { required: true })}\n            />\n          </FormGroup>\n          <FormProvider {...form}>\n            <DynamicComponents properties={provider.properties} />\n          </FormProvider>\n          <ActionGroup>\n            <Button data-testid=\"save\" type=\"submit\">\n              {t(\"common:save\")}\n            </Button>\n            <Button\n              variant=\"link\"\n              component={(props) => (\n                <Link\n                  {...props}\n                  to={toClientRegistration({ realm, subTab })}\n                ></Link>\n              )}\n            >\n              {t(\"common:cancel\")}\n            </Button>\n          </ActionGroup>\n        </FormAccess>\n      </PageSection>\n    </>\n  );\n}\n"],"names":["DetailProvider","useTranslation","id","providerId","subTab","useParams","navigate","useNavigate","form","useForm","register","control","handleSubmit","reset","errors","adminClient","useAdminClient","realm","useRealm","addAlert","addError","useAlerts","provider","setProvider","useState","parentId","setParentId","useFetch","providers","data","p","providerName","useWatch","onSubmit","component","key","value","updatedComponent","toRegistrationProvider","error","toggleDeleteDialog","DeleteConfirm","useConfirmDialog","ButtonVariant","toClientRegistration","jsxs","Fragment","jsx","ViewHeader","DropdownItem","PageSection","FormAccess","FormGroup","KeycloakTextInput","ValidatedOptions","HelpItem","FormProvider","DynamicComponents","ActionGroup","Button","props","Link","KeycloakSpinner"],"mappings":"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"}