import{u as D,r as S,j as e,F as I,G as P,V as m,C as O,f as N,e as U,b as G,c as R,d as H,k as _,A as T,bL as F,n as $,X as z,P as X,w as J,g as Q,B as V,L as W,s as Y,bN as Z,q as ee}from"./index-a3421f29.js";import{u as re}from"./ConfirmDialog-09ff7a12.js";import{D as te}from"./DynamicComponents-72877b30.js";import{F as ae}from"./FormAccess-1cceaef6.js";import{K as L}from"./KeycloakTextInput-e7f6e917.js";import{V as ie}from"./ViewHeader-832ec56e.js";import{u as se,m as oe}from"./useLocaleSort-3efc7c31.js";import{u as ne}from"./useParams-5abeab7d.js";import{S as k,a as w,b as A}from"./Select-0f56a9cc.js";import{A as de}from"./Form-518a2cf2.js";import"./Modal-21c37af7.js";import"./ClientSelect-3f0fc581.js";import"./FileUpload-ca37c1a6.js";import"./CodeEditor-2fb93648.js";import"./copy-icon-a4fe01af.js";import"./EmptyStateBody-7b4fcee1.js";import"./EmptyStateSecondaryActions-08edafb5.js";import"./GroupPickerDialog-caf8c38d.js";import"./PaginatingTableToolbar-08ca9efb.js";import"./plus-circle-icon-cb854796.js";import"./TableToolbar-ee0c86ef.js";import"./ToolbarContent-7b435752.js";import"./DataListItemRow-75e02946.js";import"./data-list-7d55714c.js";import"./grip-vertical-icon-cbeff50f.js";import"./ActionListItem-ab1a4322.js";import"./FlexItem-65b5f999.js";import"./minus-circle-icon-6f9a971c.js";import"./MultiLineInput-14187d1c.js";import"./PasswordInput-85f9399f.js";import"./useToggle-a9cb2c55.js";import"./AddRoleMappingModal-abb19beb.js";import"./KeycloakDataTable-10a62d94.js";import"./Td-6d4ab209.js";import"./star-icon-6a7e7d25.js";import"./check-fc57dbe1.js";import"./Checkbox-d00621d8.js";import"./resource-08ae7dbc.js";import"./joinPath-55fd24bc.js";import"./filter-icon-9d72dc58.js";import"./KeycloakTextArea-1b518857.js";import"./GridItem-d34dae2e.js";import"./Text-564bf299.js";const pe=({mapperTypes:r,mapperType:c,form:C,id:M,updateMapperType:g})=>{const{t:a}=D("identity-providers"),{control:y,register:h,formState:{errors:j}}=C,[v,l]=S.useState(!1),i=["inherit","import","legacy","force"],[d,s]=S.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(I,{label:a("common:name"),labelIcon:e.jsx(P,{helpText:a("identity-providers-help:addIdpMapperName"),fieldLabelId:"name"}),fieldId:"kc-name",isRequired:!0,validated:j.name?m.error:m.default,helperTextInvalid:a("common:required"),children:e.jsx(L,{id:"kc-name",isDisabled:!!M,validated:j.name?m.error:m.default,...h("name",{required:!0})})}),e.jsx(I,{label:a("syncModeOverride"),isRequired:!0,labelIcon:e.jsx(P,{helpText:a("identity-providers-help:syncModeOverride"),fieldLabelId:"identity-providers:syncModeOverride"}),fieldId:"syncMode",children:e.jsx(O,{name:"config.syncMode",defaultValue:i[0].toUpperCase(),control:y,render:({field:p})=>e.jsx(k,{toggleId:"syncMode","datatest-id":"syncmode-select",required:!0,direction:"down",onToggle:()=>s(!d),onSelect:(t,o)=>{p.onChange(o.toString().toUpperCase()),s(!1)},selections:a(`syncModes.${p.value.toLowerCase()}`),variant:w.single,"aria-label":a("syncMode"),isOpen:d,children:i.map(t=>e.jsx(A,{selected:t===p.value,"data-testid":t,value:t.toUpperCase(),children:a(`syncModes.${t}`)},t))})})}),e.jsx(I,{label:a("mapperType"),labelIcon:e.jsx(P,{helpText:c.helpText,fieldLabelId:"identity-providers:mapperType"}),fieldId:"identityProviderMapper",children:e.jsx(O,{name:"identityProviderMapper",defaultValue:r[0].id,control:y,render:({field:p})=>e.jsx(k,{toggleId:"identityProviderMapper","data-testid":"idp-mapper-select",isDisabled:!!M,required:!0,onToggle:()=>l(!v),onSelect:(t,o)=>{const f=o;g(f),p.onChange(f.id),l(!1)},selections:c.name,variant:w.single,"aria-label":a("mapperType"),isOpen:v,children:r.map(t=>e.jsx(A,{selected:t===p.value,"datatest-id":t.id,value:t,children:t.name},t.name))})})})]})};function Ze(){const{t:r}=D("identity-providers"),c=N(),{handleSubmit:C,register:M,formState:{errors:g}}=c,{addAlert:a,addError:y}=U(),h=G(),j=se(),{realm:v}=R(),{adminClient:l}=H(),{id:i,providerId:d,alias:s}=ne(),[p,t]=S.useState(),[o,f]=S.useState(),q=async n=>{const b=Y(n),x={...b,config:{...b.config},identityProviderAlias:s};if(i)try{await l.identityProviders.updateMapper({id:i,alias:s},{...x,name:o?.name}),a(r("mapperSaveSuccess"),T.success)}catch(u){y(r("mapperSaveError"),u)}else try{const u=await l.identityProviders.createMapper({identityProviderMapper:x,alias:s});a(r("mapperCreateSuccess"),T.success),h(Z({realm:v,alias:s,providerId:d,id:u.id}))}catch(u){y(r("mapperCreateError"),u)}},[E,K]=re({titleKey:"identity-providers:deleteProviderMapper",messageKey:r("identity-providers:deleteMapperConfirm",{mapper:o?.name}),continueButtonLabel:"common:delete",continueButtonVariant:_.danger,onConfirm:async()=>{try{await l.identityProviders.delMapper({alias:s,id:i}),a(r("deleteMapperSuccess"),T.success),h(F({providerId:d,alias:s,tab:"mappers",realm:v}))}catch(n){y("identity-providers:deleteErrorError",n)}}});$(()=>Promise.all([i?l.identityProviders.findOneMapper({alias:s,id:i}):null,l.identityProviders.findMapperTypes({alias:s})]),([n,b])=>{const x=j(Object.values(b),oe("name"));n?(f(x.find(({id:u})=>u===n.identityProviderMapper)),B(n)):f(x[0]),t(x)},[]);const B=n=>{ee(n,c.setValue)};return!p||!o?e.jsx(z,{}):e.jsxs(X,{variant:"light",children:[e.jsx(K,{}),e.jsx(ie,{className:"kc-add-mapper-title",titleKey:i?r("editIdPMapper",{providerId:d[0].toUpperCase()+d.substring(1)}):r("addIdPMapper",{providerId:d[0].toUpperCase()+d.substring(1)}),dropdownItems:i?[e.jsx(J,{onClick:E,children:r("common:delete")},"delete")]:void 0,divider:!0}),e.jsxs(ae,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:C(q),className:"pf-u-mt-lg",children:[i&&e.jsx(I,{label:r("common:id"),fieldId:"kc-name",validated:g.name?m.error:m.default,helperTextInvalid:r("common:required"),children:e.jsx(L,{value:o.id,id:"kc-name",isDisabled:!!i,validated:g.name?m.error:m.default,...M("name")})}),o.properties&&e.jsxs(e.Fragment,{children:[e.jsx(pe,{form:c,id:i,mapperTypes:p,updateMapperType:f,mapperType:o}),e.jsx(Q,{...c,children:e.jsx(te,{properties:o.properties})})]}),e.jsxs(de,{children:[e.jsx(V,{"data-testid":"new-mapper-save-button",variant:"primary",type:"submit",children:r("common:save")}),e.jsx(V,{"data-testid":"new-mapper-cancel-button",variant:"link",component:n=>e.jsx(W,{...n,to:F({realm:v,providerId:d,alias:s,tab:"mappers"})}),children:r("common:cancel")})]})]})]})}export{Ze as default};
//# sourceMappingURL=AddMapper-6ffeb7ed.js.map
