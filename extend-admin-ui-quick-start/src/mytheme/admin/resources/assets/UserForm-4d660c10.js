import{az as B,c as $,d as R,r as x,n as w,j as e,B as F,L as ie,dn as te,u as T,a as L,F as u,C,G as S,b as oe,e as le,cX as de,S as _,M as ce,A as M}from"./index-a3421f29.js";import{F as me}from"./FormAccess-1cceaef6.js";import{G as ue}from"./GroupPickerDialog-caf8c38d.js";import{K as j}from"./KeycloakTextInput-e7f6e917.js";import{u as pe}from"./useFormatDate-7fddef56.js";import{u as fe,F as he}from"./useIsFeatureEnabled-1df1a04b.js";import{S as xe}from"./ScrollForm-a21fd695.js";import{u as je}from"./UserProfileContext-1adc9dc8.js";import{u as ge}from"./useToggle-a9cb2c55.js";import{F as ve,A as ke}from"./Form-518a2cf2.js";import{T as be}from"./Text-564bf299.js";import{S as K,b as q,a as Ie,C as Ae,c as ye}from"./Select-0f56a9cc.js";const Se=({user:s})=>{const o=B(),{realm:t}=$(),{adminClient:i}=R(),[l,a]=x.useState();return w(()=>o.hasAccess("view-realm")?i.components.findOne({id:s.federationLink||s.origin}):i.userStorageProvider.name({id:s.federationLink||s.origin}),a,[]),l?e.jsx(F,{variant:"link",isDisabled:!o.hasAccess("view-realm"),component:f=>e.jsx(ie,{...f,to:te({id:l.id,realm:t})}),children:l.name}):null},Te=["username","firstName","lastName","email"],G=["admin","user"];function Be(s){return!!s.responseData.errors}function $e(s){return s.responseData.errors?.map(o=>o.errorMessage).join(`
`)||""}const Fe=({roles:s=["admin"]})=>{const{t:o}=T("realm-settings"),{config:t}=je();return e.jsx(xe,{sections:[{name:""},...t?.groups||[]].map(i=>({title:i.name||o("general"),panel:e.jsxs(ve,{children:[i.displayDescription&&e.jsx(be,{className:"pf-u-pb-lg",children:i.displayDescription}),t?.attributes?.map(l=>e.jsx(x.Fragment,{children:(l.group||"")===i.name&&(l.permissions?.view||G).some(a=>s.includes(a))&&e.jsx(Le,{attribute:l,roles:s})},l.name))]})}))})},Le=({attribute:s,roles:o})=>{const{t}=T("users"),{formState:{errors:i},register:l,control:a}=L(),[f,g]=ge(),b=r=>r?.includes("${"),I=r=>r.substring(2,r.length-1),c=r=>Object.hasOwn(r.validations||{},"options"),d=r=>r&&Te.includes(r),m=r=>Object.keys(r||{}).length!==0,h=r=>`${d(r.name)?"":"attributes."}${r.name}`;return e.jsx(u,{label:(b(s.displayName)?t(I(s.displayName)):s.displayName)||s.name,fieldId:s.name,isRequired:m(s.required),validated:i.username?"error":"default",helperTextInvalid:t("common:required"),children:c(s)?e.jsx(C,{name:h(s),defaultValue:"",control:a,render:({field:r})=>e.jsx(K,{toggleId:s.name,onToggle:g,onSelect:(p,v)=>{r.onChange(v.toString()),g()},selections:r.value,variant:"single","aria-label":t("common:selectOne"),isOpen:f,isDisabled:!(s.permissions?.edit||G).some(p=>o.includes(p)),children:[e.jsx(q,{value:"",children:t("common:choose")},"empty"),...(s.validations?.options).options.map(p=>e.jsx(q,{selected:r.value===p,value:p,children:p},p))]})}):e.jsx(j,{id:s.name,isDisabled:!(s.permissions?.edit||G).some(r=>o.includes(r)),...l(h(s))})},s.name)},Ce=({name:s,label:o,help:t})=>{const{t:i}=T("users"),{adminClient:l}=R(),{control:a}=L(),[f,g]=x.useState(!1),[b,I]=x.useState([]);return w(()=>l.authenticationManagement.getRequiredActions(),c=>{const d=c.filter(m=>m.enabled);I(d)},[]),e.jsx(u,{label:i(o),labelIcon:e.jsx(S,{helpText:i(t),fieldLabelId:"resetActions"}),fieldId:"actions",children:e.jsx(C,{name:s,defaultValue:[],control:a,render:({field:c})=>e.jsx(K,{maxHeight:375,toggleId:`${s}-actions`,variant:Ie.typeaheadMulti,chipGroupProps:{numChips:3},placeholderText:i("requiredActionPlaceholder"),menuAppendTo:"parent",onToggle:d=>g(d),isOpen:f,selections:c.value,onSelect:(d,m)=>c.onChange(c.value.find(h=>h===m)?c.value.filter(h=>h!==m):[...c.value,m]),onClear:d=>{d.stopPropagation(),c.onChange([])},typeAheadAriaLabel:i("resetActions"),children:b.map(({alias:d,name:m})=>e.jsx(q,{value:d,"data-testid":`${d}-option`,children:m},d))})})})},V=()=>{const{t:s}=T("users"),{control:o}=L();return e.jsx(u,{label:s("emailVerified"),fieldId:"kc-email-verified",helperTextInvalid:s("common:required"),labelIcon:e.jsx(S,{helpText:s("users-help:emailVerified"),fieldLabelId:"users:emailVerified"}),children:e.jsx(C,{name:"emailVerified",defaultValue:!1,control:o,render:({field:t})=>e.jsx(_,{"data-testid":"email-verified-switch",id:"kc-user-email-verified",onChange:i=>t.onChange(i),isChecked:t.value,label:s("common:yes"),labelOff:s("common:no")})})})},_e=({user:s,bruteForce:{isBruteForceProtected:o,isLocked:t}={isBruteForceProtected:!1,isLocked:!1},save:i,onGroupsUpdate:l})=>{const{t:a}=T("users"),{realm:f}=$(),g=pe(),b=fe(),I=oe(),{adminClient:c}=R(),{addAlert:d,addError:m}=le(),{hasAccess:h}=B(),r=h("manage-users"),{handleSubmit:p,register:v,watch:z,control:H,reset:W,formState:{errors:A}}=L(),X=z("username"),[k,E]=x.useState([]),[O,N]=x.useState(!1),[U,J]=x.useState(t),[y,Q]=x.useState();w(()=>c.realms.findOne({realm:f}),n=>{if(!n)throw new Error(a("common:notFound"));Q(n)},[]);const Y=async()=>{try{await c.attackDetection.del({id:s.id}),d(a("unlockSuccess"),M.success)}catch(n){m("users:unlockError",n)}},Z=n=>{E(k.filter(P=>P.name!==n)),l?.(k)},ee=async n=>{E([...k,...n]),l?.([...k,...n])},se=async n=>{n.forEach(async re=>{try{await c.users.addToGroup({id:s.id,groupId:re.id}),d(a("users:addedGroupMembership"),M.success)}catch(ne){m("users:addedGroupMembershipError",ne)}})},ae=()=>{N(!O)},D=b(he.DeclarativeUserProfile)&&y?.attributes?.userProfileEnabled==="true";return e.jsxs(me,{isHorizontal:!0,onSubmit:p(i),role:"query-users",fineGrainedAccess:s?.access?.manage,className:"pf-u-mt-lg",children:[O&&e.jsx(ue,{type:"selectMany",text:{title:"users:selectGroups",ok:"users:join"},canBrowse:r,onConfirm:n=>{s?.id?se(n||[]):ee(n||[]),N(!1)},onClose:()=>N(!1),filterGroups:k}),D&&e.jsx(V,{}),s?.id&&e.jsxs(e.Fragment,{children:[e.jsx(u,{label:a("common:id"),fieldId:"kc-id",isRequired:!0,children:e.jsx(j,{id:s.id,"aria-label":a("userID"),value:s.id,type:"text",isReadOnly:!0})}),e.jsx(u,{label:a("createdAt"),fieldId:"kc-created-at",isRequired:!0,children:e.jsx(j,{value:g(new Date(s.createdTimestamp)),type:"text",id:"kc-created-at","aria-label":a("createdAt"),name:"createdTimestamp",isReadOnly:!0})})]}),e.jsx(Ce,{name:"requiredActions",label:"requiredUserActions",help:"users-help:requiredUserActions"}),(s?.federationLink||s?.origin)&&e.jsx(u,{label:a("federationLink"),labelIcon:e.jsx(S,{helpText:a("users-help:federationLink"),fieldLabelId:"users:federationLink"}),children:e.jsx(Se,{user:s})}),D?e.jsx(Fe,{}):e.jsxs(e.Fragment,{children:[!y?.registrationEmailAsUsername&&e.jsx(u,{label:a("username"),fieldId:"kc-username",isRequired:!0,validated:A.username?"error":"default",helperTextInvalid:a("common:required"),children:e.jsx(j,{id:"kc-username",isReadOnly:!!s?.id&&!y?.editUsernameAllowed&&y?.editUsernameAllowed!==void 0,...v("username")})}),e.jsx(u,{label:a("email"),fieldId:"kc-email",validated:A.email?"error":"default",helperTextInvalid:a("users:emailInvalid"),children:e.jsx(j,{type:"email",id:"kc-email","data-testid":"email-input",...v("email",{pattern:de})})}),e.jsx(V,{}),e.jsx(u,{label:a("firstName"),fieldId:"kc-firstName",validated:A.firstName?"error":"default",helperTextInvalid:a("common:required"),children:e.jsx(j,{"data-testid":"firstName-input",id:"kc-firstName",...v("firstName")})}),e.jsx(u,{label:a("lastName"),fieldId:"kc-lastName",validated:A.lastName?"error":"default",children:e.jsx(j,{"data-testid":"lastName-input",id:"kc-lastname","aria-label":a("lastName"),...v("lastName")})})]}),o&&e.jsx(u,{label:a("temporaryLocked"),fieldId:"temporaryLocked",labelIcon:e.jsx(S,{helpText:a("users-help:temporaryLocked"),fieldLabelId:"users:temporaryLocked"}),children:e.jsx(_,{"data-testid":"user-locked-switch",id:"temporaryLocked",onChange:n=>{Y(),J(n)},isChecked:U,isDisabled:!U,label:a("common:on"),labelOff:a("common:off")})}),!s?.id&&e.jsx(u,{label:a("common:groups"),fieldId:"kc-groups",validated:A.requiredActions?"error":"default",helperTextInvalid:a("common:required"),labelIcon:e.jsx(S,{helpText:a("users-help:groups"),fieldLabelId:"groups"}),children:e.jsx(C,{name:"groups",defaultValue:[],control:H,render:()=>e.jsxs(ce,{children:[e.jsx(Ae,{categoryName:" ",children:k.map(n=>e.jsx(ye,{onClick:()=>Z(n.name),children:n.path},n.id))}),e.jsx(F,{id:"kc-join-groups-button",onClick:ae,variant:"secondary","data-testid":"join-groups-button",children:a("users:joinGroups")})]})})}),e.jsxs(ke,{children:[e.jsx(F,{"data-testid":s?.id?"save-user":"create-user",isDisabled:!s?.id&&!X&&!y?.registrationEmailAsUsername,variant:"primary",type:"submit",children:s?.id?a("common:save"):a("common:create")}),e.jsx(F,{"data-testid":"cancel-create-user",onClick:()=>s?.id?W(s):I(`/${f}/users`),variant:"link",children:s?.id?a("common:revert"):a("common:cancel")})]})]})};export{Se as F,Ce as R,_e as U,Be as i,$e as u};
//# sourceMappingURL=UserForm-4d660c10.js.map
